<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.0.0"/>
    <title>dlc2action.data.annotation_store API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../data.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;dlc2action.data</a>

            <img src="https://i.ibb.co/tKsQMZb/main.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#EmptyAnnotationStore">EmptyAnnotationStore</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.__init__">EmptyAnnotationStore</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.remove">remove</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.key_objects">key_objects</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.load_from_key_objects">load_from_key_objects</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.to_ram">to_ram</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.get_original_coordinates">get_original_coordinates</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.create_subsample">create_subsample</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.get_file_ids">get_file_ids</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.get_len">get_len</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.get_idx">get_idx</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.count_classes">count_classes</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.behaviors_dict">behaviors_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.annotation_class">annotation_class</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.size">size</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.filtered_indices">filtered_indices</a>
                        </li>
                        <li>
                                <a class="function" href="#EmptyAnnotationStore.set_pseudo_labels">set_pseudo_labels</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ActionSegmentationStore">ActionSegmentationStore</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ActionSegmentationStore.__init__">ActionSegmentationStore</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.remove">remove</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.key_objects">key_objects</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.load_from_key_objects">load_from_key_objects</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.to_ram">to_ram</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.get_original_coordinates">get_original_coordinates</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.create_subsample">create_subsample</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.get_len">get_len</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.get_indices">get_indices</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.count_classes">count_classes</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.behaviors_dict">behaviors_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.annotation_class">annotation_class</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.size">size</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.filtered_indices">filtered_indices</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.set_pseudo_labels">set_pseudo_labels</a>
                        </li>
                        <li>
                                <a class="function" href="#ActionSegmentationStore.get_file_ids">get_file_ids</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#FileAnnotationStore">FileAnnotationStore</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#SequenceAnnotationStore">SequenceAnnotationStore</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SequenceAnnotationStore.get_file_ids">get_file_ids</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DLCAnnotationStore">DLCAnnotationStore</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#BorisAnnotationStore">BorisAnnotationStore</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#BorisAnnotationStore.__init__">BorisAnnotationStore</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PKUMMDAnnotationStore">PKUMMDAnnotationStore</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PKUMMDAnnotationStore.__init__">PKUMMDAnnotationStore</a>
                        </li>
                        <li>
                                <a class="function" href="#PKUMMDAnnotationStore.get_file_ids">get_file_ids</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CalMS21AnnotationStore">CalMS21AnnotationStore</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CalMS21AnnotationStore.__init__">CalMS21AnnotationStore</a>
                        </li>
                        <li>
                                <a class="function" href="#CalMS21AnnotationStore.get_file_ids">get_file_ids</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CSVAnnotationStore">CSVAnnotationStore</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CSVAnnotationStore.__init__">CSVAnnotationStore</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SIMBAAnnotationStore">SIMBAAnnotationStore</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SIMBAAnnotationStore.__init__">SIMBAAnnotationStore</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../dlc2action.html">dlc2action</a><wbr>.<a href="./../data.html">data</a><wbr>.annotation_store    </h1>

                        <div class="docstring"><p>Specific implementations of <code><a href="base_store.html#AnnotationStore">dlc2action.data.base_store.AnnotationStore</a></code> are defined here</p>
</div>

                        <input id="annotation_store-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="annotation_store-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="c1">#</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="c1"># Copyright 2020-2022 by A. Mathis Group and contributors. All rights reserved.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="c1">#</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="c1"># This project and all its files are licensed under GNU AGPLv3 or later version. A copy is included in dlc2action/LICENSE.AGPL.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="c1">#</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">Specific implementations of `dlc2action.data.base_store.AnnotationStore` are defined here</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">from</span> <span class="nn">dlc2action.data.base_store</span> <span class="kn">import</span> <span class="n">AnnotationStore</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">from</span> <span class="nn">dlc2action.utils</span> <span class="kn">import</span> <span class="n">strip_suffix</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="k">class</span> <span class="nc">EmptyAnnotationStore</span><span class="p">(</span><span class="n">AnnotationStore</span><span class="p">):</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>    <span class="p">):</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">        Parameters</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">        ----------</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>        <span class="k">pass</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">        Get the number of available samples</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">        Returns</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">        -------</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">        length : int</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">            the number of available samples</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">        Remove the samples corresponding to indices</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="sd">        Parameters</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">        ----------</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="sd">        indices : int</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">            a list of integer indices to remove</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>        <span class="k">pass</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>    <span class="k">def</span> <span class="nf">key_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">        Return a tuple of the key objects necessary to re-create the Store</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">        Returns</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">        -------</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">        key_objects : tuple</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>        <span class="k">return</span> <span class="p">()</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>    <span class="k">def</span> <span class="nf">load_from_key_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">        Load the information from a tuple of key objects</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">        Parameters</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">        ----------</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">        key_objects : tuple</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>        <span class="k">pass</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>    <span class="k">def</span> <span class="nf">to_ram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">        Transfer the data samples to RAM if they were previously stored as file paths</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>        <span class="k">pass</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>    <span class="k">def</span> <span class="nf">get_original_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="sd">        Return the original coordinates array</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="sd">        Returns</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="sd">        -------</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="sd">        np.ndarray</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="sd">            an array that contains the coordinates of the data samples in original input data (video id, clip id,</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="sd">            start frame)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>    <span class="k">def</span> <span class="nf">create_subsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">ssl_indices</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">        Create a new store that contains a subsample of the data</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="sd">        Parameters</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">        ----------</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">        indices : list</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="sd">            the indices to be included in the subsample</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">        ssl_indices : list, optional</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">            the indices to be included in the subsample without the annotation data</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">        Returns</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">        -------</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">        video_ids : list</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">            a list of video file ids</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="sd">        Return the annotation of the sample corresponding to an index</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">        Parameters</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">        ----------</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">        ind : int</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">            index of the sample</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="sd">        Returns</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">        -------</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">        sample : torch.Tensor</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">            the corresponding annotation tensor</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">))</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>    <span class="k">def</span> <span class="nf">get_len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">        Get the length of the subsample of labeled/unlabeled data</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">        If return_unlabeled is True, the index is in the subsample of unlabeled data, if False in labeled</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="sd">        and if return_unlabeled is None the index is already correct</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">        Parameters</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">        ----------</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">        return_unlabeled : bool</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">            the identifier for the subsample</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">        Returns</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">        -------</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">        length : int</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">            the length of the subsample</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>    <span class="k">def</span> <span class="nf">get_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">        Convert from an index in the subsample of labeled/unlabeled data to an index in the full array</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">        If return_unlabeled is True, the index is in the subsample of unlabeled data, if False in labeled</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">        and if return_unlabeled is None the index is already correct</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">        Parameters</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">        ----------</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="sd">        index : int</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a><span class="sd">            the index in the subsample</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="sd">        return_unlabeled : bool</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="sd">            the identifier for the subsample</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="sd">        Returns</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">        -------</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">        corrected_index : int</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">            the index in the full dataset</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>        <span class="k">return</span> <span class="n">index</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>    <span class="k">def</span> <span class="nf">count_classes</span><span class="p">(</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">frac</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zeros</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bouts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">        Get a dictionary with class-wise frame counts</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">        Parameters</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">        ----------</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">        frac : bool, default False</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">            if True, a fraction of the total frame count is returned</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">        Returns</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="sd">        -------</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">        count_dictionary : dict</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="sd">            a dictionary with class indices as keys and frame counts as values</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>    <span class="k">def</span> <span class="nf">behaviors_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">        Get a dictionary of class names</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">        Returns</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">        -------</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">        behavior_dictionary: dict</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">            a dictionary with class indices as keys and class names as values</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>    <span class="k">def</span> <span class="nf">annotation_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">        Get the type of annotation (&#39;exclusive_classification&#39;, &#39;nonexclusive_classification&#39;, more coming soon)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">        Returns</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a><span class="sd">        -------</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">        annotation_class : str</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="sd">            the type of annotation</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="k">return</span> <span class="s2">&quot;none&quot;</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">        Get the total number of frames in the data</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">        Returns</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">        -------</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">        size : int</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">            the total number of frames</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>    <span class="k">def</span> <span class="nf">filtered_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">        Return the indices of the samples that should be removed</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">        Choosing the indices can be based on any kind of filering defined in the __init__ function by the data</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">        parameters</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">        Returns</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">        -------</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">        indices_to_remove : list</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">            a list of integer indices that should be removed</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>        <span class="k">return</span> <span class="p">[]</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>    <span class="k">def</span> <span class="nf">set_pseudo_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">        Set pseudo labels to the unlabeled data</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">        Parameters</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a><span class="sd">        ----------</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a><span class="sd">        labels : torch.Tensor</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a><span class="sd">            a tensor of pseudo-labels for the unlabeled data</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>        <span class="k">pass</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="k">class</span> <span class="nc">ActionSegmentationStore</span><span class="p">(</span><span class="n">AnnotationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="sd">    A general realization of an annotation store for action segmentation tasks</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">    Assumes the following file structure:</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="sd">    ```</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">    annotation_path</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="sd">     video1_annotation.pickle</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a><span class="sd">     video2_labels.pickle</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">    ```</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">    Here `annotation_suffix` is `{&#39;_annotation.pickle&#39;, &#39;_labels.pickle&#39;}`.</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>        <span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>        <span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>        <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>        <span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>        <span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>        <span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">        Parameters</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="sd">        ----------</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">        behaviors : set, optional</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="sd">            the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="sd">            loaded from a file)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">        ignored_clips : set, optional</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">            clip ids to ignore</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">            (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">            from key objects)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a><span class="sd">        frame_limit : int, default 0</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a><span class="sd">            the smallest possible length of a clip (shorter clips are discarded)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="sd">        use_hard_negatives : bool, default False</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a><span class="sd">            mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a><span class="sd">        interactive : bool, default False</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="sd">            if `True`, annotation is assigned to pairs of individuals</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>        <span class="k">if</span> <span class="n">ignored_clips</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>            <span class="n">ignored_clips</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">len_segment</span><span class="p">)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">=</span> <span class="n">exclusive</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>        <span class="k">if</span> <span class="n">overlap</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>            <span class="n">overlap</span> <span class="o">=</span> <span class="n">overlap</span> <span class="o">*</span> <span class="n">len_segment</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">overlap</span><span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">video_order</span> <span class="o">=</span> <span class="n">video_order</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span> <span class="o">=</span> <span class="n">min_frames</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span> <span class="o">=</span> <span class="n">max_frames</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="n">visibility</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vis_min_score</span> <span class="o">=</span> <span class="n">visibility_min_score</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vis_min_frac</span> <span class="o">=</span> <span class="n">visibility_min_frac</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_negatives</span> <span class="o">=</span> <span class="n">use_hard_negatives</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">interactive</span> <span class="o">=</span> <span class="n">interactive</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ignored_clips</span> <span class="o">=</span> <span class="n">ignored_clips</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_file_paths</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">)</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ignored_classes</span> <span class="o">=</span> <span class="n">ignored_classes</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_behaviors</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ram</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ann_suffix</span> <span class="o">=</span> <span class="n">annotation_suffix</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_folder</span> <span class="o">=</span> <span class="n">annotation_path</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filter_annotated</span> <span class="o">=</span> <span class="n">filter_annotated</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filter_background</span> <span class="o">=</span> <span class="n">filter_background</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">frame_limit</span> <span class="o">=</span> <span class="n">frame_limit</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">min_frames_action</span> <span class="o">=</span> <span class="n">min_frames_action</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_class</span> <span class="o">=</span> <span class="n">error_class</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>        <span class="k">if</span> <span class="n">correction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>            <span class="n">correction</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">correction</span> <span class="o">=</span> <span class="n">correction</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>        <span class="n">lists</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ann_suffix</span><span class="p">]</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lists</span><span class="p">)):</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>            <span class="n">iterable</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">))</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>            <span class="k">if</span> <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">iterable</span><span class="p">:</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>                    <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>                <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ann_suffix</span> <span class="o">=</span> <span class="n">lists</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>        <span class="k">if</span> <span class="n">ignored_classes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>            <span class="n">ignored_classes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ignored_classes</span> <span class="o">=</span> <span class="n">ignored_classes</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_behaviors</span><span class="p">(</span><span class="n">behaviors</span><span class="p">,</span> <span class="n">ignored_classes</span><span class="p">,</span> <span class="n">behavior_file</span><span class="p">)</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="k">if</span> <span class="n">key_objects</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">()</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>        <span class="k">elif</span> <span class="n">key_objects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_from_key_objects</span><span class="p">(</span><span class="n">key_objects</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">labeled_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_labeled</span><span class="p">()</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The annotation store data has not been initialized!&quot;</span><span class="p">)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The annotation store data has not been initialized!&quot;</span><span class="p">)</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a><span class="sd">        Remove the samples corresponding to indices</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a><span class="sd">        Parameters</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a><span class="sd">        ----------</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a><span class="sd">        indices : list</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a><span class="sd">            a list of integer indices to remove</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>            <span class="n">mask</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>    <span class="k">def</span> <span class="nf">key_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a><span class="sd">        Return a tuple of the key objects necessary to re-create the Store</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="sd">        Returns</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="sd">        -------</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="sd">        key_objects : tuple</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">,</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>        <span class="p">)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>    <span class="k">def</span> <span class="nf">load_from_key_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a><span class="sd">        Load the information from a tuple of key objects</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">        Parameters</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="sd">        ----------</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">        key_objects : tuple</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="p">(</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">,</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="n">key_objects</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">labeled_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_labeled</span><span class="p">()</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>    <span class="k">def</span> <span class="nf">to_ram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a><span class="sd">        Transfer the data samples to RAM if they were previously stored as file paths</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="k">pass</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>    <span class="k">def</span> <span class="nf">get_original_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="sd">        Return the video_indices array</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">        Returns</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a><span class="sd">        -------</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">        original_coordinates : numpy.ndarray</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">            an array that contains the coordinates of the data samples in original input data</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>    <span class="k">def</span> <span class="nf">create_subsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">ssl_indices</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">        Create a new store that contains a subsample of the data</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">        Parameters</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">        ----------</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">        indices : list</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">            the indices to be included in the subsample</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">        ssl_indices : list, optional</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">            the indices to be included in the subsample without the annotation data</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>        <span class="k">if</span> <span class="n">ssl_indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>            <span class="n">ssl_indices</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="n">data</span><span class="p">[</span><span class="n">ssl_indices</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">original_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">[</span><span class="n">indices</span> <span class="o">+</span> <span class="n">ssl_indices</span><span class="p">]</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">indices</span> <span class="o">+</span> <span class="n">ssl_indices</span><span class="p">]</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">labeled_indices</span><span class="p">,</span> <span class="n">new</span><span class="o">.</span><span class="n">unlabeled_indices</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">_compute_labeled</span><span class="p">()</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">behaviors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">len_segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">overlap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">max_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">min_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="k">return</span> <span class="n">new</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>    <span class="k">def</span> <span class="nf">get_len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a><span class="sd">        Get the length of the subsample of labeled/unlabeled data</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a><span class="sd">        If return_unlabeled is True, the index is in the subsample of unlabeled data, if False in labeled</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a><span class="sd">        and if return_unlabeled is None the index is already correct</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a><span class="sd">        Parameters</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a><span class="sd">        ----------</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a><span class="sd">        return_unlabeled : bool</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a><span class="sd">            the identifier for the subsample</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="sd">        Returns</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="sd">        -------</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">        length : int</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a><span class="sd">            the length of the subsample</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The annotation store data has not been initialized!&quot;</span><span class="p">)</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>        <span class="k">elif</span> <span class="n">return_unlabeled</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>        <span class="k">elif</span> <span class="n">return_unlabeled</span><span class="p">:</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_indices</span><span class="p">)</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_indices</span><span class="p">)</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>    <span class="k">def</span> <span class="nf">get_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="sd">        Get a list of indices of samples in the labeled/unlabeled subset</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="sd">        Parameters</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="sd">        ----------</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">        return_unlabeled : bool</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a><span class="sd">            the identifier for the subsample (`True` for unlabeled, `False` for labeled, `None` for the</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="sd">            whole dataset)</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">        Returns</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">        -------</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a><span class="sd">        indices : list</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a><span class="sd">            a list of indices that meet the criteria</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)))</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>    <span class="k">def</span> <span class="nf">count_classes</span><span class="p">(</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">perc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zeros</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bouts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="sd">        Get a dictionary with class-wise frame counts</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="sd">        Parameters</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a><span class="sd">        ----------</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">        perc : bool, default False</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a><span class="sd">            if `True`, a fraction of the total frame count is returned</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a><span class="sd">        zeros : bool, default False</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a><span class="sd">            if `True` and annotation is not exclusive, zero counts are returned</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="sd">        bouts : bool, default False</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="sd">            if `True`, instead of frame counts segment counts are returned</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="sd">        Returns</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="sd">        -------</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a><span class="sd">        count_dictionary : dict</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="sd">            a dictionary with class indices as keys and frame counts as values</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="k">if</span> <span class="n">bouts</span><span class="p">:</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>                <span class="k">for</span> <span class="n">video</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>                    <span class="k">for</span> <span class="n">clip</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>                        <span class="n">length</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_min_frame</span><span class="p">(</span><span class="n">video</span><span class="p">,</span> <span class="n">clip</span><span class="p">)</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>                            <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video</span><span class="si">}</span><span class="s2">---</span><span class="si">{</span><span class="n">clip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>                            <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video</span><span class="si">}</span><span class="s2">---</span><span class="si">{</span><span class="n">clip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>                                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()),</span> <span class="n">length</span><span class="p">)</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>                            <span class="p">)</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>                <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">):</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>                    <span class="n">split</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;---&quot;</span><span class="p">)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>                    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_max_frame</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_min_frame</span><span class="p">(</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>                        <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>                    <span class="p">)</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>                    <span class="n">i</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>                    <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>                    <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>                    <span class="n">data</span><span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="o">...</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">]</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">))</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>            <span class="n">count_dictionary</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">():</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>                    <span class="n">arr</span> <span class="o">=</span> <span class="n">data</span> <span class="o">==</span> <span class="n">c</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>                    <span class="k">if</span> <span class="n">zeros</span><span class="p">:</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>                        <span class="n">arr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>                        <span class="n">arr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>                <span class="n">output</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">unique_consecutive</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>                <span class="n">true_indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">output</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>                <span class="n">count_dictionary</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_indices</span><span class="p">)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>            <span class="n">ind</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>            <span class="k">if</span> <span class="n">zeros</span><span class="p">:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>                <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>                <span class="n">count_dictionary</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()))</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>                <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>                    <span class="n">cnt</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>                    <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>                <span class="n">count_dictionary</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>            <span class="k">if</span> <span class="n">perc</span><span class="p">:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>                <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">count_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>                <span class="n">count_dictionary</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="o">/</span> <span class="n">total</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">count_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">():</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">count_dictionary</span><span class="p">:</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>                <span class="n">count_dictionary</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>        <span class="k">return</span> <span class="n">count_dictionary</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>    <span class="k">def</span> <span class="nf">behaviors_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">        Get a dictionary of class names</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a><span class="sd">        Returns</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="sd">        -------</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="sd">        behavior_dictionary: dict</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">            a dictionary with class indices as keys and class names as values</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>        <span class="c1"># if self.behaviors is None</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="ow">and</span> <span class="s2">&quot;other&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">:</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">b</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">)}</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>            <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;other&quot;</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">b</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">)}</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>        <span class="k">return</span> <span class="n">d</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>    <span class="k">def</span> <span class="nf">annotation_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="sd">        Get the type of annotation (&#39;exclusive_classification&#39;, &#39;nonexclusive_classification&#39;)</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">        Returns</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">        -------</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">        annotation_class : str</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">            the type of annotation</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>            <span class="k">return</span> <span class="s2">&quot;exclusive_classification&quot;</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>            <span class="k">return</span> <span class="s2">&quot;nonexclusive_classification&quot;</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">        Get the total number of frames in the data</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">        Returns</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">        -------</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">        size : int</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">            the total number of frames</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>    <span class="k">def</span> <span class="nf">filtered_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="sd">        Return the indices of the samples that should be removed</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">        Choosing the indices can be based on any kind of filering defined in the __init__ function by the data</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">        parameters</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">        Returns</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">        -------</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">        indices_to_remove : list</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">            a list of integer indices that should be removed</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtered</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>    <span class="k">def</span> <span class="nf">set_pseudo_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">        Set pseudo labels to the unlabeled data</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="sd">        Parameters</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="sd">        ----------</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="sd">        labels : torch.Tensor</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">            a tensor of pseudo-labels for the unlabeled data</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">],</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">],</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a><span class="sd">        Parameters</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a><span class="sd">        ----------</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a><span class="sd">        annotation_path : str | set</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a><span class="sd">        Returns</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a><span class="sd">        -------</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a><span class="sd">        video_ids : list</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a><span class="sd">            a list of video file ids</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>        <span class="n">lists</span> <span class="o">=</span> <span class="p">[</span><span class="n">annotation_path</span><span class="p">,</span> <span class="n">annotation_suffix</span><span class="p">]</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lists</span><span class="p">)):</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>            <span class="n">iterable</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">))</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>            <span class="k">if</span> <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">iterable</span><span class="p">:</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                    <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>                <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>        <span class="n">annotation_path</span><span class="p">,</span> <span class="n">annotation_suffix</span> <span class="o">=</span> <span class="n">lists</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">annotation_path</span><span class="p">:</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>            <span class="n">files</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>                <span class="n">strip_suffix</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="n">annotation_suffix</span><span class="p">)</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">annotation_suffix</span><span class="p">]))</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>            <span class="p">]</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>        <span class="k">return</span> <span class="n">files</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>    <span class="k">def</span> <span class="nf">_set_behaviors</span><span class="p">(</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">behaviors</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>    <span class="p">):</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="sd">        Get a list of behaviors that should be annotated from behavior parameters</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>        <span class="k">if</span> <span class="n">behaviors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">ignored_classes</span><span class="p">:</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>                <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">:</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>                    <span class="n">behaviors</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span> <span class="o">=</span> <span class="n">behaviors</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>    <span class="k">def</span> <span class="nf">_compute_labeled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a><span class="sd">        Get the indices of labeled (annotated) and unlabeled samples</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>            <span class="n">unlabeled</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>            <span class="n">labeled_indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">unlabeled</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>            <span class="n">unlabeled_indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">unlabeled</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>            <span class="n">labeled_indices</span><span class="p">,</span> <span class="n">unlabeled_indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([])</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>        <span class="k">return</span> <span class="n">labeled_indices</span><span class="p">,</span> <span class="n">unlabeled_indices</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>    <span class="k">def</span> <span class="nf">_generate_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="sd">        Process a loaded annotation file to generate a training labels dictionary</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>        <span class="n">annotation</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>            <span class="n">behaviors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">times</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>                <span class="n">behaviors</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>                <span class="n">x</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">behaviors</span><span class="p">)</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>                <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignored_classes</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>                <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;negative&quot;</span><span class="p">)</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>                <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>            <span class="p">]</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">times</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot generate annotqtion without behavior information!&quot;</span><span class="p">)</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>        <span class="n">beh_inv</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>        <span class="c1"># if there is no annotation file, generate empty annotation</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>            <span class="n">clips</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>                <span class="s2">&quot;+&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>            <span class="p">]</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>            <span class="n">clips</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>        <span class="k">if</span> <span class="n">times</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>            <span class="n">clips</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clips</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignored_clips</span><span class="p">]</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>        <span class="c1"># otherwise, apply filters and generate label arrays</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>            <span class="n">clips</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>                <span class="n">x</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clips</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>                <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignored_clips</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">times</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>            <span class="p">]</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">times</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>                    <span class="n">min_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_min_frame</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>                    <span class="n">max_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_max_frame</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>                    <span class="k">continue</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>                <span class="n">go_on</span> <span class="o">=</span> <span class="n">max_frame</span> <span class="o">-</span> <span class="n">min_frame</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_limit</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>                <span class="k">if</span> <span class="n">go_on</span><span class="p">:</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>                    <span class="n">v_len</span> <span class="o">=</span> <span class="n">max_frame</span> <span class="o">-</span> <span class="n">min_frame</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_background</span><span class="p">:</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>                            <span class="n">value</span> <span class="o">=</span> <span class="n">beh_inv</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;other&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>                            <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">v_len</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">long</span><span class="p">)</span> <span class="o">*</span> <span class="n">value</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>                            <span class="n">labels</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">v_len</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">long</span><span class="p">)</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>                        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">),</span> <span class="n">v_len</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>                    <span class="n">cat_new</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>                    <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">times</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>                        <span class="k">if</span> <span class="n">cat</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">):</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>                            <span class="n">cat_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>                    <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">times</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>                        <span class="k">if</span> <span class="n">cat</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;negative&quot;</span><span class="p">):</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                            <span class="n">cat_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>                    <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">times</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">cat</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;negative&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cat</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>                            <span class="s2">&quot;unknown&quot;</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>                        <span class="p">):</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>                            <span class="n">cat_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>                    <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">cat_new</span><span class="p">:</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>                        <span class="n">neg</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>                        <span class="n">unknown</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>                        <span class="n">cat_times</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="n">cat</span><span class="p">]</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_negatives</span> <span class="ow">and</span> <span class="n">cat</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;negative&quot;</span><span class="p">):</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>                            <span class="n">cat</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>                            <span class="n">neg</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>                        <span class="k">elif</span> <span class="n">cat</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">):</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>                            <span class="n">cat</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>                            <span class="n">unknown</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>                        <span class="k">if</span> <span class="n">cat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">correction</span><span class="p">:</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>                            <span class="n">cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">correction</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>                        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">amb</span> <span class="ow">in</span> <span class="n">cat_times</span><span class="p">:</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>                            <span class="k">if</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_max_frame</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>                                <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_max_frame</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>                            <span class="k">if</span> <span class="n">amb</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>                                <span class="k">continue</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>                            <span class="n">start</span> <span class="o">-=</span> <span class="n">min_frame</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>                            <span class="n">end</span> <span class="o">-=</span> <span class="n">min_frame</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>                            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">min_frames_action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>                                <span class="ow">and</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frames_action</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>                            <span class="p">):</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>                                <span class="k">continue</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>                            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">vis_min_frac</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>                                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis_min_score</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>                                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibility</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>                            <span class="p">):</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>                                <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>                                <span class="k">for</span> <span class="n">ind_k</span> <span class="ow">in</span> <span class="n">ind</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">):</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>                                    <span class="n">s</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">visibility</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">ind_k</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>                                        <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis_min_score</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>                                    <span class="p">)</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>                                <span class="k">if</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis_min_frac</span> <span class="o">*</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>                                    <span class="n">ind</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>                                <span class="p">):</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>                                    <span class="k">continue</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>                            <span class="k">if</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">beh_inv</span><span class="p">:</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>                                <span class="n">cat_i_global</span> <span class="o">=</span> <span class="n">beh_inv</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>                                    <span class="n">labels</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">cat_i_global</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>                                    <span class="k">if</span> <span class="n">unknown</span><span class="p">:</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>                                        <span class="n">labels</span><span class="p">[</span><span class="n">cat_i_global</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>                                    <span class="k">elif</span> <span class="n">neg</span><span class="p">:</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>                                        <span class="n">labels</span><span class="p">[</span><span class="n">cat_i_global</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>                                        <span class="n">labels</span><span class="p">[</span><span class="n">cat_i_global</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">not_found</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_background</span><span class="p">:</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>                                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>                                        <span class="n">labels</span><span class="p">[:,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">][</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>                                            <span class="n">labels</span><span class="p">[:,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>                                        <span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>                                        <span class="n">labels</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">][</span><span class="n">labels</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_class</span> <span class="ow">in</span> <span class="n">times</span><span class="p">[</span><span class="n">ind</span><span class="p">]:</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>                        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">amb</span> <span class="ow">in</span> <span class="n">times</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">error_class</span><span class="p">]:</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                                <span class="n">labels</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>                                <span class="n">labels</span><span class="p">[:,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>                    <span class="n">annotation</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;---&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span> <span class="o">=</span> <span class="n">labels</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">clips</span><span class="p">:</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>                <span class="n">min_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_min_frame</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>                <span class="n">max_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_max_frame</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>                <span class="k">continue</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>            <span class="n">go_on</span> <span class="o">=</span> <span class="n">max_frame</span> <span class="o">-</span> <span class="n">min_frame</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_limit</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>            <span class="k">if</span> <span class="n">go_on</span><span class="p">:</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>                <span class="n">v_len</span> <span class="o">=</span> <span class="n">max_frame</span> <span class="o">-</span> <span class="n">min_frame</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>                    <span class="n">annotation</span><span class="p">[</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;---&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">v_len</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">long</span><span class="p">)</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>                    <span class="n">annotation</span><span class="p">[</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;---&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">),</span> <span class="n">v_len</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        <span class="k">return</span> <span class="n">annotation</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>    <span class="k">def</span> <span class="nf">_make_trimmed_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotations_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a><span class="sd">        Cut a label dictionary into overlapping pieces of equal length</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>        <span class="n">masked_all</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>        <span class="k">for</span> <span class="n">v_id</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">annotations_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>            <span class="k">if</span> <span class="n">v_id</span> <span class="ow">in</span> <span class="n">annotations_dict</span><span class="p">:</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>                <span class="n">annotations</span> <span class="o">=</span> <span class="n">annotations_dict</span><span class="p">[</span><span class="n">v_id</span><span class="p">]</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>                    <span class="sa">f</span><span class="s1">&#39;The id list in </span><span class="si">{</span><span class="n">v_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;---&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> is not consistent across files&#39;</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>                <span class="p">)</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>            <span class="n">split</span> <span class="o">=</span> <span class="n">v_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;---&quot;</span><span class="p">)</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>                <span class="n">video_id</span><span class="p">,</span> <span class="n">ind</span> <span class="o">=</span> <span class="n">split</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>                <span class="n">video_id</span> <span class="o">=</span> <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>                <span class="n">ind</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>            <span class="n">min_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_min_frame</span><span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>            <span class="n">max_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_max_frame</span><span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>            <span class="n">v_len</span> <span class="o">=</span> <span class="n">max_frame</span> <span class="o">-</span> <span class="n">min_frame</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>            <span class="n">sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">v_len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>            <span class="n">pad</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span> <span class="o">-</span> <span class="n">v_len</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>                <span class="n">annotations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">annotations</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">pad</span><span class="p">)),</span> <span class="n">constant_values</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>                <span class="n">annotations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>                    <span class="n">annotations</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pad</span><span class="p">)),</span> <span class="n">constant_values</span><span class="o">=-</span><span class="mi">100</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>                <span class="p">)</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>            <span class="n">masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">annotations</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                <span class="ow">and</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">]</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>                <span class="ow">and</span> <span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">]</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>            <span class="p">):</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>                <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">ind</span><span class="p">]:</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>                    <span class="n">masked</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sp</span><span class="p">):</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">v_id</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                    <span class="n">ann</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">[</span><span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">]</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>                    <span class="n">m</span> <span class="o">=</span> <span class="n">masked</span><span class="p">[</span><span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">]</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>                    <span class="n">ann</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">[:,</span> <span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">]</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>                    <span class="n">m</span> <span class="o">=</span> <span class="n">masked</span><span class="p">[:,</span> <span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">]</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ann</span><span class="p">)</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>                <span class="n">masked_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">)</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>        <span class="n">masked_all</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">masked_all</span><span class="p">))</span><span class="o">.</span><span class="n">int</span><span class="p">()</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_background</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                <span class="n">label</span><span class="p">[:,</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">label</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">label</span> <span class="o">==</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                <span class="n">label</span><span class="p">[</span><span class="n">label</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>        <span class="n">labels</span><span class="p">[(</span><span class="n">labels</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">masked_all</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">200</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>        <span class="k">return</span> <span class="n">labels</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>    <span class="k">def</span> <span class="nf">_get_file_paths</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a><span class="sd">        Get a list of relevant files</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>        <span class="k">if</span> <span class="n">annotation_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>                <span class="n">annotation_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">annotation_path</span><span class="p">]</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">annotation_path</span><span class="p">:</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>                <span class="n">file_paths</span> <span class="o">+=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)]</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>        <span class="k">return</span> <span class="n">file_paths</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>    <span class="k">def</span> <span class="nf">_get_max_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">        Get the end frame of a clip in a video</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>        <span class="k">if</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">ind_k</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind_k</span> <span class="ow">in</span> <span class="n">clip_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)]</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>            <span class="p">)</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>    <span class="k">def</span> <span class="nf">_get_min_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">):</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="sd">        Get the start frame of a clip in a video</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>        <span class="k">if</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">ind_k</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind_k</span> <span class="ow">in</span> <span class="n">clip_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)]</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>            <span class="p">)</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>    <span class="k">def</span> <span class="nf">_load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a><span class="sd">        Load behavior annotation and generate annotation prompts</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a><span class="k">class</span> <span class="nc">FileAnnotationStore</span><span class="p">(</span><span class="n">ActionSegmentationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a><span class="sd">    A generalized implementation of `ActionSegmentationStore` for datasets where one file corresponds to one video</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>    <span class="k">def</span> <span class="nf">_generate_max_min_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">video_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a><span class="sd">        Generate `max_frames` and `min_frames` objects in case they were not passed from an `InputStore`</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>        <span class="k">if</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">:</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>            <span class="k">return</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">cat_dict</span> <span class="ow">in</span> <span class="n">times</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>            <span class="n">maxes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>            <span class="n">mins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>            <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">cat_list</span> <span class="ow">in</span> <span class="n">cat_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>                    <span class="n">maxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_list</span><span class="p">]))</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>                    <span class="n">mins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_list</span><span class="p">]))</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxes</span><span class="p">)</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mins</span><span class="p">)</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>    <span class="k">def</span> <span class="nf">_load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a><span class="sd">        Load behavior annotation and generate annotation prompts</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_order</span><span class="p">:</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>            <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_folder</span><span class="p">:</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ann_suffix</span><span class="p">:</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>                    <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>                        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>                        <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>                        <span class="k">break</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">not_found</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>        <span class="n">annotations_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing annotation arrays...&quot;</span><span class="p">)</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_order</span><span class="p">,</span> <span class="n">files</span><span class="p">))):</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>                <span class="n">times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_annotations</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>                <span class="n">times</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>            <span class="k">if</span> <span class="n">times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_generate_max_min_frames</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>            <span class="n">annotations_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_annotation</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>            <span class="k">del</span> <span class="n">times</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>        <span class="n">annotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_trimmed_annotations</span><span class="p">(</span><span class="n">annotations_dict</span><span class="p">)</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>        <span class="k">del</span> <span class="n">annotations_dict</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_annotated</span><span class="p">:</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">annotation</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">annotation</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>                <span class="p">)</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filtered</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>        <span class="n">annotation</span><span class="p">[</span><span class="n">annotation</span> <span class="o">==</span> <span class="o">-</span><span class="mi">200</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>        <span class="k">return</span> <span class="n">annotation</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>    <span class="k">def</span> <span class="nf">_open_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a><span class="sd">        Load the annotation from filename</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a><span class="sd">        Parameters</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a><span class="sd">        ----------</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a><span class="sd">        filename : str</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a><span class="sd">            path to an annotation file</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="sd">        Returns</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a><span class="sd">        -------</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a><span class="sd">        times : dict</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="sd">            a nested dictionary where first-level keys are clip ids, second-level keys are categories and values are</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a><span class="sd">            lists of (start, end, ambiguity status) lists</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="k">class</span> <span class="nc">SequenceAnnotationStore</span><span class="p">(</span><span class="n">ActionSegmentationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">    A generalized implementation of `ActionSegmentationStore` for datasets where one file corresponds to multiple videos</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>    <span class="k">def</span> <span class="nf">_generate_max_min_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a><span class="sd">        Generate `max_frames` and `min_frames` objects in case they were not passed from an `InputStore`</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>        <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>            <span class="k">if</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">:</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>                <span class="k">continue</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">cat_dict</span> <span class="ow">in</span> <span class="n">times</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>                <span class="n">maxes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>                <span class="n">mins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>                <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">cat_list</span> <span class="ow">in</span> <span class="n">cat_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>                    <span class="n">maxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_list</span><span class="p">]))</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>                    <span class="n">mins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_list</span><span class="p">]))</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxes</span><span class="p">)</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mins</span><span class="p">)</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>        <span class="n">filenames</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a><span class="sd">        Parameters</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a><span class="sd">        ----------</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a><span class="sd">        filenames : list, optional</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a><span class="sd">            a list of annotation file paths</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a><span class="sd">        annotation_path : str, optional</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a><span class="sd">            path to the annotation folder</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a><span class="sd">        Returns</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a><span class="sd">        -------</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a><span class="sd">        video_ids : list</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a><span class="sd">            a list of video file ids</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>        <span class="k">if</span> <span class="n">annotation_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>                <span class="n">annotation_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">annotation_path</span><span class="p">]</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>            <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">annotation_path</span><span class="p">:</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>                <span class="n">file_paths</span> <span class="o">+=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)]</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>                <span class="n">ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>        <span class="k">return</span> <span class="n">ids</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>    <span class="k">def</span> <span class="nf">_load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a><span class="sd">        Load behavior annotation and generate annotation prompts</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">:</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_order</span><span class="p">:</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">not_found</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>        <span class="n">annotations_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_order</span><span class="p">,</span> <span class="n">files</span><span class="p">)):</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>                <span class="n">times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_sequences</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>                <span class="n">times</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>            <span class="k">if</span> <span class="n">times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_generate_max_min_frames</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>                <span class="n">none_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>                <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">sequence_dict</span> <span class="ow">in</span> <span class="n">times</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>                    <span class="k">if</span> <span class="n">sequence_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>                        <span class="n">none_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence_dict</span><span class="p">)</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>                        <span class="k">continue</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>                    <span class="n">annotations_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_annotation</span><span class="p">(</span><span class="n">sequence_dict</span><span class="p">,</span> <span class="n">video_id</span><span class="p">)</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>                    <span class="p">)</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>                <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">none_ids</span><span class="p">:</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>                    <span class="n">annotations_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_annotation</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">video_id</span><span class="p">))</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>                <span class="k">del</span> <span class="n">times</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>        <span class="n">annotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_trimmed_annotations</span><span class="p">(</span><span class="n">annotations_dict</span><span class="p">)</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>        <span class="k">del</span> <span class="n">annotations_dict</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_annotated</span><span class="p">:</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">annotation</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">annotation</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>                <span class="p">)</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filtered</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>        <span class="n">annotation</span><span class="p">[</span><span class="n">annotation</span> <span class="o">==</span> <span class="o">-</span><span class="mi">200</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>        <span class="k">return</span> <span class="n">annotation</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>    <span class="k">def</span> <span class="nf">_open_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a><span class="sd">        Load the annotation from filename</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a><span class="sd">        Parameters</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a><span class="sd">        ----------</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a><span class="sd">        filename : str</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a><span class="sd">            path to an annotation file</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a><span class="sd">        Returns</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a><span class="sd">        -------</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a><span class="sd">        times : dict</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids,</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a><span class="sd">            third-level keys are categories and values are</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a><span class="sd">            lists of (start, end, ambiguity status) lists</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a><span class="k">class</span> <span class="nc">DLCAnnotationStore</span><span class="p">(</span><span class="n">FileAnnotationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a><span class="sd">    DLC type annotation data</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a><span class="sd">    The files are either the DLC2Action GUI output or a pickled dictionary of the following structure:</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a><span class="sd">        - nested dictionary,</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a><span class="sd">        - first-level keys are individual IDs,</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a><span class="sd">        - second-level keys are labels,</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a><span class="sd">        - values are lists of intervals,</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a><span class="sd">        - the lists of intervals is formatted as `[start_frame, end_frame, ambiguity]`,</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a><span class="sd">        - ambiguity is 1 if the action is ambiguous (!!at the moment DLC2Action will IGNORE those intervals!!) or 0 if it isn&#39;t.</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a><span class="sd">    A minimum working example of such a dictionary is:</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a><span class="sd">    ```</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a><span class="sd">    {</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a><span class="sd">        &quot;ind0&quot;: {},</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a><span class="sd">        &quot;ind1&quot;: {</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a><span class="sd">            &quot;running&quot;: [60, 70, 0]],</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a><span class="sd">            &quot;eating&quot;: []</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a><span class="sd">        }</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a><span class="sd">    }</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a><span class="sd">    ```</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a><span class="sd">    Here there are two animals: `&quot;ind0&quot;` and `&quot;ind1&quot;`, and two actions: running and eating.</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a><span class="sd">    The only annotated action is eating for `&quot;ind1&quot;` between frames 60 and 70.</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a><span class="sd">    If you generate those files manually, run this code for a sanity check:</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a><span class="sd">    ```</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a><span class="sd">    import pickle</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a><span class="sd">    with open(&quot;/path/to/annotation.pickle&quot;, &quot;rb&quot;) as f:</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a><span class="sd">    data = pickle.load(f)</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a><span class="sd">    for ind, ind_dict in data.items():</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a><span class="sd">        print(f&#39;individual {ind}:&#39;)</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a><span class="sd">        for label, intervals in ind_dict.items():</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a><span class="sd">            for start, end, ambiguity in intervals:</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a><span class="sd">                if ambiguity == 0:</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a><span class="sd">                    print(f&#39;  from {start} to {end} frame: {label}&#39;)</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a><span class="sd">    ```</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a><span class="sd">    Assumes the following file structure:</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a><span class="sd">    ```</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a><span class="sd">    annotation_path</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a><span class="sd">     video1_annotation.pickle</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a><span class="sd">     video2_labels.pickle</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a><span class="sd">    ```</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a><span class="sd">    Here `annotation_suffix` is `{&#39;_annotation.pickle&#39;, &#39;_labels.pickle&#39;}`.</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>    <span class="k">def</span> <span class="nf">_open_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a><span class="sd">        Load the annotation from `filename`</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>                <span class="n">annotation</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>                <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">annotation</span><span class="p">:</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>                    <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">cat_list</span> <span class="ow">in</span> <span class="n">annotation</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>                        <span class="n">annotation</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>                            <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">cat_list</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>                        <span class="p">]</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">loaded_labels</span><span class="p">,</span> <span class="n">animals</span><span class="p">,</span> <span class="n">loaded_times</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>                <span class="n">annotation</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>                <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">ind_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">animals</span><span class="p">,</span> <span class="n">loaded_times</span><span class="p">):</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>                    <span class="n">annotation</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>                    <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">cat_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">loaded_labels</span><span class="p">,</span> <span class="n">ind_list</span><span class="p">):</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>                        <span class="n">annotation</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="n">cat_list</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>            <span class="k">return</span> <span class="n">annotation</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> is invalid or does not exist&quot;</span><span class="p">)</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a><span class="k">class</span> <span class="nc">BorisAnnotationStore</span><span class="p">(</span><span class="n">FileAnnotationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a><span class="sd">    BORIS type annotation data</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a><span class="sd">    Assumes the following file structure:</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a><span class="sd">    ```</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a><span class="sd">    annotation_path</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a><span class="sd">     video1_annotation.pickle</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a><span class="sd">     video2_labels.pickle</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a><span class="sd">    ```</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a><span class="sd">    Here `annotation_suffix` is `{&#39;_annotation.pickle&#39;, &#39;_labels.pickle&#39;}`.</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>        <span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>        <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>        <span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a>        <span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a>        <span class="n">default_agent_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ind0&quot;</span><span class="p">,</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>        <span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>        <span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a><span class="sd">        Parameters</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a><span class="sd">        ----------</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a><span class="sd">        behaviors : set, optional</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a><span class="sd">            the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a><span class="sd">            loaded from a file)</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a><span class="sd">            (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a><span class="sd">            from key objects)</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a><span class="sd">        frame_limit : int, default 0</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a><span class="sd">            the smallest possible length of a clip (shorter clips are discarded)</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a><span class="sd">        use_hard_negatives : bool, default False</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a><span class="sd">            mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a><span class="sd">        interactive : bool, default False</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a><span class="sd">            if `True`, annotation is assigned to pairs of individuals</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a><span class="sd">        ignored_clips : set, optional</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a><span class="sd">            a set of clip ids to ignore</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_agent_name</span> <span class="o">=</span> <span class="n">default_agent_name</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>            <span class="n">visibility</span><span class="o">=</span><span class="n">visibility</span><span class="p">,</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>            <span class="n">annotation_suffix</span><span class="o">=</span><span class="n">annotation_suffix</span><span class="p">,</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>            <span class="n">behavior_file</span><span class="o">=</span><span class="n">behavior_file</span><span class="p">,</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>            <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>            <span class="n">frame_limit</span><span class="o">=</span><span class="n">frame_limit</span><span class="p">,</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="n">filter_annotated</span><span class="p">,</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>            <span class="n">filter_background</span><span class="o">=</span><span class="n">filter_background</span><span class="p">,</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a>            <span class="n">error_class</span><span class="o">=</span><span class="n">error_class</span><span class="p">,</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>            <span class="n">min_frames_action</span><span class="o">=</span><span class="n">min_frames_action</span><span class="p">,</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>            <span class="n">visibility_min_score</span><span class="o">=</span><span class="n">visibility_min_score</span><span class="p">,</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>            <span class="n">visibility_min_frac</span><span class="o">=</span><span class="n">visibility_min_frac</span><span class="p">,</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a>            <span class="n">use_hard_negatives</span><span class="o">=</span><span class="n">use_hard_negatives</span><span class="p">,</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>            <span class="n">interactive</span><span class="o">=</span><span class="n">interactive</span><span class="p">,</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>            <span class="n">ignored_clips</span><span class="o">=</span><span class="n">ignored_clips</span><span class="p">,</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>        <span class="p">)</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>    <span class="k">def</span> <span class="nf">_open_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a><span class="sd">        Load the annotation from filename</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>            <span class="n">fps</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;FPS&quot;</span><span class="p">]</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_agent_name</span><span class="p">)</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>            <span class="n">loaded_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Behavior&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>            <span class="n">animals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>            <span class="n">loaded_times</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">animals</span><span class="p">:</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>                <span class="n">loaded_times</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>                <span class="n">agent_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ind</span><span class="p">]</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>                <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">loaded_labels</span><span class="p">:</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>                    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">agent_df</span><span class="p">[</span><span class="n">agent_df</span><span class="p">[</span><span class="s2">&quot;Behavior&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cat</span><span class="p">]</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>                    <span class="n">starts</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>                        <span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">][</span><span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;Status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;START&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a>                    <span class="n">ends</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a>                        <span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">][</span><span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;Status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;STOP&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>                    <span class="n">loaded_times</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>                        <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>                    <span class="p">]</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a>            <span class="k">return</span> <span class="n">loaded_times</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> is invalid or does not exist&quot;</span><span class="p">)</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a><span class="k">class</span> <span class="nc">PKUMMDAnnotationStore</span><span class="p">(</span><span class="n">FileAnnotationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a><span class="sd">    PKU-MMD annotation data</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a><span class="sd">    Assumes the following file structure:</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a><span class="sd">    ```</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a><span class="sd">    annotation_path</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a><span class="sd">     0364-L.txt</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a><span class="sd">    ...</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a><span class="sd">     0144-M.txt</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a><span class="sd">    ```</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>        <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>        <span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a>        <span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>        <span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>        <span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a><span class="sd">        Parameters</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a><span class="sd">        ----------</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a><span class="sd">            from key objects)</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a><span class="sd">        frame_limit : int, default 0</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a><span class="sd">            the smallest possible length of a clip (shorter clips are discarded)</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a><span class="sd">        use_hard_negatives : bool, default False</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a><span class="sd">            mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a><span class="sd">        interactive : bool, default False</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a><span class="sd">            if `True`, annotation is assigned to pairs of individuals</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a><span class="sd">        ignored_clips : set, optional</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a><span class="sd">            a set of clip ids to ignore</span>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>            <span class="n">visibility</span><span class="o">=</span><span class="n">visibility</span><span class="p">,</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a>            <span class="n">annotation_suffix</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;.txt&quot;</span><span class="p">},</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a>            <span class="n">behavior_file</span><span class="o">=</span><span class="n">behavior_file</span><span class="p">,</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a>            <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a>            <span class="n">frame_limit</span><span class="o">=</span><span class="n">frame_limit</span><span class="p">,</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="n">filter_annotated</span><span class="p">,</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a>            <span class="n">filter_background</span><span class="o">=</span><span class="n">filter_background</span><span class="p">,</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a>            <span class="n">error_class</span><span class="o">=</span><span class="n">error_class</span><span class="p">,</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a>            <span class="n">min_frames_action</span><span class="o">=</span><span class="n">min_frames_action</span><span class="p">,</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a>            <span class="n">visibility_min_score</span><span class="o">=</span><span class="n">visibility_min_score</span><span class="p">,</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>            <span class="n">visibility_min_frac</span><span class="o">=</span><span class="n">visibility_min_frac</span><span class="p">,</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a>            <span class="n">use_hard_negatives</span><span class="o">=</span><span class="n">use_hard_negatives</span><span class="p">,</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a>            <span class="n">interactive</span><span class="o">=</span><span class="n">interactive</span><span class="p">,</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a>            <span class="n">ignored_clips</span><span class="o">=</span><span class="n">ignored_clips</span><span class="p">,</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a>            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>        <span class="p">)</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a><span class="sd">        Parameters</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a><span class="sd">        ----------</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a><span class="sd">        annotation_path : str | set</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a><span class="sd">        Returns</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a><span class="sd">        -------</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a><span class="sd">        video_ids : list</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a><span class="sd">            a list of video file ids</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a>            <span class="n">annotation_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">annotation_path</span><span class="p">]</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">annotation_path</span><span class="p">:</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a>            <span class="n">files</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;.txt&quot;</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a>            <span class="p">]</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a>        <span class="k">return</span> <span class="n">files</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a>    <span class="k">def</span> <span class="nf">_open_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a><span class="sd">        Load the annotation from filename</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>            <span class="n">agent_name</span> <span class="o">=</span> <span class="s2">&quot;0+1&quot;</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>            <span class="n">agent_name</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>        <span class="n">times</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent_name</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])}</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>                <span class="n">label</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>                <span class="n">times</span><span class="p">[</span><span class="n">agent_name</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">all_behaviors</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>                    <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>                <span class="p">)</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>        <span class="k">return</span> <span class="n">times</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>    <span class="k">def</span> <span class="nf">_set_behaviors</span><span class="p">(</span>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">behaviors</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>    <span class="p">):</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a><span class="sd">        Get a list of behaviors that should be annotated from behavior parameters</span>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>        <span class="k">if</span> <span class="n">behavior_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>            <span class="n">behaviors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">behavior_file</span><span class="p">)[</span><span class="s2">&quot;Action&quot;</span><span class="p">])</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all_behaviors</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">behaviors</span><span class="p">)</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">ignored_classes</span><span class="p">:</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>            <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">:</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>                <span class="n">behaviors</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span> <span class="o">=</span> <span class="n">behaviors</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a><span class="k">class</span> <span class="nc">CalMS21AnnotationStore</span><span class="p">(</span><span class="n">SequenceAnnotationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a><span class="sd">    CalMS21 annotation data</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a><span class="sd">    Use the `&#39;random:test_from_name:{name}&#39;` and `&#39;val-from-name:{val_name}:test-from-name:{test_name}&#39;`</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a><span class="sd">    partitioning methods with `&#39;train&#39;`, `&#39;test&#39;` and `&#39;unlabeled&#39;` names to separate into train, test and validation</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a><span class="sd">    subsets according to the original files. For example, with `&#39;val-from-name:test:test-from-name:unlabeled&#39;`</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a><span class="sd">    the data from the test file will go into validation and the unlabeled files will be the test.</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a><span class="sd">    Assumes the following file structure:</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a><span class="sd">    ```</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a><span class="sd">    annotation_path</span>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a><span class="sd">     calms21_task_train.npy</span>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a><span class="sd">     calms21_task_test.npy</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a><span class="sd">     calms21_unlabeled_videos_part1.npy</span>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a><span class="sd">     calms21_unlabeled_videos_part2.npy</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a><span class="sd">     calms21_unlabeled_videos_part3.npy</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a><span class="sd">    ```</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>        <span class="n">task_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>        <span class="n">include_task1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a>        <span class="n">treba_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a><span class="sd">        Parameters</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a><span class="sd">        ----------</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a><span class="sd">        task_n : [1, 2]</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a><span class="sd">            the number of the task</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a><span class="sd">        include_task1 : bool, default True</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a><span class="sd">            include task 1 data to training set</span>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a><span class="sd">            from key objects)</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a><span class="sd">        treba_files : bool, default False</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a><span class="sd">            if `True`, TREBA feature files will be loaded</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">task_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">task_n</span><span class="p">)</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_task1</span> <span class="o">=</span> <span class="n">include_task1</span>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">include_task1</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">treba_files</span> <span class="o">=</span> <span class="n">treba_files</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a>        <span class="k">if</span> <span class="s2">&quot;exclusive&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>            <span class="n">exclusive</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;exclusive&quot;</span><span class="p">]</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a>            <span class="n">exclusive</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a>        <span class="k">if</span> <span class="s2">&quot;behaviors&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;behaviors&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>            <span class="n">behaviors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;behaviors&quot;</span><span class="p">]</span>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a>            <span class="n">behaviors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;attack&quot;</span><span class="p">,</span> <span class="s2">&quot;investigation&quot;</span><span class="p">,</span> <span class="s2">&quot;mount&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">]</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a>            <span class="k">if</span> <span class="n">task_n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a>                <span class="n">exclusive</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a>                <span class="n">behaviors</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a>                    <span class="s2">&quot;approach&quot;</span><span class="p">,</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a>                    <span class="s2">&quot;disengaged&quot;</span><span class="p">,</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a>                    <span class="s2">&quot;groom&quot;</span><span class="p">,</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a>                    <span class="s2">&quot;intromission&quot;</span><span class="p">,</span>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a>                    <span class="s2">&quot;mount_attempt&quot;</span><span class="p">,</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a>                    <span class="s2">&quot;sniff_face&quot;</span><span class="p">,</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a>                    <span class="s2">&quot;whiterearing&quot;</span><span class="p">,</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a>                <span class="p">]</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a>            <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a>        <span class="p">)</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>        <span class="n">task_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>        <span class="n">include_task1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a>        <span class="n">treba_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a>        <span class="n">file_paths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">:</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a><span class="sd">        Parameters</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a><span class="sd">        ----------</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a><span class="sd">        task_n : {1, 2, 3}</span>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a><span class="sd">            the index of the CalMS21 challenge task</span>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a><span class="sd">        include_task1 : bool, default False</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a><span class="sd">            if `True`, the training file of the task 1 will be loaded</span>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a><span class="sd">        treba_files : bool, default False</span>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a><span class="sd">            if `True`, the TREBA feature files will be loaded</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a><span class="sd">        filenames : set, optional</span>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a><span class="sd">            a set of string filenames to search for (only basenames, not the whole paths)</span>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a><span class="sd">            the path to the folder where the pose and feature files are stored or a set of such paths</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a><span class="sd">            (not passed if creating from key objects or from `file_paths`)</span>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a><span class="sd">        file_paths : set, optional</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a><span class="sd">            a set of string paths to the pose and feature files</span>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a><span class="sd">            (not passed if creating from key objects or from `data_path`)</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a><span class="sd">        Returns</span>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a><span class="sd">        -------</span>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a><span class="sd">        video_ids : list</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a><span class="sd">            a list of video file ids</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a>        <span class="n">task_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">task_n</span><span class="p">)</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a>        <span class="k">if</span> <span class="n">task_n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>            <span class="n">include_task1</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>        <span class="k">if</span> <span class="n">treba_files</span><span class="p">:</span>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>            <span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;_features&quot;</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>            <span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calms21_task</span><span class="si">{</span><span class="n">task_n</span><span class="si">}</span><span class="s2">_train</span><span class="si">{</span><span class="n">postfix</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a>        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calms21_task</span><span class="si">{</span><span class="n">task_n</span><span class="si">}</span><span class="s2">_test</span><span class="si">{</span><span class="n">postfix</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>        <span class="k">if</span> <span class="n">include_task1</span><span class="p">:</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calms21_task1_train</span><span class="si">{</span><span class="n">postfix</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a>        <span class="k">return</span> <span class="n">SequenceAnnotationStore</span><span class="o">.</span><span class="n">get_file_ids</span><span class="p">(</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a>            <span class="n">filenames</span><span class="p">,</span> <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>        <span class="p">)</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>    <span class="k">def</span> <span class="nf">_open_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a><span class="sd">        Load the annotation from filename</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a><span class="sd">        Parameters</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a><span class="sd">        ----------</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a><span class="sd">        filename : str</span>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a><span class="sd">            path to an annotation file</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a><span class="sd">        Returns</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a><span class="sd">        -------</span>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a><span class="sd">        times : dict</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids,</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a><span class="sd">            third-level keys are categories and values are</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a><span class="sd">            lists of (start, end, ambiguity status) lists</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>        <span class="n">data_dict</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a>        <span class="k">if</span> <span class="s2">&quot;test&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>        <span class="k">elif</span> <span class="s2">&quot;unlabeled&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;unlabeled&quot;</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>        <span class="k">if</span> <span class="s2">&quot;approach&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>            <span class="k">for</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="p">[</span><span class="n">behavior</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a>                    <span class="n">ann</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="n">behavior</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>                    <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">--</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a>                        <span class="s2">&quot;mouse1+mouse2&quot;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a>                    <span class="p">}</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a>                    <span class="n">starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">ann</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]))</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a>                        <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>                    <span class="n">ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">ann</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]))</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a>                        <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">):</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a>                        <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">--</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s2">&quot;mouse1+mouse2&quot;</span><span class="p">][</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a>                            <span class="n">behavior</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a>                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">:</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a>                        <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">--</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">---mouse1+mouse2&#39;</span><span class="p">][</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a>                            <span class="s2">&quot;mouse1+mouse2&quot;</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a>                        <span class="p">][</span><span class="sa">f</span><span class="s2">&quot;unknown </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ann</span><span class="p">),</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a>            <span class="n">data_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>        <span class="k">if</span> <span class="s2">&quot;approach&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>                <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">--</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;mouse1+mouse2&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>                <span class="n">ann</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>                    <span class="n">starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">ann</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>                            <span class="p">)</span>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a>                        <span class="p">)</span>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a>                        <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a>                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a>                    <span class="n">ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a>                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">ann</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a>                            <span class="p">)</span>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a>                        <span class="p">)</span>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>                        <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a>                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a>                    <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">--</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s2">&quot;mouse1+mouse2&quot;</span><span class="p">][</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)]</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_n</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a>            <span class="k">for</span> <span class="n">seq_name</span><span class="p">,</span> <span class="n">seq_dict</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>                <span class="k">if</span> <span class="s2">&quot;annotations&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seq_dict</span><span class="p">:</span>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a>                <span class="n">behaviors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">seq_dict</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">])</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>                <span class="n">ann</span> <span class="o">=</span> <span class="n">seq_dict</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">--</span><span class="si">{</span><span class="n">seq_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;mouse1+mouse2&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">:</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>                    <span class="n">starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">ann</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a>                            <span class="p">)</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a>                        <span class="p">)</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>                        <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a>                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a>                    <span class="n">ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a>                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">ann</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a>                            <span class="p">)</span>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a>                        <span class="p">)</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a>                        <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a>                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a>                    <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;mouse1+mouse2&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a>                        <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a>                    <span class="p">]</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a><span class="k">class</span> <span class="nc">CSVAnnotationStore</span><span class="p">(</span><span class="n">FileAnnotationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a><span class="sd">    CSV type annotation data</span>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a><span class="sd">    Assumes that files are saved as .csv tables with at least the following columns:</span>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a><span class="sd">    - from / start : start of action,</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a><span class="sd">    - to / end : end of action,</span>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a><span class="sd">    - class / behavior / behaviour / label / type : action label.</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a><span class="sd">    If the times are set in seconds instead of frames, don&#39;t forget to set the `fps` parameter to your frame rate.</span>
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a><span class="sd">    Assumes the following file structure:</span>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a><span class="sd">    ```</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a><span class="sd">    annotation_path</span>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a><span class="sd">     video1_annotation.csv</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a><span class="sd">     video2_labels.csv</span>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a><span class="sd">    ```</span>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a><span class="sd">    Here `annotation_suffix` is `{&#39;_annotation.csv&#39;, &#39;_labels.csv&#39;}`.</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a>
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a>        <span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a>        <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a>        <span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2048"><a href="#L-2048"><span class="linenos">2048</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2049"><a href="#L-2049"><span class="linenos">2049</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2050"><a href="#L-2050"><span class="linenos">2050</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="L-2051"><a href="#L-2051"><span class="linenos">2051</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
</span><span id="L-2052"><a href="#L-2052"><span class="linenos">2052</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2053"><a href="#L-2053"><span class="linenos">2053</span></a>        <span class="n">default_agent_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ind0&quot;</span><span class="p">,</span>
</span><span id="L-2054"><a href="#L-2054"><span class="linenos">2054</span></a>        <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
</span><span id="L-2055"><a href="#L-2055"><span class="linenos">2055</span></a>        <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="L-2056"><a href="#L-2056"><span class="linenos">2056</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="L-2057"><a href="#L-2057"><span class="linenos">2057</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-2058"><a href="#L-2058"><span class="linenos">2058</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2059"><a href="#L-2059"><span class="linenos">2059</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2060"><a href="#L-2060"><span class="linenos">2060</span></a><span class="sd">        Parameters</span>
</span><span id="L-2061"><a href="#L-2061"><span class="linenos">2061</span></a><span class="sd">        ----------</span>
</span><span id="L-2062"><a href="#L-2062"><span class="linenos">2062</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="L-2063"><a href="#L-2063"><span class="linenos">2063</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="L-2064"><a href="#L-2064"><span class="linenos">2064</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="L-2065"><a href="#L-2065"><span class="linenos">2065</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-2066"><a href="#L-2066"><span class="linenos">2066</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="L-2067"><a href="#L-2067"><span class="linenos">2067</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="L-2068"><a href="#L-2068"><span class="linenos">2068</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-2069"><a href="#L-2069"><span class="linenos">2069</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="L-2070"><a href="#L-2070"><span class="linenos">2070</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="L-2071"><a href="#L-2071"><span class="linenos">2071</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-2072"><a href="#L-2072"><span class="linenos">2072</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="L-2073"><a href="#L-2073"><span class="linenos">2073</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="L-2074"><a href="#L-2074"><span class="linenos">2074</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="L-2075"><a href="#L-2075"><span class="linenos">2075</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="L-2076"><a href="#L-2076"><span class="linenos">2076</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="L-2077"><a href="#L-2077"><span class="linenos">2077</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="L-2078"><a href="#L-2078"><span class="linenos">2078</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="L-2079"><a href="#L-2079"><span class="linenos">2079</span></a><span class="sd">        behaviors : set, optional</span>
</span><span id="L-2080"><a href="#L-2080"><span class="linenos">2080</span></a><span class="sd">            the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are</span>
</span><span id="L-2081"><a href="#L-2081"><span class="linenos">2081</span></a><span class="sd">            loaded from a file)</span>
</span><span id="L-2082"><a href="#L-2082"><span class="linenos">2082</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="L-2083"><a href="#L-2083"><span class="linenos">2083</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="L-2084"><a href="#L-2084"><span class="linenos">2084</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="L-2085"><a href="#L-2085"><span class="linenos">2085</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="L-2086"><a href="#L-2086"><span class="linenos">2086</span></a><span class="sd">            (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="L-2087"><a href="#L-2087"><span class="linenos">2087</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="L-2088"><a href="#L-2088"><span class="linenos">2088</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="L-2089"><a href="#L-2089"><span class="linenos">2089</span></a><span class="sd">            from key objects)</span>
</span><span id="L-2090"><a href="#L-2090"><span class="linenos">2090</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="L-2091"><a href="#L-2091"><span class="linenos">2091</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="L-2092"><a href="#L-2092"><span class="linenos">2092</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="L-2093"><a href="#L-2093"><span class="linenos">2093</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="L-2094"><a href="#L-2094"><span class="linenos">2094</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="L-2095"><a href="#L-2095"><span class="linenos">2095</span></a><span class="sd">        frame_limit : int, default 0</span>
</span><span id="L-2096"><a href="#L-2096"><span class="linenos">2096</span></a><span class="sd">            the smallest possible length of a clip (shorter clips are discarded)</span>
</span><span id="L-2097"><a href="#L-2097"><span class="linenos">2097</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="L-2098"><a href="#L-2098"><span class="linenos">2098</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="L-2099"><a href="#L-2099"><span class="linenos">2099</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="L-2100"><a href="#L-2100"><span class="linenos">2100</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="L-2101"><a href="#L-2101"><span class="linenos">2101</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="L-2102"><a href="#L-2102"><span class="linenos">2102</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="L-2103"><a href="#L-2103"><span class="linenos">2103</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="L-2104"><a href="#L-2104"><span class="linenos">2104</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="L-2105"><a href="#L-2105"><span class="linenos">2105</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="L-2106"><a href="#L-2106"><span class="linenos">2106</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="L-2107"><a href="#L-2107"><span class="linenos">2107</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="L-2108"><a href="#L-2108"><span class="linenos">2108</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="L-2109"><a href="#L-2109"><span class="linenos">2109</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="L-2110"><a href="#L-2110"><span class="linenos">2110</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="L-2111"><a href="#L-2111"><span class="linenos">2111</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="L-2112"><a href="#L-2112"><span class="linenos">2112</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="L-2113"><a href="#L-2113"><span class="linenos">2113</span></a><span class="sd">        default_agent_name : str, default &quot;ind0&quot;</span>
</span><span id="L-2114"><a href="#L-2114"><span class="linenos">2114</span></a><span class="sd">            the clip id to use when there is no given</span>
</span><span id="L-2115"><a href="#L-2115"><span class="linenos">2115</span></a><span class="sd">        separator : str, default &quot;,&quot;</span>
</span><span id="L-2116"><a href="#L-2116"><span class="linenos">2116</span></a><span class="sd">            the separator in the csv files</span>
</span><span id="L-2117"><a href="#L-2117"><span class="linenos">2117</span></a><span class="sd">        fps : int, default 30</span>
</span><span id="L-2118"><a href="#L-2118"><span class="linenos">2118</span></a><span class="sd">            frames per second in the videos</span>
</span><span id="L-2119"><a href="#L-2119"><span class="linenos">2119</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2120"><a href="#L-2120"><span class="linenos">2120</span></a>
</span><span id="L-2121"><a href="#L-2121"><span class="linenos">2121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_agent_name</span> <span class="o">=</span> <span class="n">default_agent_name</span>
</span><span id="L-2122"><a href="#L-2122"><span class="linenos">2122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">separator</span> <span class="o">=</span> <span class="n">separator</span>
</span><span id="L-2123"><a href="#L-2123"><span class="linenos">2123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="n">fps</span>
</span><span id="L-2124"><a href="#L-2124"><span class="linenos">2124</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-2125"><a href="#L-2125"><span class="linenos">2125</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="L-2126"><a href="#L-2126"><span class="linenos">2126</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="L-2127"><a href="#L-2127"><span class="linenos">2127</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="L-2128"><a href="#L-2128"><span class="linenos">2128</span></a>            <span class="n">visibility</span><span class="o">=</span><span class="n">visibility</span><span class="p">,</span>
</span><span id="L-2129"><a href="#L-2129"><span class="linenos">2129</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="L-2130"><a href="#L-2130"><span class="linenos">2130</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="L-2131"><a href="#L-2131"><span class="linenos">2131</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="L-2132"><a href="#L-2132"><span class="linenos">2132</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="L-2133"><a href="#L-2133"><span class="linenos">2133</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="L-2134"><a href="#L-2134"><span class="linenos">2134</span></a>            <span class="n">ignored_clips</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-2135"><a href="#L-2135"><span class="linenos">2135</span></a>            <span class="n">annotation_suffix</span><span class="o">=</span><span class="n">annotation_suffix</span><span class="p">,</span>
</span><span id="L-2136"><a href="#L-2136"><span class="linenos">2136</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="L-2137"><a href="#L-2137"><span class="linenos">2137</span></a>            <span class="n">behavior_file</span><span class="o">=</span><span class="n">behavior_file</span><span class="p">,</span>
</span><span id="L-2138"><a href="#L-2138"><span class="linenos">2138</span></a>            <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span>
</span><span id="L-2139"><a href="#L-2139"><span class="linenos">2139</span></a>            <span class="n">frame_limit</span><span class="o">=</span><span class="n">frame_limit</span><span class="p">,</span>
</span><span id="L-2140"><a href="#L-2140"><span class="linenos">2140</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="n">filter_annotated</span><span class="p">,</span>
</span><span id="L-2141"><a href="#L-2141"><span class="linenos">2141</span></a>            <span class="n">filter_background</span><span class="o">=</span><span class="n">filter_background</span><span class="p">,</span>
</span><span id="L-2142"><a href="#L-2142"><span class="linenos">2142</span></a>            <span class="n">error_class</span><span class="o">=</span><span class="n">error_class</span><span class="p">,</span>
</span><span id="L-2143"><a href="#L-2143"><span class="linenos">2143</span></a>            <span class="n">min_frames_action</span><span class="o">=</span><span class="n">min_frames_action</span><span class="p">,</span>
</span><span id="L-2144"><a href="#L-2144"><span class="linenos">2144</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="L-2145"><a href="#L-2145"><span class="linenos">2145</span></a>            <span class="n">visibility_min_score</span><span class="o">=</span><span class="n">visibility_min_score</span><span class="p">,</span>
</span><span id="L-2146"><a href="#L-2146"><span class="linenos">2146</span></a>            <span class="n">visibility_min_frac</span><span class="o">=</span><span class="n">visibility_min_frac</span><span class="p">,</span>
</span><span id="L-2147"><a href="#L-2147"><span class="linenos">2147</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="L-2148"><a href="#L-2148"><span class="linenos">2148</span></a>        <span class="p">)</span>
</span><span id="L-2149"><a href="#L-2149"><span class="linenos">2149</span></a>
</span><span id="L-2150"><a href="#L-2150"><span class="linenos">2150</span></a>    <span class="k">def</span> <span class="nf">_open_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-2151"><a href="#L-2151"><span class="linenos">2151</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2152"><a href="#L-2152"><span class="linenos">2152</span></a><span class="sd">        Load the annotation from `filename`</span>
</span><span id="L-2153"><a href="#L-2153"><span class="linenos">2153</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2154"><a href="#L-2154"><span class="linenos">2154</span></a>
</span><span id="L-2155"><a href="#L-2155"><span class="linenos">2155</span></a>        <span class="c1"># try:</span>
</span><span id="L-2156"><a href="#L-2156"><span class="linenos">2156</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">separator</span><span class="p">)</span>
</span><span id="L-2157"><a href="#L-2157"><span class="linenos">2157</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
</span><span id="L-2158"><a href="#L-2158"><span class="linenos">2158</span></a>        <span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">,</span> <span class="n">actions</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-2159"><a href="#L-2159"><span class="linenos">2159</span></a>        <span class="n">start_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">]</span>
</span><span id="L-2160"><a href="#L-2160"><span class="linenos">2160</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">start_names</span><span class="p">:</span>
</span><span id="L-2161"><a href="#L-2161"><span class="linenos">2161</span></a>            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-2162"><a href="#L-2162"><span class="linenos">2162</span></a>                <span class="n">starts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
</span><span id="L-2163"><a href="#L-2163"><span class="linenos">2163</span></a>        <span class="n">end_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">]</span>
</span><span id="L-2164"><a href="#L-2164"><span class="linenos">2164</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">end_names</span><span class="p">:</span>
</span><span id="L-2165"><a href="#L-2165"><span class="linenos">2165</span></a>            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-2166"><a href="#L-2166"><span class="linenos">2166</span></a>                <span class="n">ends</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
</span><span id="L-2167"><a href="#L-2167"><span class="linenos">2167</span></a>        <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;behavior&quot;</span><span class="p">,</span> <span class="s2">&quot;behaviour&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">]</span>
</span><span id="L-2168"><a href="#L-2168"><span class="linenos">2168</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">class_names</span><span class="p">:</span>
</span><span id="L-2169"><a href="#L-2169"><span class="linenos">2169</span></a>            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-2170"><a href="#L-2170"><span class="linenos">2170</span></a>                <span class="n">actions</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
</span><span id="L-2171"><a href="#L-2171"><span class="linenos">2171</span></a>        <span class="k">if</span> <span class="n">starts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2172"><a href="#L-2172"><span class="linenos">2172</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The file must have a column titled &#39;from&#39; or &#39;start&#39;!&quot;</span><span class="p">)</span>
</span><span id="L-2173"><a href="#L-2173"><span class="linenos">2173</span></a>        <span class="k">if</span> <span class="n">ends</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2174"><a href="#L-2174"><span class="linenos">2174</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The file must have a column titled &#39;to&#39; or &#39;end&#39;!&quot;</span><span class="p">)</span>
</span><span id="L-2175"><a href="#L-2175"><span class="linenos">2175</span></a>        <span class="k">if</span> <span class="n">actions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2176"><a href="#L-2176"><span class="linenos">2176</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2177"><a href="#L-2177"><span class="linenos">2177</span></a>                <span class="s2">&quot;The file must have a column titled &#39;class&#39;, &#39;behavior&#39;, &#39;behaviour&#39;, &#39;type&#39; or &#39;label&#39;!&quot;</span>
</span><span id="L-2178"><a href="#L-2178"><span class="linenos">2178</span></a>            <span class="p">)</span>
</span><span id="L-2179"><a href="#L-2179"><span class="linenos">2179</span></a>        <span class="n">times</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[]))</span>
</span><span id="L-2180"><a href="#L-2180"><span class="linenos">2180</span></a>        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">action</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
</span><span id="L-2181"><a href="#L-2181"><span class="linenos">2181</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">]]):</span>
</span><span id="L-2182"><a href="#L-2182"><span class="linenos">2182</span></a>                <span class="k">continue</span>
</span><span id="L-2183"><a href="#L-2183"><span class="linenos">2183</span></a>            <span class="n">times</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_agent_name</span><span class="p">][</span><span class="n">action</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2184"><a href="#L-2184"><span class="linenos">2184</span></a>                <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-2185"><a href="#L-2185"><span class="linenos">2185</span></a>            <span class="p">)</span>
</span><span id="L-2186"><a href="#L-2186"><span class="linenos">2186</span></a>        <span class="k">return</span> <span class="n">times</span>
</span><span id="L-2187"><a href="#L-2187"><span class="linenos">2187</span></a>
</span><span id="L-2188"><a href="#L-2188"><span class="linenos">2188</span></a>
</span><span id="L-2189"><a href="#L-2189"><span class="linenos">2189</span></a><span class="k">class</span> <span class="nc">SIMBAAnnotationStore</span><span class="p">(</span><span class="n">FileAnnotationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="L-2190"><a href="#L-2190"><span class="linenos">2190</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2191"><a href="#L-2191"><span class="linenos">2191</span></a><span class="sd">    SIMBA paper format data</span>
</span><span id="L-2192"><a href="#L-2192"><span class="linenos">2192</span></a>
</span><span id="L-2193"><a href="#L-2193"><span class="linenos">2193</span></a><span class="sd">    Assumes the following file structure:</span>
</span><span id="L-2194"><a href="#L-2194"><span class="linenos">2194</span></a><span class="sd">    ```</span>
</span><span id="L-2195"><a href="#L-2195"><span class="linenos">2195</span></a><span class="sd">    annotation_path</span>
</span><span id="L-2196"><a href="#L-2196"><span class="linenos">2196</span></a><span class="sd">     Video1.csv</span>
</span><span id="L-2197"><a href="#L-2197"><span class="linenos">2197</span></a><span class="sd">    ...</span>
</span><span id="L-2198"><a href="#L-2198"><span class="linenos">2198</span></a><span class="sd">     Video9.csv</span>
</span><span id="L-2199"><a href="#L-2199"><span class="linenos">2199</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2200"><a href="#L-2200"><span class="linenos">2200</span></a>
</span><span id="L-2201"><a href="#L-2201"><span class="linenos">2201</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-2202"><a href="#L-2202"><span class="linenos">2202</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2203"><a href="#L-2203"><span class="linenos">2203</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2204"><a href="#L-2204"><span class="linenos">2204</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2205"><a href="#L-2205"><span class="linenos">2205</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2206"><a href="#L-2206"><span class="linenos">2206</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2207"><a href="#L-2207"><span class="linenos">2207</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2208"><a href="#L-2208"><span class="linenos">2208</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="L-2209"><a href="#L-2209"><span class="linenos">2209</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2210"><a href="#L-2210"><span class="linenos">2210</span></a>        <span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2211"><a href="#L-2211"><span class="linenos">2211</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2212"><a href="#L-2212"><span class="linenos">2212</span></a>        <span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2213"><a href="#L-2213"><span class="linenos">2213</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2214"><a href="#L-2214"><span class="linenos">2214</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2215"><a href="#L-2215"><span class="linenos">2215</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2216"><a href="#L-2216"><span class="linenos">2216</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2217"><a href="#L-2217"><span class="linenos">2217</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2218"><a href="#L-2218"><span class="linenos">2218</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2219"><a href="#L-2219"><span class="linenos">2219</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2220"><a href="#L-2220"><span class="linenos">2220</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="L-2221"><a href="#L-2221"><span class="linenos">2221</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
</span><span id="L-2222"><a href="#L-2222"><span class="linenos">2222</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2223"><a href="#L-2223"><span class="linenos">2223</span></a>        <span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2224"><a href="#L-2224"><span class="linenos">2224</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2225"><a href="#L-2225"><span class="linenos">2225</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="L-2226"><a href="#L-2226"><span class="linenos">2226</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-2227"><a href="#L-2227"><span class="linenos">2227</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2228"><a href="#L-2228"><span class="linenos">2228</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2229"><a href="#L-2229"><span class="linenos">2229</span></a><span class="sd">        Parameters</span>
</span><span id="L-2230"><a href="#L-2230"><span class="linenos">2230</span></a><span class="sd">        ----------</span>
</span><span id="L-2231"><a href="#L-2231"><span class="linenos">2231</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="L-2232"><a href="#L-2232"><span class="linenos">2232</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="L-2233"><a href="#L-2233"><span class="linenos">2233</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="L-2234"><a href="#L-2234"><span class="linenos">2234</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-2235"><a href="#L-2235"><span class="linenos">2235</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="L-2236"><a href="#L-2236"><span class="linenos">2236</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="L-2237"><a href="#L-2237"><span class="linenos">2237</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-2238"><a href="#L-2238"><span class="linenos">2238</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="L-2239"><a href="#L-2239"><span class="linenos">2239</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="L-2240"><a href="#L-2240"><span class="linenos">2240</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="L-2241"><a href="#L-2241"><span class="linenos">2241</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="L-2242"><a href="#L-2242"><span class="linenos">2242</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="L-2243"><a href="#L-2243"><span class="linenos">2243</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="L-2244"><a href="#L-2244"><span class="linenos">2244</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="L-2245"><a href="#L-2245"><span class="linenos">2245</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="L-2246"><a href="#L-2246"><span class="linenos">2246</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="L-2247"><a href="#L-2247"><span class="linenos">2247</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="L-2248"><a href="#L-2248"><span class="linenos">2248</span></a><span class="sd">        behaviors : set, optional</span>
</span><span id="L-2249"><a href="#L-2249"><span class="linenos">2249</span></a><span class="sd">            the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are</span>
</span><span id="L-2250"><a href="#L-2250"><span class="linenos">2250</span></a><span class="sd">            loaded from a file)</span>
</span><span id="L-2251"><a href="#L-2251"><span class="linenos">2251</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="L-2252"><a href="#L-2252"><span class="linenos">2252</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="L-2253"><a href="#L-2253"><span class="linenos">2253</span></a><span class="sd">        ignored_clips : set, optional</span>
</span><span id="L-2254"><a href="#L-2254"><span class="linenos">2254</span></a><span class="sd">            clip ids to ignore</span>
</span><span id="L-2255"><a href="#L-2255"><span class="linenos">2255</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="L-2256"><a href="#L-2256"><span class="linenos">2256</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="L-2257"><a href="#L-2257"><span class="linenos">2257</span></a><span class="sd">            from key objects)</span>
</span><span id="L-2258"><a href="#L-2258"><span class="linenos">2258</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="L-2259"><a href="#L-2259"><span class="linenos">2259</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="L-2260"><a href="#L-2260"><span class="linenos">2260</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="L-2261"><a href="#L-2261"><span class="linenos">2261</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="L-2262"><a href="#L-2262"><span class="linenos">2262</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="L-2263"><a href="#L-2263"><span class="linenos">2263</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="L-2264"><a href="#L-2264"><span class="linenos">2264</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="L-2265"><a href="#L-2265"><span class="linenos">2265</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="L-2266"><a href="#L-2266"><span class="linenos">2266</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="L-2267"><a href="#L-2267"><span class="linenos">2267</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="L-2268"><a href="#L-2268"><span class="linenos">2268</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="L-2269"><a href="#L-2269"><span class="linenos">2269</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="L-2270"><a href="#L-2270"><span class="linenos">2270</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="L-2271"><a href="#L-2271"><span class="linenos">2271</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="L-2272"><a href="#L-2272"><span class="linenos">2272</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="L-2273"><a href="#L-2273"><span class="linenos">2273</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="L-2274"><a href="#L-2274"><span class="linenos">2274</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="L-2275"><a href="#L-2275"><span class="linenos">2275</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="L-2276"><a href="#L-2276"><span class="linenos">2276</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="L-2277"><a href="#L-2277"><span class="linenos">2277</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="L-2278"><a href="#L-2278"><span class="linenos">2278</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="L-2279"><a href="#L-2279"><span class="linenos">2279</span></a><span class="sd">        use_hard_negatives : bool, default False</span>
</span><span id="L-2280"><a href="#L-2280"><span class="linenos">2280</span></a><span class="sd">            mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing</span>
</span><span id="L-2281"><a href="#L-2281"><span class="linenos">2281</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="L-2282"><a href="#L-2282"><span class="linenos">2282</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="L-2283"><a href="#L-2283"><span class="linenos">2283</span></a><span class="sd">            (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="L-2284"><a href="#L-2284"><span class="linenos">2284</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2285"><a href="#L-2285"><span class="linenos">2285</span></a>
</span><span id="L-2286"><a href="#L-2286"><span class="linenos">2286</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-2287"><a href="#L-2287"><span class="linenos">2287</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="L-2288"><a href="#L-2288"><span class="linenos">2288</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="L-2289"><a href="#L-2289"><span class="linenos">2289</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="L-2290"><a href="#L-2290"><span class="linenos">2290</span></a>            <span class="n">visibility</span><span class="o">=</span><span class="n">visibility</span><span class="p">,</span>
</span><span id="L-2291"><a href="#L-2291"><span class="linenos">2291</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="L-2292"><a href="#L-2292"><span class="linenos">2292</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="L-2293"><a href="#L-2293"><span class="linenos">2293</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="L-2294"><a href="#L-2294"><span class="linenos">2294</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="L-2295"><a href="#L-2295"><span class="linenos">2295</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="L-2296"><a href="#L-2296"><span class="linenos">2296</span></a>            <span class="n">ignored_clips</span><span class="o">=</span><span class="n">ignored_clips</span><span class="p">,</span>
</span><span id="L-2297"><a href="#L-2297"><span class="linenos">2297</span></a>            <span class="n">annotation_suffix</span><span class="o">=</span><span class="n">annotation_suffix</span><span class="p">,</span>
</span><span id="L-2298"><a href="#L-2298"><span class="linenos">2298</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="L-2299"><a href="#L-2299"><span class="linenos">2299</span></a>            <span class="n">behavior_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-2300"><a href="#L-2300"><span class="linenos">2300</span></a>            <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span>
</span><span id="L-2301"><a href="#L-2301"><span class="linenos">2301</span></a>            <span class="n">frame_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-2302"><a href="#L-2302"><span class="linenos">2302</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="n">filter_annotated</span><span class="p">,</span>
</span><span id="L-2303"><a href="#L-2303"><span class="linenos">2303</span></a>            <span class="n">filter_background</span><span class="o">=</span><span class="n">filter_background</span><span class="p">,</span>
</span><span id="L-2304"><a href="#L-2304"><span class="linenos">2304</span></a>            <span class="n">error_class</span><span class="o">=</span><span class="n">error_class</span><span class="p">,</span>
</span><span id="L-2305"><a href="#L-2305"><span class="linenos">2305</span></a>            <span class="n">min_frames_action</span><span class="o">=</span><span class="n">min_frames_action</span><span class="p">,</span>
</span><span id="L-2306"><a href="#L-2306"><span class="linenos">2306</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="L-2307"><a href="#L-2307"><span class="linenos">2307</span></a>            <span class="n">visibility_min_score</span><span class="o">=</span><span class="n">visibility_min_score</span><span class="p">,</span>
</span><span id="L-2308"><a href="#L-2308"><span class="linenos">2308</span></a>            <span class="n">visibility_min_frac</span><span class="o">=</span><span class="n">visibility_min_frac</span><span class="p">,</span>
</span><span id="L-2309"><a href="#L-2309"><span class="linenos">2309</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="L-2310"><a href="#L-2310"><span class="linenos">2310</span></a>            <span class="n">use_hard_negatives</span><span class="o">=</span><span class="n">use_hard_negatives</span><span class="p">,</span>
</span><span id="L-2311"><a href="#L-2311"><span class="linenos">2311</span></a>            <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-2312"><a href="#L-2312"><span class="linenos">2312</span></a>        <span class="p">)</span>
</span><span id="L-2313"><a href="#L-2313"><span class="linenos">2313</span></a>
</span><span id="L-2314"><a href="#L-2314"><span class="linenos">2314</span></a>    <span class="k">def</span> <span class="nf">_open_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-2315"><a href="#L-2315"><span class="linenos">2315</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2316"><a href="#L-2316"><span class="linenos">2316</span></a><span class="sd">        Load the annotation from filename</span>
</span><span id="L-2317"><a href="#L-2317"><span class="linenos">2317</span></a>
</span><span id="L-2318"><a href="#L-2318"><span class="linenos">2318</span></a><span class="sd">        Parameters</span>
</span><span id="L-2319"><a href="#L-2319"><span class="linenos">2319</span></a><span class="sd">        ----------</span>
</span><span id="L-2320"><a href="#L-2320"><span class="linenos">2320</span></a><span class="sd">        filename : str</span>
</span><span id="L-2321"><a href="#L-2321"><span class="linenos">2321</span></a><span class="sd">            path to an annotation file</span>
</span><span id="L-2322"><a href="#L-2322"><span class="linenos">2322</span></a>
</span><span id="L-2323"><a href="#L-2323"><span class="linenos">2323</span></a><span class="sd">        Returns</span>
</span><span id="L-2324"><a href="#L-2324"><span class="linenos">2324</span></a><span class="sd">        -------</span>
</span><span id="L-2325"><a href="#L-2325"><span class="linenos">2325</span></a><span class="sd">        times : dict</span>
</span><span id="L-2326"><a href="#L-2326"><span class="linenos">2326</span></a><span class="sd">            a nested dictionary where first-level keys are clip ids, second-level keys are categories and values are</span>
</span><span id="L-2327"><a href="#L-2327"><span class="linenos">2327</span></a><span class="sd">            lists of (start, end, ambiguity status) lists</span>
</span><span id="L-2328"><a href="#L-2328"><span class="linenos">2328</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2329"><a href="#L-2329"><span class="linenos">2329</span></a>
</span><span id="L-2330"><a href="#L-2330"><span class="linenos">2330</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-2331"><a href="#L-2331"><span class="linenos">2331</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
</span><span id="L-2332"><a href="#L-2332"><span class="linenos">2332</span></a>        <span class="n">animals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]))</span>
</span><span id="L-2333"><a href="#L-2333"><span class="linenos">2333</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-2334"><a href="#L-2334"><span class="linenos">2334</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-2335"><a href="#L-2335"><span class="linenos">2335</span></a>                <span class="s2">&quot;SIMBAAnnotationStore is only implemented for files with 1 or 2 animals!&quot;</span>
</span><span id="L-2336"><a href="#L-2336"><span class="linenos">2336</span></a>            <span class="p">)</span>
</span><span id="L-2337"><a href="#L-2337"><span class="linenos">2337</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2338"><a href="#L-2338"><span class="linenos">2338</span></a>            <span class="n">ind</span> <span class="o">=</span> <span class="n">animals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2339"><a href="#L-2339"><span class="linenos">2339</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2340"><a href="#L-2340"><span class="linenos">2340</span></a>            <span class="n">ind</span> <span class="o">=</span> <span class="s2">&quot;+&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span>
</span><span id="L-2341"><a href="#L-2341"><span class="linenos">2341</span></a>        <span class="n">behaviors</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2342"><a href="#L-2342"><span class="linenos">2342</span></a>            <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-2343"><a href="#L-2343"><span class="linenos">2343</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>
</span><span id="L-2344"><a href="#L-2344"><span class="linenos">2344</span></a>            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;prediction&quot;</span>
</span><span id="L-2345"><a href="#L-2345"><span class="linenos">2345</span></a>        <span class="p">]</span>
</span><span id="L-2346"><a href="#L-2346"><span class="linenos">2346</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2347"><a href="#L-2347"><span class="linenos">2347</span></a>        <span class="k">for</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">:</span>
</span><span id="L-2348"><a href="#L-2348"><span class="linenos">2348</span></a>            <span class="n">ann</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">behavior</span><span class="si">}</span><span class="s2">_prediction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="L-2349"><a href="#L-2349"><span class="linenos">2349</span></a>            <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span>
</span><span id="L-2350"><a href="#L-2350"><span class="linenos">2350</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">ann</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])])</span>
</span><span id="L-2351"><a href="#L-2351"><span class="linenos">2351</span></a>            <span class="p">)</span>
</span><span id="L-2352"><a href="#L-2352"><span class="linenos">2352</span></a>            <span class="n">starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2353"><a href="#L-2353"><span class="linenos">2353</span></a>            <span class="n">ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2354"><a href="#L-2354"><span class="linenos">2354</span></a>            <span class="n">result</span><span class="p">[</span><span class="n">behavior</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)]</span>
</span><span id="L-2355"><a href="#L-2355"><span class="linenos">2355</span></a>            <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span>
</span><span id="L-2356"><a href="#L-2356"><span class="linenos">2356</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="L-2357"><a href="#L-2357"><span class="linenos">2357</span></a>                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ann</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="L-2358"><a href="#L-2358"><span class="linenos">2358</span></a>                <span class="p">)</span>
</span><span id="L-2359"><a href="#L-2359"><span class="linenos">2359</span></a>            <span class="p">)</span>
</span><span id="L-2360"><a href="#L-2360"><span class="linenos">2360</span></a>            <span class="n">starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2361"><a href="#L-2361"><span class="linenos">2361</span></a>            <span class="n">ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2362"><a href="#L-2362"><span class="linenos">2362</span></a>            <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;unknown </span><span class="si">{</span><span class="n">behavior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2363"><a href="#L-2363"><span class="linenos">2363</span></a>                <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)</span>
</span><span id="L-2364"><a href="#L-2364"><span class="linenos">2364</span></a>            <span class="p">]</span>
</span><span id="L-2365"><a href="#L-2365"><span class="linenos">2365</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2366"><a href="#L-2366"><span class="linenos">2366</span></a>            <span class="k">for</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">:</span>
</span><span id="L-2367"><a href="#L-2367"><span class="linenos">2367</span></a>                <span class="k">if</span> <span class="n">behavior</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">:</span>
</span><span id="L-2368"><a href="#L-2368"><span class="linenos">2368</span></a>                    <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;unknown </span><span class="si">{</span><span class="n">behavior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">0</span><span class="p">]]</span>
</span><span id="L-2369"><a href="#L-2369"><span class="linenos">2369</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">ind</span><span class="p">:</span> <span class="n">result</span><span class="p">}</span>
</span></pre></div>


            </section>
                <section id="EmptyAnnotationStore">
                            <input id="EmptyAnnotationStore-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EmptyAnnotationStore</span><wbr>(<span class="base"><a href="base_store.html#AnnotationStore">dlc2action.data.base_store.AnnotationStore</a></span>):

                <label class="view-source-button" for="EmptyAnnotationStore-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore-28"><a href="#EmptyAnnotationStore-28"><span class="linenos"> 28</span></a><span class="k">class</span> <span class="nc">EmptyAnnotationStore</span><span class="p">(</span><span class="n">AnnotationStore</span><span class="p">):</span>
</span><span id="EmptyAnnotationStore-29"><a href="#EmptyAnnotationStore-29"><span class="linenos"> 29</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="EmptyAnnotationStore-30"><a href="#EmptyAnnotationStore-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="EmptyAnnotationStore-31"><a href="#EmptyAnnotationStore-31"><span class="linenos"> 31</span></a>    <span class="p">):</span>
</span><span id="EmptyAnnotationStore-32"><a href="#EmptyAnnotationStore-32"><span class="linenos"> 32</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-33"><a href="#EmptyAnnotationStore-33"><span class="linenos"> 33</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore-34"><a href="#EmptyAnnotationStore-34"><span class="linenos"> 34</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore-35"><a href="#EmptyAnnotationStore-35"><span class="linenos"> 35</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="EmptyAnnotationStore-36"><a href="#EmptyAnnotationStore-36"><span class="linenos"> 36</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="EmptyAnnotationStore-37"><a href="#EmptyAnnotationStore-37"><span class="linenos"> 37</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="EmptyAnnotationStore-38"><a href="#EmptyAnnotationStore-38"><span class="linenos"> 38</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="EmptyAnnotationStore-39"><a href="#EmptyAnnotationStore-39"><span class="linenos"> 39</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-40"><a href="#EmptyAnnotationStore-40"><span class="linenos"> 40</span></a>
</span><span id="EmptyAnnotationStore-41"><a href="#EmptyAnnotationStore-41"><span class="linenos"> 41</span></a>        <span class="k">pass</span>
</span><span id="EmptyAnnotationStore-42"><a href="#EmptyAnnotationStore-42"><span class="linenos"> 42</span></a>
</span><span id="EmptyAnnotationStore-43"><a href="#EmptyAnnotationStore-43"><span class="linenos"> 43</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-44"><a href="#EmptyAnnotationStore-44"><span class="linenos"> 44</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-45"><a href="#EmptyAnnotationStore-45"><span class="linenos"> 45</span></a><span class="sd">        Get the number of available samples</span>
</span><span id="EmptyAnnotationStore-46"><a href="#EmptyAnnotationStore-46"><span class="linenos"> 46</span></a>
</span><span id="EmptyAnnotationStore-47"><a href="#EmptyAnnotationStore-47"><span class="linenos"> 47</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore-48"><a href="#EmptyAnnotationStore-48"><span class="linenos"> 48</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore-49"><a href="#EmptyAnnotationStore-49"><span class="linenos"> 49</span></a><span class="sd">        length : int</span>
</span><span id="EmptyAnnotationStore-50"><a href="#EmptyAnnotationStore-50"><span class="linenos"> 50</span></a><span class="sd">            the number of available samples</span>
</span><span id="EmptyAnnotationStore-51"><a href="#EmptyAnnotationStore-51"><span class="linenos"> 51</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-52"><a href="#EmptyAnnotationStore-52"><span class="linenos"> 52</span></a>
</span><span id="EmptyAnnotationStore-53"><a href="#EmptyAnnotationStore-53"><span class="linenos"> 53</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="EmptyAnnotationStore-54"><a href="#EmptyAnnotationStore-54"><span class="linenos"> 54</span></a>
</span><span id="EmptyAnnotationStore-55"><a href="#EmptyAnnotationStore-55"><span class="linenos"> 55</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-56"><a href="#EmptyAnnotationStore-56"><span class="linenos"> 56</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-57"><a href="#EmptyAnnotationStore-57"><span class="linenos"> 57</span></a><span class="sd">        Remove the samples corresponding to indices</span>
</span><span id="EmptyAnnotationStore-58"><a href="#EmptyAnnotationStore-58"><span class="linenos"> 58</span></a>
</span><span id="EmptyAnnotationStore-59"><a href="#EmptyAnnotationStore-59"><span class="linenos"> 59</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore-60"><a href="#EmptyAnnotationStore-60"><span class="linenos"> 60</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore-61"><a href="#EmptyAnnotationStore-61"><span class="linenos"> 61</span></a><span class="sd">        indices : int</span>
</span><span id="EmptyAnnotationStore-62"><a href="#EmptyAnnotationStore-62"><span class="linenos"> 62</span></a><span class="sd">            a list of integer indices to remove</span>
</span><span id="EmptyAnnotationStore-63"><a href="#EmptyAnnotationStore-63"><span class="linenos"> 63</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-64"><a href="#EmptyAnnotationStore-64"><span class="linenos"> 64</span></a>
</span><span id="EmptyAnnotationStore-65"><a href="#EmptyAnnotationStore-65"><span class="linenos"> 65</span></a>        <span class="k">pass</span>
</span><span id="EmptyAnnotationStore-66"><a href="#EmptyAnnotationStore-66"><span class="linenos"> 66</span></a>
</span><span id="EmptyAnnotationStore-67"><a href="#EmptyAnnotationStore-67"><span class="linenos"> 67</span></a>    <span class="k">def</span> <span class="nf">key_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-68"><a href="#EmptyAnnotationStore-68"><span class="linenos"> 68</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-69"><a href="#EmptyAnnotationStore-69"><span class="linenos"> 69</span></a><span class="sd">        Return a tuple of the key objects necessary to re-create the Store</span>
</span><span id="EmptyAnnotationStore-70"><a href="#EmptyAnnotationStore-70"><span class="linenos"> 70</span></a>
</span><span id="EmptyAnnotationStore-71"><a href="#EmptyAnnotationStore-71"><span class="linenos"> 71</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore-72"><a href="#EmptyAnnotationStore-72"><span class="linenos"> 72</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore-73"><a href="#EmptyAnnotationStore-73"><span class="linenos"> 73</span></a><span class="sd">        key_objects : tuple</span>
</span><span id="EmptyAnnotationStore-74"><a href="#EmptyAnnotationStore-74"><span class="linenos"> 74</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="EmptyAnnotationStore-75"><a href="#EmptyAnnotationStore-75"><span class="linenos"> 75</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-76"><a href="#EmptyAnnotationStore-76"><span class="linenos"> 76</span></a>
</span><span id="EmptyAnnotationStore-77"><a href="#EmptyAnnotationStore-77"><span class="linenos"> 77</span></a>        <span class="k">return</span> <span class="p">()</span>
</span><span id="EmptyAnnotationStore-78"><a href="#EmptyAnnotationStore-78"><span class="linenos"> 78</span></a>
</span><span id="EmptyAnnotationStore-79"><a href="#EmptyAnnotationStore-79"><span class="linenos"> 79</span></a>    <span class="k">def</span> <span class="nf">load_from_key_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-80"><a href="#EmptyAnnotationStore-80"><span class="linenos"> 80</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-81"><a href="#EmptyAnnotationStore-81"><span class="linenos"> 81</span></a><span class="sd">        Load the information from a tuple of key objects</span>
</span><span id="EmptyAnnotationStore-82"><a href="#EmptyAnnotationStore-82"><span class="linenos"> 82</span></a>
</span><span id="EmptyAnnotationStore-83"><a href="#EmptyAnnotationStore-83"><span class="linenos"> 83</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore-84"><a href="#EmptyAnnotationStore-84"><span class="linenos"> 84</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore-85"><a href="#EmptyAnnotationStore-85"><span class="linenos"> 85</span></a><span class="sd">        key_objects : tuple</span>
</span><span id="EmptyAnnotationStore-86"><a href="#EmptyAnnotationStore-86"><span class="linenos"> 86</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="EmptyAnnotationStore-87"><a href="#EmptyAnnotationStore-87"><span class="linenos"> 87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-88"><a href="#EmptyAnnotationStore-88"><span class="linenos"> 88</span></a>
</span><span id="EmptyAnnotationStore-89"><a href="#EmptyAnnotationStore-89"><span class="linenos"> 89</span></a>        <span class="k">pass</span>
</span><span id="EmptyAnnotationStore-90"><a href="#EmptyAnnotationStore-90"><span class="linenos"> 90</span></a>
</span><span id="EmptyAnnotationStore-91"><a href="#EmptyAnnotationStore-91"><span class="linenos"> 91</span></a>    <span class="k">def</span> <span class="nf">to_ram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-92"><a href="#EmptyAnnotationStore-92"><span class="linenos"> 92</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-93"><a href="#EmptyAnnotationStore-93"><span class="linenos"> 93</span></a><span class="sd">        Transfer the data samples to RAM if they were previously stored as file paths</span>
</span><span id="EmptyAnnotationStore-94"><a href="#EmptyAnnotationStore-94"><span class="linenos"> 94</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-95"><a href="#EmptyAnnotationStore-95"><span class="linenos"> 95</span></a>
</span><span id="EmptyAnnotationStore-96"><a href="#EmptyAnnotationStore-96"><span class="linenos"> 96</span></a>        <span class="k">pass</span>
</span><span id="EmptyAnnotationStore-97"><a href="#EmptyAnnotationStore-97"><span class="linenos"> 97</span></a>
</span><span id="EmptyAnnotationStore-98"><a href="#EmptyAnnotationStore-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">get_original_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-99"><a href="#EmptyAnnotationStore-99"><span class="linenos"> 99</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-100"><a href="#EmptyAnnotationStore-100"><span class="linenos">100</span></a><span class="sd">        Return the original coordinates array</span>
</span><span id="EmptyAnnotationStore-101"><a href="#EmptyAnnotationStore-101"><span class="linenos">101</span></a>
</span><span id="EmptyAnnotationStore-102"><a href="#EmptyAnnotationStore-102"><span class="linenos">102</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore-103"><a href="#EmptyAnnotationStore-103"><span class="linenos">103</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore-104"><a href="#EmptyAnnotationStore-104"><span class="linenos">104</span></a><span class="sd">        np.ndarray</span>
</span><span id="EmptyAnnotationStore-105"><a href="#EmptyAnnotationStore-105"><span class="linenos">105</span></a><span class="sd">            an array that contains the coordinates of the data samples in original input data (video id, clip id,</span>
</span><span id="EmptyAnnotationStore-106"><a href="#EmptyAnnotationStore-106"><span class="linenos">106</span></a><span class="sd">            start frame)</span>
</span><span id="EmptyAnnotationStore-107"><a href="#EmptyAnnotationStore-107"><span class="linenos">107</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-108"><a href="#EmptyAnnotationStore-108"><span class="linenos">108</span></a>
</span><span id="EmptyAnnotationStore-109"><a href="#EmptyAnnotationStore-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="EmptyAnnotationStore-110"><a href="#EmptyAnnotationStore-110"><span class="linenos">110</span></a>
</span><span id="EmptyAnnotationStore-111"><a href="#EmptyAnnotationStore-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="nf">create_subsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">ssl_indices</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="EmptyAnnotationStore-112"><a href="#EmptyAnnotationStore-112"><span class="linenos">112</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-113"><a href="#EmptyAnnotationStore-113"><span class="linenos">113</span></a><span class="sd">        Create a new store that contains a subsample of the data</span>
</span><span id="EmptyAnnotationStore-114"><a href="#EmptyAnnotationStore-114"><span class="linenos">114</span></a>
</span><span id="EmptyAnnotationStore-115"><a href="#EmptyAnnotationStore-115"><span class="linenos">115</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore-116"><a href="#EmptyAnnotationStore-116"><span class="linenos">116</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore-117"><a href="#EmptyAnnotationStore-117"><span class="linenos">117</span></a><span class="sd">        indices : list</span>
</span><span id="EmptyAnnotationStore-118"><a href="#EmptyAnnotationStore-118"><span class="linenos">118</span></a><span class="sd">            the indices to be included in the subsample</span>
</span><span id="EmptyAnnotationStore-119"><a href="#EmptyAnnotationStore-119"><span class="linenos">119</span></a><span class="sd">        ssl_indices : list, optional</span>
</span><span id="EmptyAnnotationStore-120"><a href="#EmptyAnnotationStore-120"><span class="linenos">120</span></a><span class="sd">            the indices to be included in the subsample without the annotation data</span>
</span><span id="EmptyAnnotationStore-121"><a href="#EmptyAnnotationStore-121"><span class="linenos">121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-122"><a href="#EmptyAnnotationStore-122"><span class="linenos">122</span></a>
</span><span id="EmptyAnnotationStore-123"><a href="#EmptyAnnotationStore-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
</span><span id="EmptyAnnotationStore-124"><a href="#EmptyAnnotationStore-124"><span class="linenos">124</span></a>
</span><span id="EmptyAnnotationStore-125"><a href="#EmptyAnnotationStore-125"><span class="linenos">125</span></a>    <span class="nd">@classmethod</span>
</span><span id="EmptyAnnotationStore-126"><a href="#EmptyAnnotationStore-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-127"><a href="#EmptyAnnotationStore-127"><span class="linenos">127</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-128"><a href="#EmptyAnnotationStore-128"><span class="linenos">128</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="EmptyAnnotationStore-129"><a href="#EmptyAnnotationStore-129"><span class="linenos">129</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="EmptyAnnotationStore-130"><a href="#EmptyAnnotationStore-130"><span class="linenos">130</span></a>
</span><span id="EmptyAnnotationStore-131"><a href="#EmptyAnnotationStore-131"><span class="linenos">131</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore-132"><a href="#EmptyAnnotationStore-132"><span class="linenos">132</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore-133"><a href="#EmptyAnnotationStore-133"><span class="linenos">133</span></a><span class="sd">        video_ids : list</span>
</span><span id="EmptyAnnotationStore-134"><a href="#EmptyAnnotationStore-134"><span class="linenos">134</span></a><span class="sd">            a list of video file ids</span>
</span><span id="EmptyAnnotationStore-135"><a href="#EmptyAnnotationStore-135"><span class="linenos">135</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-136"><a href="#EmptyAnnotationStore-136"><span class="linenos">136</span></a>
</span><span id="EmptyAnnotationStore-137"><a href="#EmptyAnnotationStore-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="EmptyAnnotationStore-138"><a href="#EmptyAnnotationStore-138"><span class="linenos">138</span></a>
</span><span id="EmptyAnnotationStore-139"><a href="#EmptyAnnotationStore-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-140"><a href="#EmptyAnnotationStore-140"><span class="linenos">140</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-141"><a href="#EmptyAnnotationStore-141"><span class="linenos">141</span></a><span class="sd">        Return the annotation of the sample corresponding to an index</span>
</span><span id="EmptyAnnotationStore-142"><a href="#EmptyAnnotationStore-142"><span class="linenos">142</span></a>
</span><span id="EmptyAnnotationStore-143"><a href="#EmptyAnnotationStore-143"><span class="linenos">143</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore-144"><a href="#EmptyAnnotationStore-144"><span class="linenos">144</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore-145"><a href="#EmptyAnnotationStore-145"><span class="linenos">145</span></a><span class="sd">        ind : int</span>
</span><span id="EmptyAnnotationStore-146"><a href="#EmptyAnnotationStore-146"><span class="linenos">146</span></a><span class="sd">            index of the sample</span>
</span><span id="EmptyAnnotationStore-147"><a href="#EmptyAnnotationStore-147"><span class="linenos">147</span></a>
</span><span id="EmptyAnnotationStore-148"><a href="#EmptyAnnotationStore-148"><span class="linenos">148</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore-149"><a href="#EmptyAnnotationStore-149"><span class="linenos">149</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore-150"><a href="#EmptyAnnotationStore-150"><span class="linenos">150</span></a><span class="sd">        sample : torch.Tensor</span>
</span><span id="EmptyAnnotationStore-151"><a href="#EmptyAnnotationStore-151"><span class="linenos">151</span></a><span class="sd">            the corresponding annotation tensor</span>
</span><span id="EmptyAnnotationStore-152"><a href="#EmptyAnnotationStore-152"><span class="linenos">152</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-153"><a href="#EmptyAnnotationStore-153"><span class="linenos">153</span></a>
</span><span id="EmptyAnnotationStore-154"><a href="#EmptyAnnotationStore-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">))</span>
</span><span id="EmptyAnnotationStore-155"><a href="#EmptyAnnotationStore-155"><span class="linenos">155</span></a>
</span><span id="EmptyAnnotationStore-156"><a href="#EmptyAnnotationStore-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="nf">get_len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-157"><a href="#EmptyAnnotationStore-157"><span class="linenos">157</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-158"><a href="#EmptyAnnotationStore-158"><span class="linenos">158</span></a><span class="sd">        Get the length of the subsample of labeled/unlabeled data</span>
</span><span id="EmptyAnnotationStore-159"><a href="#EmptyAnnotationStore-159"><span class="linenos">159</span></a>
</span><span id="EmptyAnnotationStore-160"><a href="#EmptyAnnotationStore-160"><span class="linenos">160</span></a><span class="sd">        If return_unlabeled is True, the index is in the subsample of unlabeled data, if False in labeled</span>
</span><span id="EmptyAnnotationStore-161"><a href="#EmptyAnnotationStore-161"><span class="linenos">161</span></a><span class="sd">        and if return_unlabeled is None the index is already correct</span>
</span><span id="EmptyAnnotationStore-162"><a href="#EmptyAnnotationStore-162"><span class="linenos">162</span></a>
</span><span id="EmptyAnnotationStore-163"><a href="#EmptyAnnotationStore-163"><span class="linenos">163</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore-164"><a href="#EmptyAnnotationStore-164"><span class="linenos">164</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore-165"><a href="#EmptyAnnotationStore-165"><span class="linenos">165</span></a><span class="sd">        return_unlabeled : bool</span>
</span><span id="EmptyAnnotationStore-166"><a href="#EmptyAnnotationStore-166"><span class="linenos">166</span></a><span class="sd">            the identifier for the subsample</span>
</span><span id="EmptyAnnotationStore-167"><a href="#EmptyAnnotationStore-167"><span class="linenos">167</span></a>
</span><span id="EmptyAnnotationStore-168"><a href="#EmptyAnnotationStore-168"><span class="linenos">168</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore-169"><a href="#EmptyAnnotationStore-169"><span class="linenos">169</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore-170"><a href="#EmptyAnnotationStore-170"><span class="linenos">170</span></a><span class="sd">        length : int</span>
</span><span id="EmptyAnnotationStore-171"><a href="#EmptyAnnotationStore-171"><span class="linenos">171</span></a><span class="sd">            the length of the subsample</span>
</span><span id="EmptyAnnotationStore-172"><a href="#EmptyAnnotationStore-172"><span class="linenos">172</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-173"><a href="#EmptyAnnotationStore-173"><span class="linenos">173</span></a>
</span><span id="EmptyAnnotationStore-174"><a href="#EmptyAnnotationStore-174"><span class="linenos">174</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="EmptyAnnotationStore-175"><a href="#EmptyAnnotationStore-175"><span class="linenos">175</span></a>
</span><span id="EmptyAnnotationStore-176"><a href="#EmptyAnnotationStore-176"><span class="linenos">176</span></a>    <span class="k">def</span> <span class="nf">get_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-177"><a href="#EmptyAnnotationStore-177"><span class="linenos">177</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-178"><a href="#EmptyAnnotationStore-178"><span class="linenos">178</span></a><span class="sd">        Convert from an index in the subsample of labeled/unlabeled data to an index in the full array</span>
</span><span id="EmptyAnnotationStore-179"><a href="#EmptyAnnotationStore-179"><span class="linenos">179</span></a>
</span><span id="EmptyAnnotationStore-180"><a href="#EmptyAnnotationStore-180"><span class="linenos">180</span></a><span class="sd">        If return_unlabeled is True, the index is in the subsample of unlabeled data, if False in labeled</span>
</span><span id="EmptyAnnotationStore-181"><a href="#EmptyAnnotationStore-181"><span class="linenos">181</span></a><span class="sd">        and if return_unlabeled is None the index is already correct</span>
</span><span id="EmptyAnnotationStore-182"><a href="#EmptyAnnotationStore-182"><span class="linenos">182</span></a>
</span><span id="EmptyAnnotationStore-183"><a href="#EmptyAnnotationStore-183"><span class="linenos">183</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore-184"><a href="#EmptyAnnotationStore-184"><span class="linenos">184</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore-185"><a href="#EmptyAnnotationStore-185"><span class="linenos">185</span></a><span class="sd">        index : int</span>
</span><span id="EmptyAnnotationStore-186"><a href="#EmptyAnnotationStore-186"><span class="linenos">186</span></a><span class="sd">            the index in the subsample</span>
</span><span id="EmptyAnnotationStore-187"><a href="#EmptyAnnotationStore-187"><span class="linenos">187</span></a><span class="sd">        return_unlabeled : bool</span>
</span><span id="EmptyAnnotationStore-188"><a href="#EmptyAnnotationStore-188"><span class="linenos">188</span></a><span class="sd">            the identifier for the subsample</span>
</span><span id="EmptyAnnotationStore-189"><a href="#EmptyAnnotationStore-189"><span class="linenos">189</span></a>
</span><span id="EmptyAnnotationStore-190"><a href="#EmptyAnnotationStore-190"><span class="linenos">190</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore-191"><a href="#EmptyAnnotationStore-191"><span class="linenos">191</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore-192"><a href="#EmptyAnnotationStore-192"><span class="linenos">192</span></a><span class="sd">        corrected_index : int</span>
</span><span id="EmptyAnnotationStore-193"><a href="#EmptyAnnotationStore-193"><span class="linenos">193</span></a><span class="sd">            the index in the full dataset</span>
</span><span id="EmptyAnnotationStore-194"><a href="#EmptyAnnotationStore-194"><span class="linenos">194</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-195"><a href="#EmptyAnnotationStore-195"><span class="linenos">195</span></a>
</span><span id="EmptyAnnotationStore-196"><a href="#EmptyAnnotationStore-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="n">index</span>
</span><span id="EmptyAnnotationStore-197"><a href="#EmptyAnnotationStore-197"><span class="linenos">197</span></a>
</span><span id="EmptyAnnotationStore-198"><a href="#EmptyAnnotationStore-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">count_classes</span><span class="p">(</span>
</span><span id="EmptyAnnotationStore-199"><a href="#EmptyAnnotationStore-199"><span class="linenos">199</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">frac</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zeros</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bouts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="EmptyAnnotationStore-200"><a href="#EmptyAnnotationStore-200"><span class="linenos">200</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-201"><a href="#EmptyAnnotationStore-201"><span class="linenos">201</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-202"><a href="#EmptyAnnotationStore-202"><span class="linenos">202</span></a><span class="sd">        Get a dictionary with class-wise frame counts</span>
</span><span id="EmptyAnnotationStore-203"><a href="#EmptyAnnotationStore-203"><span class="linenos">203</span></a>
</span><span id="EmptyAnnotationStore-204"><a href="#EmptyAnnotationStore-204"><span class="linenos">204</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore-205"><a href="#EmptyAnnotationStore-205"><span class="linenos">205</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore-206"><a href="#EmptyAnnotationStore-206"><span class="linenos">206</span></a><span class="sd">        frac : bool, default False</span>
</span><span id="EmptyAnnotationStore-207"><a href="#EmptyAnnotationStore-207"><span class="linenos">207</span></a><span class="sd">            if True, a fraction of the total frame count is returned</span>
</span><span id="EmptyAnnotationStore-208"><a href="#EmptyAnnotationStore-208"><span class="linenos">208</span></a>
</span><span id="EmptyAnnotationStore-209"><a href="#EmptyAnnotationStore-209"><span class="linenos">209</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore-210"><a href="#EmptyAnnotationStore-210"><span class="linenos">210</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore-211"><a href="#EmptyAnnotationStore-211"><span class="linenos">211</span></a><span class="sd">        count_dictionary : dict</span>
</span><span id="EmptyAnnotationStore-212"><a href="#EmptyAnnotationStore-212"><span class="linenos">212</span></a><span class="sd">            a dictionary with class indices as keys and frame counts as values</span>
</span><span id="EmptyAnnotationStore-213"><a href="#EmptyAnnotationStore-213"><span class="linenos">213</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-214"><a href="#EmptyAnnotationStore-214"><span class="linenos">214</span></a>
</span><span id="EmptyAnnotationStore-215"><a href="#EmptyAnnotationStore-215"><span class="linenos">215</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="EmptyAnnotationStore-216"><a href="#EmptyAnnotationStore-216"><span class="linenos">216</span></a>
</span><span id="EmptyAnnotationStore-217"><a href="#EmptyAnnotationStore-217"><span class="linenos">217</span></a>    <span class="k">def</span> <span class="nf">behaviors_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-218"><a href="#EmptyAnnotationStore-218"><span class="linenos">218</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-219"><a href="#EmptyAnnotationStore-219"><span class="linenos">219</span></a><span class="sd">        Get a dictionary of class names</span>
</span><span id="EmptyAnnotationStore-220"><a href="#EmptyAnnotationStore-220"><span class="linenos">220</span></a>
</span><span id="EmptyAnnotationStore-221"><a href="#EmptyAnnotationStore-221"><span class="linenos">221</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore-222"><a href="#EmptyAnnotationStore-222"><span class="linenos">222</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore-223"><a href="#EmptyAnnotationStore-223"><span class="linenos">223</span></a><span class="sd">        behavior_dictionary: dict</span>
</span><span id="EmptyAnnotationStore-224"><a href="#EmptyAnnotationStore-224"><span class="linenos">224</span></a><span class="sd">            a dictionary with class indices as keys and class names as values</span>
</span><span id="EmptyAnnotationStore-225"><a href="#EmptyAnnotationStore-225"><span class="linenos">225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-226"><a href="#EmptyAnnotationStore-226"><span class="linenos">226</span></a>
</span><span id="EmptyAnnotationStore-227"><a href="#EmptyAnnotationStore-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="EmptyAnnotationStore-228"><a href="#EmptyAnnotationStore-228"><span class="linenos">228</span></a>
</span><span id="EmptyAnnotationStore-229"><a href="#EmptyAnnotationStore-229"><span class="linenos">229</span></a>    <span class="k">def</span> <span class="nf">annotation_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-230"><a href="#EmptyAnnotationStore-230"><span class="linenos">230</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-231"><a href="#EmptyAnnotationStore-231"><span class="linenos">231</span></a><span class="sd">        Get the type of annotation (&#39;exclusive_classification&#39;, &#39;nonexclusive_classification&#39;, more coming soon)</span>
</span><span id="EmptyAnnotationStore-232"><a href="#EmptyAnnotationStore-232"><span class="linenos">232</span></a>
</span><span id="EmptyAnnotationStore-233"><a href="#EmptyAnnotationStore-233"><span class="linenos">233</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore-234"><a href="#EmptyAnnotationStore-234"><span class="linenos">234</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore-235"><a href="#EmptyAnnotationStore-235"><span class="linenos">235</span></a><span class="sd">        annotation_class : str</span>
</span><span id="EmptyAnnotationStore-236"><a href="#EmptyAnnotationStore-236"><span class="linenos">236</span></a><span class="sd">            the type of annotation</span>
</span><span id="EmptyAnnotationStore-237"><a href="#EmptyAnnotationStore-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-238"><a href="#EmptyAnnotationStore-238"><span class="linenos">238</span></a>
</span><span id="EmptyAnnotationStore-239"><a href="#EmptyAnnotationStore-239"><span class="linenos">239</span></a>        <span class="k">return</span> <span class="s2">&quot;none&quot;</span>
</span><span id="EmptyAnnotationStore-240"><a href="#EmptyAnnotationStore-240"><span class="linenos">240</span></a>
</span><span id="EmptyAnnotationStore-241"><a href="#EmptyAnnotationStore-241"><span class="linenos">241</span></a>    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-242"><a href="#EmptyAnnotationStore-242"><span class="linenos">242</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-243"><a href="#EmptyAnnotationStore-243"><span class="linenos">243</span></a><span class="sd">        Get the total number of frames in the data</span>
</span><span id="EmptyAnnotationStore-244"><a href="#EmptyAnnotationStore-244"><span class="linenos">244</span></a>
</span><span id="EmptyAnnotationStore-245"><a href="#EmptyAnnotationStore-245"><span class="linenos">245</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore-246"><a href="#EmptyAnnotationStore-246"><span class="linenos">246</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore-247"><a href="#EmptyAnnotationStore-247"><span class="linenos">247</span></a><span class="sd">        size : int</span>
</span><span id="EmptyAnnotationStore-248"><a href="#EmptyAnnotationStore-248"><span class="linenos">248</span></a><span class="sd">            the total number of frames</span>
</span><span id="EmptyAnnotationStore-249"><a href="#EmptyAnnotationStore-249"><span class="linenos">249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-250"><a href="#EmptyAnnotationStore-250"><span class="linenos">250</span></a>
</span><span id="EmptyAnnotationStore-251"><a href="#EmptyAnnotationStore-251"><span class="linenos">251</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="EmptyAnnotationStore-252"><a href="#EmptyAnnotationStore-252"><span class="linenos">252</span></a>
</span><span id="EmptyAnnotationStore-253"><a href="#EmptyAnnotationStore-253"><span class="linenos">253</span></a>    <span class="k">def</span> <span class="nf">filtered_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-254"><a href="#EmptyAnnotationStore-254"><span class="linenos">254</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-255"><a href="#EmptyAnnotationStore-255"><span class="linenos">255</span></a><span class="sd">        Return the indices of the samples that should be removed</span>
</span><span id="EmptyAnnotationStore-256"><a href="#EmptyAnnotationStore-256"><span class="linenos">256</span></a>
</span><span id="EmptyAnnotationStore-257"><a href="#EmptyAnnotationStore-257"><span class="linenos">257</span></a><span class="sd">        Choosing the indices can be based on any kind of filering defined in the __init__ function by the data</span>
</span><span id="EmptyAnnotationStore-258"><a href="#EmptyAnnotationStore-258"><span class="linenos">258</span></a><span class="sd">        parameters</span>
</span><span id="EmptyAnnotationStore-259"><a href="#EmptyAnnotationStore-259"><span class="linenos">259</span></a>
</span><span id="EmptyAnnotationStore-260"><a href="#EmptyAnnotationStore-260"><span class="linenos">260</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore-261"><a href="#EmptyAnnotationStore-261"><span class="linenos">261</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore-262"><a href="#EmptyAnnotationStore-262"><span class="linenos">262</span></a><span class="sd">        indices_to_remove : list</span>
</span><span id="EmptyAnnotationStore-263"><a href="#EmptyAnnotationStore-263"><span class="linenos">263</span></a><span class="sd">            a list of integer indices that should be removed</span>
</span><span id="EmptyAnnotationStore-264"><a href="#EmptyAnnotationStore-264"><span class="linenos">264</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-265"><a href="#EmptyAnnotationStore-265"><span class="linenos">265</span></a>
</span><span id="EmptyAnnotationStore-266"><a href="#EmptyAnnotationStore-266"><span class="linenos">266</span></a>        <span class="k">return</span> <span class="p">[]</span>
</span><span id="EmptyAnnotationStore-267"><a href="#EmptyAnnotationStore-267"><span class="linenos">267</span></a>
</span><span id="EmptyAnnotationStore-268"><a href="#EmptyAnnotationStore-268"><span class="linenos">268</span></a>    <span class="k">def</span> <span class="nf">set_pseudo_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore-269"><a href="#EmptyAnnotationStore-269"><span class="linenos">269</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-270"><a href="#EmptyAnnotationStore-270"><span class="linenos">270</span></a><span class="sd">        Set pseudo labels to the unlabeled data</span>
</span><span id="EmptyAnnotationStore-271"><a href="#EmptyAnnotationStore-271"><span class="linenos">271</span></a>
</span><span id="EmptyAnnotationStore-272"><a href="#EmptyAnnotationStore-272"><span class="linenos">272</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore-273"><a href="#EmptyAnnotationStore-273"><span class="linenos">273</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore-274"><a href="#EmptyAnnotationStore-274"><span class="linenos">274</span></a><span class="sd">        labels : torch.Tensor</span>
</span><span id="EmptyAnnotationStore-275"><a href="#EmptyAnnotationStore-275"><span class="linenos">275</span></a><span class="sd">            a tensor of pseudo-labels for the unlabeled data</span>
</span><span id="EmptyAnnotationStore-276"><a href="#EmptyAnnotationStore-276"><span class="linenos">276</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore-277"><a href="#EmptyAnnotationStore-277"><span class="linenos">277</span></a>
</span><span id="EmptyAnnotationStore-278"><a href="#EmptyAnnotationStore-278"><span class="linenos">278</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>A class that generates annotation from video information and stores it</p>

<p>Processes input video information and generates ordered arrays of annotation samples and corresponding unique
original coordinates, as well as some meta objects.
It is assumed that the input videos are separated into clips (e.g. corresponding to different individuals).
Each video and each clip inside the video has a unique id (video_id and clip_id, correspondingly).
The original coordinates object contains information about the video_id, clip_id and start time of the
samples in the original input data.
An AnnotationStore has to be fully defined with a tuple of key objects.
The annotation array can be accessed with integer indices.
The samples can be stored as a torch.Tensor in RAM or as an array of file paths to be loaded on runtime.
When no arguments are passed a blank class instance should be created that can later be filled with
information from key objects</p>
</div>


                            <div id="EmptyAnnotationStore.__init__" class="classattr">
                                        <input id="EmptyAnnotationStore.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">EmptyAnnotationStore</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="EmptyAnnotationStore.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.__init__-29"><a href="#EmptyAnnotationStore.__init__-29"><span class="linenos">29</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="EmptyAnnotationStore.__init__-30"><a href="#EmptyAnnotationStore.__init__-30"><span class="linenos">30</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="EmptyAnnotationStore.__init__-31"><a href="#EmptyAnnotationStore.__init__-31"><span class="linenos">31</span></a>    <span class="p">):</span>
</span><span id="EmptyAnnotationStore.__init__-32"><a href="#EmptyAnnotationStore.__init__-32"><span class="linenos">32</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.__init__-33"><a href="#EmptyAnnotationStore.__init__-33"><span class="linenos">33</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore.__init__-34"><a href="#EmptyAnnotationStore.__init__-34"><span class="linenos">34</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore.__init__-35"><a href="#EmptyAnnotationStore.__init__-35"><span class="linenos">35</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="EmptyAnnotationStore.__init__-36"><a href="#EmptyAnnotationStore.__init__-36"><span class="linenos">36</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="EmptyAnnotationStore.__init__-37"><a href="#EmptyAnnotationStore.__init__-37"><span class="linenos">37</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="EmptyAnnotationStore.__init__-38"><a href="#EmptyAnnotationStore.__init__-38"><span class="linenos">38</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="EmptyAnnotationStore.__init__-39"><a href="#EmptyAnnotationStore.__init__-39"><span class="linenos">39</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.__init__-40"><a href="#EmptyAnnotationStore.__init__-40"><span class="linenos">40</span></a>
</span><span id="EmptyAnnotationStore.__init__-41"><a href="#EmptyAnnotationStore.__init__-41"><span class="linenos">41</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><h2 id="parameters">Parameters</h2>

<p>video_order : list, optional
    a list of video ids that should be processed in the same order (not passed if creating from key objects)
key_objects : tuple, optional
    a tuple of key objects</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.remove" class="classattr">
                                        <input id="EmptyAnnotationStore.remove-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">indices</span><span class="p">:</span> <span class="n">List</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="EmptyAnnotationStore.remove-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.remove"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.remove-55"><a href="#EmptyAnnotationStore.remove-55"><span class="linenos">55</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore.remove-56"><a href="#EmptyAnnotationStore.remove-56"><span class="linenos">56</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.remove-57"><a href="#EmptyAnnotationStore.remove-57"><span class="linenos">57</span></a><span class="sd">        Remove the samples corresponding to indices</span>
</span><span id="EmptyAnnotationStore.remove-58"><a href="#EmptyAnnotationStore.remove-58"><span class="linenos">58</span></a>
</span><span id="EmptyAnnotationStore.remove-59"><a href="#EmptyAnnotationStore.remove-59"><span class="linenos">59</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore.remove-60"><a href="#EmptyAnnotationStore.remove-60"><span class="linenos">60</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore.remove-61"><a href="#EmptyAnnotationStore.remove-61"><span class="linenos">61</span></a><span class="sd">        indices : int</span>
</span><span id="EmptyAnnotationStore.remove-62"><a href="#EmptyAnnotationStore.remove-62"><span class="linenos">62</span></a><span class="sd">            a list of integer indices to remove</span>
</span><span id="EmptyAnnotationStore.remove-63"><a href="#EmptyAnnotationStore.remove-63"><span class="linenos">63</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.remove-64"><a href="#EmptyAnnotationStore.remove-64"><span class="linenos">64</span></a>
</span><span id="EmptyAnnotationStore.remove-65"><a href="#EmptyAnnotationStore.remove-65"><span class="linenos">65</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Remove the samples corresponding to indices</p>

<h2 id="parameters">Parameters</h2>

<p>indices : int
    a list of integer indices to remove</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.key_objects" class="classattr">
                                        <input id="EmptyAnnotationStore.key_objects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">key_objects</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Tuple</span>:</span></span>

                <label class="view-source-button" for="EmptyAnnotationStore.key_objects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.key_objects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.key_objects-67"><a href="#EmptyAnnotationStore.key_objects-67"><span class="linenos">67</span></a>    <span class="k">def</span> <span class="nf">key_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore.key_objects-68"><a href="#EmptyAnnotationStore.key_objects-68"><span class="linenos">68</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.key_objects-69"><a href="#EmptyAnnotationStore.key_objects-69"><span class="linenos">69</span></a><span class="sd">        Return a tuple of the key objects necessary to re-create the Store</span>
</span><span id="EmptyAnnotationStore.key_objects-70"><a href="#EmptyAnnotationStore.key_objects-70"><span class="linenos">70</span></a>
</span><span id="EmptyAnnotationStore.key_objects-71"><a href="#EmptyAnnotationStore.key_objects-71"><span class="linenos">71</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore.key_objects-72"><a href="#EmptyAnnotationStore.key_objects-72"><span class="linenos">72</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore.key_objects-73"><a href="#EmptyAnnotationStore.key_objects-73"><span class="linenos">73</span></a><span class="sd">        key_objects : tuple</span>
</span><span id="EmptyAnnotationStore.key_objects-74"><a href="#EmptyAnnotationStore.key_objects-74"><span class="linenos">74</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="EmptyAnnotationStore.key_objects-75"><a href="#EmptyAnnotationStore.key_objects-75"><span class="linenos">75</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.key_objects-76"><a href="#EmptyAnnotationStore.key_objects-76"><span class="linenos">76</span></a>
</span><span id="EmptyAnnotationStore.key_objects-77"><a href="#EmptyAnnotationStore.key_objects-77"><span class="linenos">77</span></a>        <span class="k">return</span> <span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Return a tuple of the key objects necessary to re-create the Store</p>

<h2 id="returns">Returns</h2>

<p>key_objects : tuple
    a tuple of key objects</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.load_from_key_objects" class="classattr">
                                        <input id="EmptyAnnotationStore.load_from_key_objects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_from_key_objects</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="EmptyAnnotationStore.load_from_key_objects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.load_from_key_objects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.load_from_key_objects-79"><a href="#EmptyAnnotationStore.load_from_key_objects-79"><span class="linenos">79</span></a>    <span class="k">def</span> <span class="nf">load_from_key_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore.load_from_key_objects-80"><a href="#EmptyAnnotationStore.load_from_key_objects-80"><span class="linenos">80</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.load_from_key_objects-81"><a href="#EmptyAnnotationStore.load_from_key_objects-81"><span class="linenos">81</span></a><span class="sd">        Load the information from a tuple of key objects</span>
</span><span id="EmptyAnnotationStore.load_from_key_objects-82"><a href="#EmptyAnnotationStore.load_from_key_objects-82"><span class="linenos">82</span></a>
</span><span id="EmptyAnnotationStore.load_from_key_objects-83"><a href="#EmptyAnnotationStore.load_from_key_objects-83"><span class="linenos">83</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore.load_from_key_objects-84"><a href="#EmptyAnnotationStore.load_from_key_objects-84"><span class="linenos">84</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore.load_from_key_objects-85"><a href="#EmptyAnnotationStore.load_from_key_objects-85"><span class="linenos">85</span></a><span class="sd">        key_objects : tuple</span>
</span><span id="EmptyAnnotationStore.load_from_key_objects-86"><a href="#EmptyAnnotationStore.load_from_key_objects-86"><span class="linenos">86</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="EmptyAnnotationStore.load_from_key_objects-87"><a href="#EmptyAnnotationStore.load_from_key_objects-87"><span class="linenos">87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.load_from_key_objects-88"><a href="#EmptyAnnotationStore.load_from_key_objects-88"><span class="linenos">88</span></a>
</span><span id="EmptyAnnotationStore.load_from_key_objects-89"><a href="#EmptyAnnotationStore.load_from_key_objects-89"><span class="linenos">89</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Load the information from a tuple of key objects</p>

<h2 id="parameters">Parameters</h2>

<p>key_objects : tuple
    a tuple of key objects</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.to_ram" class="classattr">
                                        <input id="EmptyAnnotationStore.to_ram-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_ram</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="EmptyAnnotationStore.to_ram-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.to_ram"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.to_ram-91"><a href="#EmptyAnnotationStore.to_ram-91"><span class="linenos">91</span></a>    <span class="k">def</span> <span class="nf">to_ram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore.to_ram-92"><a href="#EmptyAnnotationStore.to_ram-92"><span class="linenos">92</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.to_ram-93"><a href="#EmptyAnnotationStore.to_ram-93"><span class="linenos">93</span></a><span class="sd">        Transfer the data samples to RAM if they were previously stored as file paths</span>
</span><span id="EmptyAnnotationStore.to_ram-94"><a href="#EmptyAnnotationStore.to_ram-94"><span class="linenos">94</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.to_ram-95"><a href="#EmptyAnnotationStore.to_ram-95"><span class="linenos">95</span></a>
</span><span id="EmptyAnnotationStore.to_ram-96"><a href="#EmptyAnnotationStore.to_ram-96"><span class="linenos">96</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Transfer the data samples to RAM if they were previously stored as file paths</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.get_original_coordinates" class="classattr">
                                        <input id="EmptyAnnotationStore.get_original_coordinates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_original_coordinates</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="EmptyAnnotationStore.get_original_coordinates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.get_original_coordinates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.get_original_coordinates-98"><a href="#EmptyAnnotationStore.get_original_coordinates-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">get_original_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore.get_original_coordinates-99"><a href="#EmptyAnnotationStore.get_original_coordinates-99"><span class="linenos"> 99</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.get_original_coordinates-100"><a href="#EmptyAnnotationStore.get_original_coordinates-100"><span class="linenos">100</span></a><span class="sd">        Return the original coordinates array</span>
</span><span id="EmptyAnnotationStore.get_original_coordinates-101"><a href="#EmptyAnnotationStore.get_original_coordinates-101"><span class="linenos">101</span></a>
</span><span id="EmptyAnnotationStore.get_original_coordinates-102"><a href="#EmptyAnnotationStore.get_original_coordinates-102"><span class="linenos">102</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore.get_original_coordinates-103"><a href="#EmptyAnnotationStore.get_original_coordinates-103"><span class="linenos">103</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore.get_original_coordinates-104"><a href="#EmptyAnnotationStore.get_original_coordinates-104"><span class="linenos">104</span></a><span class="sd">        np.ndarray</span>
</span><span id="EmptyAnnotationStore.get_original_coordinates-105"><a href="#EmptyAnnotationStore.get_original_coordinates-105"><span class="linenos">105</span></a><span class="sd">            an array that contains the coordinates of the data samples in original input data (video id, clip id,</span>
</span><span id="EmptyAnnotationStore.get_original_coordinates-106"><a href="#EmptyAnnotationStore.get_original_coordinates-106"><span class="linenos">106</span></a><span class="sd">            start frame)</span>
</span><span id="EmptyAnnotationStore.get_original_coordinates-107"><a href="#EmptyAnnotationStore.get_original_coordinates-107"><span class="linenos">107</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.get_original_coordinates-108"><a href="#EmptyAnnotationStore.get_original_coordinates-108"><span class="linenos">108</span></a>
</span><span id="EmptyAnnotationStore.get_original_coordinates-109"><a href="#EmptyAnnotationStore.get_original_coordinates-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Return the original coordinates array</p>

<h2 id="returns">Returns</h2>

<p>np.ndarray
    an array that contains the coordinates of the data samples in original input data (video id, clip id,
    start frame)</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.create_subsample" class="classattr">
                                        <input id="EmptyAnnotationStore.create_subsample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_subsample</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">indices</span><span class="p">:</span> <span class="n">List</span>, </span><span class="param"><span class="n">ssl_indices</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="EmptyAnnotationStore.create_subsample-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.create_subsample"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.create_subsample-111"><a href="#EmptyAnnotationStore.create_subsample-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="nf">create_subsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">ssl_indices</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="EmptyAnnotationStore.create_subsample-112"><a href="#EmptyAnnotationStore.create_subsample-112"><span class="linenos">112</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.create_subsample-113"><a href="#EmptyAnnotationStore.create_subsample-113"><span class="linenos">113</span></a><span class="sd">        Create a new store that contains a subsample of the data</span>
</span><span id="EmptyAnnotationStore.create_subsample-114"><a href="#EmptyAnnotationStore.create_subsample-114"><span class="linenos">114</span></a>
</span><span id="EmptyAnnotationStore.create_subsample-115"><a href="#EmptyAnnotationStore.create_subsample-115"><span class="linenos">115</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore.create_subsample-116"><a href="#EmptyAnnotationStore.create_subsample-116"><span class="linenos">116</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore.create_subsample-117"><a href="#EmptyAnnotationStore.create_subsample-117"><span class="linenos">117</span></a><span class="sd">        indices : list</span>
</span><span id="EmptyAnnotationStore.create_subsample-118"><a href="#EmptyAnnotationStore.create_subsample-118"><span class="linenos">118</span></a><span class="sd">            the indices to be included in the subsample</span>
</span><span id="EmptyAnnotationStore.create_subsample-119"><a href="#EmptyAnnotationStore.create_subsample-119"><span class="linenos">119</span></a><span class="sd">        ssl_indices : list, optional</span>
</span><span id="EmptyAnnotationStore.create_subsample-120"><a href="#EmptyAnnotationStore.create_subsample-120"><span class="linenos">120</span></a><span class="sd">            the indices to be included in the subsample without the annotation data</span>
</span><span id="EmptyAnnotationStore.create_subsample-121"><a href="#EmptyAnnotationStore.create_subsample-121"><span class="linenos">121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.create_subsample-122"><a href="#EmptyAnnotationStore.create_subsample-122"><span class="linenos">122</span></a>
</span><span id="EmptyAnnotationStore.create_subsample-123"><a href="#EmptyAnnotationStore.create_subsample-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Create a new store that contains a subsample of the data</p>

<h2 id="parameters">Parameters</h2>

<p>indices : list
    the indices to be included in the subsample
ssl_indices : list, optional
    the indices to be included in the subsample without the annotation data</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.get_file_ids" class="classattr">
                                        <input id="EmptyAnnotationStore.get_file_ids-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_file_ids</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n">List</span>:</span></span>

                <label class="view-source-button" for="EmptyAnnotationStore.get_file_ids-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.get_file_ids"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.get_file_ids-125"><a href="#EmptyAnnotationStore.get_file_ids-125"><span class="linenos">125</span></a>    <span class="nd">@classmethod</span>
</span><span id="EmptyAnnotationStore.get_file_ids-126"><a href="#EmptyAnnotationStore.get_file_ids-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore.get_file_ids-127"><a href="#EmptyAnnotationStore.get_file_ids-127"><span class="linenos">127</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.get_file_ids-128"><a href="#EmptyAnnotationStore.get_file_ids-128"><span class="linenos">128</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="EmptyAnnotationStore.get_file_ids-129"><a href="#EmptyAnnotationStore.get_file_ids-129"><span class="linenos">129</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="EmptyAnnotationStore.get_file_ids-130"><a href="#EmptyAnnotationStore.get_file_ids-130"><span class="linenos">130</span></a>
</span><span id="EmptyAnnotationStore.get_file_ids-131"><a href="#EmptyAnnotationStore.get_file_ids-131"><span class="linenos">131</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore.get_file_ids-132"><a href="#EmptyAnnotationStore.get_file_ids-132"><span class="linenos">132</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore.get_file_ids-133"><a href="#EmptyAnnotationStore.get_file_ids-133"><span class="linenos">133</span></a><span class="sd">        video_ids : list</span>
</span><span id="EmptyAnnotationStore.get_file_ids-134"><a href="#EmptyAnnotationStore.get_file_ids-134"><span class="linenos">134</span></a><span class="sd">            a list of video file ids</span>
</span><span id="EmptyAnnotationStore.get_file_ids-135"><a href="#EmptyAnnotationStore.get_file_ids-135"><span class="linenos">135</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.get_file_ids-136"><a href="#EmptyAnnotationStore.get_file_ids-136"><span class="linenos">136</span></a>
</span><span id="EmptyAnnotationStore.get_file_ids-137"><a href="#EmptyAnnotationStore.get_file_ids-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Process data parameters and return a list of ids  of the videos that should
be processed by the __init__ function</p>

<h2 id="returns">Returns</h2>

<p>video_ids : list
    a list of video file ids</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.get_len" class="classattr">
                                        <input id="EmptyAnnotationStore.get_len-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_len</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="EmptyAnnotationStore.get_len-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.get_len"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.get_len-156"><a href="#EmptyAnnotationStore.get_len-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="nf">get_len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore.get_len-157"><a href="#EmptyAnnotationStore.get_len-157"><span class="linenos">157</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.get_len-158"><a href="#EmptyAnnotationStore.get_len-158"><span class="linenos">158</span></a><span class="sd">        Get the length of the subsample of labeled/unlabeled data</span>
</span><span id="EmptyAnnotationStore.get_len-159"><a href="#EmptyAnnotationStore.get_len-159"><span class="linenos">159</span></a>
</span><span id="EmptyAnnotationStore.get_len-160"><a href="#EmptyAnnotationStore.get_len-160"><span class="linenos">160</span></a><span class="sd">        If return_unlabeled is True, the index is in the subsample of unlabeled data, if False in labeled</span>
</span><span id="EmptyAnnotationStore.get_len-161"><a href="#EmptyAnnotationStore.get_len-161"><span class="linenos">161</span></a><span class="sd">        and if return_unlabeled is None the index is already correct</span>
</span><span id="EmptyAnnotationStore.get_len-162"><a href="#EmptyAnnotationStore.get_len-162"><span class="linenos">162</span></a>
</span><span id="EmptyAnnotationStore.get_len-163"><a href="#EmptyAnnotationStore.get_len-163"><span class="linenos">163</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore.get_len-164"><a href="#EmptyAnnotationStore.get_len-164"><span class="linenos">164</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore.get_len-165"><a href="#EmptyAnnotationStore.get_len-165"><span class="linenos">165</span></a><span class="sd">        return_unlabeled : bool</span>
</span><span id="EmptyAnnotationStore.get_len-166"><a href="#EmptyAnnotationStore.get_len-166"><span class="linenos">166</span></a><span class="sd">            the identifier for the subsample</span>
</span><span id="EmptyAnnotationStore.get_len-167"><a href="#EmptyAnnotationStore.get_len-167"><span class="linenos">167</span></a>
</span><span id="EmptyAnnotationStore.get_len-168"><a href="#EmptyAnnotationStore.get_len-168"><span class="linenos">168</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore.get_len-169"><a href="#EmptyAnnotationStore.get_len-169"><span class="linenos">169</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore.get_len-170"><a href="#EmptyAnnotationStore.get_len-170"><span class="linenos">170</span></a><span class="sd">        length : int</span>
</span><span id="EmptyAnnotationStore.get_len-171"><a href="#EmptyAnnotationStore.get_len-171"><span class="linenos">171</span></a><span class="sd">            the length of the subsample</span>
</span><span id="EmptyAnnotationStore.get_len-172"><a href="#EmptyAnnotationStore.get_len-172"><span class="linenos">172</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.get_len-173"><a href="#EmptyAnnotationStore.get_len-173"><span class="linenos">173</span></a>
</span><span id="EmptyAnnotationStore.get_len-174"><a href="#EmptyAnnotationStore.get_len-174"><span class="linenos">174</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Get the length of the subsample of labeled/unlabeled data</p>

<p>If return_unlabeled is True, the index is in the subsample of unlabeled data, if False in labeled
and if return_unlabeled is None the index is already correct</p>

<h2 id="parameters">Parameters</h2>

<p>return_unlabeled : bool
    the identifier for the subsample</p>

<h2 id="returns">Returns</h2>

<p>length : int
    the length of the subsample</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.get_idx" class="classattr">
                                        <input id="EmptyAnnotationStore.get_idx-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_idx</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">index</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="EmptyAnnotationStore.get_idx-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.get_idx"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.get_idx-176"><a href="#EmptyAnnotationStore.get_idx-176"><span class="linenos">176</span></a>    <span class="k">def</span> <span class="nf">get_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore.get_idx-177"><a href="#EmptyAnnotationStore.get_idx-177"><span class="linenos">177</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.get_idx-178"><a href="#EmptyAnnotationStore.get_idx-178"><span class="linenos">178</span></a><span class="sd">        Convert from an index in the subsample of labeled/unlabeled data to an index in the full array</span>
</span><span id="EmptyAnnotationStore.get_idx-179"><a href="#EmptyAnnotationStore.get_idx-179"><span class="linenos">179</span></a>
</span><span id="EmptyAnnotationStore.get_idx-180"><a href="#EmptyAnnotationStore.get_idx-180"><span class="linenos">180</span></a><span class="sd">        If return_unlabeled is True, the index is in the subsample of unlabeled data, if False in labeled</span>
</span><span id="EmptyAnnotationStore.get_idx-181"><a href="#EmptyAnnotationStore.get_idx-181"><span class="linenos">181</span></a><span class="sd">        and if return_unlabeled is None the index is already correct</span>
</span><span id="EmptyAnnotationStore.get_idx-182"><a href="#EmptyAnnotationStore.get_idx-182"><span class="linenos">182</span></a>
</span><span id="EmptyAnnotationStore.get_idx-183"><a href="#EmptyAnnotationStore.get_idx-183"><span class="linenos">183</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore.get_idx-184"><a href="#EmptyAnnotationStore.get_idx-184"><span class="linenos">184</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore.get_idx-185"><a href="#EmptyAnnotationStore.get_idx-185"><span class="linenos">185</span></a><span class="sd">        index : int</span>
</span><span id="EmptyAnnotationStore.get_idx-186"><a href="#EmptyAnnotationStore.get_idx-186"><span class="linenos">186</span></a><span class="sd">            the index in the subsample</span>
</span><span id="EmptyAnnotationStore.get_idx-187"><a href="#EmptyAnnotationStore.get_idx-187"><span class="linenos">187</span></a><span class="sd">        return_unlabeled : bool</span>
</span><span id="EmptyAnnotationStore.get_idx-188"><a href="#EmptyAnnotationStore.get_idx-188"><span class="linenos">188</span></a><span class="sd">            the identifier for the subsample</span>
</span><span id="EmptyAnnotationStore.get_idx-189"><a href="#EmptyAnnotationStore.get_idx-189"><span class="linenos">189</span></a>
</span><span id="EmptyAnnotationStore.get_idx-190"><a href="#EmptyAnnotationStore.get_idx-190"><span class="linenos">190</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore.get_idx-191"><a href="#EmptyAnnotationStore.get_idx-191"><span class="linenos">191</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore.get_idx-192"><a href="#EmptyAnnotationStore.get_idx-192"><span class="linenos">192</span></a><span class="sd">        corrected_index : int</span>
</span><span id="EmptyAnnotationStore.get_idx-193"><a href="#EmptyAnnotationStore.get_idx-193"><span class="linenos">193</span></a><span class="sd">            the index in the full dataset</span>
</span><span id="EmptyAnnotationStore.get_idx-194"><a href="#EmptyAnnotationStore.get_idx-194"><span class="linenos">194</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.get_idx-195"><a href="#EmptyAnnotationStore.get_idx-195"><span class="linenos">195</span></a>
</span><span id="EmptyAnnotationStore.get_idx-196"><a href="#EmptyAnnotationStore.get_idx-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="n">index</span>
</span></pre></div>


            <div class="docstring"><p>Convert from an index in the subsample of labeled/unlabeled data to an index in the full array</p>

<p>If return_unlabeled is True, the index is in the subsample of unlabeled data, if False in labeled
and if return_unlabeled is None the index is already correct</p>

<h2 id="parameters">Parameters</h2>

<p>index : int
    the index in the subsample
return_unlabeled : bool
    the identifier for the subsample</p>

<h2 id="returns">Returns</h2>

<p>corrected_index : int
    the index in the full dataset</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.count_classes" class="classattr">
                                        <input id="EmptyAnnotationStore.count_classes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">count_classes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">frac</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">zeros</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">bouts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="EmptyAnnotationStore.count_classes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.count_classes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.count_classes-198"><a href="#EmptyAnnotationStore.count_classes-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">count_classes</span><span class="p">(</span>
</span><span id="EmptyAnnotationStore.count_classes-199"><a href="#EmptyAnnotationStore.count_classes-199"><span class="linenos">199</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">frac</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zeros</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bouts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="EmptyAnnotationStore.count_classes-200"><a href="#EmptyAnnotationStore.count_classes-200"><span class="linenos">200</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore.count_classes-201"><a href="#EmptyAnnotationStore.count_classes-201"><span class="linenos">201</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.count_classes-202"><a href="#EmptyAnnotationStore.count_classes-202"><span class="linenos">202</span></a><span class="sd">        Get a dictionary with class-wise frame counts</span>
</span><span id="EmptyAnnotationStore.count_classes-203"><a href="#EmptyAnnotationStore.count_classes-203"><span class="linenos">203</span></a>
</span><span id="EmptyAnnotationStore.count_classes-204"><a href="#EmptyAnnotationStore.count_classes-204"><span class="linenos">204</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore.count_classes-205"><a href="#EmptyAnnotationStore.count_classes-205"><span class="linenos">205</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore.count_classes-206"><a href="#EmptyAnnotationStore.count_classes-206"><span class="linenos">206</span></a><span class="sd">        frac : bool, default False</span>
</span><span id="EmptyAnnotationStore.count_classes-207"><a href="#EmptyAnnotationStore.count_classes-207"><span class="linenos">207</span></a><span class="sd">            if True, a fraction of the total frame count is returned</span>
</span><span id="EmptyAnnotationStore.count_classes-208"><a href="#EmptyAnnotationStore.count_classes-208"><span class="linenos">208</span></a>
</span><span id="EmptyAnnotationStore.count_classes-209"><a href="#EmptyAnnotationStore.count_classes-209"><span class="linenos">209</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore.count_classes-210"><a href="#EmptyAnnotationStore.count_classes-210"><span class="linenos">210</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore.count_classes-211"><a href="#EmptyAnnotationStore.count_classes-211"><span class="linenos">211</span></a><span class="sd">        count_dictionary : dict</span>
</span><span id="EmptyAnnotationStore.count_classes-212"><a href="#EmptyAnnotationStore.count_classes-212"><span class="linenos">212</span></a><span class="sd">            a dictionary with class indices as keys and frame counts as values</span>
</span><span id="EmptyAnnotationStore.count_classes-213"><a href="#EmptyAnnotationStore.count_classes-213"><span class="linenos">213</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.count_classes-214"><a href="#EmptyAnnotationStore.count_classes-214"><span class="linenos">214</span></a>
</span><span id="EmptyAnnotationStore.count_classes-215"><a href="#EmptyAnnotationStore.count_classes-215"><span class="linenos">215</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>Get a dictionary with class-wise frame counts</p>

<h2 id="parameters">Parameters</h2>

<p>frac : bool, default False
    if True, a fraction of the total frame count is returned</p>

<h2 id="returns">Returns</h2>

<p>count_dictionary : dict
    a dictionary with class indices as keys and frame counts as values</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.behaviors_dict" class="classattr">
                                        <input id="EmptyAnnotationStore.behaviors_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">behaviors_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="EmptyAnnotationStore.behaviors_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.behaviors_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.behaviors_dict-217"><a href="#EmptyAnnotationStore.behaviors_dict-217"><span class="linenos">217</span></a>    <span class="k">def</span> <span class="nf">behaviors_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore.behaviors_dict-218"><a href="#EmptyAnnotationStore.behaviors_dict-218"><span class="linenos">218</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.behaviors_dict-219"><a href="#EmptyAnnotationStore.behaviors_dict-219"><span class="linenos">219</span></a><span class="sd">        Get a dictionary of class names</span>
</span><span id="EmptyAnnotationStore.behaviors_dict-220"><a href="#EmptyAnnotationStore.behaviors_dict-220"><span class="linenos">220</span></a>
</span><span id="EmptyAnnotationStore.behaviors_dict-221"><a href="#EmptyAnnotationStore.behaviors_dict-221"><span class="linenos">221</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore.behaviors_dict-222"><a href="#EmptyAnnotationStore.behaviors_dict-222"><span class="linenos">222</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore.behaviors_dict-223"><a href="#EmptyAnnotationStore.behaviors_dict-223"><span class="linenos">223</span></a><span class="sd">        behavior_dictionary: dict</span>
</span><span id="EmptyAnnotationStore.behaviors_dict-224"><a href="#EmptyAnnotationStore.behaviors_dict-224"><span class="linenos">224</span></a><span class="sd">            a dictionary with class indices as keys and class names as values</span>
</span><span id="EmptyAnnotationStore.behaviors_dict-225"><a href="#EmptyAnnotationStore.behaviors_dict-225"><span class="linenos">225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.behaviors_dict-226"><a href="#EmptyAnnotationStore.behaviors_dict-226"><span class="linenos">226</span></a>
</span><span id="EmptyAnnotationStore.behaviors_dict-227"><a href="#EmptyAnnotationStore.behaviors_dict-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>Get a dictionary of class names</p>

<h2 id="returns">Returns</h2>

<p>behavior_dictionary: dict
    a dictionary with class indices as keys and class names as values</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.annotation_class" class="classattr">
                                        <input id="EmptyAnnotationStore.annotation_class-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">annotation_class</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="EmptyAnnotationStore.annotation_class-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.annotation_class"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.annotation_class-229"><a href="#EmptyAnnotationStore.annotation_class-229"><span class="linenos">229</span></a>    <span class="k">def</span> <span class="nf">annotation_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore.annotation_class-230"><a href="#EmptyAnnotationStore.annotation_class-230"><span class="linenos">230</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.annotation_class-231"><a href="#EmptyAnnotationStore.annotation_class-231"><span class="linenos">231</span></a><span class="sd">        Get the type of annotation (&#39;exclusive_classification&#39;, &#39;nonexclusive_classification&#39;, more coming soon)</span>
</span><span id="EmptyAnnotationStore.annotation_class-232"><a href="#EmptyAnnotationStore.annotation_class-232"><span class="linenos">232</span></a>
</span><span id="EmptyAnnotationStore.annotation_class-233"><a href="#EmptyAnnotationStore.annotation_class-233"><span class="linenos">233</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore.annotation_class-234"><a href="#EmptyAnnotationStore.annotation_class-234"><span class="linenos">234</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore.annotation_class-235"><a href="#EmptyAnnotationStore.annotation_class-235"><span class="linenos">235</span></a><span class="sd">        annotation_class : str</span>
</span><span id="EmptyAnnotationStore.annotation_class-236"><a href="#EmptyAnnotationStore.annotation_class-236"><span class="linenos">236</span></a><span class="sd">            the type of annotation</span>
</span><span id="EmptyAnnotationStore.annotation_class-237"><a href="#EmptyAnnotationStore.annotation_class-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.annotation_class-238"><a href="#EmptyAnnotationStore.annotation_class-238"><span class="linenos">238</span></a>
</span><span id="EmptyAnnotationStore.annotation_class-239"><a href="#EmptyAnnotationStore.annotation_class-239"><span class="linenos">239</span></a>        <span class="k">return</span> <span class="s2">&quot;none&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Get the type of annotation ('exclusive_classification', 'nonexclusive_classification', more coming soon)</p>

<h2 id="returns">Returns</h2>

<p>annotation_class : str
    the type of annotation</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.size" class="classattr">
                                        <input id="EmptyAnnotationStore.size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="EmptyAnnotationStore.size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.size-241"><a href="#EmptyAnnotationStore.size-241"><span class="linenos">241</span></a>    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore.size-242"><a href="#EmptyAnnotationStore.size-242"><span class="linenos">242</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.size-243"><a href="#EmptyAnnotationStore.size-243"><span class="linenos">243</span></a><span class="sd">        Get the total number of frames in the data</span>
</span><span id="EmptyAnnotationStore.size-244"><a href="#EmptyAnnotationStore.size-244"><span class="linenos">244</span></a>
</span><span id="EmptyAnnotationStore.size-245"><a href="#EmptyAnnotationStore.size-245"><span class="linenos">245</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore.size-246"><a href="#EmptyAnnotationStore.size-246"><span class="linenos">246</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore.size-247"><a href="#EmptyAnnotationStore.size-247"><span class="linenos">247</span></a><span class="sd">        size : int</span>
</span><span id="EmptyAnnotationStore.size-248"><a href="#EmptyAnnotationStore.size-248"><span class="linenos">248</span></a><span class="sd">            the total number of frames</span>
</span><span id="EmptyAnnotationStore.size-249"><a href="#EmptyAnnotationStore.size-249"><span class="linenos">249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.size-250"><a href="#EmptyAnnotationStore.size-250"><span class="linenos">250</span></a>
</span><span id="EmptyAnnotationStore.size-251"><a href="#EmptyAnnotationStore.size-251"><span class="linenos">251</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Get the total number of frames in the data</p>

<h2 id="returns">Returns</h2>

<p>size : int
    the total number of frames</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.filtered_indices" class="classattr">
                                        <input id="EmptyAnnotationStore.filtered_indices-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filtered_indices</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span>:</span></span>

                <label class="view-source-button" for="EmptyAnnotationStore.filtered_indices-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.filtered_indices"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.filtered_indices-253"><a href="#EmptyAnnotationStore.filtered_indices-253"><span class="linenos">253</span></a>    <span class="k">def</span> <span class="nf">filtered_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore.filtered_indices-254"><a href="#EmptyAnnotationStore.filtered_indices-254"><span class="linenos">254</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.filtered_indices-255"><a href="#EmptyAnnotationStore.filtered_indices-255"><span class="linenos">255</span></a><span class="sd">        Return the indices of the samples that should be removed</span>
</span><span id="EmptyAnnotationStore.filtered_indices-256"><a href="#EmptyAnnotationStore.filtered_indices-256"><span class="linenos">256</span></a>
</span><span id="EmptyAnnotationStore.filtered_indices-257"><a href="#EmptyAnnotationStore.filtered_indices-257"><span class="linenos">257</span></a><span class="sd">        Choosing the indices can be based on any kind of filering defined in the __init__ function by the data</span>
</span><span id="EmptyAnnotationStore.filtered_indices-258"><a href="#EmptyAnnotationStore.filtered_indices-258"><span class="linenos">258</span></a><span class="sd">        parameters</span>
</span><span id="EmptyAnnotationStore.filtered_indices-259"><a href="#EmptyAnnotationStore.filtered_indices-259"><span class="linenos">259</span></a>
</span><span id="EmptyAnnotationStore.filtered_indices-260"><a href="#EmptyAnnotationStore.filtered_indices-260"><span class="linenos">260</span></a><span class="sd">        Returns</span>
</span><span id="EmptyAnnotationStore.filtered_indices-261"><a href="#EmptyAnnotationStore.filtered_indices-261"><span class="linenos">261</span></a><span class="sd">        -------</span>
</span><span id="EmptyAnnotationStore.filtered_indices-262"><a href="#EmptyAnnotationStore.filtered_indices-262"><span class="linenos">262</span></a><span class="sd">        indices_to_remove : list</span>
</span><span id="EmptyAnnotationStore.filtered_indices-263"><a href="#EmptyAnnotationStore.filtered_indices-263"><span class="linenos">263</span></a><span class="sd">            a list of integer indices that should be removed</span>
</span><span id="EmptyAnnotationStore.filtered_indices-264"><a href="#EmptyAnnotationStore.filtered_indices-264"><span class="linenos">264</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.filtered_indices-265"><a href="#EmptyAnnotationStore.filtered_indices-265"><span class="linenos">265</span></a>
</span><span id="EmptyAnnotationStore.filtered_indices-266"><a href="#EmptyAnnotationStore.filtered_indices-266"><span class="linenos">266</span></a>        <span class="k">return</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Return the indices of the samples that should be removed</p>

<p>Choosing the indices can be based on any kind of filering defined in the __init__ function by the data
parameters</p>

<h2 id="returns">Returns</h2>

<p>indices_to_remove : list
    a list of integer indices that should be removed</p>
</div>


                            </div>
                            <div id="EmptyAnnotationStore.set_pseudo_labels" class="classattr">
                                        <input id="EmptyAnnotationStore.set_pseudo_labels-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_pseudo_labels</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">labels</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="EmptyAnnotationStore.set_pseudo_labels-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EmptyAnnotationStore.set_pseudo_labels"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EmptyAnnotationStore.set_pseudo_labels-268"><a href="#EmptyAnnotationStore.set_pseudo_labels-268"><span class="linenos">268</span></a>    <span class="k">def</span> <span class="nf">set_pseudo_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EmptyAnnotationStore.set_pseudo_labels-269"><a href="#EmptyAnnotationStore.set_pseudo_labels-269"><span class="linenos">269</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.set_pseudo_labels-270"><a href="#EmptyAnnotationStore.set_pseudo_labels-270"><span class="linenos">270</span></a><span class="sd">        Set pseudo labels to the unlabeled data</span>
</span><span id="EmptyAnnotationStore.set_pseudo_labels-271"><a href="#EmptyAnnotationStore.set_pseudo_labels-271"><span class="linenos">271</span></a>
</span><span id="EmptyAnnotationStore.set_pseudo_labels-272"><a href="#EmptyAnnotationStore.set_pseudo_labels-272"><span class="linenos">272</span></a><span class="sd">        Parameters</span>
</span><span id="EmptyAnnotationStore.set_pseudo_labels-273"><a href="#EmptyAnnotationStore.set_pseudo_labels-273"><span class="linenos">273</span></a><span class="sd">        ----------</span>
</span><span id="EmptyAnnotationStore.set_pseudo_labels-274"><a href="#EmptyAnnotationStore.set_pseudo_labels-274"><span class="linenos">274</span></a><span class="sd">        labels : torch.Tensor</span>
</span><span id="EmptyAnnotationStore.set_pseudo_labels-275"><a href="#EmptyAnnotationStore.set_pseudo_labels-275"><span class="linenos">275</span></a><span class="sd">            a tensor of pseudo-labels for the unlabeled data</span>
</span><span id="EmptyAnnotationStore.set_pseudo_labels-276"><a href="#EmptyAnnotationStore.set_pseudo_labels-276"><span class="linenos">276</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EmptyAnnotationStore.set_pseudo_labels-277"><a href="#EmptyAnnotationStore.set_pseudo_labels-277"><span class="linenos">277</span></a>
</span><span id="EmptyAnnotationStore.set_pseudo_labels-278"><a href="#EmptyAnnotationStore.set_pseudo_labels-278"><span class="linenos">278</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Set pseudo labels to the unlabeled data</p>

<h2 id="parameters">Parameters</h2>

<p>labels : torch.Tensor
    a tensor of pseudo-labels for the unlabeled data</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="base_store.html#AnnotationStore">dlc2action.data.base_store.AnnotationStore</a></dt>
                                <dd id="EmptyAnnotationStore.required_objects" class="variable"><a href="base_store.html#AnnotationStore.required_objects">required_objects</a></dd>

            </div>
            <div><dt><a href="base_store.html#Store">dlc2action.data.base_store.Store</a></dt>
                                <dd id="EmptyAnnotationStore.get_parameters" class="function"><a href="base_store.html#Store.get_parameters">get_parameters</a></dd>
                <dd id="EmptyAnnotationStore.new" class="function"><a href="base_store.html#Store.new">new</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ActionSegmentationStore">
                            <input id="ActionSegmentationStore-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ActionSegmentationStore</span><wbr>(<span class="base"><a href="base_store.html#AnnotationStore">dlc2action.data.base_store.AnnotationStore</a></span>):

                <label class="view-source-button" for="ActionSegmentationStore-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore-281"><a href="#ActionSegmentationStore-281"><span class="linenos"> 281</span></a><span class="k">class</span> <span class="nc">ActionSegmentationStore</span><span class="p">(</span><span class="n">AnnotationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="ActionSegmentationStore-282"><a href="#ActionSegmentationStore-282"><span class="linenos"> 282</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-283"><a href="#ActionSegmentationStore-283"><span class="linenos"> 283</span></a><span class="sd">    A general realization of an annotation store for action segmentation tasks</span>
</span><span id="ActionSegmentationStore-284"><a href="#ActionSegmentationStore-284"><span class="linenos"> 284</span></a>
</span><span id="ActionSegmentationStore-285"><a href="#ActionSegmentationStore-285"><span class="linenos"> 285</span></a><span class="sd">    Assumes the following file structure:</span>
</span><span id="ActionSegmentationStore-286"><a href="#ActionSegmentationStore-286"><span class="linenos"> 286</span></a><span class="sd">    ```</span>
</span><span id="ActionSegmentationStore-287"><a href="#ActionSegmentationStore-287"><span class="linenos"> 287</span></a><span class="sd">    annotation_path</span>
</span><span id="ActionSegmentationStore-288"><a href="#ActionSegmentationStore-288"><span class="linenos"> 288</span></a><span class="sd">     video1_annotation.pickle</span>
</span><span id="ActionSegmentationStore-289"><a href="#ActionSegmentationStore-289"><span class="linenos"> 289</span></a><span class="sd">     video2_labels.pickle</span>
</span><span id="ActionSegmentationStore-290"><a href="#ActionSegmentationStore-290"><span class="linenos"> 290</span></a><span class="sd">    ```</span>
</span><span id="ActionSegmentationStore-291"><a href="#ActionSegmentationStore-291"><span class="linenos"> 291</span></a><span class="sd">    Here `annotation_suffix` is `{&#39;_annotation.pickle&#39;, &#39;_labels.pickle&#39;}`.</span>
</span><span id="ActionSegmentationStore-292"><a href="#ActionSegmentationStore-292"><span class="linenos"> 292</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-293"><a href="#ActionSegmentationStore-293"><span class="linenos"> 293</span></a>
</span><span id="ActionSegmentationStore-294"><a href="#ActionSegmentationStore-294"><span class="linenos"> 294</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="ActionSegmentationStore-295"><a href="#ActionSegmentationStore-295"><span class="linenos"> 295</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-296"><a href="#ActionSegmentationStore-296"><span class="linenos"> 296</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-297"><a href="#ActionSegmentationStore-297"><span class="linenos"> 297</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-298"><a href="#ActionSegmentationStore-298"><span class="linenos"> 298</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-299"><a href="#ActionSegmentationStore-299"><span class="linenos"> 299</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-300"><a href="#ActionSegmentationStore-300"><span class="linenos"> 300</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-301"><a href="#ActionSegmentationStore-301"><span class="linenos"> 301</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-302"><a href="#ActionSegmentationStore-302"><span class="linenos"> 302</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-303"><a href="#ActionSegmentationStore-303"><span class="linenos"> 303</span></a>        <span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-304"><a href="#ActionSegmentationStore-304"><span class="linenos"> 304</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-305"><a href="#ActionSegmentationStore-305"><span class="linenos"> 305</span></a>        <span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-306"><a href="#ActionSegmentationStore-306"><span class="linenos"> 306</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-307"><a href="#ActionSegmentationStore-307"><span class="linenos"> 307</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-308"><a href="#ActionSegmentationStore-308"><span class="linenos"> 308</span></a>        <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-309"><a href="#ActionSegmentationStore-309"><span class="linenos"> 309</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-310"><a href="#ActionSegmentationStore-310"><span class="linenos"> 310</span></a>        <span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-311"><a href="#ActionSegmentationStore-311"><span class="linenos"> 311</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-312"><a href="#ActionSegmentationStore-312"><span class="linenos"> 312</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-313"><a href="#ActionSegmentationStore-313"><span class="linenos"> 313</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-314"><a href="#ActionSegmentationStore-314"><span class="linenos"> 314</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-315"><a href="#ActionSegmentationStore-315"><span class="linenos"> 315</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-316"><a href="#ActionSegmentationStore-316"><span class="linenos"> 316</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-317"><a href="#ActionSegmentationStore-317"><span class="linenos"> 317</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-318"><a href="#ActionSegmentationStore-318"><span class="linenos"> 318</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-319"><a href="#ActionSegmentationStore-319"><span class="linenos"> 319</span></a>        <span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-320"><a href="#ActionSegmentationStore-320"><span class="linenos"> 320</span></a>        <span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-321"><a href="#ActionSegmentationStore-321"><span class="linenos"> 321</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-322"><a href="#ActionSegmentationStore-322"><span class="linenos"> 322</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-323"><a href="#ActionSegmentationStore-323"><span class="linenos"> 323</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-324"><a href="#ActionSegmentationStore-324"><span class="linenos"> 324</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-325"><a href="#ActionSegmentationStore-325"><span class="linenos"> 325</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore-326"><a href="#ActionSegmentationStore-326"><span class="linenos"> 326</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore-327"><a href="#ActionSegmentationStore-327"><span class="linenos"> 327</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="ActionSegmentationStore-328"><a href="#ActionSegmentationStore-328"><span class="linenos"> 328</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="ActionSegmentationStore-329"><a href="#ActionSegmentationStore-329"><span class="linenos"> 329</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="ActionSegmentationStore-330"><a href="#ActionSegmentationStore-330"><span class="linenos"> 330</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="ActionSegmentationStore-331"><a href="#ActionSegmentationStore-331"><span class="linenos"> 331</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="ActionSegmentationStore-332"><a href="#ActionSegmentationStore-332"><span class="linenos"> 332</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="ActionSegmentationStore-333"><a href="#ActionSegmentationStore-333"><span class="linenos"> 333</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="ActionSegmentationStore-334"><a href="#ActionSegmentationStore-334"><span class="linenos"> 334</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="ActionSegmentationStore-335"><a href="#ActionSegmentationStore-335"><span class="linenos"> 335</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="ActionSegmentationStore-336"><a href="#ActionSegmentationStore-336"><span class="linenos"> 336</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="ActionSegmentationStore-337"><a href="#ActionSegmentationStore-337"><span class="linenos"> 337</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="ActionSegmentationStore-338"><a href="#ActionSegmentationStore-338"><span class="linenos"> 338</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="ActionSegmentationStore-339"><a href="#ActionSegmentationStore-339"><span class="linenos"> 339</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="ActionSegmentationStore-340"><a href="#ActionSegmentationStore-340"><span class="linenos"> 340</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="ActionSegmentationStore-341"><a href="#ActionSegmentationStore-341"><span class="linenos"> 341</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="ActionSegmentationStore-342"><a href="#ActionSegmentationStore-342"><span class="linenos"> 342</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="ActionSegmentationStore-343"><a href="#ActionSegmentationStore-343"><span class="linenos"> 343</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="ActionSegmentationStore-344"><a href="#ActionSegmentationStore-344"><span class="linenos"> 344</span></a><span class="sd">        behaviors : set, optional</span>
</span><span id="ActionSegmentationStore-345"><a href="#ActionSegmentationStore-345"><span class="linenos"> 345</span></a><span class="sd">            the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are</span>
</span><span id="ActionSegmentationStore-346"><a href="#ActionSegmentationStore-346"><span class="linenos"> 346</span></a><span class="sd">            loaded from a file)</span>
</span><span id="ActionSegmentationStore-347"><a href="#ActionSegmentationStore-347"><span class="linenos"> 347</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="ActionSegmentationStore-348"><a href="#ActionSegmentationStore-348"><span class="linenos"> 348</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="ActionSegmentationStore-349"><a href="#ActionSegmentationStore-349"><span class="linenos"> 349</span></a><span class="sd">        ignored_clips : set, optional</span>
</span><span id="ActionSegmentationStore-350"><a href="#ActionSegmentationStore-350"><span class="linenos"> 350</span></a><span class="sd">            clip ids to ignore</span>
</span><span id="ActionSegmentationStore-351"><a href="#ActionSegmentationStore-351"><span class="linenos"> 351</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="ActionSegmentationStore-352"><a href="#ActionSegmentationStore-352"><span class="linenos"> 352</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="ActionSegmentationStore-353"><a href="#ActionSegmentationStore-353"><span class="linenos"> 353</span></a><span class="sd">            (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="ActionSegmentationStore-354"><a href="#ActionSegmentationStore-354"><span class="linenos"> 354</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="ActionSegmentationStore-355"><a href="#ActionSegmentationStore-355"><span class="linenos"> 355</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="ActionSegmentationStore-356"><a href="#ActionSegmentationStore-356"><span class="linenos"> 356</span></a><span class="sd">            from key objects)</span>
</span><span id="ActionSegmentationStore-357"><a href="#ActionSegmentationStore-357"><span class="linenos"> 357</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="ActionSegmentationStore-358"><a href="#ActionSegmentationStore-358"><span class="linenos"> 358</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="ActionSegmentationStore-359"><a href="#ActionSegmentationStore-359"><span class="linenos"> 359</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="ActionSegmentationStore-360"><a href="#ActionSegmentationStore-360"><span class="linenos"> 360</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="ActionSegmentationStore-361"><a href="#ActionSegmentationStore-361"><span class="linenos"> 361</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="ActionSegmentationStore-362"><a href="#ActionSegmentationStore-362"><span class="linenos"> 362</span></a><span class="sd">        frame_limit : int, default 0</span>
</span><span id="ActionSegmentationStore-363"><a href="#ActionSegmentationStore-363"><span class="linenos"> 363</span></a><span class="sd">            the smallest possible length of a clip (shorter clips are discarded)</span>
</span><span id="ActionSegmentationStore-364"><a href="#ActionSegmentationStore-364"><span class="linenos"> 364</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="ActionSegmentationStore-365"><a href="#ActionSegmentationStore-365"><span class="linenos"> 365</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="ActionSegmentationStore-366"><a href="#ActionSegmentationStore-366"><span class="linenos"> 366</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="ActionSegmentationStore-367"><a href="#ActionSegmentationStore-367"><span class="linenos"> 367</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="ActionSegmentationStore-368"><a href="#ActionSegmentationStore-368"><span class="linenos"> 368</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="ActionSegmentationStore-369"><a href="#ActionSegmentationStore-369"><span class="linenos"> 369</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="ActionSegmentationStore-370"><a href="#ActionSegmentationStore-370"><span class="linenos"> 370</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="ActionSegmentationStore-371"><a href="#ActionSegmentationStore-371"><span class="linenos"> 371</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="ActionSegmentationStore-372"><a href="#ActionSegmentationStore-372"><span class="linenos"> 372</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="ActionSegmentationStore-373"><a href="#ActionSegmentationStore-373"><span class="linenos"> 373</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="ActionSegmentationStore-374"><a href="#ActionSegmentationStore-374"><span class="linenos"> 374</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="ActionSegmentationStore-375"><a href="#ActionSegmentationStore-375"><span class="linenos"> 375</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="ActionSegmentationStore-376"><a href="#ActionSegmentationStore-376"><span class="linenos"> 376</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="ActionSegmentationStore-377"><a href="#ActionSegmentationStore-377"><span class="linenos"> 377</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="ActionSegmentationStore-378"><a href="#ActionSegmentationStore-378"><span class="linenos"> 378</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="ActionSegmentationStore-379"><a href="#ActionSegmentationStore-379"><span class="linenos"> 379</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="ActionSegmentationStore-380"><a href="#ActionSegmentationStore-380"><span class="linenos"> 380</span></a><span class="sd">        use_hard_negatives : bool, default False</span>
</span><span id="ActionSegmentationStore-381"><a href="#ActionSegmentationStore-381"><span class="linenos"> 381</span></a><span class="sd">            mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing</span>
</span><span id="ActionSegmentationStore-382"><a href="#ActionSegmentationStore-382"><span class="linenos"> 382</span></a><span class="sd">        interactive : bool, default False</span>
</span><span id="ActionSegmentationStore-383"><a href="#ActionSegmentationStore-383"><span class="linenos"> 383</span></a><span class="sd">            if `True`, annotation is assigned to pairs of individuals</span>
</span><span id="ActionSegmentationStore-384"><a href="#ActionSegmentationStore-384"><span class="linenos"> 384</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-385"><a href="#ActionSegmentationStore-385"><span class="linenos"> 385</span></a>
</span><span id="ActionSegmentationStore-386"><a href="#ActionSegmentationStore-386"><span class="linenos"> 386</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="ActionSegmentationStore-387"><a href="#ActionSegmentationStore-387"><span class="linenos"> 387</span></a>
</span><span id="ActionSegmentationStore-388"><a href="#ActionSegmentationStore-388"><span class="linenos"> 388</span></a>        <span class="k">if</span> <span class="n">ignored_clips</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-389"><a href="#ActionSegmentationStore-389"><span class="linenos"> 389</span></a>            <span class="n">ignored_clips</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore-390"><a href="#ActionSegmentationStore-390"><span class="linenos"> 390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">len_segment</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-391"><a href="#ActionSegmentationStore-391"><span class="linenos"> 391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">=</span> <span class="n">exclusive</span>
</span><span id="ActionSegmentationStore-392"><a href="#ActionSegmentationStore-392"><span class="linenos"> 392</span></a>        <span class="k">if</span> <span class="n">overlap</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-393"><a href="#ActionSegmentationStore-393"><span class="linenos"> 393</span></a>            <span class="n">overlap</span> <span class="o">=</span> <span class="n">overlap</span> <span class="o">*</span> <span class="n">len_segment</span>
</span><span id="ActionSegmentationStore-394"><a href="#ActionSegmentationStore-394"><span class="linenos"> 394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">overlap</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-395"><a href="#ActionSegmentationStore-395"><span class="linenos"> 395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">video_order</span> <span class="o">=</span> <span class="n">video_order</span>
</span><span id="ActionSegmentationStore-396"><a href="#ActionSegmentationStore-396"><span class="linenos"> 396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span> <span class="o">=</span> <span class="n">min_frames</span>
</span><span id="ActionSegmentationStore-397"><a href="#ActionSegmentationStore-397"><span class="linenos"> 397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span> <span class="o">=</span> <span class="n">max_frames</span>
</span><span id="ActionSegmentationStore-398"><a href="#ActionSegmentationStore-398"><span class="linenos"> 398</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="n">visibility</span>
</span><span id="ActionSegmentationStore-399"><a href="#ActionSegmentationStore-399"><span class="linenos"> 399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vis_min_score</span> <span class="o">=</span> <span class="n">visibility_min_score</span>
</span><span id="ActionSegmentationStore-400"><a href="#ActionSegmentationStore-400"><span class="linenos"> 400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vis_min_frac</span> <span class="o">=</span> <span class="n">visibility_min_frac</span>
</span><span id="ActionSegmentationStore-401"><a href="#ActionSegmentationStore-401"><span class="linenos"> 401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>
</span><span id="ActionSegmentationStore-402"><a href="#ActionSegmentationStore-402"><span class="linenos"> 402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_negatives</span> <span class="o">=</span> <span class="n">use_hard_negatives</span>
</span><span id="ActionSegmentationStore-403"><a href="#ActionSegmentationStore-403"><span class="linenos"> 403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">interactive</span> <span class="o">=</span> <span class="n">interactive</span>
</span><span id="ActionSegmentationStore-404"><a href="#ActionSegmentationStore-404"><span class="linenos"> 404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ignored_clips</span> <span class="o">=</span> <span class="n">ignored_clips</span>
</span><span id="ActionSegmentationStore-405"><a href="#ActionSegmentationStore-405"><span class="linenos"> 405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_file_paths</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-406"><a href="#ActionSegmentationStore-406"><span class="linenos"> 406</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ignored_classes</span> <span class="o">=</span> <span class="n">ignored_classes</span>
</span><span id="ActionSegmentationStore-407"><a href="#ActionSegmentationStore-407"><span class="linenos"> 407</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_behaviors</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ActionSegmentationStore-408"><a href="#ActionSegmentationStore-408"><span class="linenos"> 408</span></a>
</span><span id="ActionSegmentationStore-409"><a href="#ActionSegmentationStore-409"><span class="linenos"> 409</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ram</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ActionSegmentationStore-410"><a href="#ActionSegmentationStore-410"><span class="linenos"> 410</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore-411"><a href="#ActionSegmentationStore-411"><span class="linenos"> 411</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore-412"><a href="#ActionSegmentationStore-412"><span class="linenos"> 412</span></a>
</span><span id="ActionSegmentationStore-413"><a href="#ActionSegmentationStore-413"><span class="linenos"> 413</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span>
</span><span id="ActionSegmentationStore-414"><a href="#ActionSegmentationStore-414"><span class="linenos"> 414</span></a>
</span><span id="ActionSegmentationStore-415"><a href="#ActionSegmentationStore-415"><span class="linenos"> 415</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ann_suffix</span> <span class="o">=</span> <span class="n">annotation_suffix</span>
</span><span id="ActionSegmentationStore-416"><a href="#ActionSegmentationStore-416"><span class="linenos"> 416</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_folder</span> <span class="o">=</span> <span class="n">annotation_path</span>
</span><span id="ActionSegmentationStore-417"><a href="#ActionSegmentationStore-417"><span class="linenos"> 417</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filter_annotated</span> <span class="o">=</span> <span class="n">filter_annotated</span>
</span><span id="ActionSegmentationStore-418"><a href="#ActionSegmentationStore-418"><span class="linenos"> 418</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filter_background</span> <span class="o">=</span> <span class="n">filter_background</span>
</span><span id="ActionSegmentationStore-419"><a href="#ActionSegmentationStore-419"><span class="linenos"> 419</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">frame_limit</span> <span class="o">=</span> <span class="n">frame_limit</span>
</span><span id="ActionSegmentationStore-420"><a href="#ActionSegmentationStore-420"><span class="linenos"> 420</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">min_frames_action</span> <span class="o">=</span> <span class="n">min_frames_action</span>
</span><span id="ActionSegmentationStore-421"><a href="#ActionSegmentationStore-421"><span class="linenos"> 421</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_class</span> <span class="o">=</span> <span class="n">error_class</span>
</span><span id="ActionSegmentationStore-422"><a href="#ActionSegmentationStore-422"><span class="linenos"> 422</span></a>
</span><span id="ActionSegmentationStore-423"><a href="#ActionSegmentationStore-423"><span class="linenos"> 423</span></a>        <span class="k">if</span> <span class="n">correction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-424"><a href="#ActionSegmentationStore-424"><span class="linenos"> 424</span></a>            <span class="n">correction</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ActionSegmentationStore-425"><a href="#ActionSegmentationStore-425"><span class="linenos"> 425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">correction</span> <span class="o">=</span> <span class="n">correction</span>
</span><span id="ActionSegmentationStore-426"><a href="#ActionSegmentationStore-426"><span class="linenos"> 426</span></a>
</span><span id="ActionSegmentationStore-427"><a href="#ActionSegmentationStore-427"><span class="linenos"> 427</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-428"><a href="#ActionSegmentationStore-428"><span class="linenos"> 428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="ActionSegmentationStore-429"><a href="#ActionSegmentationStore-429"><span class="linenos"> 429</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-430"><a href="#ActionSegmentationStore-430"><span class="linenos"> 430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="ActionSegmentationStore-431"><a href="#ActionSegmentationStore-431"><span class="linenos"> 431</span></a>
</span><span id="ActionSegmentationStore-432"><a href="#ActionSegmentationStore-432"><span class="linenos"> 432</span></a>        <span class="n">lists</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ann_suffix</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-433"><a href="#ActionSegmentationStore-433"><span class="linenos"> 433</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lists</span><span class="p">)):</span>
</span><span id="ActionSegmentationStore-434"><a href="#ActionSegmentationStore-434"><span class="linenos"> 434</span></a>            <span class="n">iterable</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">))</span>
</span><span id="ActionSegmentationStore-435"><a href="#ActionSegmentationStore-435"><span class="linenos"> 435</span></a>            <span class="k">if</span> <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-436"><a href="#ActionSegmentationStore-436"><span class="linenos"> 436</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">iterable</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-437"><a href="#ActionSegmentationStore-437"><span class="linenos"> 437</span></a>                    <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="ActionSegmentationStore-438"><a href="#ActionSegmentationStore-438"><span class="linenos"> 438</span></a>                <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="ActionSegmentationStore-439"><a href="#ActionSegmentationStore-439"><span class="linenos"> 439</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ann_suffix</span> <span class="o">=</span> <span class="n">lists</span>
</span><span id="ActionSegmentationStore-440"><a href="#ActionSegmentationStore-440"><span class="linenos"> 440</span></a>
</span><span id="ActionSegmentationStore-441"><a href="#ActionSegmentationStore-441"><span class="linenos"> 441</span></a>        <span class="k">if</span> <span class="n">ignored_classes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-442"><a href="#ActionSegmentationStore-442"><span class="linenos"> 442</span></a>            <span class="n">ignored_classes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore-443"><a href="#ActionSegmentationStore-443"><span class="linenos"> 443</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ignored_classes</span> <span class="o">=</span> <span class="n">ignored_classes</span>
</span><span id="ActionSegmentationStore-444"><a href="#ActionSegmentationStore-444"><span class="linenos"> 444</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_behaviors</span><span class="p">(</span><span class="n">behaviors</span><span class="p">,</span> <span class="n">ignored_classes</span><span class="p">,</span> <span class="n">behavior_file</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-445"><a href="#ActionSegmentationStore-445"><span class="linenos"> 445</span></a>
</span><span id="ActionSegmentationStore-446"><a href="#ActionSegmentationStore-446"><span class="linenos"> 446</span></a>        <span class="k">if</span> <span class="n">key_objects</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-447"><a href="#ActionSegmentationStore-447"><span class="linenos"> 447</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">()</span>
</span><span id="ActionSegmentationStore-448"><a href="#ActionSegmentationStore-448"><span class="linenos"> 448</span></a>        <span class="k">elif</span> <span class="n">key_objects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-449"><a href="#ActionSegmentationStore-449"><span class="linenos"> 449</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_from_key_objects</span><span class="p">(</span><span class="n">key_objects</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-450"><a href="#ActionSegmentationStore-450"><span class="linenos"> 450</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-451"><a href="#ActionSegmentationStore-451"><span class="linenos"> 451</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ActionSegmentationStore-452"><a href="#ActionSegmentationStore-452"><span class="linenos"> 452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">labeled_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_labeled</span><span class="p">()</span>
</span><span id="ActionSegmentationStore-453"><a href="#ActionSegmentationStore-453"><span class="linenos"> 453</span></a>
</span><span id="ActionSegmentationStore-454"><a href="#ActionSegmentationStore-454"><span class="linenos"> 454</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
</span><span id="ActionSegmentationStore-455"><a href="#ActionSegmentationStore-455"><span class="linenos"> 455</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-456"><a href="#ActionSegmentationStore-456"><span class="linenos"> 456</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The annotation store data has not been initialized!&quot;</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-457"><a href="#ActionSegmentationStore-457"><span class="linenos"> 457</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-458"><a href="#ActionSegmentationStore-458"><span class="linenos"> 458</span></a>
</span><span id="ActionSegmentationStore-459"><a href="#ActionSegmentationStore-459"><span class="linenos"> 459</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-460"><a href="#ActionSegmentationStore-460"><span class="linenos"> 460</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-461"><a href="#ActionSegmentationStore-461"><span class="linenos"> 461</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The annotation store data has not been initialized!&quot;</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-462"><a href="#ActionSegmentationStore-462"><span class="linenos"> 462</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-463"><a href="#ActionSegmentationStore-463"><span class="linenos"> 463</span></a>
</span><span id="ActionSegmentationStore-464"><a href="#ActionSegmentationStore-464"><span class="linenos"> 464</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-465"><a href="#ActionSegmentationStore-465"><span class="linenos"> 465</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-466"><a href="#ActionSegmentationStore-466"><span class="linenos"> 466</span></a><span class="sd">        Remove the samples corresponding to indices</span>
</span><span id="ActionSegmentationStore-467"><a href="#ActionSegmentationStore-467"><span class="linenos"> 467</span></a>
</span><span id="ActionSegmentationStore-468"><a href="#ActionSegmentationStore-468"><span class="linenos"> 468</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore-469"><a href="#ActionSegmentationStore-469"><span class="linenos"> 469</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore-470"><a href="#ActionSegmentationStore-470"><span class="linenos"> 470</span></a><span class="sd">        indices : list</span>
</span><span id="ActionSegmentationStore-471"><a href="#ActionSegmentationStore-471"><span class="linenos"> 471</span></a><span class="sd">            a list of integer indices to remove</span>
</span><span id="ActionSegmentationStore-472"><a href="#ActionSegmentationStore-472"><span class="linenos"> 472</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-473"><a href="#ActionSegmentationStore-473"><span class="linenos"> 473</span></a>
</span><span id="ActionSegmentationStore-474"><a href="#ActionSegmentationStore-474"><span class="linenos"> 474</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-475"><a href="#ActionSegmentationStore-475"><span class="linenos"> 475</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="ActionSegmentationStore-476"><a href="#ActionSegmentationStore-476"><span class="linenos"> 476</span></a>            <span class="n">mask</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore-477"><a href="#ActionSegmentationStore-477"><span class="linenos"> 477</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-478"><a href="#ActionSegmentationStore-478"><span class="linenos"> 478</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-479"><a href="#ActionSegmentationStore-479"><span class="linenos"> 479</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-480"><a href="#ActionSegmentationStore-480"><span class="linenos"> 480</span></a>
</span><span id="ActionSegmentationStore-481"><a href="#ActionSegmentationStore-481"><span class="linenos"> 481</span></a>    <span class="k">def</span> <span class="nf">key_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-482"><a href="#ActionSegmentationStore-482"><span class="linenos"> 482</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-483"><a href="#ActionSegmentationStore-483"><span class="linenos"> 483</span></a><span class="sd">        Return a tuple of the key objects necessary to re-create the Store</span>
</span><span id="ActionSegmentationStore-484"><a href="#ActionSegmentationStore-484"><span class="linenos"> 484</span></a>
</span><span id="ActionSegmentationStore-485"><a href="#ActionSegmentationStore-485"><span class="linenos"> 485</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore-486"><a href="#ActionSegmentationStore-486"><span class="linenos"> 486</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore-487"><a href="#ActionSegmentationStore-487"><span class="linenos"> 487</span></a><span class="sd">        key_objects : tuple</span>
</span><span id="ActionSegmentationStore-488"><a href="#ActionSegmentationStore-488"><span class="linenos"> 488</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="ActionSegmentationStore-489"><a href="#ActionSegmentationStore-489"><span class="linenos"> 489</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-490"><a href="#ActionSegmentationStore-490"><span class="linenos"> 490</span></a>
</span><span id="ActionSegmentationStore-491"><a href="#ActionSegmentationStore-491"><span class="linenos"> 491</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="ActionSegmentationStore-492"><a href="#ActionSegmentationStore-492"><span class="linenos"> 492</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-493"><a href="#ActionSegmentationStore-493"><span class="linenos"> 493</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-494"><a href="#ActionSegmentationStore-494"><span class="linenos"> 494</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-495"><a href="#ActionSegmentationStore-495"><span class="linenos"> 495</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-496"><a href="#ActionSegmentationStore-496"><span class="linenos"> 496</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-497"><a href="#ActionSegmentationStore-497"><span class="linenos"> 497</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-498"><a href="#ActionSegmentationStore-498"><span class="linenos"> 498</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-499"><a href="#ActionSegmentationStore-499"><span class="linenos"> 499</span></a>        <span class="p">)</span>
</span><span id="ActionSegmentationStore-500"><a href="#ActionSegmentationStore-500"><span class="linenos"> 500</span></a>
</span><span id="ActionSegmentationStore-501"><a href="#ActionSegmentationStore-501"><span class="linenos"> 501</span></a>    <span class="k">def</span> <span class="nf">load_from_key_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-502"><a href="#ActionSegmentationStore-502"><span class="linenos"> 502</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-503"><a href="#ActionSegmentationStore-503"><span class="linenos"> 503</span></a><span class="sd">        Load the information from a tuple of key objects</span>
</span><span id="ActionSegmentationStore-504"><a href="#ActionSegmentationStore-504"><span class="linenos"> 504</span></a>
</span><span id="ActionSegmentationStore-505"><a href="#ActionSegmentationStore-505"><span class="linenos"> 505</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore-506"><a href="#ActionSegmentationStore-506"><span class="linenos"> 506</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore-507"><a href="#ActionSegmentationStore-507"><span class="linenos"> 507</span></a><span class="sd">        key_objects : tuple</span>
</span><span id="ActionSegmentationStore-508"><a href="#ActionSegmentationStore-508"><span class="linenos"> 508</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="ActionSegmentationStore-509"><a href="#ActionSegmentationStore-509"><span class="linenos"> 509</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-510"><a href="#ActionSegmentationStore-510"><span class="linenos"> 510</span></a>
</span><span id="ActionSegmentationStore-511"><a href="#ActionSegmentationStore-511"><span class="linenos"> 511</span></a>        <span class="p">(</span>
</span><span id="ActionSegmentationStore-512"><a href="#ActionSegmentationStore-512"><span class="linenos"> 512</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-513"><a href="#ActionSegmentationStore-513"><span class="linenos"> 513</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-514"><a href="#ActionSegmentationStore-514"><span class="linenos"> 514</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-515"><a href="#ActionSegmentationStore-515"><span class="linenos"> 515</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-516"><a href="#ActionSegmentationStore-516"><span class="linenos"> 516</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-517"><a href="#ActionSegmentationStore-517"><span class="linenos"> 517</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-518"><a href="#ActionSegmentationStore-518"><span class="linenos"> 518</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-519"><a href="#ActionSegmentationStore-519"><span class="linenos"> 519</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="n">key_objects</span>
</span><span id="ActionSegmentationStore-520"><a href="#ActionSegmentationStore-520"><span class="linenos"> 520</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">labeled_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_labeled</span><span class="p">()</span>
</span><span id="ActionSegmentationStore-521"><a href="#ActionSegmentationStore-521"><span class="linenos"> 521</span></a>
</span><span id="ActionSegmentationStore-522"><a href="#ActionSegmentationStore-522"><span class="linenos"> 522</span></a>    <span class="k">def</span> <span class="nf">to_ram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-523"><a href="#ActionSegmentationStore-523"><span class="linenos"> 523</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-524"><a href="#ActionSegmentationStore-524"><span class="linenos"> 524</span></a><span class="sd">        Transfer the data samples to RAM if they were previously stored as file paths</span>
</span><span id="ActionSegmentationStore-525"><a href="#ActionSegmentationStore-525"><span class="linenos"> 525</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-526"><a href="#ActionSegmentationStore-526"><span class="linenos"> 526</span></a>
</span><span id="ActionSegmentationStore-527"><a href="#ActionSegmentationStore-527"><span class="linenos"> 527</span></a>        <span class="k">pass</span>
</span><span id="ActionSegmentationStore-528"><a href="#ActionSegmentationStore-528"><span class="linenos"> 528</span></a>
</span><span id="ActionSegmentationStore-529"><a href="#ActionSegmentationStore-529"><span class="linenos"> 529</span></a>    <span class="k">def</span> <span class="nf">get_original_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-530"><a href="#ActionSegmentationStore-530"><span class="linenos"> 530</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-531"><a href="#ActionSegmentationStore-531"><span class="linenos"> 531</span></a><span class="sd">        Return the video_indices array</span>
</span><span id="ActionSegmentationStore-532"><a href="#ActionSegmentationStore-532"><span class="linenos"> 532</span></a>
</span><span id="ActionSegmentationStore-533"><a href="#ActionSegmentationStore-533"><span class="linenos"> 533</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore-534"><a href="#ActionSegmentationStore-534"><span class="linenos"> 534</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore-535"><a href="#ActionSegmentationStore-535"><span class="linenos"> 535</span></a><span class="sd">        original_coordinates : numpy.ndarray</span>
</span><span id="ActionSegmentationStore-536"><a href="#ActionSegmentationStore-536"><span class="linenos"> 536</span></a><span class="sd">            an array that contains the coordinates of the data samples in original input data</span>
</span><span id="ActionSegmentationStore-537"><a href="#ActionSegmentationStore-537"><span class="linenos"> 537</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-538"><a href="#ActionSegmentationStore-538"><span class="linenos"> 538</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span>
</span><span id="ActionSegmentationStore-539"><a href="#ActionSegmentationStore-539"><span class="linenos"> 539</span></a>
</span><span id="ActionSegmentationStore-540"><a href="#ActionSegmentationStore-540"><span class="linenos"> 540</span></a>    <span class="k">def</span> <span class="nf">create_subsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">ssl_indices</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ActionSegmentationStore-541"><a href="#ActionSegmentationStore-541"><span class="linenos"> 541</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-542"><a href="#ActionSegmentationStore-542"><span class="linenos"> 542</span></a><span class="sd">        Create a new store that contains a subsample of the data</span>
</span><span id="ActionSegmentationStore-543"><a href="#ActionSegmentationStore-543"><span class="linenos"> 543</span></a>
</span><span id="ActionSegmentationStore-544"><a href="#ActionSegmentationStore-544"><span class="linenos"> 544</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore-545"><a href="#ActionSegmentationStore-545"><span class="linenos"> 545</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore-546"><a href="#ActionSegmentationStore-546"><span class="linenos"> 546</span></a><span class="sd">        indices : list</span>
</span><span id="ActionSegmentationStore-547"><a href="#ActionSegmentationStore-547"><span class="linenos"> 547</span></a><span class="sd">            the indices to be included in the subsample</span>
</span><span id="ActionSegmentationStore-548"><a href="#ActionSegmentationStore-548"><span class="linenos"> 548</span></a><span class="sd">        ssl_indices : list, optional</span>
</span><span id="ActionSegmentationStore-549"><a href="#ActionSegmentationStore-549"><span class="linenos"> 549</span></a><span class="sd">            the indices to be included in the subsample without the annotation data</span>
</span><span id="ActionSegmentationStore-550"><a href="#ActionSegmentationStore-550"><span class="linenos"> 550</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-551"><a href="#ActionSegmentationStore-551"><span class="linenos"> 551</span></a>
</span><span id="ActionSegmentationStore-552"><a href="#ActionSegmentationStore-552"><span class="linenos"> 552</span></a>        <span class="k">if</span> <span class="n">ssl_indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-553"><a href="#ActionSegmentationStore-553"><span class="linenos"> 553</span></a>            <span class="n">ssl_indices</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore-554"><a href="#ActionSegmentationStore-554"><span class="linenos"> 554</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-555"><a href="#ActionSegmentationStore-555"><span class="linenos"> 555</span></a>        <span class="n">data</span><span class="p">[</span><span class="n">ssl_indices</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="ActionSegmentationStore-556"><a href="#ActionSegmentationStore-556"><span class="linenos"> 556</span></a>        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
</span><span id="ActionSegmentationStore-557"><a href="#ActionSegmentationStore-557"><span class="linenos"> 557</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">original_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">[</span><span class="n">indices</span> <span class="o">+</span> <span class="n">ssl_indices</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-558"><a href="#ActionSegmentationStore-558"><span class="linenos"> 558</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">indices</span> <span class="o">+</span> <span class="n">ssl_indices</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-559"><a href="#ActionSegmentationStore-559"><span class="linenos"> 559</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">labeled_indices</span><span class="p">,</span> <span class="n">new</span><span class="o">.</span><span class="n">unlabeled_indices</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">_compute_labeled</span><span class="p">()</span>
</span><span id="ActionSegmentationStore-560"><a href="#ActionSegmentationStore-560"><span class="linenos"> 560</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">behaviors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span>
</span><span id="ActionSegmentationStore-561"><a href="#ActionSegmentationStore-561"><span class="linenos"> 561</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span>
</span><span id="ActionSegmentationStore-562"><a href="#ActionSegmentationStore-562"><span class="linenos"> 562</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">len_segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span>
</span><span id="ActionSegmentationStore-563"><a href="#ActionSegmentationStore-563"><span class="linenos"> 563</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
</span><span id="ActionSegmentationStore-564"><a href="#ActionSegmentationStore-564"><span class="linenos"> 564</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">overlap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span>
</span><span id="ActionSegmentationStore-565"><a href="#ActionSegmentationStore-565"><span class="linenos"> 565</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">max_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span>
</span><span id="ActionSegmentationStore-566"><a href="#ActionSegmentationStore-566"><span class="linenos"> 566</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">min_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span>
</span><span id="ActionSegmentationStore-567"><a href="#ActionSegmentationStore-567"><span class="linenos"> 567</span></a>        <span class="k">return</span> <span class="n">new</span>
</span><span id="ActionSegmentationStore-568"><a href="#ActionSegmentationStore-568"><span class="linenos"> 568</span></a>
</span><span id="ActionSegmentationStore-569"><a href="#ActionSegmentationStore-569"><span class="linenos"> 569</span></a>    <span class="k">def</span> <span class="nf">get_len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-570"><a href="#ActionSegmentationStore-570"><span class="linenos"> 570</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-571"><a href="#ActionSegmentationStore-571"><span class="linenos"> 571</span></a><span class="sd">        Get the length of the subsample of labeled/unlabeled data</span>
</span><span id="ActionSegmentationStore-572"><a href="#ActionSegmentationStore-572"><span class="linenos"> 572</span></a>
</span><span id="ActionSegmentationStore-573"><a href="#ActionSegmentationStore-573"><span class="linenos"> 573</span></a><span class="sd">        If return_unlabeled is True, the index is in the subsample of unlabeled data, if False in labeled</span>
</span><span id="ActionSegmentationStore-574"><a href="#ActionSegmentationStore-574"><span class="linenos"> 574</span></a><span class="sd">        and if return_unlabeled is None the index is already correct</span>
</span><span id="ActionSegmentationStore-575"><a href="#ActionSegmentationStore-575"><span class="linenos"> 575</span></a>
</span><span id="ActionSegmentationStore-576"><a href="#ActionSegmentationStore-576"><span class="linenos"> 576</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore-577"><a href="#ActionSegmentationStore-577"><span class="linenos"> 577</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore-578"><a href="#ActionSegmentationStore-578"><span class="linenos"> 578</span></a><span class="sd">        return_unlabeled : bool</span>
</span><span id="ActionSegmentationStore-579"><a href="#ActionSegmentationStore-579"><span class="linenos"> 579</span></a><span class="sd">            the identifier for the subsample</span>
</span><span id="ActionSegmentationStore-580"><a href="#ActionSegmentationStore-580"><span class="linenos"> 580</span></a>
</span><span id="ActionSegmentationStore-581"><a href="#ActionSegmentationStore-581"><span class="linenos"> 581</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore-582"><a href="#ActionSegmentationStore-582"><span class="linenos"> 582</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore-583"><a href="#ActionSegmentationStore-583"><span class="linenos"> 583</span></a><span class="sd">        length : int</span>
</span><span id="ActionSegmentationStore-584"><a href="#ActionSegmentationStore-584"><span class="linenos"> 584</span></a><span class="sd">            the length of the subsample</span>
</span><span id="ActionSegmentationStore-585"><a href="#ActionSegmentationStore-585"><span class="linenos"> 585</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-586"><a href="#ActionSegmentationStore-586"><span class="linenos"> 586</span></a>
</span><span id="ActionSegmentationStore-587"><a href="#ActionSegmentationStore-587"><span class="linenos"> 587</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-588"><a href="#ActionSegmentationStore-588"><span class="linenos"> 588</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The annotation store data has not been initialized!&quot;</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-589"><a href="#ActionSegmentationStore-589"><span class="linenos"> 589</span></a>        <span class="k">elif</span> <span class="n">return_unlabeled</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-590"><a href="#ActionSegmentationStore-590"><span class="linenos"> 590</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-591"><a href="#ActionSegmentationStore-591"><span class="linenos"> 591</span></a>        <span class="k">elif</span> <span class="n">return_unlabeled</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-592"><a href="#ActionSegmentationStore-592"><span class="linenos"> 592</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_indices</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-593"><a href="#ActionSegmentationStore-593"><span class="linenos"> 593</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-594"><a href="#ActionSegmentationStore-594"><span class="linenos"> 594</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_indices</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-595"><a href="#ActionSegmentationStore-595"><span class="linenos"> 595</span></a>
</span><span id="ActionSegmentationStore-596"><a href="#ActionSegmentationStore-596"><span class="linenos"> 596</span></a>    <span class="k">def</span> <span class="nf">get_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-597"><a href="#ActionSegmentationStore-597"><span class="linenos"> 597</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-598"><a href="#ActionSegmentationStore-598"><span class="linenos"> 598</span></a><span class="sd">        Get a list of indices of samples in the labeled/unlabeled subset</span>
</span><span id="ActionSegmentationStore-599"><a href="#ActionSegmentationStore-599"><span class="linenos"> 599</span></a>
</span><span id="ActionSegmentationStore-600"><a href="#ActionSegmentationStore-600"><span class="linenos"> 600</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore-601"><a href="#ActionSegmentationStore-601"><span class="linenos"> 601</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore-602"><a href="#ActionSegmentationStore-602"><span class="linenos"> 602</span></a><span class="sd">        return_unlabeled : bool</span>
</span><span id="ActionSegmentationStore-603"><a href="#ActionSegmentationStore-603"><span class="linenos"> 603</span></a><span class="sd">            the identifier for the subsample (`True` for unlabeled, `False` for labeled, `None` for the</span>
</span><span id="ActionSegmentationStore-604"><a href="#ActionSegmentationStore-604"><span class="linenos"> 604</span></a><span class="sd">            whole dataset)</span>
</span><span id="ActionSegmentationStore-605"><a href="#ActionSegmentationStore-605"><span class="linenos"> 605</span></a>
</span><span id="ActionSegmentationStore-606"><a href="#ActionSegmentationStore-606"><span class="linenos"> 606</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore-607"><a href="#ActionSegmentationStore-607"><span class="linenos"> 607</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore-608"><a href="#ActionSegmentationStore-608"><span class="linenos"> 608</span></a><span class="sd">        indices : list</span>
</span><span id="ActionSegmentationStore-609"><a href="#ActionSegmentationStore-609"><span class="linenos"> 609</span></a><span class="sd">            a list of indices that meet the criteria</span>
</span><span id="ActionSegmentationStore-610"><a href="#ActionSegmentationStore-610"><span class="linenos"> 610</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-611"><a href="#ActionSegmentationStore-611"><span class="linenos"> 611</span></a>
</span><span id="ActionSegmentationStore-612"><a href="#ActionSegmentationStore-612"><span class="linenos"> 612</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)))</span>
</span><span id="ActionSegmentationStore-613"><a href="#ActionSegmentationStore-613"><span class="linenos"> 613</span></a>
</span><span id="ActionSegmentationStore-614"><a href="#ActionSegmentationStore-614"><span class="linenos"> 614</span></a>    <span class="k">def</span> <span class="nf">count_classes</span><span class="p">(</span>
</span><span id="ActionSegmentationStore-615"><a href="#ActionSegmentationStore-615"><span class="linenos"> 615</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">perc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zeros</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bouts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ActionSegmentationStore-616"><a href="#ActionSegmentationStore-616"><span class="linenos"> 616</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-617"><a href="#ActionSegmentationStore-617"><span class="linenos"> 617</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-618"><a href="#ActionSegmentationStore-618"><span class="linenos"> 618</span></a><span class="sd">        Get a dictionary with class-wise frame counts</span>
</span><span id="ActionSegmentationStore-619"><a href="#ActionSegmentationStore-619"><span class="linenos"> 619</span></a>
</span><span id="ActionSegmentationStore-620"><a href="#ActionSegmentationStore-620"><span class="linenos"> 620</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore-621"><a href="#ActionSegmentationStore-621"><span class="linenos"> 621</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore-622"><a href="#ActionSegmentationStore-622"><span class="linenos"> 622</span></a><span class="sd">        perc : bool, default False</span>
</span><span id="ActionSegmentationStore-623"><a href="#ActionSegmentationStore-623"><span class="linenos"> 623</span></a><span class="sd">            if `True`, a fraction of the total frame count is returned</span>
</span><span id="ActionSegmentationStore-624"><a href="#ActionSegmentationStore-624"><span class="linenos"> 624</span></a><span class="sd">        zeros : bool, default False</span>
</span><span id="ActionSegmentationStore-625"><a href="#ActionSegmentationStore-625"><span class="linenos"> 625</span></a><span class="sd">            if `True` and annotation is not exclusive, zero counts are returned</span>
</span><span id="ActionSegmentationStore-626"><a href="#ActionSegmentationStore-626"><span class="linenos"> 626</span></a><span class="sd">        bouts : bool, default False</span>
</span><span id="ActionSegmentationStore-627"><a href="#ActionSegmentationStore-627"><span class="linenos"> 627</span></a><span class="sd">            if `True`, instead of frame counts segment counts are returned</span>
</span><span id="ActionSegmentationStore-628"><a href="#ActionSegmentationStore-628"><span class="linenos"> 628</span></a>
</span><span id="ActionSegmentationStore-629"><a href="#ActionSegmentationStore-629"><span class="linenos"> 629</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore-630"><a href="#ActionSegmentationStore-630"><span class="linenos"> 630</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore-631"><a href="#ActionSegmentationStore-631"><span class="linenos"> 631</span></a><span class="sd">        count_dictionary : dict</span>
</span><span id="ActionSegmentationStore-632"><a href="#ActionSegmentationStore-632"><span class="linenos"> 632</span></a><span class="sd">            a dictionary with class indices as keys and frame counts as values</span>
</span><span id="ActionSegmentationStore-633"><a href="#ActionSegmentationStore-633"><span class="linenos"> 633</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-634"><a href="#ActionSegmentationStore-634"><span class="linenos"> 634</span></a>
</span><span id="ActionSegmentationStore-635"><a href="#ActionSegmentationStore-635"><span class="linenos"> 635</span></a>        <span class="k">if</span> <span class="n">bouts</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-636"><a href="#ActionSegmentationStore-636"><span class="linenos"> 636</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-637"><a href="#ActionSegmentationStore-637"><span class="linenos"> 637</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ActionSegmentationStore-638"><a href="#ActionSegmentationStore-638"><span class="linenos"> 638</span></a>                <span class="k">for</span> <span class="n">video</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ActionSegmentationStore-639"><a href="#ActionSegmentationStore-639"><span class="linenos"> 639</span></a>                    <span class="k">for</span> <span class="n">clip</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ActionSegmentationStore-640"><a href="#ActionSegmentationStore-640"><span class="linenos"> 640</span></a>                        <span class="n">length</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_min_frame</span><span class="p">(</span><span class="n">video</span><span class="p">,</span> <span class="n">clip</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-641"><a href="#ActionSegmentationStore-641"><span class="linenos"> 641</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-642"><a href="#ActionSegmentationStore-642"><span class="linenos"> 642</span></a>                            <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video</span><span class="si">}</span><span class="s2">---</span><span class="si">{</span><span class="n">clip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-643"><a href="#ActionSegmentationStore-643"><span class="linenos"> 643</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-644"><a href="#ActionSegmentationStore-644"><span class="linenos"> 644</span></a>                            <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video</span><span class="si">}</span><span class="s2">---</span><span class="si">{</span><span class="n">clip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
</span><span id="ActionSegmentationStore-645"><a href="#ActionSegmentationStore-645"><span class="linenos"> 645</span></a>                                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()),</span> <span class="n">length</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-646"><a href="#ActionSegmentationStore-646"><span class="linenos"> 646</span></a>                            <span class="p">)</span>
</span><span id="ActionSegmentationStore-647"><a href="#ActionSegmentationStore-647"><span class="linenos"> 647</span></a>                <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">):</span>
</span><span id="ActionSegmentationStore-648"><a href="#ActionSegmentationStore-648"><span class="linenos"> 648</span></a>                    <span class="n">split</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;---&quot;</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-649"><a href="#ActionSegmentationStore-649"><span class="linenos"> 649</span></a>                    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_max_frame</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_min_frame</span><span class="p">(</span>
</span><span id="ActionSegmentationStore-650"><a href="#ActionSegmentationStore-650"><span class="linenos"> 650</span></a>                        <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-651"><a href="#ActionSegmentationStore-651"><span class="linenos"> 651</span></a>                    <span class="p">)</span>
</span><span id="ActionSegmentationStore-652"><a href="#ActionSegmentationStore-652"><span class="linenos"> 652</span></a>                    <span class="n">i</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-653"><a href="#ActionSegmentationStore-653"><span class="linenos"> 653</span></a>                    <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
</span><span id="ActionSegmentationStore-654"><a href="#ActionSegmentationStore-654"><span class="linenos"> 654</span></a>                    <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-655"><a href="#ActionSegmentationStore-655"><span class="linenos"> 655</span></a>                    <span class="n">data</span><span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="o">...</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-656"><a href="#ActionSegmentationStore-656"><span class="linenos"> 656</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore-657"><a href="#ActionSegmentationStore-657"><span class="linenos"> 657</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ActionSegmentationStore-658"><a href="#ActionSegmentationStore-658"><span class="linenos"> 658</span></a>                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-659"><a href="#ActionSegmentationStore-659"><span class="linenos"> 659</span></a>                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
</span><span id="ActionSegmentationStore-660"><a href="#ActionSegmentationStore-660"><span class="linenos"> 660</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="ActionSegmentationStore-661"><a href="#ActionSegmentationStore-661"><span class="linenos"> 661</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-662"><a href="#ActionSegmentationStore-662"><span class="linenos"> 662</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-663"><a href="#ActionSegmentationStore-663"><span class="linenos"> 663</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-664"><a href="#ActionSegmentationStore-664"><span class="linenos"> 664</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ActionSegmentationStore-665"><a href="#ActionSegmentationStore-665"><span class="linenos"> 665</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-666"><a href="#ActionSegmentationStore-666"><span class="linenos"> 666</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">))</span>
</span><span id="ActionSegmentationStore-667"><a href="#ActionSegmentationStore-667"><span class="linenos"> 667</span></a>            <span class="n">count_dictionary</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ActionSegmentationStore-668"><a href="#ActionSegmentationStore-668"><span class="linenos"> 668</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">():</span>
</span><span id="ActionSegmentationStore-669"><a href="#ActionSegmentationStore-669"><span class="linenos"> 669</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-670"><a href="#ActionSegmentationStore-670"><span class="linenos"> 670</span></a>                    <span class="n">arr</span> <span class="o">=</span> <span class="n">data</span> <span class="o">==</span> <span class="n">c</span>
</span><span id="ActionSegmentationStore-671"><a href="#ActionSegmentationStore-671"><span class="linenos"> 671</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-672"><a href="#ActionSegmentationStore-672"><span class="linenos"> 672</span></a>                    <span class="k">if</span> <span class="n">zeros</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-673"><a href="#ActionSegmentationStore-673"><span class="linenos"> 673</span></a>                        <span class="n">arr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore-674"><a href="#ActionSegmentationStore-674"><span class="linenos"> 674</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-675"><a href="#ActionSegmentationStore-675"><span class="linenos"> 675</span></a>                        <span class="n">arr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="ActionSegmentationStore-676"><a href="#ActionSegmentationStore-676"><span class="linenos"> 676</span></a>                <span class="n">output</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">unique_consecutive</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-677"><a href="#ActionSegmentationStore-677"><span class="linenos"> 677</span></a>                <span class="n">true_indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">output</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-678"><a href="#ActionSegmentationStore-678"><span class="linenos"> 678</span></a>                <span class="n">count_dictionary</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_indices</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-679"><a href="#ActionSegmentationStore-679"><span class="linenos"> 679</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-680"><a href="#ActionSegmentationStore-680"><span class="linenos"> 680</span></a>            <span class="n">ind</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ActionSegmentationStore-681"><a href="#ActionSegmentationStore-681"><span class="linenos"> 681</span></a>            <span class="k">if</span> <span class="n">zeros</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-682"><a href="#ActionSegmentationStore-682"><span class="linenos"> 682</span></a>                <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore-683"><a href="#ActionSegmentationStore-683"><span class="linenos"> 683</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-684"><a href="#ActionSegmentationStore-684"><span class="linenos"> 684</span></a>                <span class="n">count_dictionary</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()))</span>
</span><span id="ActionSegmentationStore-685"><a href="#ActionSegmentationStore-685"><span class="linenos"> 685</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-686"><a href="#ActionSegmentationStore-686"><span class="linenos"> 686</span></a>                <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ActionSegmentationStore-687"><a href="#ActionSegmentationStore-687"><span class="linenos"> 687</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="ActionSegmentationStore-688"><a href="#ActionSegmentationStore-688"><span class="linenos"> 688</span></a>                    <span class="n">cnt</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span><span id="ActionSegmentationStore-689"><a href="#ActionSegmentationStore-689"><span class="linenos"> 689</span></a>                    <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-690"><a href="#ActionSegmentationStore-690"><span class="linenos"> 690</span></a>                <span class="n">count_dictionary</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="ActionSegmentationStore-691"><a href="#ActionSegmentationStore-691"><span class="linenos"> 691</span></a>            <span class="k">if</span> <span class="n">perc</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-692"><a href="#ActionSegmentationStore-692"><span class="linenos"> 692</span></a>                <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">count_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="ActionSegmentationStore-693"><a href="#ActionSegmentationStore-693"><span class="linenos"> 693</span></a>                <span class="n">count_dictionary</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="o">/</span> <span class="n">total</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">count_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="ActionSegmentationStore-694"><a href="#ActionSegmentationStore-694"><span class="linenos"> 694</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">():</span>
</span><span id="ActionSegmentationStore-695"><a href="#ActionSegmentationStore-695"><span class="linenos"> 695</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">count_dictionary</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-696"><a href="#ActionSegmentationStore-696"><span class="linenos"> 696</span></a>                <span class="n">count_dictionary</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore-697"><a href="#ActionSegmentationStore-697"><span class="linenos"> 697</span></a>        <span class="k">return</span> <span class="n">count_dictionary</span>
</span><span id="ActionSegmentationStore-698"><a href="#ActionSegmentationStore-698"><span class="linenos"> 698</span></a>
</span><span id="ActionSegmentationStore-699"><a href="#ActionSegmentationStore-699"><span class="linenos"> 699</span></a>    <span class="k">def</span> <span class="nf">behaviors_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-700"><a href="#ActionSegmentationStore-700"><span class="linenos"> 700</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-701"><a href="#ActionSegmentationStore-701"><span class="linenos"> 701</span></a><span class="sd">        Get a dictionary of class names</span>
</span><span id="ActionSegmentationStore-702"><a href="#ActionSegmentationStore-702"><span class="linenos"> 702</span></a>
</span><span id="ActionSegmentationStore-703"><a href="#ActionSegmentationStore-703"><span class="linenos"> 703</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore-704"><a href="#ActionSegmentationStore-704"><span class="linenos"> 704</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore-705"><a href="#ActionSegmentationStore-705"><span class="linenos"> 705</span></a><span class="sd">        behavior_dictionary: dict</span>
</span><span id="ActionSegmentationStore-706"><a href="#ActionSegmentationStore-706"><span class="linenos"> 706</span></a><span class="sd">            a dictionary with class indices as keys and class names as values</span>
</span><span id="ActionSegmentationStore-707"><a href="#ActionSegmentationStore-707"><span class="linenos"> 707</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-708"><a href="#ActionSegmentationStore-708"><span class="linenos"> 708</span></a>
</span><span id="ActionSegmentationStore-709"><a href="#ActionSegmentationStore-709"><span class="linenos"> 709</span></a>        <span class="c1"># if self.behaviors is None</span>
</span><span id="ActionSegmentationStore-710"><a href="#ActionSegmentationStore-710"><span class="linenos"> 710</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="ow">and</span> <span class="s2">&quot;other&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-711"><a href="#ActionSegmentationStore-711"><span class="linenos"> 711</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">b</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">)}</span>
</span><span id="ActionSegmentationStore-712"><a href="#ActionSegmentationStore-712"><span class="linenos"> 712</span></a>            <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;other&quot;</span>
</span><span id="ActionSegmentationStore-713"><a href="#ActionSegmentationStore-713"><span class="linenos"> 713</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-714"><a href="#ActionSegmentationStore-714"><span class="linenos"> 714</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">b</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">)}</span>
</span><span id="ActionSegmentationStore-715"><a href="#ActionSegmentationStore-715"><span class="linenos"> 715</span></a>        <span class="k">return</span> <span class="n">d</span>
</span><span id="ActionSegmentationStore-716"><a href="#ActionSegmentationStore-716"><span class="linenos"> 716</span></a>
</span><span id="ActionSegmentationStore-717"><a href="#ActionSegmentationStore-717"><span class="linenos"> 717</span></a>    <span class="k">def</span> <span class="nf">annotation_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-718"><a href="#ActionSegmentationStore-718"><span class="linenos"> 718</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-719"><a href="#ActionSegmentationStore-719"><span class="linenos"> 719</span></a><span class="sd">        Get the type of annotation (&#39;exclusive_classification&#39;, &#39;nonexclusive_classification&#39;)</span>
</span><span id="ActionSegmentationStore-720"><a href="#ActionSegmentationStore-720"><span class="linenos"> 720</span></a>
</span><span id="ActionSegmentationStore-721"><a href="#ActionSegmentationStore-721"><span class="linenos"> 721</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore-722"><a href="#ActionSegmentationStore-722"><span class="linenos"> 722</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore-723"><a href="#ActionSegmentationStore-723"><span class="linenos"> 723</span></a><span class="sd">        annotation_class : str</span>
</span><span id="ActionSegmentationStore-724"><a href="#ActionSegmentationStore-724"><span class="linenos"> 724</span></a><span class="sd">            the type of annotation</span>
</span><span id="ActionSegmentationStore-725"><a href="#ActionSegmentationStore-725"><span class="linenos"> 725</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-726"><a href="#ActionSegmentationStore-726"><span class="linenos"> 726</span></a>
</span><span id="ActionSegmentationStore-727"><a href="#ActionSegmentationStore-727"><span class="linenos"> 727</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-728"><a href="#ActionSegmentationStore-728"><span class="linenos"> 728</span></a>            <span class="k">return</span> <span class="s2">&quot;exclusive_classification&quot;</span>
</span><span id="ActionSegmentationStore-729"><a href="#ActionSegmentationStore-729"><span class="linenos"> 729</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-730"><a href="#ActionSegmentationStore-730"><span class="linenos"> 730</span></a>            <span class="k">return</span> <span class="s2">&quot;nonexclusive_classification&quot;</span>
</span><span id="ActionSegmentationStore-731"><a href="#ActionSegmentationStore-731"><span class="linenos"> 731</span></a>
</span><span id="ActionSegmentationStore-732"><a href="#ActionSegmentationStore-732"><span class="linenos"> 732</span></a>    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-733"><a href="#ActionSegmentationStore-733"><span class="linenos"> 733</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-734"><a href="#ActionSegmentationStore-734"><span class="linenos"> 734</span></a><span class="sd">        Get the total number of frames in the data</span>
</span><span id="ActionSegmentationStore-735"><a href="#ActionSegmentationStore-735"><span class="linenos"> 735</span></a>
</span><span id="ActionSegmentationStore-736"><a href="#ActionSegmentationStore-736"><span class="linenos"> 736</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore-737"><a href="#ActionSegmentationStore-737"><span class="linenos"> 737</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore-738"><a href="#ActionSegmentationStore-738"><span class="linenos"> 738</span></a><span class="sd">        size : int</span>
</span><span id="ActionSegmentationStore-739"><a href="#ActionSegmentationStore-739"><span class="linenos"> 739</span></a><span class="sd">            the total number of frames</span>
</span><span id="ActionSegmentationStore-740"><a href="#ActionSegmentationStore-740"><span class="linenos"> 740</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-741"><a href="#ActionSegmentationStore-741"><span class="linenos"> 741</span></a>
</span><span id="ActionSegmentationStore-742"><a href="#ActionSegmentationStore-742"><span class="linenos"> 742</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-743"><a href="#ActionSegmentationStore-743"><span class="linenos"> 743</span></a>
</span><span id="ActionSegmentationStore-744"><a href="#ActionSegmentationStore-744"><span class="linenos"> 744</span></a>    <span class="k">def</span> <span class="nf">filtered_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-745"><a href="#ActionSegmentationStore-745"><span class="linenos"> 745</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-746"><a href="#ActionSegmentationStore-746"><span class="linenos"> 746</span></a><span class="sd">        Return the indices of the samples that should be removed</span>
</span><span id="ActionSegmentationStore-747"><a href="#ActionSegmentationStore-747"><span class="linenos"> 747</span></a>
</span><span id="ActionSegmentationStore-748"><a href="#ActionSegmentationStore-748"><span class="linenos"> 748</span></a><span class="sd">        Choosing the indices can be based on any kind of filering defined in the __init__ function by the data</span>
</span><span id="ActionSegmentationStore-749"><a href="#ActionSegmentationStore-749"><span class="linenos"> 749</span></a><span class="sd">        parameters</span>
</span><span id="ActionSegmentationStore-750"><a href="#ActionSegmentationStore-750"><span class="linenos"> 750</span></a>
</span><span id="ActionSegmentationStore-751"><a href="#ActionSegmentationStore-751"><span class="linenos"> 751</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore-752"><a href="#ActionSegmentationStore-752"><span class="linenos"> 752</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore-753"><a href="#ActionSegmentationStore-753"><span class="linenos"> 753</span></a><span class="sd">        indices_to_remove : list</span>
</span><span id="ActionSegmentationStore-754"><a href="#ActionSegmentationStore-754"><span class="linenos"> 754</span></a><span class="sd">            a list of integer indices that should be removed</span>
</span><span id="ActionSegmentationStore-755"><a href="#ActionSegmentationStore-755"><span class="linenos"> 755</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-756"><a href="#ActionSegmentationStore-756"><span class="linenos"> 756</span></a>
</span><span id="ActionSegmentationStore-757"><a href="#ActionSegmentationStore-757"><span class="linenos"> 757</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtered</span>
</span><span id="ActionSegmentationStore-758"><a href="#ActionSegmentationStore-758"><span class="linenos"> 758</span></a>
</span><span id="ActionSegmentationStore-759"><a href="#ActionSegmentationStore-759"><span class="linenos"> 759</span></a>    <span class="k">def</span> <span class="nf">set_pseudo_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-760"><a href="#ActionSegmentationStore-760"><span class="linenos"> 760</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-761"><a href="#ActionSegmentationStore-761"><span class="linenos"> 761</span></a><span class="sd">        Set pseudo labels to the unlabeled data</span>
</span><span id="ActionSegmentationStore-762"><a href="#ActionSegmentationStore-762"><span class="linenos"> 762</span></a>
</span><span id="ActionSegmentationStore-763"><a href="#ActionSegmentationStore-763"><span class="linenos"> 763</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore-764"><a href="#ActionSegmentationStore-764"><span class="linenos"> 764</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore-765"><a href="#ActionSegmentationStore-765"><span class="linenos"> 765</span></a><span class="sd">        labels : torch.Tensor</span>
</span><span id="ActionSegmentationStore-766"><a href="#ActionSegmentationStore-766"><span class="linenos"> 766</span></a><span class="sd">            a tensor of pseudo-labels for the unlabeled data</span>
</span><span id="ActionSegmentationStore-767"><a href="#ActionSegmentationStore-767"><span class="linenos"> 767</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-768"><a href="#ActionSegmentationStore-768"><span class="linenos"> 768</span></a>
</span><span id="ActionSegmentationStore-769"><a href="#ActionSegmentationStore-769"><span class="linenos"> 769</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
</span><span id="ActionSegmentationStore-770"><a href="#ActionSegmentationStore-770"><span class="linenos"> 770</span></a>
</span><span id="ActionSegmentationStore-771"><a href="#ActionSegmentationStore-771"><span class="linenos"> 771</span></a>    <span class="nd">@classmethod</span>
</span><span id="ActionSegmentationStore-772"><a href="#ActionSegmentationStore-772"><span class="linenos"> 772</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span>
</span><span id="ActionSegmentationStore-773"><a href="#ActionSegmentationStore-773"><span class="linenos"> 773</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-774"><a href="#ActionSegmentationStore-774"><span class="linenos"> 774</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">],</span>
</span><span id="ActionSegmentationStore-775"><a href="#ActionSegmentationStore-775"><span class="linenos"> 775</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">],</span>
</span><span id="ActionSegmentationStore-776"><a href="#ActionSegmentationStore-776"><span class="linenos"> 776</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-777"><a href="#ActionSegmentationStore-777"><span class="linenos"> 777</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="ActionSegmentationStore-778"><a href="#ActionSegmentationStore-778"><span class="linenos"> 778</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-779"><a href="#ActionSegmentationStore-779"><span class="linenos"> 779</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-780"><a href="#ActionSegmentationStore-780"><span class="linenos"> 780</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="ActionSegmentationStore-781"><a href="#ActionSegmentationStore-781"><span class="linenos"> 781</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="ActionSegmentationStore-782"><a href="#ActionSegmentationStore-782"><span class="linenos"> 782</span></a>
</span><span id="ActionSegmentationStore-783"><a href="#ActionSegmentationStore-783"><span class="linenos"> 783</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore-784"><a href="#ActionSegmentationStore-784"><span class="linenos"> 784</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore-785"><a href="#ActionSegmentationStore-785"><span class="linenos"> 785</span></a><span class="sd">        annotation_path : str | set</span>
</span><span id="ActionSegmentationStore-786"><a href="#ActionSegmentationStore-786"><span class="linenos"> 786</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored</span>
</span><span id="ActionSegmentationStore-787"><a href="#ActionSegmentationStore-787"><span class="linenos"> 787</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="ActionSegmentationStore-788"><a href="#ActionSegmentationStore-788"><span class="linenos"> 788</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="ActionSegmentationStore-789"><a href="#ActionSegmentationStore-789"><span class="linenos"> 789</span></a>
</span><span id="ActionSegmentationStore-790"><a href="#ActionSegmentationStore-790"><span class="linenos"> 790</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore-791"><a href="#ActionSegmentationStore-791"><span class="linenos"> 791</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore-792"><a href="#ActionSegmentationStore-792"><span class="linenos"> 792</span></a><span class="sd">        video_ids : list</span>
</span><span id="ActionSegmentationStore-793"><a href="#ActionSegmentationStore-793"><span class="linenos"> 793</span></a><span class="sd">            a list of video file ids</span>
</span><span id="ActionSegmentationStore-794"><a href="#ActionSegmentationStore-794"><span class="linenos"> 794</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-795"><a href="#ActionSegmentationStore-795"><span class="linenos"> 795</span></a>
</span><span id="ActionSegmentationStore-796"><a href="#ActionSegmentationStore-796"><span class="linenos"> 796</span></a>        <span class="n">lists</span> <span class="o">=</span> <span class="p">[</span><span class="n">annotation_path</span><span class="p">,</span> <span class="n">annotation_suffix</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-797"><a href="#ActionSegmentationStore-797"><span class="linenos"> 797</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lists</span><span class="p">)):</span>
</span><span id="ActionSegmentationStore-798"><a href="#ActionSegmentationStore-798"><span class="linenos"> 798</span></a>            <span class="n">iterable</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">))</span>
</span><span id="ActionSegmentationStore-799"><a href="#ActionSegmentationStore-799"><span class="linenos"> 799</span></a>            <span class="k">if</span> <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-800"><a href="#ActionSegmentationStore-800"><span class="linenos"> 800</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">iterable</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-801"><a href="#ActionSegmentationStore-801"><span class="linenos"> 801</span></a>                    <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="ActionSegmentationStore-802"><a href="#ActionSegmentationStore-802"><span class="linenos"> 802</span></a>                <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="ActionSegmentationStore-803"><a href="#ActionSegmentationStore-803"><span class="linenos"> 803</span></a>        <span class="n">annotation_path</span><span class="p">,</span> <span class="n">annotation_suffix</span> <span class="o">=</span> <span class="n">lists</span>
</span><span id="ActionSegmentationStore-804"><a href="#ActionSegmentationStore-804"><span class="linenos"> 804</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore-805"><a href="#ActionSegmentationStore-805"><span class="linenos"> 805</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">annotation_path</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-806"><a href="#ActionSegmentationStore-806"><span class="linenos"> 806</span></a>            <span class="n">files</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="ActionSegmentationStore-807"><a href="#ActionSegmentationStore-807"><span class="linenos"> 807</span></a>                <span class="n">strip_suffix</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="n">annotation_suffix</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-808"><a href="#ActionSegmentationStore-808"><span class="linenos"> 808</span></a>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-809"><a href="#ActionSegmentationStore-809"><span class="linenos"> 809</span></a>                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">annotation_suffix</span><span class="p">]))</span>
</span><span id="ActionSegmentationStore-810"><a href="#ActionSegmentationStore-810"><span class="linenos"> 810</span></a>            <span class="p">]</span>
</span><span id="ActionSegmentationStore-811"><a href="#ActionSegmentationStore-811"><span class="linenos"> 811</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="ActionSegmentationStore-812"><a href="#ActionSegmentationStore-812"><span class="linenos"> 812</span></a>        <span class="k">return</span> <span class="n">files</span>
</span><span id="ActionSegmentationStore-813"><a href="#ActionSegmentationStore-813"><span class="linenos"> 813</span></a>
</span><span id="ActionSegmentationStore-814"><a href="#ActionSegmentationStore-814"><span class="linenos"> 814</span></a>    <span class="k">def</span> <span class="nf">_set_behaviors</span><span class="p">(</span>
</span><span id="ActionSegmentationStore-815"><a href="#ActionSegmentationStore-815"><span class="linenos"> 815</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">behaviors</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="ActionSegmentationStore-816"><a href="#ActionSegmentationStore-816"><span class="linenos"> 816</span></a>    <span class="p">):</span>
</span><span id="ActionSegmentationStore-817"><a href="#ActionSegmentationStore-817"><span class="linenos"> 817</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-818"><a href="#ActionSegmentationStore-818"><span class="linenos"> 818</span></a><span class="sd">        Get a list of behaviors that should be annotated from behavior parameters</span>
</span><span id="ActionSegmentationStore-819"><a href="#ActionSegmentationStore-819"><span class="linenos"> 819</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-820"><a href="#ActionSegmentationStore-820"><span class="linenos"> 820</span></a>
</span><span id="ActionSegmentationStore-821"><a href="#ActionSegmentationStore-821"><span class="linenos"> 821</span></a>        <span class="k">if</span> <span class="n">behaviors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-822"><a href="#ActionSegmentationStore-822"><span class="linenos"> 822</span></a>            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">ignored_classes</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-823"><a href="#ActionSegmentationStore-823"><span class="linenos"> 823</span></a>                <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-824"><a href="#ActionSegmentationStore-824"><span class="linenos"> 824</span></a>                    <span class="n">behaviors</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-825"><a href="#ActionSegmentationStore-825"><span class="linenos"> 825</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span> <span class="o">=</span> <span class="n">behaviors</span>
</span><span id="ActionSegmentationStore-826"><a href="#ActionSegmentationStore-826"><span class="linenos"> 826</span></a>
</span><span id="ActionSegmentationStore-827"><a href="#ActionSegmentationStore-827"><span class="linenos"> 827</span></a>    <span class="k">def</span> <span class="nf">_compute_labeled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="ActionSegmentationStore-828"><a href="#ActionSegmentationStore-828"><span class="linenos"> 828</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-829"><a href="#ActionSegmentationStore-829"><span class="linenos"> 829</span></a><span class="sd">        Get the indices of labeled (annotated) and unlabeled samples</span>
</span><span id="ActionSegmentationStore-830"><a href="#ActionSegmentationStore-830"><span class="linenos"> 830</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-831"><a href="#ActionSegmentationStore-831"><span class="linenos"> 831</span></a>
</span><span id="ActionSegmentationStore-832"><a href="#ActionSegmentationStore-832"><span class="linenos"> 832</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-833"><a href="#ActionSegmentationStore-833"><span class="linenos"> 833</span></a>            <span class="n">unlabeled</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore-834"><a href="#ActionSegmentationStore-834"><span class="linenos"> 834</span></a>            <span class="n">labeled_indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">unlabeled</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-835"><a href="#ActionSegmentationStore-835"><span class="linenos"> 835</span></a>            <span class="n">unlabeled_indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">unlabeled</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-836"><a href="#ActionSegmentationStore-836"><span class="linenos"> 836</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-837"><a href="#ActionSegmentationStore-837"><span class="linenos"> 837</span></a>            <span class="n">labeled_indices</span><span class="p">,</span> <span class="n">unlabeled_indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([])</span>
</span><span id="ActionSegmentationStore-838"><a href="#ActionSegmentationStore-838"><span class="linenos"> 838</span></a>        <span class="k">return</span> <span class="n">labeled_indices</span><span class="p">,</span> <span class="n">unlabeled_indices</span>
</span><span id="ActionSegmentationStore-839"><a href="#ActionSegmentationStore-839"><span class="linenos"> 839</span></a>
</span><span id="ActionSegmentationStore-840"><a href="#ActionSegmentationStore-840"><span class="linenos"> 840</span></a>    <span class="k">def</span> <span class="nf">_generate_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-841"><a href="#ActionSegmentationStore-841"><span class="linenos"> 841</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-842"><a href="#ActionSegmentationStore-842"><span class="linenos"> 842</span></a><span class="sd">        Process a loaded annotation file to generate a training labels dictionary</span>
</span><span id="ActionSegmentationStore-843"><a href="#ActionSegmentationStore-843"><span class="linenos"> 843</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-844"><a href="#ActionSegmentationStore-844"><span class="linenos"> 844</span></a>
</span><span id="ActionSegmentationStore-845"><a href="#ActionSegmentationStore-845"><span class="linenos"> 845</span></a>        <span class="n">annotation</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ActionSegmentationStore-846"><a href="#ActionSegmentationStore-846"><span class="linenos"> 846</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-847"><a href="#ActionSegmentationStore-847"><span class="linenos"> 847</span></a>            <span class="n">behaviors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="ActionSegmentationStore-848"><a href="#ActionSegmentationStore-848"><span class="linenos"> 848</span></a>            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">times</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="ActionSegmentationStore-849"><a href="#ActionSegmentationStore-849"><span class="linenos"> 849</span></a>                <span class="n">behaviors</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="ActionSegmentationStore-850"><a href="#ActionSegmentationStore-850"><span class="linenos"> 850</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ActionSegmentationStore-851"><a href="#ActionSegmentationStore-851"><span class="linenos"> 851</span></a>                <span class="n">x</span>
</span><span id="ActionSegmentationStore-852"><a href="#ActionSegmentationStore-852"><span class="linenos"> 852</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">behaviors</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-853"><a href="#ActionSegmentationStore-853"><span class="linenos"> 853</span></a>                <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignored_classes</span>
</span><span id="ActionSegmentationStore-854"><a href="#ActionSegmentationStore-854"><span class="linenos"> 854</span></a>                <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;negative&quot;</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-855"><a href="#ActionSegmentationStore-855"><span class="linenos"> 855</span></a>                <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-856"><a href="#ActionSegmentationStore-856"><span class="linenos"> 856</span></a>            <span class="p">]</span>
</span><span id="ActionSegmentationStore-857"><a href="#ActionSegmentationStore-857"><span class="linenos"> 857</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">times</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-858"><a href="#ActionSegmentationStore-858"><span class="linenos"> 858</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot generate annotqtion without behavior information!&quot;</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-859"><a href="#ActionSegmentationStore-859"><span class="linenos"> 859</span></a>        <span class="n">beh_inv</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="ActionSegmentationStore-860"><a href="#ActionSegmentationStore-860"><span class="linenos"> 860</span></a>        <span class="c1"># if there is no annotation file, generate empty annotation</span>
</span><span id="ActionSegmentationStore-861"><a href="#ActionSegmentationStore-861"><span class="linenos"> 861</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-862"><a href="#ActionSegmentationStore-862"><span class="linenos"> 862</span></a>            <span class="n">clips</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ActionSegmentationStore-863"><a href="#ActionSegmentationStore-863"><span class="linenos"> 863</span></a>                <span class="s2">&quot;+&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="ActionSegmentationStore-864"><a href="#ActionSegmentationStore-864"><span class="linenos"> 864</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-865"><a href="#ActionSegmentationStore-865"><span class="linenos"> 865</span></a>            <span class="p">]</span>
</span><span id="ActionSegmentationStore-866"><a href="#ActionSegmentationStore-866"><span class="linenos"> 866</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-867"><a href="#ActionSegmentationStore-867"><span class="linenos"> 867</span></a>            <span class="n">clips</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="ActionSegmentationStore-868"><a href="#ActionSegmentationStore-868"><span class="linenos"> 868</span></a>        <span class="k">if</span> <span class="n">times</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-869"><a href="#ActionSegmentationStore-869"><span class="linenos"> 869</span></a>            <span class="n">clips</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clips</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignored_clips</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-870"><a href="#ActionSegmentationStore-870"><span class="linenos"> 870</span></a>        <span class="c1"># otherwise, apply filters and generate label arrays</span>
</span><span id="ActionSegmentationStore-871"><a href="#ActionSegmentationStore-871"><span class="linenos"> 871</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-872"><a href="#ActionSegmentationStore-872"><span class="linenos"> 872</span></a>            <span class="n">clips</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ActionSegmentationStore-873"><a href="#ActionSegmentationStore-873"><span class="linenos"> 873</span></a>                <span class="n">x</span>
</span><span id="ActionSegmentationStore-874"><a href="#ActionSegmentationStore-874"><span class="linenos"> 874</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">clips</span>
</span><span id="ActionSegmentationStore-875"><a href="#ActionSegmentationStore-875"><span class="linenos"> 875</span></a>                <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignored_clips</span> <span class="ow">and</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">times</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="ActionSegmentationStore-876"><a href="#ActionSegmentationStore-876"><span class="linenos"> 876</span></a>            <span class="p">]</span>
</span><span id="ActionSegmentationStore-877"><a href="#ActionSegmentationStore-877"><span class="linenos"> 877</span></a>            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">times</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ActionSegmentationStore-878"><a href="#ActionSegmentationStore-878"><span class="linenos"> 878</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-879"><a href="#ActionSegmentationStore-879"><span class="linenos"> 879</span></a>                    <span class="n">min_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_min_frame</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-880"><a href="#ActionSegmentationStore-880"><span class="linenos"> 880</span></a>                    <span class="n">max_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_max_frame</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-881"><a href="#ActionSegmentationStore-881"><span class="linenos"> 881</span></a>                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-882"><a href="#ActionSegmentationStore-882"><span class="linenos"> 882</span></a>                    <span class="k">continue</span>
</span><span id="ActionSegmentationStore-883"><a href="#ActionSegmentationStore-883"><span class="linenos"> 883</span></a>                <span class="n">go_on</span> <span class="o">=</span> <span class="n">max_frame</span> <span class="o">-</span> <span class="n">min_frame</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_limit</span>
</span><span id="ActionSegmentationStore-884"><a href="#ActionSegmentationStore-884"><span class="linenos"> 884</span></a>                <span class="k">if</span> <span class="n">go_on</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-885"><a href="#ActionSegmentationStore-885"><span class="linenos"> 885</span></a>                    <span class="n">v_len</span> <span class="o">=</span> <span class="n">max_frame</span> <span class="o">-</span> <span class="n">min_frame</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ActionSegmentationStore-886"><a href="#ActionSegmentationStore-886"><span class="linenos"> 886</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-887"><a href="#ActionSegmentationStore-887"><span class="linenos"> 887</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_background</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-888"><a href="#ActionSegmentationStore-888"><span class="linenos"> 888</span></a>                            <span class="n">value</span> <span class="o">=</span> <span class="n">beh_inv</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;other&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-889"><a href="#ActionSegmentationStore-889"><span class="linenos"> 889</span></a>                            <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">v_len</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">long</span><span class="p">)</span> <span class="o">*</span> <span class="n">value</span>
</span><span id="ActionSegmentationStore-890"><a href="#ActionSegmentationStore-890"><span class="linenos"> 890</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-891"><a href="#ActionSegmentationStore-891"><span class="linenos"> 891</span></a>                            <span class="n">labels</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">v_len</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">long</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-892"><a href="#ActionSegmentationStore-892"><span class="linenos"> 892</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-893"><a href="#ActionSegmentationStore-893"><span class="linenos"> 893</span></a>                        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">),</span> <span class="n">v_len</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-894"><a href="#ActionSegmentationStore-894"><span class="linenos"> 894</span></a>                    <span class="n">cat_new</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore-895"><a href="#ActionSegmentationStore-895"><span class="linenos"> 895</span></a>                    <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">times</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ActionSegmentationStore-896"><a href="#ActionSegmentationStore-896"><span class="linenos"> 896</span></a>                        <span class="k">if</span> <span class="n">cat</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">):</span>
</span><span id="ActionSegmentationStore-897"><a href="#ActionSegmentationStore-897"><span class="linenos"> 897</span></a>                            <span class="n">cat_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-898"><a href="#ActionSegmentationStore-898"><span class="linenos"> 898</span></a>                    <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">times</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ActionSegmentationStore-899"><a href="#ActionSegmentationStore-899"><span class="linenos"> 899</span></a>                        <span class="k">if</span> <span class="n">cat</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;negative&quot;</span><span class="p">):</span>
</span><span id="ActionSegmentationStore-900"><a href="#ActionSegmentationStore-900"><span class="linenos"> 900</span></a>                            <span class="n">cat_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-901"><a href="#ActionSegmentationStore-901"><span class="linenos"> 901</span></a>                    <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">times</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ActionSegmentationStore-902"><a href="#ActionSegmentationStore-902"><span class="linenos"> 902</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">cat</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;negative&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cat</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
</span><span id="ActionSegmentationStore-903"><a href="#ActionSegmentationStore-903"><span class="linenos"> 903</span></a>                            <span class="s2">&quot;unknown&quot;</span>
</span><span id="ActionSegmentationStore-904"><a href="#ActionSegmentationStore-904"><span class="linenos"> 904</span></a>                        <span class="p">):</span>
</span><span id="ActionSegmentationStore-905"><a href="#ActionSegmentationStore-905"><span class="linenos"> 905</span></a>                            <span class="n">cat_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-906"><a href="#ActionSegmentationStore-906"><span class="linenos"> 906</span></a>                    <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">cat_new</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-907"><a href="#ActionSegmentationStore-907"><span class="linenos"> 907</span></a>                        <span class="n">neg</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ActionSegmentationStore-908"><a href="#ActionSegmentationStore-908"><span class="linenos"> 908</span></a>                        <span class="n">unknown</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ActionSegmentationStore-909"><a href="#ActionSegmentationStore-909"><span class="linenos"> 909</span></a>                        <span class="n">cat_times</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="n">cat</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-910"><a href="#ActionSegmentationStore-910"><span class="linenos"> 910</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_negatives</span> <span class="ow">and</span> <span class="n">cat</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;negative&quot;</span><span class="p">):</span>
</span><span id="ActionSegmentationStore-911"><a href="#ActionSegmentationStore-911"><span class="linenos"> 911</span></a>                            <span class="n">cat</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="ActionSegmentationStore-912"><a href="#ActionSegmentationStore-912"><span class="linenos"> 912</span></a>                            <span class="n">neg</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ActionSegmentationStore-913"><a href="#ActionSegmentationStore-913"><span class="linenos"> 913</span></a>                        <span class="k">elif</span> <span class="n">cat</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">):</span>
</span><span id="ActionSegmentationStore-914"><a href="#ActionSegmentationStore-914"><span class="linenos"> 914</span></a>                            <span class="n">cat</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="ActionSegmentationStore-915"><a href="#ActionSegmentationStore-915"><span class="linenos"> 915</span></a>                            <span class="n">unknown</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ActionSegmentationStore-916"><a href="#ActionSegmentationStore-916"><span class="linenos"> 916</span></a>                        <span class="k">if</span> <span class="n">cat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">correction</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-917"><a href="#ActionSegmentationStore-917"><span class="linenos"> 917</span></a>                            <span class="n">cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">correction</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-918"><a href="#ActionSegmentationStore-918"><span class="linenos"> 918</span></a>                        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">amb</span> <span class="ow">in</span> <span class="n">cat_times</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-919"><a href="#ActionSegmentationStore-919"><span class="linenos"> 919</span></a>                            <span class="k">if</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_max_frame</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-920"><a href="#ActionSegmentationStore-920"><span class="linenos"> 920</span></a>                                <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_max_frame</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ActionSegmentationStore-921"><a href="#ActionSegmentationStore-921"><span class="linenos"> 921</span></a>                            <span class="k">if</span> <span class="n">amb</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-922"><a href="#ActionSegmentationStore-922"><span class="linenos"> 922</span></a>                                <span class="k">continue</span>
</span><span id="ActionSegmentationStore-923"><a href="#ActionSegmentationStore-923"><span class="linenos"> 923</span></a>                            <span class="n">start</span> <span class="o">-=</span> <span class="n">min_frame</span>
</span><span id="ActionSegmentationStore-924"><a href="#ActionSegmentationStore-924"><span class="linenos"> 924</span></a>                            <span class="n">end</span> <span class="o">-=</span> <span class="n">min_frame</span>
</span><span id="ActionSegmentationStore-925"><a href="#ActionSegmentationStore-925"><span class="linenos"> 925</span></a>                            <span class="k">if</span> <span class="p">(</span>
</span><span id="ActionSegmentationStore-926"><a href="#ActionSegmentationStore-926"><span class="linenos"> 926</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">min_frames_action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ActionSegmentationStore-927"><a href="#ActionSegmentationStore-927"><span class="linenos"> 927</span></a>                                <span class="ow">and</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frames_action</span>
</span><span id="ActionSegmentationStore-928"><a href="#ActionSegmentationStore-928"><span class="linenos"> 928</span></a>                            <span class="p">):</span>
</span><span id="ActionSegmentationStore-929"><a href="#ActionSegmentationStore-929"><span class="linenos"> 929</span></a>                                <span class="k">continue</span>
</span><span id="ActionSegmentationStore-930"><a href="#ActionSegmentationStore-930"><span class="linenos"> 930</span></a>                            <span class="k">if</span> <span class="p">(</span>
</span><span id="ActionSegmentationStore-931"><a href="#ActionSegmentationStore-931"><span class="linenos"> 931</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">vis_min_frac</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore-932"><a href="#ActionSegmentationStore-932"><span class="linenos"> 932</span></a>                                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis_min_score</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore-933"><a href="#ActionSegmentationStore-933"><span class="linenos"> 933</span></a>                                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">visibility</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ActionSegmentationStore-934"><a href="#ActionSegmentationStore-934"><span class="linenos"> 934</span></a>                            <span class="p">):</span>
</span><span id="ActionSegmentationStore-935"><a href="#ActionSegmentationStore-935"><span class="linenos"> 935</span></a>                                <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore-936"><a href="#ActionSegmentationStore-936"><span class="linenos"> 936</span></a>                                <span class="k">for</span> <span class="n">ind_k</span> <span class="ow">in</span> <span class="n">ind</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">):</span>
</span><span id="ActionSegmentationStore-937"><a href="#ActionSegmentationStore-937"><span class="linenos"> 937</span></a>                                    <span class="n">s</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="ActionSegmentationStore-938"><a href="#ActionSegmentationStore-938"><span class="linenos"> 938</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">visibility</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">ind_k</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-939"><a href="#ActionSegmentationStore-939"><span class="linenos"> 939</span></a>                                        <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis_min_score</span>
</span><span id="ActionSegmentationStore-940"><a href="#ActionSegmentationStore-940"><span class="linenos"> 940</span></a>                                    <span class="p">)</span>
</span><span id="ActionSegmentationStore-941"><a href="#ActionSegmentationStore-941"><span class="linenos"> 941</span></a>                                <span class="k">if</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">vis_min_frac</span> <span class="o">*</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="ActionSegmentationStore-942"><a href="#ActionSegmentationStore-942"><span class="linenos"> 942</span></a>                                    <span class="n">ind</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-943"><a href="#ActionSegmentationStore-943"><span class="linenos"> 943</span></a>                                <span class="p">):</span>
</span><span id="ActionSegmentationStore-944"><a href="#ActionSegmentationStore-944"><span class="linenos"> 944</span></a>                                    <span class="k">continue</span>
</span><span id="ActionSegmentationStore-945"><a href="#ActionSegmentationStore-945"><span class="linenos"> 945</span></a>                            <span class="k">if</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">beh_inv</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-946"><a href="#ActionSegmentationStore-946"><span class="linenos"> 946</span></a>                                <span class="n">cat_i_global</span> <span class="o">=</span> <span class="n">beh_inv</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-947"><a href="#ActionSegmentationStore-947"><span class="linenos"> 947</span></a>                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-948"><a href="#ActionSegmentationStore-948"><span class="linenos"> 948</span></a>                                    <span class="n">labels</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">cat_i_global</span>
</span><span id="ActionSegmentationStore-949"><a href="#ActionSegmentationStore-949"><span class="linenos"> 949</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-950"><a href="#ActionSegmentationStore-950"><span class="linenos"> 950</span></a>                                    <span class="k">if</span> <span class="n">unknown</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-951"><a href="#ActionSegmentationStore-951"><span class="linenos"> 951</span></a>                                        <span class="n">labels</span><span class="p">[</span><span class="n">cat_i_global</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="ActionSegmentationStore-952"><a href="#ActionSegmentationStore-952"><span class="linenos"> 952</span></a>                                    <span class="k">elif</span> <span class="n">neg</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-953"><a href="#ActionSegmentationStore-953"><span class="linenos"> 953</span></a>                                        <span class="n">labels</span><span class="p">[</span><span class="n">cat_i_global</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="ActionSegmentationStore-954"><a href="#ActionSegmentationStore-954"><span class="linenos"> 954</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-955"><a href="#ActionSegmentationStore-955"><span class="linenos"> 955</span></a>                                        <span class="n">labels</span><span class="p">[</span><span class="n">cat_i_global</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ActionSegmentationStore-956"><a href="#ActionSegmentationStore-956"><span class="linenos"> 956</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-957"><a href="#ActionSegmentationStore-957"><span class="linenos"> 957</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">not_found</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-958"><a href="#ActionSegmentationStore-958"><span class="linenos"> 958</span></a>                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_background</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-959"><a href="#ActionSegmentationStore-959"><span class="linenos"> 959</span></a>                                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-960"><a href="#ActionSegmentationStore-960"><span class="linenos"> 960</span></a>                                        <span class="n">labels</span><span class="p">[:,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">][</span>
</span><span id="ActionSegmentationStore-961"><a href="#ActionSegmentationStore-961"><span class="linenos"> 961</span></a>                                            <span class="n">labels</span><span class="p">[:,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore-962"><a href="#ActionSegmentationStore-962"><span class="linenos"> 962</span></a>                                        <span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="ActionSegmentationStore-963"><a href="#ActionSegmentationStore-963"><span class="linenos"> 963</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-964"><a href="#ActionSegmentationStore-964"><span class="linenos"> 964</span></a>                                        <span class="n">labels</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">][</span><span class="n">labels</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore-965"><a href="#ActionSegmentationStore-965"><span class="linenos"> 965</span></a>
</span><span id="ActionSegmentationStore-966"><a href="#ActionSegmentationStore-966"><span class="linenos"> 966</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_class</span> <span class="ow">in</span> <span class="n">times</span><span class="p">[</span><span class="n">ind</span><span class="p">]:</span>
</span><span id="ActionSegmentationStore-967"><a href="#ActionSegmentationStore-967"><span class="linenos"> 967</span></a>                        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">amb</span> <span class="ow">in</span> <span class="n">times</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">error_class</span><span class="p">]:</span>
</span><span id="ActionSegmentationStore-968"><a href="#ActionSegmentationStore-968"><span class="linenos"> 968</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-969"><a href="#ActionSegmentationStore-969"><span class="linenos"> 969</span></a>                                <span class="n">labels</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="ActionSegmentationStore-970"><a href="#ActionSegmentationStore-970"><span class="linenos"> 970</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-971"><a href="#ActionSegmentationStore-971"><span class="linenos"> 971</span></a>                                <span class="n">labels</span><span class="p">[:,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="ActionSegmentationStore-972"><a href="#ActionSegmentationStore-972"><span class="linenos"> 972</span></a>                    <span class="n">annotation</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;---&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span> <span class="o">=</span> <span class="n">labels</span>
</span><span id="ActionSegmentationStore-973"><a href="#ActionSegmentationStore-973"><span class="linenos"> 973</span></a>        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">clips</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-974"><a href="#ActionSegmentationStore-974"><span class="linenos"> 974</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-975"><a href="#ActionSegmentationStore-975"><span class="linenos"> 975</span></a>                <span class="n">min_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_min_frame</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-976"><a href="#ActionSegmentationStore-976"><span class="linenos"> 976</span></a>                <span class="n">max_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_max_frame</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-977"><a href="#ActionSegmentationStore-977"><span class="linenos"> 977</span></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-978"><a href="#ActionSegmentationStore-978"><span class="linenos"> 978</span></a>                <span class="k">continue</span>
</span><span id="ActionSegmentationStore-979"><a href="#ActionSegmentationStore-979"><span class="linenos"> 979</span></a>            <span class="n">go_on</span> <span class="o">=</span> <span class="n">max_frame</span> <span class="o">-</span> <span class="n">min_frame</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame_limit</span>
</span><span id="ActionSegmentationStore-980"><a href="#ActionSegmentationStore-980"><span class="linenos"> 980</span></a>            <span class="k">if</span> <span class="n">go_on</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-981"><a href="#ActionSegmentationStore-981"><span class="linenos"> 981</span></a>                <span class="n">v_len</span> <span class="o">=</span> <span class="n">max_frame</span> <span class="o">-</span> <span class="n">min_frame</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ActionSegmentationStore-982"><a href="#ActionSegmentationStore-982"><span class="linenos"> 982</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-983"><a href="#ActionSegmentationStore-983"><span class="linenos"> 983</span></a>                    <span class="n">annotation</span><span class="p">[</span>
</span><span id="ActionSegmentationStore-984"><a href="#ActionSegmentationStore-984"><span class="linenos"> 984</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;---&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-985"><a href="#ActionSegmentationStore-985"><span class="linenos"> 985</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">v_len</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">compat</span><span class="o">.</span><span class="n">long</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-986"><a href="#ActionSegmentationStore-986"><span class="linenos"> 986</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-987"><a href="#ActionSegmentationStore-987"><span class="linenos"> 987</span></a>                    <span class="n">annotation</span><span class="p">[</span>
</span><span id="ActionSegmentationStore-988"><a href="#ActionSegmentationStore-988"><span class="linenos"> 988</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;---&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-989"><a href="#ActionSegmentationStore-989"><span class="linenos"> 989</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">),</span> <span class="n">v_len</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-990"><a href="#ActionSegmentationStore-990"><span class="linenos"> 990</span></a>        <span class="k">return</span> <span class="n">annotation</span>
</span><span id="ActionSegmentationStore-991"><a href="#ActionSegmentationStore-991"><span class="linenos"> 991</span></a>
</span><span id="ActionSegmentationStore-992"><a href="#ActionSegmentationStore-992"><span class="linenos"> 992</span></a>    <span class="k">def</span> <span class="nf">_make_trimmed_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annotations_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-993"><a href="#ActionSegmentationStore-993"><span class="linenos"> 993</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-994"><a href="#ActionSegmentationStore-994"><span class="linenos"> 994</span></a><span class="sd">        Cut a label dictionary into overlapping pieces of equal length</span>
</span><span id="ActionSegmentationStore-995"><a href="#ActionSegmentationStore-995"><span class="linenos"> 995</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-996"><a href="#ActionSegmentationStore-996"><span class="linenos"> 996</span></a>
</span><span id="ActionSegmentationStore-997"><a href="#ActionSegmentationStore-997"><span class="linenos"> 997</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore-998"><a href="#ActionSegmentationStore-998"><span class="linenos"> 998</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore-999"><a href="#ActionSegmentationStore-999"><span class="linenos"> 999</span></a>        <span class="n">masked_all</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore-1000"><a href="#ActionSegmentationStore-1000"><span class="linenos">1000</span></a>        <span class="k">for</span> <span class="n">v_id</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">annotations_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="ActionSegmentationStore-1001"><a href="#ActionSegmentationStore-1001"><span class="linenos">1001</span></a>            <span class="k">if</span> <span class="n">v_id</span> <span class="ow">in</span> <span class="n">annotations_dict</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1002"><a href="#ActionSegmentationStore-1002"><span class="linenos">1002</span></a>                <span class="n">annotations</span> <span class="o">=</span> <span class="n">annotations_dict</span><span class="p">[</span><span class="n">v_id</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-1003"><a href="#ActionSegmentationStore-1003"><span class="linenos">1003</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1004"><a href="#ActionSegmentationStore-1004"><span class="linenos">1004</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ActionSegmentationStore-1005"><a href="#ActionSegmentationStore-1005"><span class="linenos">1005</span></a>                    <span class="sa">f</span><span class="s1">&#39;The id list in </span><span class="si">{</span><span class="n">v_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;---&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> is not consistent across files&#39;</span>
</span><span id="ActionSegmentationStore-1006"><a href="#ActionSegmentationStore-1006"><span class="linenos">1006</span></a>                <span class="p">)</span>
</span><span id="ActionSegmentationStore-1007"><a href="#ActionSegmentationStore-1007"><span class="linenos">1007</span></a>            <span class="n">split</span> <span class="o">=</span> <span class="n">v_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;---&quot;</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-1008"><a href="#ActionSegmentationStore-1008"><span class="linenos">1008</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1009"><a href="#ActionSegmentationStore-1009"><span class="linenos">1009</span></a>                <span class="n">video_id</span><span class="p">,</span> <span class="n">ind</span> <span class="o">=</span> <span class="n">split</span>
</span><span id="ActionSegmentationStore-1010"><a href="#ActionSegmentationStore-1010"><span class="linenos">1010</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1011"><a href="#ActionSegmentationStore-1011"><span class="linenos">1011</span></a>                <span class="n">video_id</span> <span class="o">=</span> <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-1012"><a href="#ActionSegmentationStore-1012"><span class="linenos">1012</span></a>                <span class="n">ind</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ActionSegmentationStore-1013"><a href="#ActionSegmentationStore-1013"><span class="linenos">1013</span></a>            <span class="n">min_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_min_frame</span><span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-1014"><a href="#ActionSegmentationStore-1014"><span class="linenos">1014</span></a>            <span class="n">max_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_max_frame</span><span class="p">(</span><span class="n">video_id</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-1015"><a href="#ActionSegmentationStore-1015"><span class="linenos">1015</span></a>            <span class="n">v_len</span> <span class="o">=</span> <span class="n">max_frame</span> <span class="o">-</span> <span class="n">min_frame</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ActionSegmentationStore-1016"><a href="#ActionSegmentationStore-1016"><span class="linenos">1016</span></a>            <span class="n">sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">v_len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-1017"><a href="#ActionSegmentationStore-1017"><span class="linenos">1017</span></a>            <span class="n">pad</span> <span class="o">=</span> <span class="n">sp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span> <span class="o">-</span> <span class="n">v_len</span>
</span><span id="ActionSegmentationStore-1018"><a href="#ActionSegmentationStore-1018"><span class="linenos">1018</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1019"><a href="#ActionSegmentationStore-1019"><span class="linenos">1019</span></a>                <span class="n">annotations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">annotations</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">pad</span><span class="p">)),</span> <span class="n">constant_values</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-1020"><a href="#ActionSegmentationStore-1020"><span class="linenos">1020</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1021"><a href="#ActionSegmentationStore-1021"><span class="linenos">1021</span></a>                <span class="n">annotations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span>
</span><span id="ActionSegmentationStore-1022"><a href="#ActionSegmentationStore-1022"><span class="linenos">1022</span></a>                    <span class="n">annotations</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pad</span><span class="p">)),</span> <span class="n">constant_values</span><span class="o">=-</span><span class="mi">100</span>
</span><span id="ActionSegmentationStore-1023"><a href="#ActionSegmentationStore-1023"><span class="linenos">1023</span></a>                <span class="p">)</span>
</span><span id="ActionSegmentationStore-1024"><a href="#ActionSegmentationStore-1024"><span class="linenos">1024</span></a>            <span class="n">masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">annotations</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-1025"><a href="#ActionSegmentationStore-1025"><span class="linenos">1025</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="ActionSegmentationStore-1026"><a href="#ActionSegmentationStore-1026"><span class="linenos">1026</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ActionSegmentationStore-1027"><a href="#ActionSegmentationStore-1027"><span class="linenos">1027</span></a>                <span class="ow">and</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-1028"><a href="#ActionSegmentationStore-1028"><span class="linenos">1028</span></a>                <span class="ow">and</span> <span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-1029"><a href="#ActionSegmentationStore-1029"><span class="linenos">1029</span></a>            <span class="p">):</span>
</span><span id="ActionSegmentationStore-1030"><a href="#ActionSegmentationStore-1030"><span class="linenos">1030</span></a>                <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="s2">&quot;masked&quot;</span><span class="p">][</span><span class="n">video_id</span><span class="p">][</span><span class="n">ind</span><span class="p">]:</span>
</span><span id="ActionSegmentationStore-1031"><a href="#ActionSegmentationStore-1031"><span class="linenos">1031</span></a>                    <span class="n">masked</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ActionSegmentationStore-1032"><a href="#ActionSegmentationStore-1032"><span class="linenos">1032</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sp</span><span class="p">):</span>
</span><span id="ActionSegmentationStore-1033"><a href="#ActionSegmentationStore-1033"><span class="linenos">1033</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">v_id</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span id="ActionSegmentationStore-1034"><a href="#ActionSegmentationStore-1034"><span class="linenos">1034</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1035"><a href="#ActionSegmentationStore-1035"><span class="linenos">1035</span></a>                    <span class="n">ann</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">[</span><span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-1036"><a href="#ActionSegmentationStore-1036"><span class="linenos">1036</span></a>                    <span class="n">m</span> <span class="o">=</span> <span class="n">masked</span><span class="p">[</span><span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-1037"><a href="#ActionSegmentationStore-1037"><span class="linenos">1037</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1038"><a href="#ActionSegmentationStore-1038"><span class="linenos">1038</span></a>                    <span class="n">ann</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">[:,</span> <span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-1039"><a href="#ActionSegmentationStore-1039"><span class="linenos">1039</span></a>                    <span class="n">m</span> <span class="o">=</span> <span class="n">masked</span><span class="p">[:,</span> <span class="n">start</span> <span class="p">:</span> <span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-1040"><a href="#ActionSegmentationStore-1040"><span class="linenos">1040</span></a>                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ann</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-1041"><a href="#ActionSegmentationStore-1041"><span class="linenos">1041</span></a>                <span class="n">masked_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-1042"><a href="#ActionSegmentationStore-1042"><span class="linenos">1042</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">)</span>
</span><span id="ActionSegmentationStore-1043"><a href="#ActionSegmentationStore-1043"><span class="linenos">1043</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
</span><span id="ActionSegmentationStore-1044"><a href="#ActionSegmentationStore-1044"><span class="linenos">1044</span></a>        <span class="n">masked_all</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">masked_all</span><span class="p">))</span><span class="o">.</span><span class="n">int</span><span class="p">()</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>
</span><span id="ActionSegmentationStore-1045"><a href="#ActionSegmentationStore-1045"><span class="linenos">1045</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_background</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1046"><a href="#ActionSegmentationStore-1046"><span class="linenos">1046</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
</span><span id="ActionSegmentationStore-1047"><a href="#ActionSegmentationStore-1047"><span class="linenos">1047</span></a>                <span class="n">label</span><span class="p">[:,</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">label</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">label</span> <span class="o">==</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="ActionSegmentationStore-1048"><a href="#ActionSegmentationStore-1048"><span class="linenos">1048</span></a>                <span class="n">label</span><span class="p">[</span><span class="n">label</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore-1049"><a href="#ActionSegmentationStore-1049"><span class="linenos">1049</span></a>        <span class="n">labels</span><span class="p">[(</span><span class="n">labels</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">masked_all</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">200</span>
</span><span id="ActionSegmentationStore-1050"><a href="#ActionSegmentationStore-1050"><span class="linenos">1050</span></a>        <span class="k">return</span> <span class="n">labels</span>
</span><span id="ActionSegmentationStore-1051"><a href="#ActionSegmentationStore-1051"><span class="linenos">1051</span></a>
</span><span id="ActionSegmentationStore-1052"><a href="#ActionSegmentationStore-1052"><span class="linenos">1052</span></a>    <span class="nd">@classmethod</span>
</span><span id="ActionSegmentationStore-1053"><a href="#ActionSegmentationStore-1053"><span class="linenos">1053</span></a>    <span class="k">def</span> <span class="nf">_get_file_paths</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1054"><a href="#ActionSegmentationStore-1054"><span class="linenos">1054</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-1055"><a href="#ActionSegmentationStore-1055"><span class="linenos">1055</span></a><span class="sd">        Get a list of relevant files</span>
</span><span id="ActionSegmentationStore-1056"><a href="#ActionSegmentationStore-1056"><span class="linenos">1056</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-1057"><a href="#ActionSegmentationStore-1057"><span class="linenos">1057</span></a>
</span><span id="ActionSegmentationStore-1058"><a href="#ActionSegmentationStore-1058"><span class="linenos">1058</span></a>        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore-1059"><a href="#ActionSegmentationStore-1059"><span class="linenos">1059</span></a>        <span class="k">if</span> <span class="n">annotation_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1060"><a href="#ActionSegmentationStore-1060"><span class="linenos">1060</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ActionSegmentationStore-1061"><a href="#ActionSegmentationStore-1061"><span class="linenos">1061</span></a>                <span class="n">annotation_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">annotation_path</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-1062"><a href="#ActionSegmentationStore-1062"><span class="linenos">1062</span></a>            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">annotation_path</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1063"><a href="#ActionSegmentationStore-1063"><span class="linenos">1063</span></a>                <span class="n">file_paths</span> <span class="o">+=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)]</span>
</span><span id="ActionSegmentationStore-1064"><a href="#ActionSegmentationStore-1064"><span class="linenos">1064</span></a>        <span class="k">return</span> <span class="n">file_paths</span>
</span><span id="ActionSegmentationStore-1065"><a href="#ActionSegmentationStore-1065"><span class="linenos">1065</span></a>
</span><span id="ActionSegmentationStore-1066"><a href="#ActionSegmentationStore-1066"><span class="linenos">1066</span></a>    <span class="k">def</span> <span class="nf">_get_max_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ActionSegmentationStore-1067"><a href="#ActionSegmentationStore-1067"><span class="linenos">1067</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-1068"><a href="#ActionSegmentationStore-1068"><span class="linenos">1068</span></a><span class="sd">        Get the end frame of a clip in a video</span>
</span><span id="ActionSegmentationStore-1069"><a href="#ActionSegmentationStore-1069"><span class="linenos">1069</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-1070"><a href="#ActionSegmentationStore-1070"><span class="linenos">1070</span></a>
</span><span id="ActionSegmentationStore-1071"><a href="#ActionSegmentationStore-1071"><span class="linenos">1071</span></a>        <span class="k">if</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="ActionSegmentationStore-1072"><a href="#ActionSegmentationStore-1072"><span class="linenos">1072</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-1073"><a href="#ActionSegmentationStore-1073"><span class="linenos">1073</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1074"><a href="#ActionSegmentationStore-1074"><span class="linenos">1074</span></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span>
</span><span id="ActionSegmentationStore-1075"><a href="#ActionSegmentationStore-1075"><span class="linenos">1075</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">ind_k</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind_k</span> <span class="ow">in</span> <span class="n">clip_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)]</span>
</span><span id="ActionSegmentationStore-1076"><a href="#ActionSegmentationStore-1076"><span class="linenos">1076</span></a>            <span class="p">)</span>
</span><span id="ActionSegmentationStore-1077"><a href="#ActionSegmentationStore-1077"><span class="linenos">1077</span></a>
</span><span id="ActionSegmentationStore-1078"><a href="#ActionSegmentationStore-1078"><span class="linenos">1078</span></a>    <span class="k">def</span> <span class="nf">_get_min_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">clip_id</span><span class="p">):</span>
</span><span id="ActionSegmentationStore-1079"><a href="#ActionSegmentationStore-1079"><span class="linenos">1079</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-1080"><a href="#ActionSegmentationStore-1080"><span class="linenos">1080</span></a><span class="sd">        Get the start frame of a clip in a video</span>
</span><span id="ActionSegmentationStore-1081"><a href="#ActionSegmentationStore-1081"><span class="linenos">1081</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-1082"><a href="#ActionSegmentationStore-1082"><span class="linenos">1082</span></a>
</span><span id="ActionSegmentationStore-1083"><a href="#ActionSegmentationStore-1083"><span class="linenos">1083</span></a>        <span class="k">if</span> <span class="n">clip_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">]:</span>
</span><span id="ActionSegmentationStore-1084"><a href="#ActionSegmentationStore-1084"><span class="linenos">1084</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">clip_id</span><span class="p">]</span>
</span><span id="ActionSegmentationStore-1085"><a href="#ActionSegmentationStore-1085"><span class="linenos">1085</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1086"><a href="#ActionSegmentationStore-1086"><span class="linenos">1086</span></a>            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="ActionSegmentationStore-1087"><a href="#ActionSegmentationStore-1087"><span class="linenos">1087</span></a>                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">ind_k</span><span class="p">]</span> <span class="k">for</span> <span class="n">ind_k</span> <span class="ow">in</span> <span class="n">clip_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)]</span>
</span><span id="ActionSegmentationStore-1088"><a href="#ActionSegmentationStore-1088"><span class="linenos">1088</span></a>            <span class="p">)</span>
</span><span id="ActionSegmentationStore-1089"><a href="#ActionSegmentationStore-1089"><span class="linenos">1089</span></a>
</span><span id="ActionSegmentationStore-1090"><a href="#ActionSegmentationStore-1090"><span class="linenos">1090</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="ActionSegmentationStore-1091"><a href="#ActionSegmentationStore-1091"><span class="linenos">1091</span></a>    <span class="k">def</span> <span class="nf">_load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="ActionSegmentationStore-1092"><a href="#ActionSegmentationStore-1092"><span class="linenos">1092</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore-1093"><a href="#ActionSegmentationStore-1093"><span class="linenos">1093</span></a><span class="sd">        Load behavior annotation and generate annotation prompts</span>
</span><span id="ActionSegmentationStore-1094"><a href="#ActionSegmentationStore-1094"><span class="linenos">1094</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>A general realization of an annotation store for action segmentation tasks</p>

<p>Assumes the following file structure:</p>

<pre><code>annotation_path
 video1_annotation.pickle
 video2_labels.pickle
</code></pre>

<p>Here <code>annotation_suffix</code> is <code>{'_annotation.pickle', '_labels.pickle'}</code>.</p>
</div>


                            <div id="ActionSegmentationStore.__init__" class="classattr">
                                        <input id="ActionSegmentationStore.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ActionSegmentationStore</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>,</span><span class="param">	<span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span>,</span><span class="param">	<span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span>,</span><span class="param">	<span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="ActionSegmentationStore.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.__init__-294"><a href="#ActionSegmentationStore.__init__-294"><span class="linenos">294</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="ActionSegmentationStore.__init__-295"><a href="#ActionSegmentationStore.__init__-295"><span class="linenos">295</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-296"><a href="#ActionSegmentationStore.__init__-296"><span class="linenos">296</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-297"><a href="#ActionSegmentationStore.__init__-297"><span class="linenos">297</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-298"><a href="#ActionSegmentationStore.__init__-298"><span class="linenos">298</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-299"><a href="#ActionSegmentationStore.__init__-299"><span class="linenos">299</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-300"><a href="#ActionSegmentationStore.__init__-300"><span class="linenos">300</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-301"><a href="#ActionSegmentationStore.__init__-301"><span class="linenos">301</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-302"><a href="#ActionSegmentationStore.__init__-302"><span class="linenos">302</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-303"><a href="#ActionSegmentationStore.__init__-303"><span class="linenos">303</span></a>        <span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-304"><a href="#ActionSegmentationStore.__init__-304"><span class="linenos">304</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-305"><a href="#ActionSegmentationStore.__init__-305"><span class="linenos">305</span></a>        <span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-306"><a href="#ActionSegmentationStore.__init__-306"><span class="linenos">306</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-307"><a href="#ActionSegmentationStore.__init__-307"><span class="linenos">307</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-308"><a href="#ActionSegmentationStore.__init__-308"><span class="linenos">308</span></a>        <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-309"><a href="#ActionSegmentationStore.__init__-309"><span class="linenos">309</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-310"><a href="#ActionSegmentationStore.__init__-310"><span class="linenos">310</span></a>        <span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-311"><a href="#ActionSegmentationStore.__init__-311"><span class="linenos">311</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-312"><a href="#ActionSegmentationStore.__init__-312"><span class="linenos">312</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-313"><a href="#ActionSegmentationStore.__init__-313"><span class="linenos">313</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-314"><a href="#ActionSegmentationStore.__init__-314"><span class="linenos">314</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-315"><a href="#ActionSegmentationStore.__init__-315"><span class="linenos">315</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-316"><a href="#ActionSegmentationStore.__init__-316"><span class="linenos">316</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-317"><a href="#ActionSegmentationStore.__init__-317"><span class="linenos">317</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-318"><a href="#ActionSegmentationStore.__init__-318"><span class="linenos">318</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-319"><a href="#ActionSegmentationStore.__init__-319"><span class="linenos">319</span></a>        <span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-320"><a href="#ActionSegmentationStore.__init__-320"><span class="linenos">320</span></a>        <span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-321"><a href="#ActionSegmentationStore.__init__-321"><span class="linenos">321</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-322"><a href="#ActionSegmentationStore.__init__-322"><span class="linenos">322</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.__init__-323"><a href="#ActionSegmentationStore.__init__-323"><span class="linenos">323</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.__init__-324"><a href="#ActionSegmentationStore.__init__-324"><span class="linenos">324</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.__init__-325"><a href="#ActionSegmentationStore.__init__-325"><span class="linenos">325</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore.__init__-326"><a href="#ActionSegmentationStore.__init__-326"><span class="linenos">326</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore.__init__-327"><a href="#ActionSegmentationStore.__init__-327"><span class="linenos">327</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="ActionSegmentationStore.__init__-328"><a href="#ActionSegmentationStore.__init__-328"><span class="linenos">328</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="ActionSegmentationStore.__init__-329"><a href="#ActionSegmentationStore.__init__-329"><span class="linenos">329</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="ActionSegmentationStore.__init__-330"><a href="#ActionSegmentationStore.__init__-330"><span class="linenos">330</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="ActionSegmentationStore.__init__-331"><a href="#ActionSegmentationStore.__init__-331"><span class="linenos">331</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="ActionSegmentationStore.__init__-332"><a href="#ActionSegmentationStore.__init__-332"><span class="linenos">332</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="ActionSegmentationStore.__init__-333"><a href="#ActionSegmentationStore.__init__-333"><span class="linenos">333</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="ActionSegmentationStore.__init__-334"><a href="#ActionSegmentationStore.__init__-334"><span class="linenos">334</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="ActionSegmentationStore.__init__-335"><a href="#ActionSegmentationStore.__init__-335"><span class="linenos">335</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="ActionSegmentationStore.__init__-336"><a href="#ActionSegmentationStore.__init__-336"><span class="linenos">336</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="ActionSegmentationStore.__init__-337"><a href="#ActionSegmentationStore.__init__-337"><span class="linenos">337</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="ActionSegmentationStore.__init__-338"><a href="#ActionSegmentationStore.__init__-338"><span class="linenos">338</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="ActionSegmentationStore.__init__-339"><a href="#ActionSegmentationStore.__init__-339"><span class="linenos">339</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="ActionSegmentationStore.__init__-340"><a href="#ActionSegmentationStore.__init__-340"><span class="linenos">340</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="ActionSegmentationStore.__init__-341"><a href="#ActionSegmentationStore.__init__-341"><span class="linenos">341</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="ActionSegmentationStore.__init__-342"><a href="#ActionSegmentationStore.__init__-342"><span class="linenos">342</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="ActionSegmentationStore.__init__-343"><a href="#ActionSegmentationStore.__init__-343"><span class="linenos">343</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="ActionSegmentationStore.__init__-344"><a href="#ActionSegmentationStore.__init__-344"><span class="linenos">344</span></a><span class="sd">        behaviors : set, optional</span>
</span><span id="ActionSegmentationStore.__init__-345"><a href="#ActionSegmentationStore.__init__-345"><span class="linenos">345</span></a><span class="sd">            the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are</span>
</span><span id="ActionSegmentationStore.__init__-346"><a href="#ActionSegmentationStore.__init__-346"><span class="linenos">346</span></a><span class="sd">            loaded from a file)</span>
</span><span id="ActionSegmentationStore.__init__-347"><a href="#ActionSegmentationStore.__init__-347"><span class="linenos">347</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="ActionSegmentationStore.__init__-348"><a href="#ActionSegmentationStore.__init__-348"><span class="linenos">348</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="ActionSegmentationStore.__init__-349"><a href="#ActionSegmentationStore.__init__-349"><span class="linenos">349</span></a><span class="sd">        ignored_clips : set, optional</span>
</span><span id="ActionSegmentationStore.__init__-350"><a href="#ActionSegmentationStore.__init__-350"><span class="linenos">350</span></a><span class="sd">            clip ids to ignore</span>
</span><span id="ActionSegmentationStore.__init__-351"><a href="#ActionSegmentationStore.__init__-351"><span class="linenos">351</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="ActionSegmentationStore.__init__-352"><a href="#ActionSegmentationStore.__init__-352"><span class="linenos">352</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="ActionSegmentationStore.__init__-353"><a href="#ActionSegmentationStore.__init__-353"><span class="linenos">353</span></a><span class="sd">            (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="ActionSegmentationStore.__init__-354"><a href="#ActionSegmentationStore.__init__-354"><span class="linenos">354</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="ActionSegmentationStore.__init__-355"><a href="#ActionSegmentationStore.__init__-355"><span class="linenos">355</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="ActionSegmentationStore.__init__-356"><a href="#ActionSegmentationStore.__init__-356"><span class="linenos">356</span></a><span class="sd">            from key objects)</span>
</span><span id="ActionSegmentationStore.__init__-357"><a href="#ActionSegmentationStore.__init__-357"><span class="linenos">357</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="ActionSegmentationStore.__init__-358"><a href="#ActionSegmentationStore.__init__-358"><span class="linenos">358</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="ActionSegmentationStore.__init__-359"><a href="#ActionSegmentationStore.__init__-359"><span class="linenos">359</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="ActionSegmentationStore.__init__-360"><a href="#ActionSegmentationStore.__init__-360"><span class="linenos">360</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="ActionSegmentationStore.__init__-361"><a href="#ActionSegmentationStore.__init__-361"><span class="linenos">361</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="ActionSegmentationStore.__init__-362"><a href="#ActionSegmentationStore.__init__-362"><span class="linenos">362</span></a><span class="sd">        frame_limit : int, default 0</span>
</span><span id="ActionSegmentationStore.__init__-363"><a href="#ActionSegmentationStore.__init__-363"><span class="linenos">363</span></a><span class="sd">            the smallest possible length of a clip (shorter clips are discarded)</span>
</span><span id="ActionSegmentationStore.__init__-364"><a href="#ActionSegmentationStore.__init__-364"><span class="linenos">364</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="ActionSegmentationStore.__init__-365"><a href="#ActionSegmentationStore.__init__-365"><span class="linenos">365</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="ActionSegmentationStore.__init__-366"><a href="#ActionSegmentationStore.__init__-366"><span class="linenos">366</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="ActionSegmentationStore.__init__-367"><a href="#ActionSegmentationStore.__init__-367"><span class="linenos">367</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="ActionSegmentationStore.__init__-368"><a href="#ActionSegmentationStore.__init__-368"><span class="linenos">368</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="ActionSegmentationStore.__init__-369"><a href="#ActionSegmentationStore.__init__-369"><span class="linenos">369</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="ActionSegmentationStore.__init__-370"><a href="#ActionSegmentationStore.__init__-370"><span class="linenos">370</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="ActionSegmentationStore.__init__-371"><a href="#ActionSegmentationStore.__init__-371"><span class="linenos">371</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="ActionSegmentationStore.__init__-372"><a href="#ActionSegmentationStore.__init__-372"><span class="linenos">372</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="ActionSegmentationStore.__init__-373"><a href="#ActionSegmentationStore.__init__-373"><span class="linenos">373</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="ActionSegmentationStore.__init__-374"><a href="#ActionSegmentationStore.__init__-374"><span class="linenos">374</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="ActionSegmentationStore.__init__-375"><a href="#ActionSegmentationStore.__init__-375"><span class="linenos">375</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="ActionSegmentationStore.__init__-376"><a href="#ActionSegmentationStore.__init__-376"><span class="linenos">376</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="ActionSegmentationStore.__init__-377"><a href="#ActionSegmentationStore.__init__-377"><span class="linenos">377</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="ActionSegmentationStore.__init__-378"><a href="#ActionSegmentationStore.__init__-378"><span class="linenos">378</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="ActionSegmentationStore.__init__-379"><a href="#ActionSegmentationStore.__init__-379"><span class="linenos">379</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="ActionSegmentationStore.__init__-380"><a href="#ActionSegmentationStore.__init__-380"><span class="linenos">380</span></a><span class="sd">        use_hard_negatives : bool, default False</span>
</span><span id="ActionSegmentationStore.__init__-381"><a href="#ActionSegmentationStore.__init__-381"><span class="linenos">381</span></a><span class="sd">            mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing</span>
</span><span id="ActionSegmentationStore.__init__-382"><a href="#ActionSegmentationStore.__init__-382"><span class="linenos">382</span></a><span class="sd">        interactive : bool, default False</span>
</span><span id="ActionSegmentationStore.__init__-383"><a href="#ActionSegmentationStore.__init__-383"><span class="linenos">383</span></a><span class="sd">            if `True`, annotation is assigned to pairs of individuals</span>
</span><span id="ActionSegmentationStore.__init__-384"><a href="#ActionSegmentationStore.__init__-384"><span class="linenos">384</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.__init__-385"><a href="#ActionSegmentationStore.__init__-385"><span class="linenos">385</span></a>
</span><span id="ActionSegmentationStore.__init__-386"><a href="#ActionSegmentationStore.__init__-386"><span class="linenos">386</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="ActionSegmentationStore.__init__-387"><a href="#ActionSegmentationStore.__init__-387"><span class="linenos">387</span></a>
</span><span id="ActionSegmentationStore.__init__-388"><a href="#ActionSegmentationStore.__init__-388"><span class="linenos">388</span></a>        <span class="k">if</span> <span class="n">ignored_clips</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.__init__-389"><a href="#ActionSegmentationStore.__init__-389"><span class="linenos">389</span></a>            <span class="n">ignored_clips</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore.__init__-390"><a href="#ActionSegmentationStore.__init__-390"><span class="linenos">390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">len_segment</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.__init__-391"><a href="#ActionSegmentationStore.__init__-391"><span class="linenos">391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">=</span> <span class="n">exclusive</span>
</span><span id="ActionSegmentationStore.__init__-392"><a href="#ActionSegmentationStore.__init__-392"><span class="linenos">392</span></a>        <span class="k">if</span> <span class="n">overlap</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.__init__-393"><a href="#ActionSegmentationStore.__init__-393"><span class="linenos">393</span></a>            <span class="n">overlap</span> <span class="o">=</span> <span class="n">overlap</span> <span class="o">*</span> <span class="n">len_segment</span>
</span><span id="ActionSegmentationStore.__init__-394"><a href="#ActionSegmentationStore.__init__-394"><span class="linenos">394</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">overlap</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.__init__-395"><a href="#ActionSegmentationStore.__init__-395"><span class="linenos">395</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">video_order</span> <span class="o">=</span> <span class="n">video_order</span>
</span><span id="ActionSegmentationStore.__init__-396"><a href="#ActionSegmentationStore.__init__-396"><span class="linenos">396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span> <span class="o">=</span> <span class="n">min_frames</span>
</span><span id="ActionSegmentationStore.__init__-397"><a href="#ActionSegmentationStore.__init__-397"><span class="linenos">397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span> <span class="o">=</span> <span class="n">max_frames</span>
</span><span id="ActionSegmentationStore.__init__-398"><a href="#ActionSegmentationStore.__init__-398"><span class="linenos">398</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="n">visibility</span>
</span><span id="ActionSegmentationStore.__init__-399"><a href="#ActionSegmentationStore.__init__-399"><span class="linenos">399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vis_min_score</span> <span class="o">=</span> <span class="n">visibility_min_score</span>
</span><span id="ActionSegmentationStore.__init__-400"><a href="#ActionSegmentationStore.__init__-400"><span class="linenos">400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vis_min_frac</span> <span class="o">=</span> <span class="n">visibility_min_frac</span>
</span><span id="ActionSegmentationStore.__init__-401"><a href="#ActionSegmentationStore.__init__-401"><span class="linenos">401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>
</span><span id="ActionSegmentationStore.__init__-402"><a href="#ActionSegmentationStore.__init__-402"><span class="linenos">402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_negatives</span> <span class="o">=</span> <span class="n">use_hard_negatives</span>
</span><span id="ActionSegmentationStore.__init__-403"><a href="#ActionSegmentationStore.__init__-403"><span class="linenos">403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">interactive</span> <span class="o">=</span> <span class="n">interactive</span>
</span><span id="ActionSegmentationStore.__init__-404"><a href="#ActionSegmentationStore.__init__-404"><span class="linenos">404</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ignored_clips</span> <span class="o">=</span> <span class="n">ignored_clips</span>
</span><span id="ActionSegmentationStore.__init__-405"><a href="#ActionSegmentationStore.__init__-405"><span class="linenos">405</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_file_paths</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.__init__-406"><a href="#ActionSegmentationStore.__init__-406"><span class="linenos">406</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ignored_classes</span> <span class="o">=</span> <span class="n">ignored_classes</span>
</span><span id="ActionSegmentationStore.__init__-407"><a href="#ActionSegmentationStore.__init__-407"><span class="linenos">407</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_behaviors</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ActionSegmentationStore.__init__-408"><a href="#ActionSegmentationStore.__init__-408"><span class="linenos">408</span></a>
</span><span id="ActionSegmentationStore.__init__-409"><a href="#ActionSegmentationStore.__init__-409"><span class="linenos">409</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ram</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ActionSegmentationStore.__init__-410"><a href="#ActionSegmentationStore.__init__-410"><span class="linenos">410</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore.__init__-411"><a href="#ActionSegmentationStore.__init__-411"><span class="linenos">411</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore.__init__-412"><a href="#ActionSegmentationStore.__init__-412"><span class="linenos">412</span></a>
</span><span id="ActionSegmentationStore.__init__-413"><a href="#ActionSegmentationStore.__init__-413"><span class="linenos">413</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span>
</span><span id="ActionSegmentationStore.__init__-414"><a href="#ActionSegmentationStore.__init__-414"><span class="linenos">414</span></a>
</span><span id="ActionSegmentationStore.__init__-415"><a href="#ActionSegmentationStore.__init__-415"><span class="linenos">415</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ann_suffix</span> <span class="o">=</span> <span class="n">annotation_suffix</span>
</span><span id="ActionSegmentationStore.__init__-416"><a href="#ActionSegmentationStore.__init__-416"><span class="linenos">416</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_folder</span> <span class="o">=</span> <span class="n">annotation_path</span>
</span><span id="ActionSegmentationStore.__init__-417"><a href="#ActionSegmentationStore.__init__-417"><span class="linenos">417</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filter_annotated</span> <span class="o">=</span> <span class="n">filter_annotated</span>
</span><span id="ActionSegmentationStore.__init__-418"><a href="#ActionSegmentationStore.__init__-418"><span class="linenos">418</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filter_background</span> <span class="o">=</span> <span class="n">filter_background</span>
</span><span id="ActionSegmentationStore.__init__-419"><a href="#ActionSegmentationStore.__init__-419"><span class="linenos">419</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">frame_limit</span> <span class="o">=</span> <span class="n">frame_limit</span>
</span><span id="ActionSegmentationStore.__init__-420"><a href="#ActionSegmentationStore.__init__-420"><span class="linenos">420</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">min_frames_action</span> <span class="o">=</span> <span class="n">min_frames_action</span>
</span><span id="ActionSegmentationStore.__init__-421"><a href="#ActionSegmentationStore.__init__-421"><span class="linenos">421</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error_class</span> <span class="o">=</span> <span class="n">error_class</span>
</span><span id="ActionSegmentationStore.__init__-422"><a href="#ActionSegmentationStore.__init__-422"><span class="linenos">422</span></a>
</span><span id="ActionSegmentationStore.__init__-423"><a href="#ActionSegmentationStore.__init__-423"><span class="linenos">423</span></a>        <span class="k">if</span> <span class="n">correction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.__init__-424"><a href="#ActionSegmentationStore.__init__-424"><span class="linenos">424</span></a>            <span class="n">correction</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ActionSegmentationStore.__init__-425"><a href="#ActionSegmentationStore.__init__-425"><span class="linenos">425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">correction</span> <span class="o">=</span> <span class="n">correction</span>
</span><span id="ActionSegmentationStore.__init__-426"><a href="#ActionSegmentationStore.__init__-426"><span class="linenos">426</span></a>
</span><span id="ActionSegmentationStore.__init__-427"><a href="#ActionSegmentationStore.__init__-427"><span class="linenos">427</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.__init__-428"><a href="#ActionSegmentationStore.__init__-428"><span class="linenos">428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="ActionSegmentationStore.__init__-429"><a href="#ActionSegmentationStore.__init__-429"><span class="linenos">429</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.__init__-430"><a href="#ActionSegmentationStore.__init__-430"><span class="linenos">430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{})</span>
</span><span id="ActionSegmentationStore.__init__-431"><a href="#ActionSegmentationStore.__init__-431"><span class="linenos">431</span></a>
</span><span id="ActionSegmentationStore.__init__-432"><a href="#ActionSegmentationStore.__init__-432"><span class="linenos">432</span></a>        <span class="n">lists</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">annotation_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ann_suffix</span><span class="p">]</span>
</span><span id="ActionSegmentationStore.__init__-433"><a href="#ActionSegmentationStore.__init__-433"><span class="linenos">433</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lists</span><span class="p">)):</span>
</span><span id="ActionSegmentationStore.__init__-434"><a href="#ActionSegmentationStore.__init__-434"><span class="linenos">434</span></a>            <span class="n">iterable</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">))</span>
</span><span id="ActionSegmentationStore.__init__-435"><a href="#ActionSegmentationStore.__init__-435"><span class="linenos">435</span></a>            <span class="k">if</span> <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.__init__-436"><a href="#ActionSegmentationStore.__init__-436"><span class="linenos">436</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">iterable</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.__init__-437"><a href="#ActionSegmentationStore.__init__-437"><span class="linenos">437</span></a>                    <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="ActionSegmentationStore.__init__-438"><a href="#ActionSegmentationStore.__init__-438"><span class="linenos">438</span></a>                <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="ActionSegmentationStore.__init__-439"><a href="#ActionSegmentationStore.__init__-439"><span class="linenos">439</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">annotation_folder</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ann_suffix</span> <span class="o">=</span> <span class="n">lists</span>
</span><span id="ActionSegmentationStore.__init__-440"><a href="#ActionSegmentationStore.__init__-440"><span class="linenos">440</span></a>
</span><span id="ActionSegmentationStore.__init__-441"><a href="#ActionSegmentationStore.__init__-441"><span class="linenos">441</span></a>        <span class="k">if</span> <span class="n">ignored_classes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.__init__-442"><a href="#ActionSegmentationStore.__init__-442"><span class="linenos">442</span></a>            <span class="n">ignored_classes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore.__init__-443"><a href="#ActionSegmentationStore.__init__-443"><span class="linenos">443</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ignored_classes</span> <span class="o">=</span> <span class="n">ignored_classes</span>
</span><span id="ActionSegmentationStore.__init__-444"><a href="#ActionSegmentationStore.__init__-444"><span class="linenos">444</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_behaviors</span><span class="p">(</span><span class="n">behaviors</span><span class="p">,</span> <span class="n">ignored_classes</span><span class="p">,</span> <span class="n">behavior_file</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.__init__-445"><a href="#ActionSegmentationStore.__init__-445"><span class="linenos">445</span></a>
</span><span id="ActionSegmentationStore.__init__-446"><a href="#ActionSegmentationStore.__init__-446"><span class="linenos">446</span></a>        <span class="k">if</span> <span class="n">key_objects</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.__init__-447"><a href="#ActionSegmentationStore.__init__-447"><span class="linenos">447</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_data</span><span class="p">()</span>
</span><span id="ActionSegmentationStore.__init__-448"><a href="#ActionSegmentationStore.__init__-448"><span class="linenos">448</span></a>        <span class="k">elif</span> <span class="n">key_objects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.__init__-449"><a href="#ActionSegmentationStore.__init__-449"><span class="linenos">449</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">load_from_key_objects</span><span class="p">(</span><span class="n">key_objects</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.__init__-450"><a href="#ActionSegmentationStore.__init__-450"><span class="linenos">450</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.__init__-451"><a href="#ActionSegmentationStore.__init__-451"><span class="linenos">451</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ActionSegmentationStore.__init__-452"><a href="#ActionSegmentationStore.__init__-452"><span class="linenos">452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">labeled_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_labeled</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><h2 id="parameters">Parameters</h2>

<p>video_order : list, optional
    a list of video ids that should be processed in the same order (not passed if creating from key objects)
min_frames : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    clip start frames (not passed if creating from key objects)
max_frames : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    clip end frames (not passed if creating from key objects)
visibility : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)
exclusive : bool, default True
    if True, the annotation is single-label; if False, multi-label
len_segment : int, default 128
    the length of the segments in which the data should be cut (in frames)
overlap : int, default 0
    the length of the overlap between neighboring segments (in frames)
behaviors : set, optional
    the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are
    loaded from a file)
ignored_classes : set, optional
    the list of behaviors from the behaviors list or file to not annotate
ignored_clips : set, optional
    clip ids to ignore
annotation_suffix : str | set, optional
    the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}
    (not passed if creating from key objects or if irrelevant for the dataset)
annotation_path : str | set, optional
    the path or the set of paths to the folder where the annotation files are stored (not passed if creating
    from key objects)
behavior_file : str, optional
    the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)
correction : dict, optional
    a dictionary of corrections for the labels (e.g. {'sleping': 'sleeping', 'calm locomotion': 'locomotion'},
    can be used to correct for variations in naming or to merge several labels in one
frame_limit : int, default 0
    the smallest possible length of a clip (shorter clips are discarded)
filter_annotated : bool, default False
    if True, the samples that do not have any labels will be filtered
filter_background : bool, default False
    if True, only the unlabeled frames that are close to annotated frames will be labeled as background
error_class : str, optional
    the name of the error class (the annotations that intersect with this label will be discarded)
min_frames_action : int, default 0
    the minimum length of an action (shorter actions are not annotated)
key_objects : tuple, optional
    the key objects to load the AnnotationStore from
visibility_min_score : float, default 5
    the minimum visibility score for visibility filtering
visibility_min_frac : float, default 0.7
    the minimum fraction of visible frames for visibility filtering
mask : dict, optional
    a masked value dictionary (for active learning simulation experiments)
use_hard_negatives : bool, default False
    mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing
interactive : bool, default False
    if <code>True</code>, annotation is assigned to pairs of individuals</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.remove" class="classattr">
                                        <input id="ActionSegmentationStore.remove-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">indices</span><span class="p">:</span> <span class="n">List</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ActionSegmentationStore.remove-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.remove"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.remove-464"><a href="#ActionSegmentationStore.remove-464"><span class="linenos">464</span></a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.remove-465"><a href="#ActionSegmentationStore.remove-465"><span class="linenos">465</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.remove-466"><a href="#ActionSegmentationStore.remove-466"><span class="linenos">466</span></a><span class="sd">        Remove the samples corresponding to indices</span>
</span><span id="ActionSegmentationStore.remove-467"><a href="#ActionSegmentationStore.remove-467"><span class="linenos">467</span></a>
</span><span id="ActionSegmentationStore.remove-468"><a href="#ActionSegmentationStore.remove-468"><span class="linenos">468</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore.remove-469"><a href="#ActionSegmentationStore.remove-469"><span class="linenos">469</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore.remove-470"><a href="#ActionSegmentationStore.remove-470"><span class="linenos">470</span></a><span class="sd">        indices : list</span>
</span><span id="ActionSegmentationStore.remove-471"><a href="#ActionSegmentationStore.remove-471"><span class="linenos">471</span></a><span class="sd">            a list of integer indices to remove</span>
</span><span id="ActionSegmentationStore.remove-472"><a href="#ActionSegmentationStore.remove-472"><span class="linenos">472</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.remove-473"><a href="#ActionSegmentationStore.remove-473"><span class="linenos">473</span></a>
</span><span id="ActionSegmentationStore.remove-474"><a href="#ActionSegmentationStore.remove-474"><span class="linenos">474</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.remove-475"><a href="#ActionSegmentationStore.remove-475"><span class="linenos">475</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</span><span id="ActionSegmentationStore.remove-476"><a href="#ActionSegmentationStore.remove-476"><span class="linenos">476</span></a>            <span class="n">mask</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore.remove-477"><a href="#ActionSegmentationStore.remove-477"><span class="linenos">477</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.remove-478"><a href="#ActionSegmentationStore.remove-478"><span class="linenos">478</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="ActionSegmentationStore.remove-479"><a href="#ActionSegmentationStore.remove-479"><span class="linenos">479</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Remove the samples corresponding to indices</p>

<h2 id="parameters">Parameters</h2>

<p>indices : list
    a list of integer indices to remove</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.key_objects" class="classattr">
                                        <input id="ActionSegmentationStore.key_objects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">key_objects</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Tuple</span>:</span></span>

                <label class="view-source-button" for="ActionSegmentationStore.key_objects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.key_objects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.key_objects-481"><a href="#ActionSegmentationStore.key_objects-481"><span class="linenos">481</span></a>    <span class="k">def</span> <span class="nf">key_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.key_objects-482"><a href="#ActionSegmentationStore.key_objects-482"><span class="linenos">482</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.key_objects-483"><a href="#ActionSegmentationStore.key_objects-483"><span class="linenos">483</span></a><span class="sd">        Return a tuple of the key objects necessary to re-create the Store</span>
</span><span id="ActionSegmentationStore.key_objects-484"><a href="#ActionSegmentationStore.key_objects-484"><span class="linenos">484</span></a>
</span><span id="ActionSegmentationStore.key_objects-485"><a href="#ActionSegmentationStore.key_objects-485"><span class="linenos">485</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore.key_objects-486"><a href="#ActionSegmentationStore.key_objects-486"><span class="linenos">486</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore.key_objects-487"><a href="#ActionSegmentationStore.key_objects-487"><span class="linenos">487</span></a><span class="sd">        key_objects : tuple</span>
</span><span id="ActionSegmentationStore.key_objects-488"><a href="#ActionSegmentationStore.key_objects-488"><span class="linenos">488</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="ActionSegmentationStore.key_objects-489"><a href="#ActionSegmentationStore.key_objects-489"><span class="linenos">489</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.key_objects-490"><a href="#ActionSegmentationStore.key_objects-490"><span class="linenos">490</span></a>
</span><span id="ActionSegmentationStore.key_objects-491"><a href="#ActionSegmentationStore.key_objects-491"><span class="linenos">491</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="ActionSegmentationStore.key_objects-492"><a href="#ActionSegmentationStore.key_objects-492"><span class="linenos">492</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.key_objects-493"><a href="#ActionSegmentationStore.key_objects-493"><span class="linenos">493</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.key_objects-494"><a href="#ActionSegmentationStore.key_objects-494"><span class="linenos">494</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.key_objects-495"><a href="#ActionSegmentationStore.key_objects-495"><span class="linenos">495</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.key_objects-496"><a href="#ActionSegmentationStore.key_objects-496"><span class="linenos">496</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.key_objects-497"><a href="#ActionSegmentationStore.key_objects-497"><span class="linenos">497</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.key_objects-498"><a href="#ActionSegmentationStore.key_objects-498"><span class="linenos">498</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.key_objects-499"><a href="#ActionSegmentationStore.key_objects-499"><span class="linenos">499</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return a tuple of the key objects necessary to re-create the Store</p>

<h2 id="returns">Returns</h2>

<p>key_objects : tuple
    a tuple of key objects</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.load_from_key_objects" class="classattr">
                                        <input id="ActionSegmentationStore.load_from_key_objects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_from_key_objects</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ActionSegmentationStore.load_from_key_objects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.load_from_key_objects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.load_from_key_objects-501"><a href="#ActionSegmentationStore.load_from_key_objects-501"><span class="linenos">501</span></a>    <span class="k">def</span> <span class="nf">load_from_key_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-502"><a href="#ActionSegmentationStore.load_from_key_objects-502"><span class="linenos">502</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-503"><a href="#ActionSegmentationStore.load_from_key_objects-503"><span class="linenos">503</span></a><span class="sd">        Load the information from a tuple of key objects</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-504"><a href="#ActionSegmentationStore.load_from_key_objects-504"><span class="linenos">504</span></a>
</span><span id="ActionSegmentationStore.load_from_key_objects-505"><a href="#ActionSegmentationStore.load_from_key_objects-505"><span class="linenos">505</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-506"><a href="#ActionSegmentationStore.load_from_key_objects-506"><span class="linenos">506</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-507"><a href="#ActionSegmentationStore.load_from_key_objects-507"><span class="linenos">507</span></a><span class="sd">        key_objects : tuple</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-508"><a href="#ActionSegmentationStore.load_from_key_objects-508"><span class="linenos">508</span></a><span class="sd">            a tuple of key objects</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-509"><a href="#ActionSegmentationStore.load_from_key_objects-509"><span class="linenos">509</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-510"><a href="#ActionSegmentationStore.load_from_key_objects-510"><span class="linenos">510</span></a>
</span><span id="ActionSegmentationStore.load_from_key_objects-511"><a href="#ActionSegmentationStore.load_from_key_objects-511"><span class="linenos">511</span></a>        <span class="p">(</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-512"><a href="#ActionSegmentationStore.load_from_key_objects-512"><span class="linenos">512</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-513"><a href="#ActionSegmentationStore.load_from_key_objects-513"><span class="linenos">513</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-514"><a href="#ActionSegmentationStore.load_from_key_objects-514"><span class="linenos">514</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-515"><a href="#ActionSegmentationStore.load_from_key_objects-515"><span class="linenos">515</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-516"><a href="#ActionSegmentationStore.load_from_key_objects-516"><span class="linenos">516</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-517"><a href="#ActionSegmentationStore.load_from_key_objects-517"><span class="linenos">517</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-518"><a href="#ActionSegmentationStore.load_from_key_objects-518"><span class="linenos">518</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-519"><a href="#ActionSegmentationStore.load_from_key_objects-519"><span class="linenos">519</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="n">key_objects</span>
</span><span id="ActionSegmentationStore.load_from_key_objects-520"><a href="#ActionSegmentationStore.load_from_key_objects-520"><span class="linenos">520</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">labeled_indices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_labeled</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Load the information from a tuple of key objects</p>

<h2 id="parameters">Parameters</h2>

<p>key_objects : tuple
    a tuple of key objects</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.to_ram" class="classattr">
                                        <input id="ActionSegmentationStore.to_ram-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_ram</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ActionSegmentationStore.to_ram-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.to_ram"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.to_ram-522"><a href="#ActionSegmentationStore.to_ram-522"><span class="linenos">522</span></a>    <span class="k">def</span> <span class="nf">to_ram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.to_ram-523"><a href="#ActionSegmentationStore.to_ram-523"><span class="linenos">523</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.to_ram-524"><a href="#ActionSegmentationStore.to_ram-524"><span class="linenos">524</span></a><span class="sd">        Transfer the data samples to RAM if they were previously stored as file paths</span>
</span><span id="ActionSegmentationStore.to_ram-525"><a href="#ActionSegmentationStore.to_ram-525"><span class="linenos">525</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.to_ram-526"><a href="#ActionSegmentationStore.to_ram-526"><span class="linenos">526</span></a>
</span><span id="ActionSegmentationStore.to_ram-527"><a href="#ActionSegmentationStore.to_ram-527"><span class="linenos">527</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Transfer the data samples to RAM if they were previously stored as file paths</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.get_original_coordinates" class="classattr">
                                        <input id="ActionSegmentationStore.get_original_coordinates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_original_coordinates</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="ActionSegmentationStore.get_original_coordinates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.get_original_coordinates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.get_original_coordinates-529"><a href="#ActionSegmentationStore.get_original_coordinates-529"><span class="linenos">529</span></a>    <span class="k">def</span> <span class="nf">get_original_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.get_original_coordinates-530"><a href="#ActionSegmentationStore.get_original_coordinates-530"><span class="linenos">530</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.get_original_coordinates-531"><a href="#ActionSegmentationStore.get_original_coordinates-531"><span class="linenos">531</span></a><span class="sd">        Return the video_indices array</span>
</span><span id="ActionSegmentationStore.get_original_coordinates-532"><a href="#ActionSegmentationStore.get_original_coordinates-532"><span class="linenos">532</span></a>
</span><span id="ActionSegmentationStore.get_original_coordinates-533"><a href="#ActionSegmentationStore.get_original_coordinates-533"><span class="linenos">533</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore.get_original_coordinates-534"><a href="#ActionSegmentationStore.get_original_coordinates-534"><span class="linenos">534</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore.get_original_coordinates-535"><a href="#ActionSegmentationStore.get_original_coordinates-535"><span class="linenos">535</span></a><span class="sd">        original_coordinates : numpy.ndarray</span>
</span><span id="ActionSegmentationStore.get_original_coordinates-536"><a href="#ActionSegmentationStore.get_original_coordinates-536"><span class="linenos">536</span></a><span class="sd">            an array that contains the coordinates of the data samples in original input data</span>
</span><span id="ActionSegmentationStore.get_original_coordinates-537"><a href="#ActionSegmentationStore.get_original_coordinates-537"><span class="linenos">537</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.get_original_coordinates-538"><a href="#ActionSegmentationStore.get_original_coordinates-538"><span class="linenos">538</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span>
</span></pre></div>


            <div class="docstring"><p>Return the video_indices array</p>

<h2 id="returns">Returns</h2>

<p>original_coordinates : numpy.ndarray
    an array that contains the coordinates of the data samples in original input data</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.create_subsample" class="classattr">
                                        <input id="ActionSegmentationStore.create_subsample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_subsample</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">indices</span><span class="p">:</span> <span class="n">List</span>, </span><span class="param"><span class="n">ssl_indices</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="ActionSegmentationStore.create_subsample-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.create_subsample"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.create_subsample-540"><a href="#ActionSegmentationStore.create_subsample-540"><span class="linenos">540</span></a>    <span class="k">def</span> <span class="nf">create_subsample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">ssl_indices</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ActionSegmentationStore.create_subsample-541"><a href="#ActionSegmentationStore.create_subsample-541"><span class="linenos">541</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.create_subsample-542"><a href="#ActionSegmentationStore.create_subsample-542"><span class="linenos">542</span></a><span class="sd">        Create a new store that contains a subsample of the data</span>
</span><span id="ActionSegmentationStore.create_subsample-543"><a href="#ActionSegmentationStore.create_subsample-543"><span class="linenos">543</span></a>
</span><span id="ActionSegmentationStore.create_subsample-544"><a href="#ActionSegmentationStore.create_subsample-544"><span class="linenos">544</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore.create_subsample-545"><a href="#ActionSegmentationStore.create_subsample-545"><span class="linenos">545</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore.create_subsample-546"><a href="#ActionSegmentationStore.create_subsample-546"><span class="linenos">546</span></a><span class="sd">        indices : list</span>
</span><span id="ActionSegmentationStore.create_subsample-547"><a href="#ActionSegmentationStore.create_subsample-547"><span class="linenos">547</span></a><span class="sd">            the indices to be included in the subsample</span>
</span><span id="ActionSegmentationStore.create_subsample-548"><a href="#ActionSegmentationStore.create_subsample-548"><span class="linenos">548</span></a><span class="sd">        ssl_indices : list, optional</span>
</span><span id="ActionSegmentationStore.create_subsample-549"><a href="#ActionSegmentationStore.create_subsample-549"><span class="linenos">549</span></a><span class="sd">            the indices to be included in the subsample without the annotation data</span>
</span><span id="ActionSegmentationStore.create_subsample-550"><a href="#ActionSegmentationStore.create_subsample-550"><span class="linenos">550</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.create_subsample-551"><a href="#ActionSegmentationStore.create_subsample-551"><span class="linenos">551</span></a>
</span><span id="ActionSegmentationStore.create_subsample-552"><a href="#ActionSegmentationStore.create_subsample-552"><span class="linenos">552</span></a>        <span class="k">if</span> <span class="n">ssl_indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.create_subsample-553"><a href="#ActionSegmentationStore.create_subsample-553"><span class="linenos">553</span></a>            <span class="n">ssl_indices</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore.create_subsample-554"><a href="#ActionSegmentationStore.create_subsample-554"><span class="linenos">554</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.create_subsample-555"><a href="#ActionSegmentationStore.create_subsample-555"><span class="linenos">555</span></a>        <span class="n">data</span><span class="p">[</span><span class="n">ssl_indices</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="ActionSegmentationStore.create_subsample-556"><a href="#ActionSegmentationStore.create_subsample-556"><span class="linenos">556</span></a>        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
</span><span id="ActionSegmentationStore.create_subsample-557"><a href="#ActionSegmentationStore.create_subsample-557"><span class="linenos">557</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">original_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">[</span><span class="n">indices</span> <span class="o">+</span> <span class="n">ssl_indices</span><span class="p">]</span>
</span><span id="ActionSegmentationStore.create_subsample-558"><a href="#ActionSegmentationStore.create_subsample-558"><span class="linenos">558</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">indices</span> <span class="o">+</span> <span class="n">ssl_indices</span><span class="p">]</span>
</span><span id="ActionSegmentationStore.create_subsample-559"><a href="#ActionSegmentationStore.create_subsample-559"><span class="linenos">559</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">labeled_indices</span><span class="p">,</span> <span class="n">new</span><span class="o">.</span><span class="n">unlabeled_indices</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">_compute_labeled</span><span class="p">()</span>
</span><span id="ActionSegmentationStore.create_subsample-560"><a href="#ActionSegmentationStore.create_subsample-560"><span class="linenos">560</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">behaviors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span>
</span><span id="ActionSegmentationStore.create_subsample-561"><a href="#ActionSegmentationStore.create_subsample-561"><span class="linenos">561</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span>
</span><span id="ActionSegmentationStore.create_subsample-562"><a href="#ActionSegmentationStore.create_subsample-562"><span class="linenos">562</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">len_segment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span>
</span><span id="ActionSegmentationStore.create_subsample-563"><a href="#ActionSegmentationStore.create_subsample-563"><span class="linenos">563</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
</span><span id="ActionSegmentationStore.create_subsample-564"><a href="#ActionSegmentationStore.create_subsample-564"><span class="linenos">564</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">overlap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span>
</span><span id="ActionSegmentationStore.create_subsample-565"><a href="#ActionSegmentationStore.create_subsample-565"><span class="linenos">565</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">max_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span>
</span><span id="ActionSegmentationStore.create_subsample-566"><a href="#ActionSegmentationStore.create_subsample-566"><span class="linenos">566</span></a>        <span class="n">new</span><span class="o">.</span><span class="n">min_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span>
</span><span id="ActionSegmentationStore.create_subsample-567"><a href="#ActionSegmentationStore.create_subsample-567"><span class="linenos">567</span></a>        <span class="k">return</span> <span class="n">new</span>
</span></pre></div>


            <div class="docstring"><p>Create a new store that contains a subsample of the data</p>

<h2 id="parameters">Parameters</h2>

<p>indices : list
    the indices to be included in the subsample
ssl_indices : list, optional
    the indices to be included in the subsample without the annotation data</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.get_len" class="classattr">
                                        <input id="ActionSegmentationStore.get_len-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_len</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ActionSegmentationStore.get_len-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.get_len"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.get_len-569"><a href="#ActionSegmentationStore.get_len-569"><span class="linenos">569</span></a>    <span class="k">def</span> <span class="nf">get_len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.get_len-570"><a href="#ActionSegmentationStore.get_len-570"><span class="linenos">570</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.get_len-571"><a href="#ActionSegmentationStore.get_len-571"><span class="linenos">571</span></a><span class="sd">        Get the length of the subsample of labeled/unlabeled data</span>
</span><span id="ActionSegmentationStore.get_len-572"><a href="#ActionSegmentationStore.get_len-572"><span class="linenos">572</span></a>
</span><span id="ActionSegmentationStore.get_len-573"><a href="#ActionSegmentationStore.get_len-573"><span class="linenos">573</span></a><span class="sd">        If return_unlabeled is True, the index is in the subsample of unlabeled data, if False in labeled</span>
</span><span id="ActionSegmentationStore.get_len-574"><a href="#ActionSegmentationStore.get_len-574"><span class="linenos">574</span></a><span class="sd">        and if return_unlabeled is None the index is already correct</span>
</span><span id="ActionSegmentationStore.get_len-575"><a href="#ActionSegmentationStore.get_len-575"><span class="linenos">575</span></a>
</span><span id="ActionSegmentationStore.get_len-576"><a href="#ActionSegmentationStore.get_len-576"><span class="linenos">576</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore.get_len-577"><a href="#ActionSegmentationStore.get_len-577"><span class="linenos">577</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore.get_len-578"><a href="#ActionSegmentationStore.get_len-578"><span class="linenos">578</span></a><span class="sd">        return_unlabeled : bool</span>
</span><span id="ActionSegmentationStore.get_len-579"><a href="#ActionSegmentationStore.get_len-579"><span class="linenos">579</span></a><span class="sd">            the identifier for the subsample</span>
</span><span id="ActionSegmentationStore.get_len-580"><a href="#ActionSegmentationStore.get_len-580"><span class="linenos">580</span></a>
</span><span id="ActionSegmentationStore.get_len-581"><a href="#ActionSegmentationStore.get_len-581"><span class="linenos">581</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore.get_len-582"><a href="#ActionSegmentationStore.get_len-582"><span class="linenos">582</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore.get_len-583"><a href="#ActionSegmentationStore.get_len-583"><span class="linenos">583</span></a><span class="sd">        length : int</span>
</span><span id="ActionSegmentationStore.get_len-584"><a href="#ActionSegmentationStore.get_len-584"><span class="linenos">584</span></a><span class="sd">            the length of the subsample</span>
</span><span id="ActionSegmentationStore.get_len-585"><a href="#ActionSegmentationStore.get_len-585"><span class="linenos">585</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.get_len-586"><a href="#ActionSegmentationStore.get_len-586"><span class="linenos">586</span></a>
</span><span id="ActionSegmentationStore.get_len-587"><a href="#ActionSegmentationStore.get_len-587"><span class="linenos">587</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.get_len-588"><a href="#ActionSegmentationStore.get_len-588"><span class="linenos">588</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The annotation store data has not been initialized!&quot;</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.get_len-589"><a href="#ActionSegmentationStore.get_len-589"><span class="linenos">589</span></a>        <span class="k">elif</span> <span class="n">return_unlabeled</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.get_len-590"><a href="#ActionSegmentationStore.get_len-590"><span class="linenos">590</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.get_len-591"><a href="#ActionSegmentationStore.get_len-591"><span class="linenos">591</span></a>        <span class="k">elif</span> <span class="n">return_unlabeled</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.get_len-592"><a href="#ActionSegmentationStore.get_len-592"><span class="linenos">592</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_indices</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.get_len-593"><a href="#ActionSegmentationStore.get_len-593"><span class="linenos">593</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.get_len-594"><a href="#ActionSegmentationStore.get_len-594"><span class="linenos">594</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_indices</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get the length of the subsample of labeled/unlabeled data</p>

<p>If return_unlabeled is True, the index is in the subsample of unlabeled data, if False in labeled
and if return_unlabeled is None the index is already correct</p>

<h2 id="parameters">Parameters</h2>

<p>return_unlabeled : bool
    the identifier for the subsample</p>

<h2 id="returns">Returns</h2>

<p>length : int
    the length of the subsample</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.get_indices" class="classattr">
                                        <input id="ActionSegmentationStore.get_indices-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_indices</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="n">List</span>:</span></span>

                <label class="view-source-button" for="ActionSegmentationStore.get_indices-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.get_indices"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.get_indices-596"><a href="#ActionSegmentationStore.get_indices-596"><span class="linenos">596</span></a>    <span class="k">def</span> <span class="nf">get_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_unlabeled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.get_indices-597"><a href="#ActionSegmentationStore.get_indices-597"><span class="linenos">597</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.get_indices-598"><a href="#ActionSegmentationStore.get_indices-598"><span class="linenos">598</span></a><span class="sd">        Get a list of indices of samples in the labeled/unlabeled subset</span>
</span><span id="ActionSegmentationStore.get_indices-599"><a href="#ActionSegmentationStore.get_indices-599"><span class="linenos">599</span></a>
</span><span id="ActionSegmentationStore.get_indices-600"><a href="#ActionSegmentationStore.get_indices-600"><span class="linenos">600</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore.get_indices-601"><a href="#ActionSegmentationStore.get_indices-601"><span class="linenos">601</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore.get_indices-602"><a href="#ActionSegmentationStore.get_indices-602"><span class="linenos">602</span></a><span class="sd">        return_unlabeled : bool</span>
</span><span id="ActionSegmentationStore.get_indices-603"><a href="#ActionSegmentationStore.get_indices-603"><span class="linenos">603</span></a><span class="sd">            the identifier for the subsample (`True` for unlabeled, `False` for labeled, `None` for the</span>
</span><span id="ActionSegmentationStore.get_indices-604"><a href="#ActionSegmentationStore.get_indices-604"><span class="linenos">604</span></a><span class="sd">            whole dataset)</span>
</span><span id="ActionSegmentationStore.get_indices-605"><a href="#ActionSegmentationStore.get_indices-605"><span class="linenos">605</span></a>
</span><span id="ActionSegmentationStore.get_indices-606"><a href="#ActionSegmentationStore.get_indices-606"><span class="linenos">606</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore.get_indices-607"><a href="#ActionSegmentationStore.get_indices-607"><span class="linenos">607</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore.get_indices-608"><a href="#ActionSegmentationStore.get_indices-608"><span class="linenos">608</span></a><span class="sd">        indices : list</span>
</span><span id="ActionSegmentationStore.get_indices-609"><a href="#ActionSegmentationStore.get_indices-609"><span class="linenos">609</span></a><span class="sd">            a list of indices that meet the criteria</span>
</span><span id="ActionSegmentationStore.get_indices-610"><a href="#ActionSegmentationStore.get_indices-610"><span class="linenos">610</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.get_indices-611"><a href="#ActionSegmentationStore.get_indices-611"><span class="linenos">611</span></a>
</span><span id="ActionSegmentationStore.get_indices-612"><a href="#ActionSegmentationStore.get_indices-612"><span class="linenos">612</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)))</span>
</span></pre></div>


            <div class="docstring"><p>Get a list of indices of samples in the labeled/unlabeled subset</p>

<h2 id="parameters">Parameters</h2>

<p>return_unlabeled : bool
    the identifier for the subsample (<code>True</code> for unlabeled, <code>False</code> for labeled, <code>None</code> for the
    whole dataset)</p>

<h2 id="returns">Returns</h2>

<p>indices : list
    a list of indices that meet the criteria</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.count_classes" class="classattr">
                                        <input id="ActionSegmentationStore.count_classes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">count_classes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">perc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">zeros</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">bouts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="ActionSegmentationStore.count_classes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.count_classes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.count_classes-614"><a href="#ActionSegmentationStore.count_classes-614"><span class="linenos">614</span></a>    <span class="k">def</span> <span class="nf">count_classes</span><span class="p">(</span>
</span><span id="ActionSegmentationStore.count_classes-615"><a href="#ActionSegmentationStore.count_classes-615"><span class="linenos">615</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">perc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zeros</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bouts</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ActionSegmentationStore.count_classes-616"><a href="#ActionSegmentationStore.count_classes-616"><span class="linenos">616</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-617"><a href="#ActionSegmentationStore.count_classes-617"><span class="linenos">617</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.count_classes-618"><a href="#ActionSegmentationStore.count_classes-618"><span class="linenos">618</span></a><span class="sd">        Get a dictionary with class-wise frame counts</span>
</span><span id="ActionSegmentationStore.count_classes-619"><a href="#ActionSegmentationStore.count_classes-619"><span class="linenos">619</span></a>
</span><span id="ActionSegmentationStore.count_classes-620"><a href="#ActionSegmentationStore.count_classes-620"><span class="linenos">620</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore.count_classes-621"><a href="#ActionSegmentationStore.count_classes-621"><span class="linenos">621</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore.count_classes-622"><a href="#ActionSegmentationStore.count_classes-622"><span class="linenos">622</span></a><span class="sd">        perc : bool, default False</span>
</span><span id="ActionSegmentationStore.count_classes-623"><a href="#ActionSegmentationStore.count_classes-623"><span class="linenos">623</span></a><span class="sd">            if `True`, a fraction of the total frame count is returned</span>
</span><span id="ActionSegmentationStore.count_classes-624"><a href="#ActionSegmentationStore.count_classes-624"><span class="linenos">624</span></a><span class="sd">        zeros : bool, default False</span>
</span><span id="ActionSegmentationStore.count_classes-625"><a href="#ActionSegmentationStore.count_classes-625"><span class="linenos">625</span></a><span class="sd">            if `True` and annotation is not exclusive, zero counts are returned</span>
</span><span id="ActionSegmentationStore.count_classes-626"><a href="#ActionSegmentationStore.count_classes-626"><span class="linenos">626</span></a><span class="sd">        bouts : bool, default False</span>
</span><span id="ActionSegmentationStore.count_classes-627"><a href="#ActionSegmentationStore.count_classes-627"><span class="linenos">627</span></a><span class="sd">            if `True`, instead of frame counts segment counts are returned</span>
</span><span id="ActionSegmentationStore.count_classes-628"><a href="#ActionSegmentationStore.count_classes-628"><span class="linenos">628</span></a>
</span><span id="ActionSegmentationStore.count_classes-629"><a href="#ActionSegmentationStore.count_classes-629"><span class="linenos">629</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore.count_classes-630"><a href="#ActionSegmentationStore.count_classes-630"><span class="linenos">630</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore.count_classes-631"><a href="#ActionSegmentationStore.count_classes-631"><span class="linenos">631</span></a><span class="sd">        count_dictionary : dict</span>
</span><span id="ActionSegmentationStore.count_classes-632"><a href="#ActionSegmentationStore.count_classes-632"><span class="linenos">632</span></a><span class="sd">            a dictionary with class indices as keys and frame counts as values</span>
</span><span id="ActionSegmentationStore.count_classes-633"><a href="#ActionSegmentationStore.count_classes-633"><span class="linenos">633</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.count_classes-634"><a href="#ActionSegmentationStore.count_classes-634"><span class="linenos">634</span></a>
</span><span id="ActionSegmentationStore.count_classes-635"><a href="#ActionSegmentationStore.count_classes-635"><span class="linenos">635</span></a>        <span class="k">if</span> <span class="n">bouts</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-636"><a href="#ActionSegmentationStore.count_classes-636"><span class="linenos">636</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-637"><a href="#ActionSegmentationStore.count_classes-637"><span class="linenos">637</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ActionSegmentationStore.count_classes-638"><a href="#ActionSegmentationStore.count_classes-638"><span class="linenos">638</span></a>                <span class="k">for</span> <span class="n">video</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ActionSegmentationStore.count_classes-639"><a href="#ActionSegmentationStore.count_classes-639"><span class="linenos">639</span></a>                    <span class="k">for</span> <span class="n">clip</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ActionSegmentationStore.count_classes-640"><a href="#ActionSegmentationStore.count_classes-640"><span class="linenos">640</span></a>                        <span class="n">length</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_min_frame</span><span class="p">(</span><span class="n">video</span><span class="p">,</span> <span class="n">clip</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.count_classes-641"><a href="#ActionSegmentationStore.count_classes-641"><span class="linenos">641</span></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-642"><a href="#ActionSegmentationStore.count_classes-642"><span class="linenos">642</span></a>                            <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video</span><span class="si">}</span><span class="s2">---</span><span class="si">{</span><span class="n">clip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.count_classes-643"><a href="#ActionSegmentationStore.count_classes-643"><span class="linenos">643</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-644"><a href="#ActionSegmentationStore.count_classes-644"><span class="linenos">644</span></a>                            <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">video</span><span class="si">}</span><span class="s2">---</span><span class="si">{</span><span class="n">clip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
</span><span id="ActionSegmentationStore.count_classes-645"><a href="#ActionSegmentationStore.count_classes-645"><span class="linenos">645</span></a>                                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()),</span> <span class="n">length</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.count_classes-646"><a href="#ActionSegmentationStore.count_classes-646"><span class="linenos">646</span></a>                            <span class="p">)</span>
</span><span id="ActionSegmentationStore.count_classes-647"><a href="#ActionSegmentationStore.count_classes-647"><span class="linenos">647</span></a>                <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_coordinates</span><span class="p">):</span>
</span><span id="ActionSegmentationStore.count_classes-648"><a href="#ActionSegmentationStore.count_classes-648"><span class="linenos">648</span></a>                    <span class="n">split</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;---&quot;</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.count_classes-649"><a href="#ActionSegmentationStore.count_classes-649"><span class="linenos">649</span></a>                    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_max_frame</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_min_frame</span><span class="p">(</span>
</span><span id="ActionSegmentationStore.count_classes-650"><a href="#ActionSegmentationStore.count_classes-650"><span class="linenos">650</span></a>                        <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ActionSegmentationStore.count_classes-651"><a href="#ActionSegmentationStore.count_classes-651"><span class="linenos">651</span></a>                    <span class="p">)</span>
</span><span id="ActionSegmentationStore.count_classes-652"><a href="#ActionSegmentationStore.count_classes-652"><span class="linenos">652</span></a>                    <span class="n">i</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="ActionSegmentationStore.count_classes-653"><a href="#ActionSegmentationStore.count_classes-653"><span class="linenos">653</span></a>                    <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
</span><span id="ActionSegmentationStore.count_classes-654"><a href="#ActionSegmentationStore.count_classes-654"><span class="linenos">654</span></a>                    <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">len_segment</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.count_classes-655"><a href="#ActionSegmentationStore.count_classes-655"><span class="linenos">655</span></a>                    <span class="n">data</span><span class="p">[</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="o">...</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">]</span>
</span><span id="ActionSegmentationStore.count_classes-656"><a href="#ActionSegmentationStore.count_classes-656"><span class="linenos">656</span></a>                <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore.count_classes-657"><a href="#ActionSegmentationStore.count_classes-657"><span class="linenos">657</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ActionSegmentationStore.count_classes-658"><a href="#ActionSegmentationStore.count_classes-658"><span class="linenos">658</span></a>                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.count_classes-659"><a href="#ActionSegmentationStore.count_classes-659"><span class="linenos">659</span></a>                    <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)))</span>
</span><span id="ActionSegmentationStore.count_classes-660"><a href="#ActionSegmentationStore.count_classes-660"><span class="linenos">660</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="ActionSegmentationStore.count_classes-661"><a href="#ActionSegmentationStore.count_classes-661"><span class="linenos">661</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-662"><a href="#ActionSegmentationStore.count_classes-662"><span class="linenos">662</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.count_classes-663"><a href="#ActionSegmentationStore.count_classes-663"><span class="linenos">663</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-664"><a href="#ActionSegmentationStore.count_classes-664"><span class="linenos">664</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span><span id="ActionSegmentationStore.count_classes-665"><a href="#ActionSegmentationStore.count_classes-665"><span class="linenos">665</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-666"><a href="#ActionSegmentationStore.count_classes-666"><span class="linenos">666</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">))</span>
</span><span id="ActionSegmentationStore.count_classes-667"><a href="#ActionSegmentationStore.count_classes-667"><span class="linenos">667</span></a>            <span class="n">count_dictionary</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ActionSegmentationStore.count_classes-668"><a href="#ActionSegmentationStore.count_classes-668"><span class="linenos">668</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">():</span>
</span><span id="ActionSegmentationStore.count_classes-669"><a href="#ActionSegmentationStore.count_classes-669"><span class="linenos">669</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-670"><a href="#ActionSegmentationStore.count_classes-670"><span class="linenos">670</span></a>                    <span class="n">arr</span> <span class="o">=</span> <span class="n">data</span> <span class="o">==</span> <span class="n">c</span>
</span><span id="ActionSegmentationStore.count_classes-671"><a href="#ActionSegmentationStore.count_classes-671"><span class="linenos">671</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-672"><a href="#ActionSegmentationStore.count_classes-672"><span class="linenos">672</span></a>                    <span class="k">if</span> <span class="n">zeros</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-673"><a href="#ActionSegmentationStore.count_classes-673"><span class="linenos">673</span></a>                        <span class="n">arr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore.count_classes-674"><a href="#ActionSegmentationStore.count_classes-674"><span class="linenos">674</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-675"><a href="#ActionSegmentationStore.count_classes-675"><span class="linenos">675</span></a>                        <span class="n">arr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="ActionSegmentationStore.count_classes-676"><a href="#ActionSegmentationStore.count_classes-676"><span class="linenos">676</span></a>                <span class="n">output</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">unique_consecutive</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.count_classes-677"><a href="#ActionSegmentationStore.count_classes-677"><span class="linenos">677</span></a>                <span class="n">true_indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">output</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ActionSegmentationStore.count_classes-678"><a href="#ActionSegmentationStore.count_classes-678"><span class="linenos">678</span></a>                <span class="n">count_dictionary</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_indices</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.count_classes-679"><a href="#ActionSegmentationStore.count_classes-679"><span class="linenos">679</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-680"><a href="#ActionSegmentationStore.count_classes-680"><span class="linenos">680</span></a>            <span class="n">ind</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="ActionSegmentationStore.count_classes-681"><a href="#ActionSegmentationStore.count_classes-681"><span class="linenos">681</span></a>            <span class="k">if</span> <span class="n">zeros</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-682"><a href="#ActionSegmentationStore.count_classes-682"><span class="linenos">682</span></a>                <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore.count_classes-683"><a href="#ActionSegmentationStore.count_classes-683"><span class="linenos">683</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-684"><a href="#ActionSegmentationStore.count_classes-684"><span class="linenos">684</span></a>                <span class="n">count_dictionary</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()))</span>
</span><span id="ActionSegmentationStore.count_classes-685"><a href="#ActionSegmentationStore.count_classes-685"><span class="linenos">685</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-686"><a href="#ActionSegmentationStore.count_classes-686"><span class="linenos">686</span></a>                <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ActionSegmentationStore.count_classes-687"><a href="#ActionSegmentationStore.count_classes-687"><span class="linenos">687</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="ActionSegmentationStore.count_classes-688"><a href="#ActionSegmentationStore.count_classes-688"><span class="linenos">688</span></a>                    <span class="n">cnt</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</span><span id="ActionSegmentationStore.count_classes-689"><a href="#ActionSegmentationStore.count_classes-689"><span class="linenos">689</span></a>                    <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
</span><span id="ActionSegmentationStore.count_classes-690"><a href="#ActionSegmentationStore.count_classes-690"><span class="linenos">690</span></a>                <span class="n">count_dictionary</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="ActionSegmentationStore.count_classes-691"><a href="#ActionSegmentationStore.count_classes-691"><span class="linenos">691</span></a>            <span class="k">if</span> <span class="n">perc</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-692"><a href="#ActionSegmentationStore.count_classes-692"><span class="linenos">692</span></a>                <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">count_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="ActionSegmentationStore.count_classes-693"><a href="#ActionSegmentationStore.count_classes-693"><span class="linenos">693</span></a>                <span class="n">count_dictionary</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="o">/</span> <span class="n">total</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">count_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="ActionSegmentationStore.count_classes-694"><a href="#ActionSegmentationStore.count_classes-694"><span class="linenos">694</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">():</span>
</span><span id="ActionSegmentationStore.count_classes-695"><a href="#ActionSegmentationStore.count_classes-695"><span class="linenos">695</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">count_dictionary</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.count_classes-696"><a href="#ActionSegmentationStore.count_classes-696"><span class="linenos">696</span></a>                <span class="n">count_dictionary</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="ActionSegmentationStore.count_classes-697"><a href="#ActionSegmentationStore.count_classes-697"><span class="linenos">697</span></a>        <span class="k">return</span> <span class="n">count_dictionary</span>
</span></pre></div>


            <div class="docstring"><p>Get a dictionary with class-wise frame counts</p>

<h2 id="parameters">Parameters</h2>

<p>perc : bool, default False
    if <code>True</code>, a fraction of the total frame count is returned
zeros : bool, default False
    if <code>True</code> and annotation is not exclusive, zero counts are returned
bouts : bool, default False
    if <code>True</code>, instead of frame counts segment counts are returned</p>

<h2 id="returns">Returns</h2>

<p>count_dictionary : dict
    a dictionary with class indices as keys and frame counts as values</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.behaviors_dict" class="classattr">
                                        <input id="ActionSegmentationStore.behaviors_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">behaviors_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="ActionSegmentationStore.behaviors_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.behaviors_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.behaviors_dict-699"><a href="#ActionSegmentationStore.behaviors_dict-699"><span class="linenos">699</span></a>    <span class="k">def</span> <span class="nf">behaviors_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.behaviors_dict-700"><a href="#ActionSegmentationStore.behaviors_dict-700"><span class="linenos">700</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.behaviors_dict-701"><a href="#ActionSegmentationStore.behaviors_dict-701"><span class="linenos">701</span></a><span class="sd">        Get a dictionary of class names</span>
</span><span id="ActionSegmentationStore.behaviors_dict-702"><a href="#ActionSegmentationStore.behaviors_dict-702"><span class="linenos">702</span></a>
</span><span id="ActionSegmentationStore.behaviors_dict-703"><a href="#ActionSegmentationStore.behaviors_dict-703"><span class="linenos">703</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore.behaviors_dict-704"><a href="#ActionSegmentationStore.behaviors_dict-704"><span class="linenos">704</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore.behaviors_dict-705"><a href="#ActionSegmentationStore.behaviors_dict-705"><span class="linenos">705</span></a><span class="sd">        behavior_dictionary: dict</span>
</span><span id="ActionSegmentationStore.behaviors_dict-706"><a href="#ActionSegmentationStore.behaviors_dict-706"><span class="linenos">706</span></a><span class="sd">            a dictionary with class indices as keys and class names as values</span>
</span><span id="ActionSegmentationStore.behaviors_dict-707"><a href="#ActionSegmentationStore.behaviors_dict-707"><span class="linenos">707</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.behaviors_dict-708"><a href="#ActionSegmentationStore.behaviors_dict-708"><span class="linenos">708</span></a>
</span><span id="ActionSegmentationStore.behaviors_dict-709"><a href="#ActionSegmentationStore.behaviors_dict-709"><span class="linenos">709</span></a>        <span class="c1"># if self.behaviors is None</span>
</span><span id="ActionSegmentationStore.behaviors_dict-710"><a href="#ActionSegmentationStore.behaviors_dict-710"><span class="linenos">710</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="ow">and</span> <span class="s2">&quot;other&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.behaviors_dict-711"><a href="#ActionSegmentationStore.behaviors_dict-711"><span class="linenos">711</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">b</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">)}</span>
</span><span id="ActionSegmentationStore.behaviors_dict-712"><a href="#ActionSegmentationStore.behaviors_dict-712"><span class="linenos">712</span></a>            <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;other&quot;</span>
</span><span id="ActionSegmentationStore.behaviors_dict-713"><a href="#ActionSegmentationStore.behaviors_dict-713"><span class="linenos">713</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.behaviors_dict-714"><a href="#ActionSegmentationStore.behaviors_dict-714"><span class="linenos">714</span></a>            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">b</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">)}</span>
</span><span id="ActionSegmentationStore.behaviors_dict-715"><a href="#ActionSegmentationStore.behaviors_dict-715"><span class="linenos">715</span></a>        <span class="k">return</span> <span class="n">d</span>
</span></pre></div>


            <div class="docstring"><p>Get a dictionary of class names</p>

<h2 id="returns">Returns</h2>

<p>behavior_dictionary: dict
    a dictionary with class indices as keys and class names as values</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.annotation_class" class="classattr">
                                        <input id="ActionSegmentationStore.annotation_class-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">annotation_class</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="ActionSegmentationStore.annotation_class-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.annotation_class"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.annotation_class-717"><a href="#ActionSegmentationStore.annotation_class-717"><span class="linenos">717</span></a>    <span class="k">def</span> <span class="nf">annotation_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.annotation_class-718"><a href="#ActionSegmentationStore.annotation_class-718"><span class="linenos">718</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.annotation_class-719"><a href="#ActionSegmentationStore.annotation_class-719"><span class="linenos">719</span></a><span class="sd">        Get the type of annotation (&#39;exclusive_classification&#39;, &#39;nonexclusive_classification&#39;)</span>
</span><span id="ActionSegmentationStore.annotation_class-720"><a href="#ActionSegmentationStore.annotation_class-720"><span class="linenos">720</span></a>
</span><span id="ActionSegmentationStore.annotation_class-721"><a href="#ActionSegmentationStore.annotation_class-721"><span class="linenos">721</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore.annotation_class-722"><a href="#ActionSegmentationStore.annotation_class-722"><span class="linenos">722</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore.annotation_class-723"><a href="#ActionSegmentationStore.annotation_class-723"><span class="linenos">723</span></a><span class="sd">        annotation_class : str</span>
</span><span id="ActionSegmentationStore.annotation_class-724"><a href="#ActionSegmentationStore.annotation_class-724"><span class="linenos">724</span></a><span class="sd">            the type of annotation</span>
</span><span id="ActionSegmentationStore.annotation_class-725"><a href="#ActionSegmentationStore.annotation_class-725"><span class="linenos">725</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.annotation_class-726"><a href="#ActionSegmentationStore.annotation_class-726"><span class="linenos">726</span></a>
</span><span id="ActionSegmentationStore.annotation_class-727"><a href="#ActionSegmentationStore.annotation_class-727"><span class="linenos">727</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.annotation_class-728"><a href="#ActionSegmentationStore.annotation_class-728"><span class="linenos">728</span></a>            <span class="k">return</span> <span class="s2">&quot;exclusive_classification&quot;</span>
</span><span id="ActionSegmentationStore.annotation_class-729"><a href="#ActionSegmentationStore.annotation_class-729"><span class="linenos">729</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.annotation_class-730"><a href="#ActionSegmentationStore.annotation_class-730"><span class="linenos">730</span></a>            <span class="k">return</span> <span class="s2">&quot;nonexclusive_classification&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Get the type of annotation ('exclusive_classification', 'nonexclusive_classification')</p>

<h2 id="returns">Returns</h2>

<p>annotation_class : str
    the type of annotation</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.size" class="classattr">
                                        <input id="ActionSegmentationStore.size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="ActionSegmentationStore.size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.size-732"><a href="#ActionSegmentationStore.size-732"><span class="linenos">732</span></a>    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.size-733"><a href="#ActionSegmentationStore.size-733"><span class="linenos">733</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.size-734"><a href="#ActionSegmentationStore.size-734"><span class="linenos">734</span></a><span class="sd">        Get the total number of frames in the data</span>
</span><span id="ActionSegmentationStore.size-735"><a href="#ActionSegmentationStore.size-735"><span class="linenos">735</span></a>
</span><span id="ActionSegmentationStore.size-736"><a href="#ActionSegmentationStore.size-736"><span class="linenos">736</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore.size-737"><a href="#ActionSegmentationStore.size-737"><span class="linenos">737</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore.size-738"><a href="#ActionSegmentationStore.size-738"><span class="linenos">738</span></a><span class="sd">        size : int</span>
</span><span id="ActionSegmentationStore.size-739"><a href="#ActionSegmentationStore.size-739"><span class="linenos">739</span></a><span class="sd">            the total number of frames</span>
</span><span id="ActionSegmentationStore.size-740"><a href="#ActionSegmentationStore.size-740"><span class="linenos">740</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.size-741"><a href="#ActionSegmentationStore.size-741"><span class="linenos">741</span></a>
</span><span id="ActionSegmentationStore.size-742"><a href="#ActionSegmentationStore.size-742"><span class="linenos">742</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Get the total number of frames in the data</p>

<h2 id="returns">Returns</h2>

<p>size : int
    the total number of frames</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.filtered_indices" class="classattr">
                                        <input id="ActionSegmentationStore.filtered_indices-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filtered_indices</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span>:</span></span>

                <label class="view-source-button" for="ActionSegmentationStore.filtered_indices-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.filtered_indices"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.filtered_indices-744"><a href="#ActionSegmentationStore.filtered_indices-744"><span class="linenos">744</span></a>    <span class="k">def</span> <span class="nf">filtered_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.filtered_indices-745"><a href="#ActionSegmentationStore.filtered_indices-745"><span class="linenos">745</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.filtered_indices-746"><a href="#ActionSegmentationStore.filtered_indices-746"><span class="linenos">746</span></a><span class="sd">        Return the indices of the samples that should be removed</span>
</span><span id="ActionSegmentationStore.filtered_indices-747"><a href="#ActionSegmentationStore.filtered_indices-747"><span class="linenos">747</span></a>
</span><span id="ActionSegmentationStore.filtered_indices-748"><a href="#ActionSegmentationStore.filtered_indices-748"><span class="linenos">748</span></a><span class="sd">        Choosing the indices can be based on any kind of filering defined in the __init__ function by the data</span>
</span><span id="ActionSegmentationStore.filtered_indices-749"><a href="#ActionSegmentationStore.filtered_indices-749"><span class="linenos">749</span></a><span class="sd">        parameters</span>
</span><span id="ActionSegmentationStore.filtered_indices-750"><a href="#ActionSegmentationStore.filtered_indices-750"><span class="linenos">750</span></a>
</span><span id="ActionSegmentationStore.filtered_indices-751"><a href="#ActionSegmentationStore.filtered_indices-751"><span class="linenos">751</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore.filtered_indices-752"><a href="#ActionSegmentationStore.filtered_indices-752"><span class="linenos">752</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore.filtered_indices-753"><a href="#ActionSegmentationStore.filtered_indices-753"><span class="linenos">753</span></a><span class="sd">        indices_to_remove : list</span>
</span><span id="ActionSegmentationStore.filtered_indices-754"><a href="#ActionSegmentationStore.filtered_indices-754"><span class="linenos">754</span></a><span class="sd">            a list of integer indices that should be removed</span>
</span><span id="ActionSegmentationStore.filtered_indices-755"><a href="#ActionSegmentationStore.filtered_indices-755"><span class="linenos">755</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.filtered_indices-756"><a href="#ActionSegmentationStore.filtered_indices-756"><span class="linenos">756</span></a>
</span><span id="ActionSegmentationStore.filtered_indices-757"><a href="#ActionSegmentationStore.filtered_indices-757"><span class="linenos">757</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filtered</span>
</span></pre></div>


            <div class="docstring"><p>Return the indices of the samples that should be removed</p>

<p>Choosing the indices can be based on any kind of filering defined in the __init__ function by the data
parameters</p>

<h2 id="returns">Returns</h2>

<p>indices_to_remove : list
    a list of integer indices that should be removed</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.set_pseudo_labels" class="classattr">
                                        <input id="ActionSegmentationStore.set_pseudo_labels-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_pseudo_labels</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">labels</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ActionSegmentationStore.set_pseudo_labels-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.set_pseudo_labels"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.set_pseudo_labels-759"><a href="#ActionSegmentationStore.set_pseudo_labels-759"><span class="linenos">759</span></a>    <span class="k">def</span> <span class="nf">set_pseudo_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.set_pseudo_labels-760"><a href="#ActionSegmentationStore.set_pseudo_labels-760"><span class="linenos">760</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.set_pseudo_labels-761"><a href="#ActionSegmentationStore.set_pseudo_labels-761"><span class="linenos">761</span></a><span class="sd">        Set pseudo labels to the unlabeled data</span>
</span><span id="ActionSegmentationStore.set_pseudo_labels-762"><a href="#ActionSegmentationStore.set_pseudo_labels-762"><span class="linenos">762</span></a>
</span><span id="ActionSegmentationStore.set_pseudo_labels-763"><a href="#ActionSegmentationStore.set_pseudo_labels-763"><span class="linenos">763</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore.set_pseudo_labels-764"><a href="#ActionSegmentationStore.set_pseudo_labels-764"><span class="linenos">764</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore.set_pseudo_labels-765"><a href="#ActionSegmentationStore.set_pseudo_labels-765"><span class="linenos">765</span></a><span class="sd">        labels : torch.Tensor</span>
</span><span id="ActionSegmentationStore.set_pseudo_labels-766"><a href="#ActionSegmentationStore.set_pseudo_labels-766"><span class="linenos">766</span></a><span class="sd">            a tensor of pseudo-labels for the unlabeled data</span>
</span><span id="ActionSegmentationStore.set_pseudo_labels-767"><a href="#ActionSegmentationStore.set_pseudo_labels-767"><span class="linenos">767</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.set_pseudo_labels-768"><a href="#ActionSegmentationStore.set_pseudo_labels-768"><span class="linenos">768</span></a>
</span><span id="ActionSegmentationStore.set_pseudo_labels-769"><a href="#ActionSegmentationStore.set_pseudo_labels-769"><span class="linenos">769</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span>
</span></pre></div>


            <div class="docstring"><p>Set pseudo labels to the unlabeled data</p>

<h2 id="parameters">Parameters</h2>

<p>labels : torch.Tensor
    a tensor of pseudo-labels for the unlabeled data</p>
</div>


                            </div>
                            <div id="ActionSegmentationStore.get_file_ids" class="classattr">
                                        <input id="ActionSegmentationStore.get_file_ids-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_file_ids</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">]</span>,</span><span class="param">	<span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n">List</span>:</span></span>

                <label class="view-source-button" for="ActionSegmentationStore.get_file_ids-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ActionSegmentationStore.get_file_ids"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ActionSegmentationStore.get_file_ids-771"><a href="#ActionSegmentationStore.get_file_ids-771"><span class="linenos">771</span></a>    <span class="nd">@classmethod</span>
</span><span id="ActionSegmentationStore.get_file_ids-772"><a href="#ActionSegmentationStore.get_file_ids-772"><span class="linenos">772</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span>
</span><span id="ActionSegmentationStore.get_file_ids-773"><a href="#ActionSegmentationStore.get_file_ids-773"><span class="linenos">773</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.get_file_ids-774"><a href="#ActionSegmentationStore.get_file_ids-774"><span class="linenos">774</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">],</span>
</span><span id="ActionSegmentationStore.get_file_ids-775"><a href="#ActionSegmentationStore.get_file_ids-775"><span class="linenos">775</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">],</span>
</span><span id="ActionSegmentationStore.get_file_ids-776"><a href="#ActionSegmentationStore.get_file_ids-776"><span class="linenos">776</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.get_file_ids-777"><a href="#ActionSegmentationStore.get_file_ids-777"><span class="linenos">777</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="ActionSegmentationStore.get_file_ids-778"><a href="#ActionSegmentationStore.get_file_ids-778"><span class="linenos">778</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.get_file_ids-779"><a href="#ActionSegmentationStore.get_file_ids-779"><span class="linenos">779</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.get_file_ids-780"><a href="#ActionSegmentationStore.get_file_ids-780"><span class="linenos">780</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="ActionSegmentationStore.get_file_ids-781"><a href="#ActionSegmentationStore.get_file_ids-781"><span class="linenos">781</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="ActionSegmentationStore.get_file_ids-782"><a href="#ActionSegmentationStore.get_file_ids-782"><span class="linenos">782</span></a>
</span><span id="ActionSegmentationStore.get_file_ids-783"><a href="#ActionSegmentationStore.get_file_ids-783"><span class="linenos">783</span></a><span class="sd">        Parameters</span>
</span><span id="ActionSegmentationStore.get_file_ids-784"><a href="#ActionSegmentationStore.get_file_ids-784"><span class="linenos">784</span></a><span class="sd">        ----------</span>
</span><span id="ActionSegmentationStore.get_file_ids-785"><a href="#ActionSegmentationStore.get_file_ids-785"><span class="linenos">785</span></a><span class="sd">        annotation_path : str | set</span>
</span><span id="ActionSegmentationStore.get_file_ids-786"><a href="#ActionSegmentationStore.get_file_ids-786"><span class="linenos">786</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored</span>
</span><span id="ActionSegmentationStore.get_file_ids-787"><a href="#ActionSegmentationStore.get_file_ids-787"><span class="linenos">787</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="ActionSegmentationStore.get_file_ids-788"><a href="#ActionSegmentationStore.get_file_ids-788"><span class="linenos">788</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="ActionSegmentationStore.get_file_ids-789"><a href="#ActionSegmentationStore.get_file_ids-789"><span class="linenos">789</span></a>
</span><span id="ActionSegmentationStore.get_file_ids-790"><a href="#ActionSegmentationStore.get_file_ids-790"><span class="linenos">790</span></a><span class="sd">        Returns</span>
</span><span id="ActionSegmentationStore.get_file_ids-791"><a href="#ActionSegmentationStore.get_file_ids-791"><span class="linenos">791</span></a><span class="sd">        -------</span>
</span><span id="ActionSegmentationStore.get_file_ids-792"><a href="#ActionSegmentationStore.get_file_ids-792"><span class="linenos">792</span></a><span class="sd">        video_ids : list</span>
</span><span id="ActionSegmentationStore.get_file_ids-793"><a href="#ActionSegmentationStore.get_file_ids-793"><span class="linenos">793</span></a><span class="sd">            a list of video file ids</span>
</span><span id="ActionSegmentationStore.get_file_ids-794"><a href="#ActionSegmentationStore.get_file_ids-794"><span class="linenos">794</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ActionSegmentationStore.get_file_ids-795"><a href="#ActionSegmentationStore.get_file_ids-795"><span class="linenos">795</span></a>
</span><span id="ActionSegmentationStore.get_file_ids-796"><a href="#ActionSegmentationStore.get_file_ids-796"><span class="linenos">796</span></a>        <span class="n">lists</span> <span class="o">=</span> <span class="p">[</span><span class="n">annotation_path</span><span class="p">,</span> <span class="n">annotation_suffix</span><span class="p">]</span>
</span><span id="ActionSegmentationStore.get_file_ids-797"><a href="#ActionSegmentationStore.get_file_ids-797"><span class="linenos">797</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lists</span><span class="p">)):</span>
</span><span id="ActionSegmentationStore.get_file_ids-798"><a href="#ActionSegmentationStore.get_file_ids-798"><span class="linenos">798</span></a>            <span class="n">iterable</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">))</span>
</span><span id="ActionSegmentationStore.get_file_ids-799"><a href="#ActionSegmentationStore.get_file_ids-799"><span class="linenos">799</span></a>            <span class="k">if</span> <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.get_file_ids-800"><a href="#ActionSegmentationStore.get_file_ids-800"><span class="linenos">800</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">iterable</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.get_file_ids-801"><a href="#ActionSegmentationStore.get_file_ids-801"><span class="linenos">801</span></a>                    <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="ActionSegmentationStore.get_file_ids-802"><a href="#ActionSegmentationStore.get_file_ids-802"><span class="linenos">802</span></a>                <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="ActionSegmentationStore.get_file_ids-803"><a href="#ActionSegmentationStore.get_file_ids-803"><span class="linenos">803</span></a>        <span class="n">annotation_path</span><span class="p">,</span> <span class="n">annotation_suffix</span> <span class="o">=</span> <span class="n">lists</span>
</span><span id="ActionSegmentationStore.get_file_ids-804"><a href="#ActionSegmentationStore.get_file_ids-804"><span class="linenos">804</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ActionSegmentationStore.get_file_ids-805"><a href="#ActionSegmentationStore.get_file_ids-805"><span class="linenos">805</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">annotation_path</span><span class="p">:</span>
</span><span id="ActionSegmentationStore.get_file_ids-806"><a href="#ActionSegmentationStore.get_file_ids-806"><span class="linenos">806</span></a>            <span class="n">files</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="ActionSegmentationStore.get_file_ids-807"><a href="#ActionSegmentationStore.get_file_ids-807"><span class="linenos">807</span></a>                <span class="n">strip_suffix</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="n">annotation_suffix</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.get_file_ids-808"><a href="#ActionSegmentationStore.get_file_ids-808"><span class="linenos">808</span></a>                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="ActionSegmentationStore.get_file_ids-809"><a href="#ActionSegmentationStore.get_file_ids-809"><span class="linenos">809</span></a>                <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">annotation_suffix</span><span class="p">]))</span>
</span><span id="ActionSegmentationStore.get_file_ids-810"><a href="#ActionSegmentationStore.get_file_ids-810"><span class="linenos">810</span></a>            <span class="p">]</span>
</span><span id="ActionSegmentationStore.get_file_ids-811"><a href="#ActionSegmentationStore.get_file_ids-811"><span class="linenos">811</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="ActionSegmentationStore.get_file_ids-812"><a href="#ActionSegmentationStore.get_file_ids-812"><span class="linenos">812</span></a>        <span class="k">return</span> <span class="n">files</span>
</span></pre></div>


            <div class="docstring"><p>Process data parameters and return a list of ids  of the videos that should
be processed by the __init__ function</p>

<h2 id="parameters">Parameters</h2>

<p>annotation_path : str | set
    the path or the set of paths to the folder where the annotation files are stored
annotation_suffix : str | set, optional
    the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</p>

<h2 id="returns">Returns</h2>

<p>video_ids : list
    a list of video file ids</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="base_store.html#AnnotationStore">dlc2action.data.base_store.AnnotationStore</a></dt>
                                <dd id="ActionSegmentationStore.required_objects" class="variable"><a href="base_store.html#AnnotationStore.required_objects">required_objects</a></dd>

            </div>
            <div><dt><a href="base_store.html#Store">dlc2action.data.base_store.Store</a></dt>
                                <dd id="ActionSegmentationStore.get_parameters" class="function"><a href="base_store.html#Store.get_parameters">get_parameters</a></dd>
                <dd id="ActionSegmentationStore.new" class="function"><a href="base_store.html#Store.new">new</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="FileAnnotationStore">
                            <input id="FileAnnotationStore-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FileAnnotationStore</span><wbr>(<span class="base"><a href="#ActionSegmentationStore">ActionSegmentationStore</a></span>):

                <label class="view-source-button" for="FileAnnotationStore-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FileAnnotationStore"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FileAnnotationStore-1097"><a href="#FileAnnotationStore-1097"><span class="linenos">1097</span></a><span class="k">class</span> <span class="nc">FileAnnotationStore</span><span class="p">(</span><span class="n">ActionSegmentationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="FileAnnotationStore-1098"><a href="#FileAnnotationStore-1098"><span class="linenos">1098</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="FileAnnotationStore-1099"><a href="#FileAnnotationStore-1099"><span class="linenos">1099</span></a><span class="sd">    A generalized implementation of `ActionSegmentationStore` for datasets where one file corresponds to one video</span>
</span><span id="FileAnnotationStore-1100"><a href="#FileAnnotationStore-1100"><span class="linenos">1100</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="FileAnnotationStore-1101"><a href="#FileAnnotationStore-1101"><span class="linenos">1101</span></a>
</span><span id="FileAnnotationStore-1102"><a href="#FileAnnotationStore-1102"><span class="linenos">1102</span></a>    <span class="k">def</span> <span class="nf">_generate_max_min_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">video_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1103"><a href="#FileAnnotationStore-1103"><span class="linenos">1103</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="FileAnnotationStore-1104"><a href="#FileAnnotationStore-1104"><span class="linenos">1104</span></a><span class="sd">        Generate `max_frames` and `min_frames` objects in case they were not passed from an `InputStore`</span>
</span><span id="FileAnnotationStore-1105"><a href="#FileAnnotationStore-1105"><span class="linenos">1105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FileAnnotationStore-1106"><a href="#FileAnnotationStore-1106"><span class="linenos">1106</span></a>
</span><span id="FileAnnotationStore-1107"><a href="#FileAnnotationStore-1107"><span class="linenos">1107</span></a>        <span class="k">if</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1108"><a href="#FileAnnotationStore-1108"><span class="linenos">1108</span></a>            <span class="k">return</span>
</span><span id="FileAnnotationStore-1109"><a href="#FileAnnotationStore-1109"><span class="linenos">1109</span></a>        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">cat_dict</span> <span class="ow">in</span> <span class="n">times</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="FileAnnotationStore-1110"><a href="#FileAnnotationStore-1110"><span class="linenos">1110</span></a>            <span class="n">maxes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FileAnnotationStore-1111"><a href="#FileAnnotationStore-1111"><span class="linenos">1111</span></a>            <span class="n">mins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FileAnnotationStore-1112"><a href="#FileAnnotationStore-1112"><span class="linenos">1112</span></a>            <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">cat_list</span> <span class="ow">in</span> <span class="n">cat_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="FileAnnotationStore-1113"><a href="#FileAnnotationStore-1113"><span class="linenos">1113</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1114"><a href="#FileAnnotationStore-1114"><span class="linenos">1114</span></a>                    <span class="n">maxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_list</span><span class="p">]))</span>
</span><span id="FileAnnotationStore-1115"><a href="#FileAnnotationStore-1115"><span class="linenos">1115</span></a>                    <span class="n">mins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_list</span><span class="p">]))</span>
</span><span id="FileAnnotationStore-1116"><a href="#FileAnnotationStore-1116"><span class="linenos">1116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxes</span><span class="p">)</span>
</span><span id="FileAnnotationStore-1117"><a href="#FileAnnotationStore-1117"><span class="linenos">1117</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mins</span><span class="p">)</span>
</span><span id="FileAnnotationStore-1118"><a href="#FileAnnotationStore-1118"><span class="linenos">1118</span></a>
</span><span id="FileAnnotationStore-1119"><a href="#FileAnnotationStore-1119"><span class="linenos">1119</span></a>    <span class="k">def</span> <span class="nf">_load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1120"><a href="#FileAnnotationStore-1120"><span class="linenos">1120</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="FileAnnotationStore-1121"><a href="#FileAnnotationStore-1121"><span class="linenos">1121</span></a><span class="sd">        Load behavior annotation and generate annotation prompts</span>
</span><span id="FileAnnotationStore-1122"><a href="#FileAnnotationStore-1122"><span class="linenos">1122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FileAnnotationStore-1123"><a href="#FileAnnotationStore-1123"><span class="linenos">1123</span></a>
</span><span id="FileAnnotationStore-1124"><a href="#FileAnnotationStore-1124"><span class="linenos">1124</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1125"><a href="#FileAnnotationStore-1125"><span class="linenos">1125</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="FileAnnotationStore-1126"><a href="#FileAnnotationStore-1126"><span class="linenos">1126</span></a>
</span><span id="FileAnnotationStore-1127"><a href="#FileAnnotationStore-1127"><span class="linenos">1127</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FileAnnotationStore-1128"><a href="#FileAnnotationStore-1128"><span class="linenos">1128</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_order</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1129"><a href="#FileAnnotationStore-1129"><span class="linenos">1129</span></a>            <span class="n">ok</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="FileAnnotationStore-1130"><a href="#FileAnnotationStore-1130"><span class="linenos">1130</span></a>            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">annotation_folder</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1131"><a href="#FileAnnotationStore-1131"><span class="linenos">1131</span></a>                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ann_suffix</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1132"><a href="#FileAnnotationStore-1132"><span class="linenos">1132</span></a>                    <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
</span><span id="FileAnnotationStore-1133"><a href="#FileAnnotationStore-1133"><span class="linenos">1133</span></a>                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
</span><span id="FileAnnotationStore-1134"><a href="#FileAnnotationStore-1134"><span class="linenos">1134</span></a>                        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="FileAnnotationStore-1135"><a href="#FileAnnotationStore-1135"><span class="linenos">1135</span></a>                        <span class="n">ok</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FileAnnotationStore-1136"><a href="#FileAnnotationStore-1136"><span class="linenos">1136</span></a>                        <span class="k">break</span>
</span><span id="FileAnnotationStore-1137"><a href="#FileAnnotationStore-1137"><span class="linenos">1137</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1138"><a href="#FileAnnotationStore-1138"><span class="linenos">1138</span></a>                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="FileAnnotationStore-1139"><a href="#FileAnnotationStore-1139"><span class="linenos">1139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">not_found</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="FileAnnotationStore-1140"><a href="#FileAnnotationStore-1140"><span class="linenos">1140</span></a>        <span class="n">annotations_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="FileAnnotationStore-1141"><a href="#FileAnnotationStore-1141"><span class="linenos">1141</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computing annotation arrays...&quot;</span><span class="p">)</span>
</span><span id="FileAnnotationStore-1142"><a href="#FileAnnotationStore-1142"><span class="linenos">1142</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_order</span><span class="p">,</span> <span class="n">files</span><span class="p">))):</span>
</span><span id="FileAnnotationStore-1143"><a href="#FileAnnotationStore-1143"><span class="linenos">1143</span></a>            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1144"><a href="#FileAnnotationStore-1144"><span class="linenos">1144</span></a>                <span class="n">times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_annotations</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="FileAnnotationStore-1145"><a href="#FileAnnotationStore-1145"><span class="linenos">1145</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1146"><a href="#FileAnnotationStore-1146"><span class="linenos">1146</span></a>                <span class="n">times</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FileAnnotationStore-1147"><a href="#FileAnnotationStore-1147"><span class="linenos">1147</span></a>            <span class="k">if</span> <span class="n">times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1148"><a href="#FileAnnotationStore-1148"><span class="linenos">1148</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_generate_max_min_frames</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="FileAnnotationStore-1149"><a href="#FileAnnotationStore-1149"><span class="linenos">1149</span></a>            <span class="n">annotations_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_annotation</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
</span><span id="FileAnnotationStore-1150"><a href="#FileAnnotationStore-1150"><span class="linenos">1150</span></a>            <span class="k">del</span> <span class="n">times</span>
</span><span id="FileAnnotationStore-1151"><a href="#FileAnnotationStore-1151"><span class="linenos">1151</span></a>        <span class="n">annotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_trimmed_annotations</span><span class="p">(</span><span class="n">annotations_dict</span><span class="p">)</span>
</span><span id="FileAnnotationStore-1152"><a href="#FileAnnotationStore-1152"><span class="linenos">1152</span></a>        <span class="k">del</span> <span class="n">annotations_dict</span>
</span><span id="FileAnnotationStore-1153"><a href="#FileAnnotationStore-1153"><span class="linenos">1153</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_annotated</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1154"><a href="#FileAnnotationStore-1154"><span class="linenos">1154</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1155"><a href="#FileAnnotationStore-1155"><span class="linenos">1155</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">annotation</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="FileAnnotationStore-1156"><a href="#FileAnnotationStore-1156"><span class="linenos">1156</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1157"><a href="#FileAnnotationStore-1157"><span class="linenos">1157</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="FileAnnotationStore-1158"><a href="#FileAnnotationStore-1158"><span class="linenos">1158</span></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">annotation</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span>
</span><span id="FileAnnotationStore-1159"><a href="#FileAnnotationStore-1159"><span class="linenos">1159</span></a>                <span class="p">)</span>
</span><span id="FileAnnotationStore-1160"><a href="#FileAnnotationStore-1160"><span class="linenos">1160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filtered</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="FileAnnotationStore-1161"><a href="#FileAnnotationStore-1161"><span class="linenos">1161</span></a>        <span class="n">annotation</span><span class="p">[</span><span class="n">annotation</span> <span class="o">==</span> <span class="o">-</span><span class="mi">200</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="FileAnnotationStore-1162"><a href="#FileAnnotationStore-1162"><span class="linenos">1162</span></a>        <span class="k">return</span> <span class="n">annotation</span>
</span><span id="FileAnnotationStore-1163"><a href="#FileAnnotationStore-1163"><span class="linenos">1163</span></a>
</span><span id="FileAnnotationStore-1164"><a href="#FileAnnotationStore-1164"><span class="linenos">1164</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="FileAnnotationStore-1165"><a href="#FileAnnotationStore-1165"><span class="linenos">1165</span></a>    <span class="k">def</span> <span class="nf">_open_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="FileAnnotationStore-1166"><a href="#FileAnnotationStore-1166"><span class="linenos">1166</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="FileAnnotationStore-1167"><a href="#FileAnnotationStore-1167"><span class="linenos">1167</span></a><span class="sd">        Load the annotation from filename</span>
</span><span id="FileAnnotationStore-1168"><a href="#FileAnnotationStore-1168"><span class="linenos">1168</span></a>
</span><span id="FileAnnotationStore-1169"><a href="#FileAnnotationStore-1169"><span class="linenos">1169</span></a><span class="sd">        Parameters</span>
</span><span id="FileAnnotationStore-1170"><a href="#FileAnnotationStore-1170"><span class="linenos">1170</span></a><span class="sd">        ----------</span>
</span><span id="FileAnnotationStore-1171"><a href="#FileAnnotationStore-1171"><span class="linenos">1171</span></a><span class="sd">        filename : str</span>
</span><span id="FileAnnotationStore-1172"><a href="#FileAnnotationStore-1172"><span class="linenos">1172</span></a><span class="sd">            path to an annotation file</span>
</span><span id="FileAnnotationStore-1173"><a href="#FileAnnotationStore-1173"><span class="linenos">1173</span></a>
</span><span id="FileAnnotationStore-1174"><a href="#FileAnnotationStore-1174"><span class="linenos">1174</span></a><span class="sd">        Returns</span>
</span><span id="FileAnnotationStore-1175"><a href="#FileAnnotationStore-1175"><span class="linenos">1175</span></a><span class="sd">        -------</span>
</span><span id="FileAnnotationStore-1176"><a href="#FileAnnotationStore-1176"><span class="linenos">1176</span></a><span class="sd">        times : dict</span>
</span><span id="FileAnnotationStore-1177"><a href="#FileAnnotationStore-1177"><span class="linenos">1177</span></a><span class="sd">            a nested dictionary where first-level keys are clip ids, second-level keys are categories and values are</span>
</span><span id="FileAnnotationStore-1178"><a href="#FileAnnotationStore-1178"><span class="linenos">1178</span></a><span class="sd">            lists of (start, end, ambiguity status) lists</span>
</span><span id="FileAnnotationStore-1179"><a href="#FileAnnotationStore-1179"><span class="linenos">1179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>A generalized implementation of <code><a href="#ActionSegmentationStore">ActionSegmentationStore</a></code> for datasets where one file corresponds to one video</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ActionSegmentationStore">ActionSegmentationStore</a></dt>
                                <dd id="FileAnnotationStore.__init__" class="function"><a href="#ActionSegmentationStore.__init__">ActionSegmentationStore</a></dd>
                <dd id="FileAnnotationStore.remove" class="function"><a href="#ActionSegmentationStore.remove">remove</a></dd>
                <dd id="FileAnnotationStore.key_objects" class="function"><a href="#ActionSegmentationStore.key_objects">key_objects</a></dd>
                <dd id="FileAnnotationStore.load_from_key_objects" class="function"><a href="#ActionSegmentationStore.load_from_key_objects">load_from_key_objects</a></dd>
                <dd id="FileAnnotationStore.to_ram" class="function"><a href="#ActionSegmentationStore.to_ram">to_ram</a></dd>
                <dd id="FileAnnotationStore.get_original_coordinates" class="function"><a href="#ActionSegmentationStore.get_original_coordinates">get_original_coordinates</a></dd>
                <dd id="FileAnnotationStore.create_subsample" class="function"><a href="#ActionSegmentationStore.create_subsample">create_subsample</a></dd>
                <dd id="FileAnnotationStore.get_len" class="function"><a href="#ActionSegmentationStore.get_len">get_len</a></dd>
                <dd id="FileAnnotationStore.get_indices" class="function"><a href="#ActionSegmentationStore.get_indices">get_indices</a></dd>
                <dd id="FileAnnotationStore.count_classes" class="function"><a href="#ActionSegmentationStore.count_classes">count_classes</a></dd>
                <dd id="FileAnnotationStore.behaviors_dict" class="function"><a href="#ActionSegmentationStore.behaviors_dict">behaviors_dict</a></dd>
                <dd id="FileAnnotationStore.annotation_class" class="function"><a href="#ActionSegmentationStore.annotation_class">annotation_class</a></dd>
                <dd id="FileAnnotationStore.size" class="function"><a href="#ActionSegmentationStore.size">size</a></dd>
                <dd id="FileAnnotationStore.filtered_indices" class="function"><a href="#ActionSegmentationStore.filtered_indices">filtered_indices</a></dd>
                <dd id="FileAnnotationStore.set_pseudo_labels" class="function"><a href="#ActionSegmentationStore.set_pseudo_labels">set_pseudo_labels</a></dd>
                <dd id="FileAnnotationStore.get_file_ids" class="function"><a href="#ActionSegmentationStore.get_file_ids">get_file_ids</a></dd>

            </div>
            <div><dt><a href="base_store.html#AnnotationStore">dlc2action.data.base_store.AnnotationStore</a></dt>
                                <dd id="FileAnnotationStore.required_objects" class="variable"><a href="base_store.html#AnnotationStore.required_objects">required_objects</a></dd>

            </div>
            <div><dt><a href="base_store.html#Store">dlc2action.data.base_store.Store</a></dt>
                                <dd id="FileAnnotationStore.get_parameters" class="function"><a href="base_store.html#Store.get_parameters">get_parameters</a></dd>
                <dd id="FileAnnotationStore.new" class="function"><a href="base_store.html#Store.new">new</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SequenceAnnotationStore">
                            <input id="SequenceAnnotationStore-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SequenceAnnotationStore</span><wbr>(<span class="base"><a href="#ActionSegmentationStore">ActionSegmentationStore</a></span>):

                <label class="view-source-button" for="SequenceAnnotationStore-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SequenceAnnotationStore"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SequenceAnnotationStore-1182"><a href="#SequenceAnnotationStore-1182"><span class="linenos">1182</span></a><span class="k">class</span> <span class="nc">SequenceAnnotationStore</span><span class="p">(</span><span class="n">ActionSegmentationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="SequenceAnnotationStore-1183"><a href="#SequenceAnnotationStore-1183"><span class="linenos">1183</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SequenceAnnotationStore-1184"><a href="#SequenceAnnotationStore-1184"><span class="linenos">1184</span></a><span class="sd">    A generalized implementation of `ActionSegmentationStore` for datasets where one file corresponds to multiple videos</span>
</span><span id="SequenceAnnotationStore-1185"><a href="#SequenceAnnotationStore-1185"><span class="linenos">1185</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SequenceAnnotationStore-1186"><a href="#SequenceAnnotationStore-1186"><span class="linenos">1186</span></a>
</span><span id="SequenceAnnotationStore-1187"><a href="#SequenceAnnotationStore-1187"><span class="linenos">1187</span></a>    <span class="k">def</span> <span class="nf">_generate_max_min_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1188"><a href="#SequenceAnnotationStore-1188"><span class="linenos">1188</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SequenceAnnotationStore-1189"><a href="#SequenceAnnotationStore-1189"><span class="linenos">1189</span></a><span class="sd">        Generate `max_frames` and `min_frames` objects in case they were not passed from an `InputStore`</span>
</span><span id="SequenceAnnotationStore-1190"><a href="#SequenceAnnotationStore-1190"><span class="linenos">1190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SequenceAnnotationStore-1191"><a href="#SequenceAnnotationStore-1191"><span class="linenos">1191</span></a>
</span><span id="SequenceAnnotationStore-1192"><a href="#SequenceAnnotationStore-1192"><span class="linenos">1192</span></a>        <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1193"><a href="#SequenceAnnotationStore-1193"><span class="linenos">1193</span></a>            <span class="k">if</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1194"><a href="#SequenceAnnotationStore-1194"><span class="linenos">1194</span></a>                <span class="k">continue</span>
</span><span id="SequenceAnnotationStore-1195"><a href="#SequenceAnnotationStore-1195"><span class="linenos">1195</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SequenceAnnotationStore-1196"><a href="#SequenceAnnotationStore-1196"><span class="linenos">1196</span></a>            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">cat_dict</span> <span class="ow">in</span> <span class="n">times</span><span class="p">[</span><span class="n">video_id</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SequenceAnnotationStore-1197"><a href="#SequenceAnnotationStore-1197"><span class="linenos">1197</span></a>                <span class="n">maxes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SequenceAnnotationStore-1198"><a href="#SequenceAnnotationStore-1198"><span class="linenos">1198</span></a>                <span class="n">mins</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SequenceAnnotationStore-1199"><a href="#SequenceAnnotationStore-1199"><span class="linenos">1199</span></a>                <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">cat_list</span> <span class="ow">in</span> <span class="n">cat_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SequenceAnnotationStore-1200"><a href="#SequenceAnnotationStore-1200"><span class="linenos">1200</span></a>                    <span class="n">maxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_list</span><span class="p">]))</span>
</span><span id="SequenceAnnotationStore-1201"><a href="#SequenceAnnotationStore-1201"><span class="linenos">1201</span></a>                    <span class="n">mins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cat_list</span><span class="p">]))</span>
</span><span id="SequenceAnnotationStore-1202"><a href="#SequenceAnnotationStore-1202"><span class="linenos">1202</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxes</span><span class="p">)</span>
</span><span id="SequenceAnnotationStore-1203"><a href="#SequenceAnnotationStore-1203"><span class="linenos">1203</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">min_frames</span><span class="p">[</span><span class="n">video_id</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mins</span><span class="p">)</span>
</span><span id="SequenceAnnotationStore-1204"><a href="#SequenceAnnotationStore-1204"><span class="linenos">1204</span></a>
</span><span id="SequenceAnnotationStore-1205"><a href="#SequenceAnnotationStore-1205"><span class="linenos">1205</span></a>    <span class="nd">@classmethod</span>
</span><span id="SequenceAnnotationStore-1206"><a href="#SequenceAnnotationStore-1206"><span class="linenos">1206</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span>
</span><span id="SequenceAnnotationStore-1207"><a href="#SequenceAnnotationStore-1207"><span class="linenos">1207</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="SequenceAnnotationStore-1208"><a href="#SequenceAnnotationStore-1208"><span class="linenos">1208</span></a>        <span class="n">filenames</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SequenceAnnotationStore-1209"><a href="#SequenceAnnotationStore-1209"><span class="linenos">1209</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SequenceAnnotationStore-1210"><a href="#SequenceAnnotationStore-1210"><span class="linenos">1210</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="SequenceAnnotationStore-1211"><a href="#SequenceAnnotationStore-1211"><span class="linenos">1211</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="SequenceAnnotationStore-1212"><a href="#SequenceAnnotationStore-1212"><span class="linenos">1212</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1213"><a href="#SequenceAnnotationStore-1213"><span class="linenos">1213</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SequenceAnnotationStore-1214"><a href="#SequenceAnnotationStore-1214"><span class="linenos">1214</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="SequenceAnnotationStore-1215"><a href="#SequenceAnnotationStore-1215"><span class="linenos">1215</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="SequenceAnnotationStore-1216"><a href="#SequenceAnnotationStore-1216"><span class="linenos">1216</span></a>
</span><span id="SequenceAnnotationStore-1217"><a href="#SequenceAnnotationStore-1217"><span class="linenos">1217</span></a><span class="sd">        Parameters</span>
</span><span id="SequenceAnnotationStore-1218"><a href="#SequenceAnnotationStore-1218"><span class="linenos">1218</span></a><span class="sd">        ----------</span>
</span><span id="SequenceAnnotationStore-1219"><a href="#SequenceAnnotationStore-1219"><span class="linenos">1219</span></a><span class="sd">        filenames : list, optional</span>
</span><span id="SequenceAnnotationStore-1220"><a href="#SequenceAnnotationStore-1220"><span class="linenos">1220</span></a><span class="sd">            a list of annotation file paths</span>
</span><span id="SequenceAnnotationStore-1221"><a href="#SequenceAnnotationStore-1221"><span class="linenos">1221</span></a><span class="sd">        annotation_path : str, optional</span>
</span><span id="SequenceAnnotationStore-1222"><a href="#SequenceAnnotationStore-1222"><span class="linenos">1222</span></a><span class="sd">            path to the annotation folder</span>
</span><span id="SequenceAnnotationStore-1223"><a href="#SequenceAnnotationStore-1223"><span class="linenos">1223</span></a>
</span><span id="SequenceAnnotationStore-1224"><a href="#SequenceAnnotationStore-1224"><span class="linenos">1224</span></a><span class="sd">        Returns</span>
</span><span id="SequenceAnnotationStore-1225"><a href="#SequenceAnnotationStore-1225"><span class="linenos">1225</span></a><span class="sd">        -------</span>
</span><span id="SequenceAnnotationStore-1226"><a href="#SequenceAnnotationStore-1226"><span class="linenos">1226</span></a><span class="sd">        video_ids : list</span>
</span><span id="SequenceAnnotationStore-1227"><a href="#SequenceAnnotationStore-1227"><span class="linenos">1227</span></a><span class="sd">            a list of video file ids</span>
</span><span id="SequenceAnnotationStore-1228"><a href="#SequenceAnnotationStore-1228"><span class="linenos">1228</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SequenceAnnotationStore-1229"><a href="#SequenceAnnotationStore-1229"><span class="linenos">1229</span></a>
</span><span id="SequenceAnnotationStore-1230"><a href="#SequenceAnnotationStore-1230"><span class="linenos">1230</span></a>        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SequenceAnnotationStore-1231"><a href="#SequenceAnnotationStore-1231"><span class="linenos">1231</span></a>        <span class="k">if</span> <span class="n">annotation_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1232"><a href="#SequenceAnnotationStore-1232"><span class="linenos">1232</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SequenceAnnotationStore-1233"><a href="#SequenceAnnotationStore-1233"><span class="linenos">1233</span></a>                <span class="n">annotation_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">annotation_path</span><span class="p">]</span>
</span><span id="SequenceAnnotationStore-1234"><a href="#SequenceAnnotationStore-1234"><span class="linenos">1234</span></a>            <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SequenceAnnotationStore-1235"><a href="#SequenceAnnotationStore-1235"><span class="linenos">1235</span></a>            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">annotation_path</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1236"><a href="#SequenceAnnotationStore-1236"><span class="linenos">1236</span></a>                <span class="n">file_paths</span> <span class="o">+=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)]</span>
</span><span id="SequenceAnnotationStore-1237"><a href="#SequenceAnnotationStore-1237"><span class="linenos">1237</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SequenceAnnotationStore-1238"><a href="#SequenceAnnotationStore-1238"><span class="linenos">1238</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1239"><a href="#SequenceAnnotationStore-1239"><span class="linenos">1239</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1240"><a href="#SequenceAnnotationStore-1240"><span class="linenos">1240</span></a>                <span class="n">ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</span><span id="SequenceAnnotationStore-1241"><a href="#SequenceAnnotationStore-1241"><span class="linenos">1241</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
</span><span id="SequenceAnnotationStore-1242"><a href="#SequenceAnnotationStore-1242"><span class="linenos">1242</span></a>        <span class="k">return</span> <span class="n">ids</span>
</span><span id="SequenceAnnotationStore-1243"><a href="#SequenceAnnotationStore-1243"><span class="linenos">1243</span></a>
</span><span id="SequenceAnnotationStore-1244"><a href="#SequenceAnnotationStore-1244"><span class="linenos">1244</span></a>    <span class="k">def</span> <span class="nf">_load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1245"><a href="#SequenceAnnotationStore-1245"><span class="linenos">1245</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SequenceAnnotationStore-1246"><a href="#SequenceAnnotationStore-1246"><span class="linenos">1246</span></a><span class="sd">        Load behavior annotation and generate annotation prompts</span>
</span><span id="SequenceAnnotationStore-1247"><a href="#SequenceAnnotationStore-1247"><span class="linenos">1247</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SequenceAnnotationStore-1248"><a href="#SequenceAnnotationStore-1248"><span class="linenos">1248</span></a>
</span><span id="SequenceAnnotationStore-1249"><a href="#SequenceAnnotationStore-1249"><span class="linenos">1249</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1250"><a href="#SequenceAnnotationStore-1250"><span class="linenos">1250</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="SequenceAnnotationStore-1251"><a href="#SequenceAnnotationStore-1251"><span class="linenos">1251</span></a>
</span><span id="SequenceAnnotationStore-1252"><a href="#SequenceAnnotationStore-1252"><span class="linenos">1252</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SequenceAnnotationStore-1253"><a href="#SequenceAnnotationStore-1253"><span class="linenos">1253</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1254"><a href="#SequenceAnnotationStore-1254"><span class="linenos">1254</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">video_order</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1255"><a href="#SequenceAnnotationStore-1255"><span class="linenos">1255</span></a>                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="SequenceAnnotationStore-1256"><a href="#SequenceAnnotationStore-1256"><span class="linenos">1256</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">not_found</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SequenceAnnotationStore-1257"><a href="#SequenceAnnotationStore-1257"><span class="linenos">1257</span></a>        <span class="n">annotations_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SequenceAnnotationStore-1258"><a href="#SequenceAnnotationStore-1258"><span class="linenos">1258</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video_order</span><span class="p">,</span> <span class="n">files</span><span class="p">)):</span>
</span><span id="SequenceAnnotationStore-1259"><a href="#SequenceAnnotationStore-1259"><span class="linenos">1259</span></a>            <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1260"><a href="#SequenceAnnotationStore-1260"><span class="linenos">1260</span></a>                <span class="n">times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_sequences</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="SequenceAnnotationStore-1261"><a href="#SequenceAnnotationStore-1261"><span class="linenos">1261</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1262"><a href="#SequenceAnnotationStore-1262"><span class="linenos">1262</span></a>                <span class="n">times</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="SequenceAnnotationStore-1263"><a href="#SequenceAnnotationStore-1263"><span class="linenos">1263</span></a>            <span class="k">if</span> <span class="n">times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1264"><a href="#SequenceAnnotationStore-1264"><span class="linenos">1264</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_generate_max_min_frames</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
</span><span id="SequenceAnnotationStore-1265"><a href="#SequenceAnnotationStore-1265"><span class="linenos">1265</span></a>                <span class="n">none_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SequenceAnnotationStore-1266"><a href="#SequenceAnnotationStore-1266"><span class="linenos">1266</span></a>                <span class="k">for</span> <span class="n">video_id</span><span class="p">,</span> <span class="n">sequence_dict</span> <span class="ow">in</span> <span class="n">times</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SequenceAnnotationStore-1267"><a href="#SequenceAnnotationStore-1267"><span class="linenos">1267</span></a>                    <span class="k">if</span> <span class="n">sequence_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1268"><a href="#SequenceAnnotationStore-1268"><span class="linenos">1268</span></a>                        <span class="n">none_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sequence_dict</span><span class="p">)</span>
</span><span id="SequenceAnnotationStore-1269"><a href="#SequenceAnnotationStore-1269"><span class="linenos">1269</span></a>                        <span class="k">continue</span>
</span><span id="SequenceAnnotationStore-1270"><a href="#SequenceAnnotationStore-1270"><span class="linenos">1270</span></a>                    <span class="n">annotations_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="SequenceAnnotationStore-1271"><a href="#SequenceAnnotationStore-1271"><span class="linenos">1271</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_generate_annotation</span><span class="p">(</span><span class="n">sequence_dict</span><span class="p">,</span> <span class="n">video_id</span><span class="p">)</span>
</span><span id="SequenceAnnotationStore-1272"><a href="#SequenceAnnotationStore-1272"><span class="linenos">1272</span></a>                    <span class="p">)</span>
</span><span id="SequenceAnnotationStore-1273"><a href="#SequenceAnnotationStore-1273"><span class="linenos">1273</span></a>                <span class="k">for</span> <span class="n">video_id</span> <span class="ow">in</span> <span class="n">none_ids</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1274"><a href="#SequenceAnnotationStore-1274"><span class="linenos">1274</span></a>                    <span class="n">annotations_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_annotation</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">video_id</span><span class="p">))</span>
</span><span id="SequenceAnnotationStore-1275"><a href="#SequenceAnnotationStore-1275"><span class="linenos">1275</span></a>                <span class="k">del</span> <span class="n">times</span>
</span><span id="SequenceAnnotationStore-1276"><a href="#SequenceAnnotationStore-1276"><span class="linenos">1276</span></a>        <span class="n">annotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_trimmed_annotations</span><span class="p">(</span><span class="n">annotations_dict</span><span class="p">)</span>
</span><span id="SequenceAnnotationStore-1277"><a href="#SequenceAnnotationStore-1277"><span class="linenos">1277</span></a>        <span class="k">del</span> <span class="n">annotations_dict</span>
</span><span id="SequenceAnnotationStore-1278"><a href="#SequenceAnnotationStore-1278"><span class="linenos">1278</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_annotated</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1279"><a href="#SequenceAnnotationStore-1279"><span class="linenos">1279</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1280"><a href="#SequenceAnnotationStore-1280"><span class="linenos">1280</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">annotation</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="SequenceAnnotationStore-1281"><a href="#SequenceAnnotationStore-1281"><span class="linenos">1281</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1282"><a href="#SequenceAnnotationStore-1282"><span class="linenos">1282</span></a>                <span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="SequenceAnnotationStore-1283"><a href="#SequenceAnnotationStore-1283"><span class="linenos">1283</span></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">annotation</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">annotation</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span>
</span><span id="SequenceAnnotationStore-1284"><a href="#SequenceAnnotationStore-1284"><span class="linenos">1284</span></a>                <span class="p">)</span>
</span><span id="SequenceAnnotationStore-1285"><a href="#SequenceAnnotationStore-1285"><span class="linenos">1285</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filtered</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="SequenceAnnotationStore-1286"><a href="#SequenceAnnotationStore-1286"><span class="linenos">1286</span></a>        <span class="n">annotation</span><span class="p">[</span><span class="n">annotation</span> <span class="o">==</span> <span class="o">-</span><span class="mi">200</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span id="SequenceAnnotationStore-1287"><a href="#SequenceAnnotationStore-1287"><span class="linenos">1287</span></a>        <span class="k">return</span> <span class="n">annotation</span>
</span><span id="SequenceAnnotationStore-1288"><a href="#SequenceAnnotationStore-1288"><span class="linenos">1288</span></a>
</span><span id="SequenceAnnotationStore-1289"><a href="#SequenceAnnotationStore-1289"><span class="linenos">1289</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="SequenceAnnotationStore-1290"><a href="#SequenceAnnotationStore-1290"><span class="linenos">1290</span></a>    <span class="k">def</span> <span class="nf">_open_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore-1291"><a href="#SequenceAnnotationStore-1291"><span class="linenos">1291</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SequenceAnnotationStore-1292"><a href="#SequenceAnnotationStore-1292"><span class="linenos">1292</span></a><span class="sd">        Load the annotation from filename</span>
</span><span id="SequenceAnnotationStore-1293"><a href="#SequenceAnnotationStore-1293"><span class="linenos">1293</span></a>
</span><span id="SequenceAnnotationStore-1294"><a href="#SequenceAnnotationStore-1294"><span class="linenos">1294</span></a><span class="sd">        Parameters</span>
</span><span id="SequenceAnnotationStore-1295"><a href="#SequenceAnnotationStore-1295"><span class="linenos">1295</span></a><span class="sd">        ----------</span>
</span><span id="SequenceAnnotationStore-1296"><a href="#SequenceAnnotationStore-1296"><span class="linenos">1296</span></a><span class="sd">        filename : str</span>
</span><span id="SequenceAnnotationStore-1297"><a href="#SequenceAnnotationStore-1297"><span class="linenos">1297</span></a><span class="sd">            path to an annotation file</span>
</span><span id="SequenceAnnotationStore-1298"><a href="#SequenceAnnotationStore-1298"><span class="linenos">1298</span></a>
</span><span id="SequenceAnnotationStore-1299"><a href="#SequenceAnnotationStore-1299"><span class="linenos">1299</span></a><span class="sd">        Returns</span>
</span><span id="SequenceAnnotationStore-1300"><a href="#SequenceAnnotationStore-1300"><span class="linenos">1300</span></a><span class="sd">        -------</span>
</span><span id="SequenceAnnotationStore-1301"><a href="#SequenceAnnotationStore-1301"><span class="linenos">1301</span></a><span class="sd">        times : dict</span>
</span><span id="SequenceAnnotationStore-1302"><a href="#SequenceAnnotationStore-1302"><span class="linenos">1302</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids,</span>
</span><span id="SequenceAnnotationStore-1303"><a href="#SequenceAnnotationStore-1303"><span class="linenos">1303</span></a><span class="sd">            third-level keys are categories and values are</span>
</span><span id="SequenceAnnotationStore-1304"><a href="#SequenceAnnotationStore-1304"><span class="linenos">1304</span></a><span class="sd">            lists of (start, end, ambiguity status) lists</span>
</span><span id="SequenceAnnotationStore-1305"><a href="#SequenceAnnotationStore-1305"><span class="linenos">1305</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>A generalized implementation of <code><a href="#ActionSegmentationStore">ActionSegmentationStore</a></code> for datasets where one file corresponds to multiple videos</p>
</div>


                            <div id="SequenceAnnotationStore.get_file_ids" class="classattr">
                                        <input id="SequenceAnnotationStore.get_file_ids-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_file_ids</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">filenames</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">annotation_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n">List</span>:</span></span>

                <label class="view-source-button" for="SequenceAnnotationStore.get_file_ids-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SequenceAnnotationStore.get_file_ids"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SequenceAnnotationStore.get_file_ids-1205"><a href="#SequenceAnnotationStore.get_file_ids-1205"><span class="linenos">1205</span></a>    <span class="nd">@classmethod</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1206"><a href="#SequenceAnnotationStore.get_file_ids-1206"><span class="linenos">1206</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1207"><a href="#SequenceAnnotationStore.get_file_ids-1207"><span class="linenos">1207</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1208"><a href="#SequenceAnnotationStore.get_file_ids-1208"><span class="linenos">1208</span></a>        <span class="n">filenames</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1209"><a href="#SequenceAnnotationStore.get_file_ids-1209"><span class="linenos">1209</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1210"><a href="#SequenceAnnotationStore.get_file_ids-1210"><span class="linenos">1210</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1211"><a href="#SequenceAnnotationStore.get_file_ids-1211"><span class="linenos">1211</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1212"><a href="#SequenceAnnotationStore.get_file_ids-1212"><span class="linenos">1212</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1213"><a href="#SequenceAnnotationStore.get_file_ids-1213"><span class="linenos">1213</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1214"><a href="#SequenceAnnotationStore.get_file_ids-1214"><span class="linenos">1214</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1215"><a href="#SequenceAnnotationStore.get_file_ids-1215"><span class="linenos">1215</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1216"><a href="#SequenceAnnotationStore.get_file_ids-1216"><span class="linenos">1216</span></a>
</span><span id="SequenceAnnotationStore.get_file_ids-1217"><a href="#SequenceAnnotationStore.get_file_ids-1217"><span class="linenos">1217</span></a><span class="sd">        Parameters</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1218"><a href="#SequenceAnnotationStore.get_file_ids-1218"><span class="linenos">1218</span></a><span class="sd">        ----------</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1219"><a href="#SequenceAnnotationStore.get_file_ids-1219"><span class="linenos">1219</span></a><span class="sd">        filenames : list, optional</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1220"><a href="#SequenceAnnotationStore.get_file_ids-1220"><span class="linenos">1220</span></a><span class="sd">            a list of annotation file paths</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1221"><a href="#SequenceAnnotationStore.get_file_ids-1221"><span class="linenos">1221</span></a><span class="sd">        annotation_path : str, optional</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1222"><a href="#SequenceAnnotationStore.get_file_ids-1222"><span class="linenos">1222</span></a><span class="sd">            path to the annotation folder</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1223"><a href="#SequenceAnnotationStore.get_file_ids-1223"><span class="linenos">1223</span></a>
</span><span id="SequenceAnnotationStore.get_file_ids-1224"><a href="#SequenceAnnotationStore.get_file_ids-1224"><span class="linenos">1224</span></a><span class="sd">        Returns</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1225"><a href="#SequenceAnnotationStore.get_file_ids-1225"><span class="linenos">1225</span></a><span class="sd">        -------</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1226"><a href="#SequenceAnnotationStore.get_file_ids-1226"><span class="linenos">1226</span></a><span class="sd">        video_ids : list</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1227"><a href="#SequenceAnnotationStore.get_file_ids-1227"><span class="linenos">1227</span></a><span class="sd">            a list of video file ids</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1228"><a href="#SequenceAnnotationStore.get_file_ids-1228"><span class="linenos">1228</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1229"><a href="#SequenceAnnotationStore.get_file_ids-1229"><span class="linenos">1229</span></a>
</span><span id="SequenceAnnotationStore.get_file_ids-1230"><a href="#SequenceAnnotationStore.get_file_ids-1230"><span class="linenos">1230</span></a>        <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1231"><a href="#SequenceAnnotationStore.get_file_ids-1231"><span class="linenos">1231</span></a>        <span class="k">if</span> <span class="n">annotation_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1232"><a href="#SequenceAnnotationStore.get_file_ids-1232"><span class="linenos">1232</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1233"><a href="#SequenceAnnotationStore.get_file_ids-1233"><span class="linenos">1233</span></a>                <span class="n">annotation_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">annotation_path</span><span class="p">]</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1234"><a href="#SequenceAnnotationStore.get_file_ids-1234"><span class="linenos">1234</span></a>            <span class="n">file_paths</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1235"><a href="#SequenceAnnotationStore.get_file_ids-1235"><span class="linenos">1235</span></a>            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">annotation_path</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1236"><a href="#SequenceAnnotationStore.get_file_ids-1236"><span class="linenos">1236</span></a>                <span class="n">file_paths</span> <span class="o">+=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)]</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1237"><a href="#SequenceAnnotationStore.get_file_ids-1237"><span class="linenos">1237</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1238"><a href="#SequenceAnnotationStore.get_file_ids-1238"><span class="linenos">1238</span></a>        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">file_paths</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1239"><a href="#SequenceAnnotationStore.get_file_ids-1239"><span class="linenos">1239</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1240"><a href="#SequenceAnnotationStore.get_file_ids-1240"><span class="linenos">1240</span></a>                <span class="n">ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1241"><a href="#SequenceAnnotationStore.get_file_ids-1241"><span class="linenos">1241</span></a>        <span class="n">ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
</span><span id="SequenceAnnotationStore.get_file_ids-1242"><a href="#SequenceAnnotationStore.get_file_ids-1242"><span class="linenos">1242</span></a>        <span class="k">return</span> <span class="n">ids</span>
</span></pre></div>


            <div class="docstring"><p>Process data parameters and return a list of ids  of the videos that should
be processed by the __init__ function</p>

<h2 id="parameters">Parameters</h2>

<p>filenames : list, optional
    a list of annotation file paths
annotation_path : str, optional
    path to the annotation folder</p>

<h2 id="returns">Returns</h2>

<p>video_ids : list
    a list of video file ids</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ActionSegmentationStore">ActionSegmentationStore</a></dt>
                                <dd id="SequenceAnnotationStore.__init__" class="function"><a href="#ActionSegmentationStore.__init__">ActionSegmentationStore</a></dd>
                <dd id="SequenceAnnotationStore.remove" class="function"><a href="#ActionSegmentationStore.remove">remove</a></dd>
                <dd id="SequenceAnnotationStore.key_objects" class="function"><a href="#ActionSegmentationStore.key_objects">key_objects</a></dd>
                <dd id="SequenceAnnotationStore.load_from_key_objects" class="function"><a href="#ActionSegmentationStore.load_from_key_objects">load_from_key_objects</a></dd>
                <dd id="SequenceAnnotationStore.to_ram" class="function"><a href="#ActionSegmentationStore.to_ram">to_ram</a></dd>
                <dd id="SequenceAnnotationStore.get_original_coordinates" class="function"><a href="#ActionSegmentationStore.get_original_coordinates">get_original_coordinates</a></dd>
                <dd id="SequenceAnnotationStore.create_subsample" class="function"><a href="#ActionSegmentationStore.create_subsample">create_subsample</a></dd>
                <dd id="SequenceAnnotationStore.get_len" class="function"><a href="#ActionSegmentationStore.get_len">get_len</a></dd>
                <dd id="SequenceAnnotationStore.get_indices" class="function"><a href="#ActionSegmentationStore.get_indices">get_indices</a></dd>
                <dd id="SequenceAnnotationStore.count_classes" class="function"><a href="#ActionSegmentationStore.count_classes">count_classes</a></dd>
                <dd id="SequenceAnnotationStore.behaviors_dict" class="function"><a href="#ActionSegmentationStore.behaviors_dict">behaviors_dict</a></dd>
                <dd id="SequenceAnnotationStore.annotation_class" class="function"><a href="#ActionSegmentationStore.annotation_class">annotation_class</a></dd>
                <dd id="SequenceAnnotationStore.size" class="function"><a href="#ActionSegmentationStore.size">size</a></dd>
                <dd id="SequenceAnnotationStore.filtered_indices" class="function"><a href="#ActionSegmentationStore.filtered_indices">filtered_indices</a></dd>
                <dd id="SequenceAnnotationStore.set_pseudo_labels" class="function"><a href="#ActionSegmentationStore.set_pseudo_labels">set_pseudo_labels</a></dd>

            </div>
            <div><dt><a href="base_store.html#AnnotationStore">dlc2action.data.base_store.AnnotationStore</a></dt>
                                <dd id="SequenceAnnotationStore.required_objects" class="variable"><a href="base_store.html#AnnotationStore.required_objects">required_objects</a></dd>

            </div>
            <div><dt><a href="base_store.html#Store">dlc2action.data.base_store.Store</a></dt>
                                <dd id="SequenceAnnotationStore.get_parameters" class="function"><a href="base_store.html#Store.get_parameters">get_parameters</a></dd>
                <dd id="SequenceAnnotationStore.new" class="function"><a href="base_store.html#Store.new">new</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DLCAnnotationStore">
                            <input id="DLCAnnotationStore-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DLCAnnotationStore</span><wbr>(<span class="base"><a href="#FileAnnotationStore">FileAnnotationStore</a></span>):

                <label class="view-source-button" for="DLCAnnotationStore-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DLCAnnotationStore"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DLCAnnotationStore-1308"><a href="#DLCAnnotationStore-1308"><span class="linenos">1308</span></a><span class="k">class</span> <span class="nc">DLCAnnotationStore</span><span class="p">(</span><span class="n">FileAnnotationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="DLCAnnotationStore-1309"><a href="#DLCAnnotationStore-1309"><span class="linenos">1309</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DLCAnnotationStore-1310"><a href="#DLCAnnotationStore-1310"><span class="linenos">1310</span></a><span class="sd">    DLC type annotation data</span>
</span><span id="DLCAnnotationStore-1311"><a href="#DLCAnnotationStore-1311"><span class="linenos">1311</span></a>
</span><span id="DLCAnnotationStore-1312"><a href="#DLCAnnotationStore-1312"><span class="linenos">1312</span></a><span class="sd">    The files are either the DLC2Action GUI output or a pickled dictionary of the following structure:</span>
</span><span id="DLCAnnotationStore-1313"><a href="#DLCAnnotationStore-1313"><span class="linenos">1313</span></a><span class="sd">        - nested dictionary,</span>
</span><span id="DLCAnnotationStore-1314"><a href="#DLCAnnotationStore-1314"><span class="linenos">1314</span></a><span class="sd">        - first-level keys are individual IDs,</span>
</span><span id="DLCAnnotationStore-1315"><a href="#DLCAnnotationStore-1315"><span class="linenos">1315</span></a><span class="sd">        - second-level keys are labels,</span>
</span><span id="DLCAnnotationStore-1316"><a href="#DLCAnnotationStore-1316"><span class="linenos">1316</span></a><span class="sd">        - values are lists of intervals,</span>
</span><span id="DLCAnnotationStore-1317"><a href="#DLCAnnotationStore-1317"><span class="linenos">1317</span></a><span class="sd">        - the lists of intervals is formatted as `[start_frame, end_frame, ambiguity]`,</span>
</span><span id="DLCAnnotationStore-1318"><a href="#DLCAnnotationStore-1318"><span class="linenos">1318</span></a><span class="sd">        - ambiguity is 1 if the action is ambiguous (!!at the moment DLC2Action will IGNORE those intervals!!) or 0 if it isn&#39;t.</span>
</span><span id="DLCAnnotationStore-1319"><a href="#DLCAnnotationStore-1319"><span class="linenos">1319</span></a>
</span><span id="DLCAnnotationStore-1320"><a href="#DLCAnnotationStore-1320"><span class="linenos">1320</span></a><span class="sd">    A minimum working example of such a dictionary is:</span>
</span><span id="DLCAnnotationStore-1321"><a href="#DLCAnnotationStore-1321"><span class="linenos">1321</span></a><span class="sd">    ```</span>
</span><span id="DLCAnnotationStore-1322"><a href="#DLCAnnotationStore-1322"><span class="linenos">1322</span></a><span class="sd">    {</span>
</span><span id="DLCAnnotationStore-1323"><a href="#DLCAnnotationStore-1323"><span class="linenos">1323</span></a><span class="sd">        &quot;ind0&quot;: {},</span>
</span><span id="DLCAnnotationStore-1324"><a href="#DLCAnnotationStore-1324"><span class="linenos">1324</span></a><span class="sd">        &quot;ind1&quot;: {</span>
</span><span id="DLCAnnotationStore-1325"><a href="#DLCAnnotationStore-1325"><span class="linenos">1325</span></a><span class="sd">            &quot;running&quot;: [60, 70, 0]],</span>
</span><span id="DLCAnnotationStore-1326"><a href="#DLCAnnotationStore-1326"><span class="linenos">1326</span></a><span class="sd">            &quot;eating&quot;: []</span>
</span><span id="DLCAnnotationStore-1327"><a href="#DLCAnnotationStore-1327"><span class="linenos">1327</span></a><span class="sd">        }</span>
</span><span id="DLCAnnotationStore-1328"><a href="#DLCAnnotationStore-1328"><span class="linenos">1328</span></a><span class="sd">    }</span>
</span><span id="DLCAnnotationStore-1329"><a href="#DLCAnnotationStore-1329"><span class="linenos">1329</span></a><span class="sd">    ```</span>
</span><span id="DLCAnnotationStore-1330"><a href="#DLCAnnotationStore-1330"><span class="linenos">1330</span></a>
</span><span id="DLCAnnotationStore-1331"><a href="#DLCAnnotationStore-1331"><span class="linenos">1331</span></a><span class="sd">    Here there are two animals: `&quot;ind0&quot;` and `&quot;ind1&quot;`, and two actions: running and eating.</span>
</span><span id="DLCAnnotationStore-1332"><a href="#DLCAnnotationStore-1332"><span class="linenos">1332</span></a><span class="sd">    The only annotated action is eating for `&quot;ind1&quot;` between frames 60 and 70.</span>
</span><span id="DLCAnnotationStore-1333"><a href="#DLCAnnotationStore-1333"><span class="linenos">1333</span></a>
</span><span id="DLCAnnotationStore-1334"><a href="#DLCAnnotationStore-1334"><span class="linenos">1334</span></a><span class="sd">    If you generate those files manually, run this code for a sanity check:</span>
</span><span id="DLCAnnotationStore-1335"><a href="#DLCAnnotationStore-1335"><span class="linenos">1335</span></a><span class="sd">    ```</span>
</span><span id="DLCAnnotationStore-1336"><a href="#DLCAnnotationStore-1336"><span class="linenos">1336</span></a><span class="sd">    import pickle</span>
</span><span id="DLCAnnotationStore-1337"><a href="#DLCAnnotationStore-1337"><span class="linenos">1337</span></a>
</span><span id="DLCAnnotationStore-1338"><a href="#DLCAnnotationStore-1338"><span class="linenos">1338</span></a><span class="sd">    with open(&quot;/path/to/annotation.pickle&quot;, &quot;rb&quot;) as f:</span>
</span><span id="DLCAnnotationStore-1339"><a href="#DLCAnnotationStore-1339"><span class="linenos">1339</span></a><span class="sd">    data = pickle.load(f)</span>
</span><span id="DLCAnnotationStore-1340"><a href="#DLCAnnotationStore-1340"><span class="linenos">1340</span></a>
</span><span id="DLCAnnotationStore-1341"><a href="#DLCAnnotationStore-1341"><span class="linenos">1341</span></a><span class="sd">    for ind, ind_dict in data.items():</span>
</span><span id="DLCAnnotationStore-1342"><a href="#DLCAnnotationStore-1342"><span class="linenos">1342</span></a><span class="sd">        print(f&#39;individual {ind}:&#39;)</span>
</span><span id="DLCAnnotationStore-1343"><a href="#DLCAnnotationStore-1343"><span class="linenos">1343</span></a><span class="sd">        for label, intervals in ind_dict.items():</span>
</span><span id="DLCAnnotationStore-1344"><a href="#DLCAnnotationStore-1344"><span class="linenos">1344</span></a><span class="sd">            for start, end, ambiguity in intervals:</span>
</span><span id="DLCAnnotationStore-1345"><a href="#DLCAnnotationStore-1345"><span class="linenos">1345</span></a><span class="sd">                if ambiguity == 0:</span>
</span><span id="DLCAnnotationStore-1346"><a href="#DLCAnnotationStore-1346"><span class="linenos">1346</span></a><span class="sd">                    print(f&#39;  from {start} to {end} frame: {label}&#39;)</span>
</span><span id="DLCAnnotationStore-1347"><a href="#DLCAnnotationStore-1347"><span class="linenos">1347</span></a><span class="sd">    ```</span>
</span><span id="DLCAnnotationStore-1348"><a href="#DLCAnnotationStore-1348"><span class="linenos">1348</span></a>
</span><span id="DLCAnnotationStore-1349"><a href="#DLCAnnotationStore-1349"><span class="linenos">1349</span></a><span class="sd">    Assumes the following file structure:</span>
</span><span id="DLCAnnotationStore-1350"><a href="#DLCAnnotationStore-1350"><span class="linenos">1350</span></a><span class="sd">    ```</span>
</span><span id="DLCAnnotationStore-1351"><a href="#DLCAnnotationStore-1351"><span class="linenos">1351</span></a><span class="sd">    annotation_path</span>
</span><span id="DLCAnnotationStore-1352"><a href="#DLCAnnotationStore-1352"><span class="linenos">1352</span></a><span class="sd">     video1_annotation.pickle</span>
</span><span id="DLCAnnotationStore-1353"><a href="#DLCAnnotationStore-1353"><span class="linenos">1353</span></a><span class="sd">     video2_labels.pickle</span>
</span><span id="DLCAnnotationStore-1354"><a href="#DLCAnnotationStore-1354"><span class="linenos">1354</span></a><span class="sd">    ```</span>
</span><span id="DLCAnnotationStore-1355"><a href="#DLCAnnotationStore-1355"><span class="linenos">1355</span></a><span class="sd">    Here `annotation_suffix` is `{&#39;_annotation.pickle&#39;, &#39;_labels.pickle&#39;}`.</span>
</span><span id="DLCAnnotationStore-1356"><a href="#DLCAnnotationStore-1356"><span class="linenos">1356</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DLCAnnotationStore-1357"><a href="#DLCAnnotationStore-1357"><span class="linenos">1357</span></a>
</span><span id="DLCAnnotationStore-1358"><a href="#DLCAnnotationStore-1358"><span class="linenos">1358</span></a>    <span class="k">def</span> <span class="nf">_open_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="DLCAnnotationStore-1359"><a href="#DLCAnnotationStore-1359"><span class="linenos">1359</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="DLCAnnotationStore-1360"><a href="#DLCAnnotationStore-1360"><span class="linenos">1360</span></a><span class="sd">        Load the annotation from `filename`</span>
</span><span id="DLCAnnotationStore-1361"><a href="#DLCAnnotationStore-1361"><span class="linenos">1361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DLCAnnotationStore-1362"><a href="#DLCAnnotationStore-1362"><span class="linenos">1362</span></a>
</span><span id="DLCAnnotationStore-1363"><a href="#DLCAnnotationStore-1363"><span class="linenos">1363</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DLCAnnotationStore-1364"><a href="#DLCAnnotationStore-1364"><span class="linenos">1364</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="DLCAnnotationStore-1365"><a href="#DLCAnnotationStore-1365"><span class="linenos">1365</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="DLCAnnotationStore-1366"><a href="#DLCAnnotationStore-1366"><span class="linenos">1366</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DLCAnnotationStore-1367"><a href="#DLCAnnotationStore-1367"><span class="linenos">1367</span></a>                <span class="n">annotation</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="DLCAnnotationStore-1368"><a href="#DLCAnnotationStore-1368"><span class="linenos">1368</span></a>                <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">annotation</span><span class="p">:</span>
</span><span id="DLCAnnotationStore-1369"><a href="#DLCAnnotationStore-1369"><span class="linenos">1369</span></a>                    <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">cat_list</span> <span class="ow">in</span> <span class="n">annotation</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DLCAnnotationStore-1370"><a href="#DLCAnnotationStore-1370"><span class="linenos">1370</span></a>                        <span class="n">annotation</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DLCAnnotationStore-1371"><a href="#DLCAnnotationStore-1371"><span class="linenos">1371</span></a>                            <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">cat_list</span>
</span><span id="DLCAnnotationStore-1372"><a href="#DLCAnnotationStore-1372"><span class="linenos">1372</span></a>                        <span class="p">]</span>
</span><span id="DLCAnnotationStore-1373"><a href="#DLCAnnotationStore-1373"><span class="linenos">1373</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DLCAnnotationStore-1374"><a href="#DLCAnnotationStore-1374"><span class="linenos">1374</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">loaded_labels</span><span class="p">,</span> <span class="n">animals</span><span class="p">,</span> <span class="n">loaded_times</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="DLCAnnotationStore-1375"><a href="#DLCAnnotationStore-1375"><span class="linenos">1375</span></a>                <span class="n">annotation</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DLCAnnotationStore-1376"><a href="#DLCAnnotationStore-1376"><span class="linenos">1376</span></a>                <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">ind_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">animals</span><span class="p">,</span> <span class="n">loaded_times</span><span class="p">):</span>
</span><span id="DLCAnnotationStore-1377"><a href="#DLCAnnotationStore-1377"><span class="linenos">1377</span></a>                    <span class="n">annotation</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DLCAnnotationStore-1378"><a href="#DLCAnnotationStore-1378"><span class="linenos">1378</span></a>                    <span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">cat_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">loaded_labels</span><span class="p">,</span> <span class="n">ind_list</span><span class="p">):</span>
</span><span id="DLCAnnotationStore-1379"><a href="#DLCAnnotationStore-1379"><span class="linenos">1379</span></a>                        <span class="n">annotation</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="n">cat_list</span>
</span><span id="DLCAnnotationStore-1380"><a href="#DLCAnnotationStore-1380"><span class="linenos">1380</span></a>            <span class="k">return</span> <span class="n">annotation</span>
</span><span id="DLCAnnotationStore-1381"><a href="#DLCAnnotationStore-1381"><span class="linenos">1381</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="DLCAnnotationStore-1382"><a href="#DLCAnnotationStore-1382"><span class="linenos">1382</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> is invalid or does not exist&quot;</span><span class="p">)</span>
</span><span id="DLCAnnotationStore-1383"><a href="#DLCAnnotationStore-1383"><span class="linenos">1383</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>DLC type annotation data</p>

<p>The files are either the DLC2Action GUI output or a pickled dictionary of the following structure:
    - nested dictionary,
    - first-level keys are individual IDs,
    - second-level keys are labels,
    - values are lists of intervals,
    - the lists of intervals is formatted as <code>[start_frame, end_frame, ambiguity]</code>,
    - ambiguity is 1 if the action is ambiguous (!!at the moment DLC2Action will IGNORE those intervals!!) or 0 if it isn't.</p>

<p>A minimum working example of such a dictionary is:</p>

<pre><code>{
    "ind0": {},
    "ind1": {
        "running": [60, 70, 0]],
        "eating": []
    }
}
</code></pre>

<p>Here there are two animals: <code>"ind0"</code> and <code>"ind1"</code>, and two actions: running and eating.
The only annotated action is eating for <code>"ind1"</code> between frames 60 and 70.</p>

<p>If you generate those files manually, run this code for a sanity check:</p>

<pre><code>import pickle

with open("/path/to/annotation.pickle", "rb") as f:
data = pickle.load(f)

for ind, ind_dict in data.items():
    print(f'individual {ind}:')
    for label, intervals in ind_dict.items():
        for start, end, ambiguity in intervals:
            if ambiguity == 0:
                print(f'  from {start} to {end} frame: {label}')
</code></pre>

<p>Assumes the following file structure:</p>

<pre><code>annotation_path
 video1_annotation.pickle
 video2_labels.pickle
</code></pre>

<p>Here <code>annotation_suffix</code> is <code>{'_annotation.pickle', '_labels.pickle'}</code>.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ActionSegmentationStore">ActionSegmentationStore</a></dt>
                                <dd id="DLCAnnotationStore.__init__" class="function"><a href="#ActionSegmentationStore.__init__">ActionSegmentationStore</a></dd>
                <dd id="DLCAnnotationStore.remove" class="function"><a href="#ActionSegmentationStore.remove">remove</a></dd>
                <dd id="DLCAnnotationStore.key_objects" class="function"><a href="#ActionSegmentationStore.key_objects">key_objects</a></dd>
                <dd id="DLCAnnotationStore.load_from_key_objects" class="function"><a href="#ActionSegmentationStore.load_from_key_objects">load_from_key_objects</a></dd>
                <dd id="DLCAnnotationStore.to_ram" class="function"><a href="#ActionSegmentationStore.to_ram">to_ram</a></dd>
                <dd id="DLCAnnotationStore.get_original_coordinates" class="function"><a href="#ActionSegmentationStore.get_original_coordinates">get_original_coordinates</a></dd>
                <dd id="DLCAnnotationStore.create_subsample" class="function"><a href="#ActionSegmentationStore.create_subsample">create_subsample</a></dd>
                <dd id="DLCAnnotationStore.get_len" class="function"><a href="#ActionSegmentationStore.get_len">get_len</a></dd>
                <dd id="DLCAnnotationStore.get_indices" class="function"><a href="#ActionSegmentationStore.get_indices">get_indices</a></dd>
                <dd id="DLCAnnotationStore.count_classes" class="function"><a href="#ActionSegmentationStore.count_classes">count_classes</a></dd>
                <dd id="DLCAnnotationStore.behaviors_dict" class="function"><a href="#ActionSegmentationStore.behaviors_dict">behaviors_dict</a></dd>
                <dd id="DLCAnnotationStore.annotation_class" class="function"><a href="#ActionSegmentationStore.annotation_class">annotation_class</a></dd>
                <dd id="DLCAnnotationStore.size" class="function"><a href="#ActionSegmentationStore.size">size</a></dd>
                <dd id="DLCAnnotationStore.filtered_indices" class="function"><a href="#ActionSegmentationStore.filtered_indices">filtered_indices</a></dd>
                <dd id="DLCAnnotationStore.set_pseudo_labels" class="function"><a href="#ActionSegmentationStore.set_pseudo_labels">set_pseudo_labels</a></dd>
                <dd id="DLCAnnotationStore.get_file_ids" class="function"><a href="#ActionSegmentationStore.get_file_ids">get_file_ids</a></dd>

            </div>
            <div><dt><a href="base_store.html#AnnotationStore">dlc2action.data.base_store.AnnotationStore</a></dt>
                                <dd id="DLCAnnotationStore.required_objects" class="variable"><a href="base_store.html#AnnotationStore.required_objects">required_objects</a></dd>

            </div>
            <div><dt><a href="base_store.html#Store">dlc2action.data.base_store.Store</a></dt>
                                <dd id="DLCAnnotationStore.get_parameters" class="function"><a href="base_store.html#Store.get_parameters">get_parameters</a></dd>
                <dd id="DLCAnnotationStore.new" class="function"><a href="base_store.html#Store.new">new</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="BorisAnnotationStore">
                            <input id="BorisAnnotationStore-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BorisAnnotationStore</span><wbr>(<span class="base"><a href="#FileAnnotationStore">FileAnnotationStore</a></span>):

                <label class="view-source-button" for="BorisAnnotationStore-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BorisAnnotationStore"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BorisAnnotationStore-1386"><a href="#BorisAnnotationStore-1386"><span class="linenos">1386</span></a><span class="k">class</span> <span class="nc">BorisAnnotationStore</span><span class="p">(</span><span class="n">FileAnnotationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="BorisAnnotationStore-1387"><a href="#BorisAnnotationStore-1387"><span class="linenos">1387</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="BorisAnnotationStore-1388"><a href="#BorisAnnotationStore-1388"><span class="linenos">1388</span></a><span class="sd">    BORIS type annotation data</span>
</span><span id="BorisAnnotationStore-1389"><a href="#BorisAnnotationStore-1389"><span class="linenos">1389</span></a>
</span><span id="BorisAnnotationStore-1390"><a href="#BorisAnnotationStore-1390"><span class="linenos">1390</span></a><span class="sd">    Assumes the following file structure:</span>
</span><span id="BorisAnnotationStore-1391"><a href="#BorisAnnotationStore-1391"><span class="linenos">1391</span></a><span class="sd">    ```</span>
</span><span id="BorisAnnotationStore-1392"><a href="#BorisAnnotationStore-1392"><span class="linenos">1392</span></a><span class="sd">    annotation_path</span>
</span><span id="BorisAnnotationStore-1393"><a href="#BorisAnnotationStore-1393"><span class="linenos">1393</span></a><span class="sd">     video1_annotation.pickle</span>
</span><span id="BorisAnnotationStore-1394"><a href="#BorisAnnotationStore-1394"><span class="linenos">1394</span></a><span class="sd">     video2_labels.pickle</span>
</span><span id="BorisAnnotationStore-1395"><a href="#BorisAnnotationStore-1395"><span class="linenos">1395</span></a><span class="sd">    ```</span>
</span><span id="BorisAnnotationStore-1396"><a href="#BorisAnnotationStore-1396"><span class="linenos">1396</span></a><span class="sd">    Here `annotation_suffix` is `{&#39;_annotation.pickle&#39;, &#39;_labels.pickle&#39;}`.</span>
</span><span id="BorisAnnotationStore-1397"><a href="#BorisAnnotationStore-1397"><span class="linenos">1397</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="BorisAnnotationStore-1398"><a href="#BorisAnnotationStore-1398"><span class="linenos">1398</span></a>
</span><span id="BorisAnnotationStore-1399"><a href="#BorisAnnotationStore-1399"><span class="linenos">1399</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="BorisAnnotationStore-1400"><a href="#BorisAnnotationStore-1400"><span class="linenos">1400</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1401"><a href="#BorisAnnotationStore-1401"><span class="linenos">1401</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1402"><a href="#BorisAnnotationStore-1402"><span class="linenos">1402</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1403"><a href="#BorisAnnotationStore-1403"><span class="linenos">1403</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1404"><a href="#BorisAnnotationStore-1404"><span class="linenos">1404</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1405"><a href="#BorisAnnotationStore-1405"><span class="linenos">1405</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1406"><a href="#BorisAnnotationStore-1406"><span class="linenos">1406</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1407"><a href="#BorisAnnotationStore-1407"><span class="linenos">1407</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1408"><a href="#BorisAnnotationStore-1408"><span class="linenos">1408</span></a>        <span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1409"><a href="#BorisAnnotationStore-1409"><span class="linenos">1409</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1410"><a href="#BorisAnnotationStore-1410"><span class="linenos">1410</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1411"><a href="#BorisAnnotationStore-1411"><span class="linenos">1411</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1412"><a href="#BorisAnnotationStore-1412"><span class="linenos">1412</span></a>        <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1413"><a href="#BorisAnnotationStore-1413"><span class="linenos">1413</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1414"><a href="#BorisAnnotationStore-1414"><span class="linenos">1414</span></a>        <span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1415"><a href="#BorisAnnotationStore-1415"><span class="linenos">1415</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1416"><a href="#BorisAnnotationStore-1416"><span class="linenos">1416</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1417"><a href="#BorisAnnotationStore-1417"><span class="linenos">1417</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1418"><a href="#BorisAnnotationStore-1418"><span class="linenos">1418</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1419"><a href="#BorisAnnotationStore-1419"><span class="linenos">1419</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1420"><a href="#BorisAnnotationStore-1420"><span class="linenos">1420</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1421"><a href="#BorisAnnotationStore-1421"><span class="linenos">1421</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1422"><a href="#BorisAnnotationStore-1422"><span class="linenos">1422</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1423"><a href="#BorisAnnotationStore-1423"><span class="linenos">1423</span></a>        <span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1424"><a href="#BorisAnnotationStore-1424"><span class="linenos">1424</span></a>        <span class="n">default_agent_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ind0&quot;</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1425"><a href="#BorisAnnotationStore-1425"><span class="linenos">1425</span></a>        <span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1426"><a href="#BorisAnnotationStore-1426"><span class="linenos">1426</span></a>        <span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1427"><a href="#BorisAnnotationStore-1427"><span class="linenos">1427</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1428"><a href="#BorisAnnotationStore-1428"><span class="linenos">1428</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1429"><a href="#BorisAnnotationStore-1429"><span class="linenos">1429</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BorisAnnotationStore-1430"><a href="#BorisAnnotationStore-1430"><span class="linenos">1430</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="BorisAnnotationStore-1431"><a href="#BorisAnnotationStore-1431"><span class="linenos">1431</span></a><span class="sd">        Parameters</span>
</span><span id="BorisAnnotationStore-1432"><a href="#BorisAnnotationStore-1432"><span class="linenos">1432</span></a><span class="sd">        ----------</span>
</span><span id="BorisAnnotationStore-1433"><a href="#BorisAnnotationStore-1433"><span class="linenos">1433</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="BorisAnnotationStore-1434"><a href="#BorisAnnotationStore-1434"><span class="linenos">1434</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="BorisAnnotationStore-1435"><a href="#BorisAnnotationStore-1435"><span class="linenos">1435</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="BorisAnnotationStore-1436"><a href="#BorisAnnotationStore-1436"><span class="linenos">1436</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="BorisAnnotationStore-1437"><a href="#BorisAnnotationStore-1437"><span class="linenos">1437</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="BorisAnnotationStore-1438"><a href="#BorisAnnotationStore-1438"><span class="linenos">1438</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="BorisAnnotationStore-1439"><a href="#BorisAnnotationStore-1439"><span class="linenos">1439</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="BorisAnnotationStore-1440"><a href="#BorisAnnotationStore-1440"><span class="linenos">1440</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="BorisAnnotationStore-1441"><a href="#BorisAnnotationStore-1441"><span class="linenos">1441</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="BorisAnnotationStore-1442"><a href="#BorisAnnotationStore-1442"><span class="linenos">1442</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="BorisAnnotationStore-1443"><a href="#BorisAnnotationStore-1443"><span class="linenos">1443</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="BorisAnnotationStore-1444"><a href="#BorisAnnotationStore-1444"><span class="linenos">1444</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="BorisAnnotationStore-1445"><a href="#BorisAnnotationStore-1445"><span class="linenos">1445</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="BorisAnnotationStore-1446"><a href="#BorisAnnotationStore-1446"><span class="linenos">1446</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="BorisAnnotationStore-1447"><a href="#BorisAnnotationStore-1447"><span class="linenos">1447</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="BorisAnnotationStore-1448"><a href="#BorisAnnotationStore-1448"><span class="linenos">1448</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="BorisAnnotationStore-1449"><a href="#BorisAnnotationStore-1449"><span class="linenos">1449</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="BorisAnnotationStore-1450"><a href="#BorisAnnotationStore-1450"><span class="linenos">1450</span></a><span class="sd">        behaviors : set, optional</span>
</span><span id="BorisAnnotationStore-1451"><a href="#BorisAnnotationStore-1451"><span class="linenos">1451</span></a><span class="sd">            the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are</span>
</span><span id="BorisAnnotationStore-1452"><a href="#BorisAnnotationStore-1452"><span class="linenos">1452</span></a><span class="sd">            loaded from a file)</span>
</span><span id="BorisAnnotationStore-1453"><a href="#BorisAnnotationStore-1453"><span class="linenos">1453</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="BorisAnnotationStore-1454"><a href="#BorisAnnotationStore-1454"><span class="linenos">1454</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="BorisAnnotationStore-1455"><a href="#BorisAnnotationStore-1455"><span class="linenos">1455</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="BorisAnnotationStore-1456"><a href="#BorisAnnotationStore-1456"><span class="linenos">1456</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="BorisAnnotationStore-1457"><a href="#BorisAnnotationStore-1457"><span class="linenos">1457</span></a><span class="sd">            (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="BorisAnnotationStore-1458"><a href="#BorisAnnotationStore-1458"><span class="linenos">1458</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="BorisAnnotationStore-1459"><a href="#BorisAnnotationStore-1459"><span class="linenos">1459</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="BorisAnnotationStore-1460"><a href="#BorisAnnotationStore-1460"><span class="linenos">1460</span></a><span class="sd">            from key objects)</span>
</span><span id="BorisAnnotationStore-1461"><a href="#BorisAnnotationStore-1461"><span class="linenos">1461</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="BorisAnnotationStore-1462"><a href="#BorisAnnotationStore-1462"><span class="linenos">1462</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="BorisAnnotationStore-1463"><a href="#BorisAnnotationStore-1463"><span class="linenos">1463</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="BorisAnnotationStore-1464"><a href="#BorisAnnotationStore-1464"><span class="linenos">1464</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="BorisAnnotationStore-1465"><a href="#BorisAnnotationStore-1465"><span class="linenos">1465</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="BorisAnnotationStore-1466"><a href="#BorisAnnotationStore-1466"><span class="linenos">1466</span></a><span class="sd">        frame_limit : int, default 0</span>
</span><span id="BorisAnnotationStore-1467"><a href="#BorisAnnotationStore-1467"><span class="linenos">1467</span></a><span class="sd">            the smallest possible length of a clip (shorter clips are discarded)</span>
</span><span id="BorisAnnotationStore-1468"><a href="#BorisAnnotationStore-1468"><span class="linenos">1468</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="BorisAnnotationStore-1469"><a href="#BorisAnnotationStore-1469"><span class="linenos">1469</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="BorisAnnotationStore-1470"><a href="#BorisAnnotationStore-1470"><span class="linenos">1470</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="BorisAnnotationStore-1471"><a href="#BorisAnnotationStore-1471"><span class="linenos">1471</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="BorisAnnotationStore-1472"><a href="#BorisAnnotationStore-1472"><span class="linenos">1472</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="BorisAnnotationStore-1473"><a href="#BorisAnnotationStore-1473"><span class="linenos">1473</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="BorisAnnotationStore-1474"><a href="#BorisAnnotationStore-1474"><span class="linenos">1474</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="BorisAnnotationStore-1475"><a href="#BorisAnnotationStore-1475"><span class="linenos">1475</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="BorisAnnotationStore-1476"><a href="#BorisAnnotationStore-1476"><span class="linenos">1476</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="BorisAnnotationStore-1477"><a href="#BorisAnnotationStore-1477"><span class="linenos">1477</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="BorisAnnotationStore-1478"><a href="#BorisAnnotationStore-1478"><span class="linenos">1478</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="BorisAnnotationStore-1479"><a href="#BorisAnnotationStore-1479"><span class="linenos">1479</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="BorisAnnotationStore-1480"><a href="#BorisAnnotationStore-1480"><span class="linenos">1480</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="BorisAnnotationStore-1481"><a href="#BorisAnnotationStore-1481"><span class="linenos">1481</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="BorisAnnotationStore-1482"><a href="#BorisAnnotationStore-1482"><span class="linenos">1482</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="BorisAnnotationStore-1483"><a href="#BorisAnnotationStore-1483"><span class="linenos">1483</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="BorisAnnotationStore-1484"><a href="#BorisAnnotationStore-1484"><span class="linenos">1484</span></a><span class="sd">        use_hard_negatives : bool, default False</span>
</span><span id="BorisAnnotationStore-1485"><a href="#BorisAnnotationStore-1485"><span class="linenos">1485</span></a><span class="sd">            mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing</span>
</span><span id="BorisAnnotationStore-1486"><a href="#BorisAnnotationStore-1486"><span class="linenos">1486</span></a><span class="sd">        interactive : bool, default False</span>
</span><span id="BorisAnnotationStore-1487"><a href="#BorisAnnotationStore-1487"><span class="linenos">1487</span></a><span class="sd">            if `True`, annotation is assigned to pairs of individuals</span>
</span><span id="BorisAnnotationStore-1488"><a href="#BorisAnnotationStore-1488"><span class="linenos">1488</span></a><span class="sd">        ignored_clips : set, optional</span>
</span><span id="BorisAnnotationStore-1489"><a href="#BorisAnnotationStore-1489"><span class="linenos">1489</span></a><span class="sd">            a set of clip ids to ignore</span>
</span><span id="BorisAnnotationStore-1490"><a href="#BorisAnnotationStore-1490"><span class="linenos">1490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BorisAnnotationStore-1491"><a href="#BorisAnnotationStore-1491"><span class="linenos">1491</span></a>
</span><span id="BorisAnnotationStore-1492"><a href="#BorisAnnotationStore-1492"><span class="linenos">1492</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_agent_name</span> <span class="o">=</span> <span class="n">default_agent_name</span>
</span><span id="BorisAnnotationStore-1493"><a href="#BorisAnnotationStore-1493"><span class="linenos">1493</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="BorisAnnotationStore-1494"><a href="#BorisAnnotationStore-1494"><span class="linenos">1494</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1495"><a href="#BorisAnnotationStore-1495"><span class="linenos">1495</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1496"><a href="#BorisAnnotationStore-1496"><span class="linenos">1496</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1497"><a href="#BorisAnnotationStore-1497"><span class="linenos">1497</span></a>            <span class="n">visibility</span><span class="o">=</span><span class="n">visibility</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1498"><a href="#BorisAnnotationStore-1498"><span class="linenos">1498</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1499"><a href="#BorisAnnotationStore-1499"><span class="linenos">1499</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1500"><a href="#BorisAnnotationStore-1500"><span class="linenos">1500</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1501"><a href="#BorisAnnotationStore-1501"><span class="linenos">1501</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1502"><a href="#BorisAnnotationStore-1502"><span class="linenos">1502</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1503"><a href="#BorisAnnotationStore-1503"><span class="linenos">1503</span></a>            <span class="n">annotation_suffix</span><span class="o">=</span><span class="n">annotation_suffix</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1504"><a href="#BorisAnnotationStore-1504"><span class="linenos">1504</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1505"><a href="#BorisAnnotationStore-1505"><span class="linenos">1505</span></a>            <span class="n">behavior_file</span><span class="o">=</span><span class="n">behavior_file</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1506"><a href="#BorisAnnotationStore-1506"><span class="linenos">1506</span></a>            <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1507"><a href="#BorisAnnotationStore-1507"><span class="linenos">1507</span></a>            <span class="n">frame_limit</span><span class="o">=</span><span class="n">frame_limit</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1508"><a href="#BorisAnnotationStore-1508"><span class="linenos">1508</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="n">filter_annotated</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1509"><a href="#BorisAnnotationStore-1509"><span class="linenos">1509</span></a>            <span class="n">filter_background</span><span class="o">=</span><span class="n">filter_background</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1510"><a href="#BorisAnnotationStore-1510"><span class="linenos">1510</span></a>            <span class="n">error_class</span><span class="o">=</span><span class="n">error_class</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1511"><a href="#BorisAnnotationStore-1511"><span class="linenos">1511</span></a>            <span class="n">min_frames_action</span><span class="o">=</span><span class="n">min_frames_action</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1512"><a href="#BorisAnnotationStore-1512"><span class="linenos">1512</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1513"><a href="#BorisAnnotationStore-1513"><span class="linenos">1513</span></a>            <span class="n">visibility_min_score</span><span class="o">=</span><span class="n">visibility_min_score</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1514"><a href="#BorisAnnotationStore-1514"><span class="linenos">1514</span></a>            <span class="n">visibility_min_frac</span><span class="o">=</span><span class="n">visibility_min_frac</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1515"><a href="#BorisAnnotationStore-1515"><span class="linenos">1515</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1516"><a href="#BorisAnnotationStore-1516"><span class="linenos">1516</span></a>            <span class="n">use_hard_negatives</span><span class="o">=</span><span class="n">use_hard_negatives</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1517"><a href="#BorisAnnotationStore-1517"><span class="linenos">1517</span></a>            <span class="n">interactive</span><span class="o">=</span><span class="n">interactive</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1518"><a href="#BorisAnnotationStore-1518"><span class="linenos">1518</span></a>            <span class="n">ignored_clips</span><span class="o">=</span><span class="n">ignored_clips</span><span class="p">,</span>
</span><span id="BorisAnnotationStore-1519"><a href="#BorisAnnotationStore-1519"><span class="linenos">1519</span></a>        <span class="p">)</span>
</span><span id="BorisAnnotationStore-1520"><a href="#BorisAnnotationStore-1520"><span class="linenos">1520</span></a>
</span><span id="BorisAnnotationStore-1521"><a href="#BorisAnnotationStore-1521"><span class="linenos">1521</span></a>    <span class="k">def</span> <span class="nf">_open_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="BorisAnnotationStore-1522"><a href="#BorisAnnotationStore-1522"><span class="linenos">1522</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="BorisAnnotationStore-1523"><a href="#BorisAnnotationStore-1523"><span class="linenos">1523</span></a><span class="sd">        Load the annotation from filename</span>
</span><span id="BorisAnnotationStore-1524"><a href="#BorisAnnotationStore-1524"><span class="linenos">1524</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BorisAnnotationStore-1525"><a href="#BorisAnnotationStore-1525"><span class="linenos">1525</span></a>
</span><span id="BorisAnnotationStore-1526"><a href="#BorisAnnotationStore-1526"><span class="linenos">1526</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="BorisAnnotationStore-1527"><a href="#BorisAnnotationStore-1527"><span class="linenos">1527</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</span><span id="BorisAnnotationStore-1528"><a href="#BorisAnnotationStore-1528"><span class="linenos">1528</span></a>            <span class="n">fps</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;FPS&quot;</span><span class="p">]</span>
</span><span id="BorisAnnotationStore-1529"><a href="#BorisAnnotationStore-1529"><span class="linenos">1529</span></a>            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_agent_name</span><span class="p">)</span>
</span><span id="BorisAnnotationStore-1530"><a href="#BorisAnnotationStore-1530"><span class="linenos">1530</span></a>            <span class="n">loaded_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Behavior&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span><span id="BorisAnnotationStore-1531"><a href="#BorisAnnotationStore-1531"><span class="linenos">1531</span></a>            <span class="n">animals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</span><span id="BorisAnnotationStore-1532"><a href="#BorisAnnotationStore-1532"><span class="linenos">1532</span></a>            <span class="n">loaded_times</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="BorisAnnotationStore-1533"><a href="#BorisAnnotationStore-1533"><span class="linenos">1533</span></a>            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">animals</span><span class="p">:</span>
</span><span id="BorisAnnotationStore-1534"><a href="#BorisAnnotationStore-1534"><span class="linenos">1534</span></a>                <span class="n">loaded_times</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="BorisAnnotationStore-1535"><a href="#BorisAnnotationStore-1535"><span class="linenos">1535</span></a>                <span class="n">agent_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Subject&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ind</span><span class="p">]</span>
</span><span id="BorisAnnotationStore-1536"><a href="#BorisAnnotationStore-1536"><span class="linenos">1536</span></a>                <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">loaded_labels</span><span class="p">:</span>
</span><span id="BorisAnnotationStore-1537"><a href="#BorisAnnotationStore-1537"><span class="linenos">1537</span></a>                    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">agent_df</span><span class="p">[</span><span class="n">agent_df</span><span class="p">[</span><span class="s2">&quot;Behavior&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">cat</span><span class="p">]</span>
</span><span id="BorisAnnotationStore-1538"><a href="#BorisAnnotationStore-1538"><span class="linenos">1538</span></a>                    <span class="n">starts</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="BorisAnnotationStore-1539"><a href="#BorisAnnotationStore-1539"><span class="linenos">1539</span></a>                        <span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">][</span><span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;Status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;START&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span>
</span><span id="BorisAnnotationStore-1540"><a href="#BorisAnnotationStore-1540"><span class="linenos">1540</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="BorisAnnotationStore-1541"><a href="#BorisAnnotationStore-1541"><span class="linenos">1541</span></a>                    <span class="n">ends</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="BorisAnnotationStore-1542"><a href="#BorisAnnotationStore-1542"><span class="linenos">1542</span></a>                        <span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">][</span><span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;Status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;STOP&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">fps</span>
</span><span id="BorisAnnotationStore-1543"><a href="#BorisAnnotationStore-1543"><span class="linenos">1543</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="BorisAnnotationStore-1544"><a href="#BorisAnnotationStore-1544"><span class="linenos">1544</span></a>                    <span class="n">loaded_times</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="BorisAnnotationStore-1545"><a href="#BorisAnnotationStore-1545"><span class="linenos">1545</span></a>                        <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)</span>
</span><span id="BorisAnnotationStore-1546"><a href="#BorisAnnotationStore-1546"><span class="linenos">1546</span></a>                    <span class="p">]</span>
</span><span id="BorisAnnotationStore-1547"><a href="#BorisAnnotationStore-1547"><span class="linenos">1547</span></a>            <span class="k">return</span> <span class="n">loaded_times</span>
</span><span id="BorisAnnotationStore-1548"><a href="#BorisAnnotationStore-1548"><span class="linenos">1548</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="BorisAnnotationStore-1549"><a href="#BorisAnnotationStore-1549"><span class="linenos">1549</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> is invalid or does not exist&quot;</span><span class="p">)</span>
</span><span id="BorisAnnotationStore-1550"><a href="#BorisAnnotationStore-1550"><span class="linenos">1550</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>BORIS type annotation data</p>

<p>Assumes the following file structure:</p>

<pre><code>annotation_path
 video1_annotation.pickle
 video2_labels.pickle
</code></pre>

<p>Here <code>annotation_suffix</code> is <code>{'_annotation.pickle', '_labels.pickle'}</code>.</p>
</div>


                            <div id="BorisAnnotationStore.__init__" class="classattr">
                                        <input id="BorisAnnotationStore.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">BorisAnnotationStore</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>,</span><span class="param">	<span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span>,</span><span class="param">	<span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span>,</span><span class="param">	<span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">default_agent_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ind0&#39;</span>,</span><span class="param">	<span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="BorisAnnotationStore.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BorisAnnotationStore.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BorisAnnotationStore.__init__-1399"><a href="#BorisAnnotationStore.__init__-1399"><span class="linenos">1399</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="BorisAnnotationStore.__init__-1400"><a href="#BorisAnnotationStore.__init__-1400"><span class="linenos">1400</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1401"><a href="#BorisAnnotationStore.__init__-1401"><span class="linenos">1401</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1402"><a href="#BorisAnnotationStore.__init__-1402"><span class="linenos">1402</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1403"><a href="#BorisAnnotationStore.__init__-1403"><span class="linenos">1403</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1404"><a href="#BorisAnnotationStore.__init__-1404"><span class="linenos">1404</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1405"><a href="#BorisAnnotationStore.__init__-1405"><span class="linenos">1405</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1406"><a href="#BorisAnnotationStore.__init__-1406"><span class="linenos">1406</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1407"><a href="#BorisAnnotationStore.__init__-1407"><span class="linenos">1407</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1408"><a href="#BorisAnnotationStore.__init__-1408"><span class="linenos">1408</span></a>        <span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1409"><a href="#BorisAnnotationStore.__init__-1409"><span class="linenos">1409</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1410"><a href="#BorisAnnotationStore.__init__-1410"><span class="linenos">1410</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1411"><a href="#BorisAnnotationStore.__init__-1411"><span class="linenos">1411</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1412"><a href="#BorisAnnotationStore.__init__-1412"><span class="linenos">1412</span></a>        <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1413"><a href="#BorisAnnotationStore.__init__-1413"><span class="linenos">1413</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1414"><a href="#BorisAnnotationStore.__init__-1414"><span class="linenos">1414</span></a>        <span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1415"><a href="#BorisAnnotationStore.__init__-1415"><span class="linenos">1415</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1416"><a href="#BorisAnnotationStore.__init__-1416"><span class="linenos">1416</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1417"><a href="#BorisAnnotationStore.__init__-1417"><span class="linenos">1417</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1418"><a href="#BorisAnnotationStore.__init__-1418"><span class="linenos">1418</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1419"><a href="#BorisAnnotationStore.__init__-1419"><span class="linenos">1419</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1420"><a href="#BorisAnnotationStore.__init__-1420"><span class="linenos">1420</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1421"><a href="#BorisAnnotationStore.__init__-1421"><span class="linenos">1421</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1422"><a href="#BorisAnnotationStore.__init__-1422"><span class="linenos">1422</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1423"><a href="#BorisAnnotationStore.__init__-1423"><span class="linenos">1423</span></a>        <span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1424"><a href="#BorisAnnotationStore.__init__-1424"><span class="linenos">1424</span></a>        <span class="n">default_agent_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ind0&quot;</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1425"><a href="#BorisAnnotationStore.__init__-1425"><span class="linenos">1425</span></a>        <span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1426"><a href="#BorisAnnotationStore.__init__-1426"><span class="linenos">1426</span></a>        <span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1427"><a href="#BorisAnnotationStore.__init__-1427"><span class="linenos">1427</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1428"><a href="#BorisAnnotationStore.__init__-1428"><span class="linenos">1428</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1429"><a href="#BorisAnnotationStore.__init__-1429"><span class="linenos">1429</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BorisAnnotationStore.__init__-1430"><a href="#BorisAnnotationStore.__init__-1430"><span class="linenos">1430</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="BorisAnnotationStore.__init__-1431"><a href="#BorisAnnotationStore.__init__-1431"><span class="linenos">1431</span></a><span class="sd">        Parameters</span>
</span><span id="BorisAnnotationStore.__init__-1432"><a href="#BorisAnnotationStore.__init__-1432"><span class="linenos">1432</span></a><span class="sd">        ----------</span>
</span><span id="BorisAnnotationStore.__init__-1433"><a href="#BorisAnnotationStore.__init__-1433"><span class="linenos">1433</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="BorisAnnotationStore.__init__-1434"><a href="#BorisAnnotationStore.__init__-1434"><span class="linenos">1434</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="BorisAnnotationStore.__init__-1435"><a href="#BorisAnnotationStore.__init__-1435"><span class="linenos">1435</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="BorisAnnotationStore.__init__-1436"><a href="#BorisAnnotationStore.__init__-1436"><span class="linenos">1436</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="BorisAnnotationStore.__init__-1437"><a href="#BorisAnnotationStore.__init__-1437"><span class="linenos">1437</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="BorisAnnotationStore.__init__-1438"><a href="#BorisAnnotationStore.__init__-1438"><span class="linenos">1438</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="BorisAnnotationStore.__init__-1439"><a href="#BorisAnnotationStore.__init__-1439"><span class="linenos">1439</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="BorisAnnotationStore.__init__-1440"><a href="#BorisAnnotationStore.__init__-1440"><span class="linenos">1440</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="BorisAnnotationStore.__init__-1441"><a href="#BorisAnnotationStore.__init__-1441"><span class="linenos">1441</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="BorisAnnotationStore.__init__-1442"><a href="#BorisAnnotationStore.__init__-1442"><span class="linenos">1442</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="BorisAnnotationStore.__init__-1443"><a href="#BorisAnnotationStore.__init__-1443"><span class="linenos">1443</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="BorisAnnotationStore.__init__-1444"><a href="#BorisAnnotationStore.__init__-1444"><span class="linenos">1444</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="BorisAnnotationStore.__init__-1445"><a href="#BorisAnnotationStore.__init__-1445"><span class="linenos">1445</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="BorisAnnotationStore.__init__-1446"><a href="#BorisAnnotationStore.__init__-1446"><span class="linenos">1446</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="BorisAnnotationStore.__init__-1447"><a href="#BorisAnnotationStore.__init__-1447"><span class="linenos">1447</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="BorisAnnotationStore.__init__-1448"><a href="#BorisAnnotationStore.__init__-1448"><span class="linenos">1448</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="BorisAnnotationStore.__init__-1449"><a href="#BorisAnnotationStore.__init__-1449"><span class="linenos">1449</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="BorisAnnotationStore.__init__-1450"><a href="#BorisAnnotationStore.__init__-1450"><span class="linenos">1450</span></a><span class="sd">        behaviors : set, optional</span>
</span><span id="BorisAnnotationStore.__init__-1451"><a href="#BorisAnnotationStore.__init__-1451"><span class="linenos">1451</span></a><span class="sd">            the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are</span>
</span><span id="BorisAnnotationStore.__init__-1452"><a href="#BorisAnnotationStore.__init__-1452"><span class="linenos">1452</span></a><span class="sd">            loaded from a file)</span>
</span><span id="BorisAnnotationStore.__init__-1453"><a href="#BorisAnnotationStore.__init__-1453"><span class="linenos">1453</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="BorisAnnotationStore.__init__-1454"><a href="#BorisAnnotationStore.__init__-1454"><span class="linenos">1454</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="BorisAnnotationStore.__init__-1455"><a href="#BorisAnnotationStore.__init__-1455"><span class="linenos">1455</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="BorisAnnotationStore.__init__-1456"><a href="#BorisAnnotationStore.__init__-1456"><span class="linenos">1456</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="BorisAnnotationStore.__init__-1457"><a href="#BorisAnnotationStore.__init__-1457"><span class="linenos">1457</span></a><span class="sd">            (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="BorisAnnotationStore.__init__-1458"><a href="#BorisAnnotationStore.__init__-1458"><span class="linenos">1458</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="BorisAnnotationStore.__init__-1459"><a href="#BorisAnnotationStore.__init__-1459"><span class="linenos">1459</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="BorisAnnotationStore.__init__-1460"><a href="#BorisAnnotationStore.__init__-1460"><span class="linenos">1460</span></a><span class="sd">            from key objects)</span>
</span><span id="BorisAnnotationStore.__init__-1461"><a href="#BorisAnnotationStore.__init__-1461"><span class="linenos">1461</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="BorisAnnotationStore.__init__-1462"><a href="#BorisAnnotationStore.__init__-1462"><span class="linenos">1462</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="BorisAnnotationStore.__init__-1463"><a href="#BorisAnnotationStore.__init__-1463"><span class="linenos">1463</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="BorisAnnotationStore.__init__-1464"><a href="#BorisAnnotationStore.__init__-1464"><span class="linenos">1464</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="BorisAnnotationStore.__init__-1465"><a href="#BorisAnnotationStore.__init__-1465"><span class="linenos">1465</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="BorisAnnotationStore.__init__-1466"><a href="#BorisAnnotationStore.__init__-1466"><span class="linenos">1466</span></a><span class="sd">        frame_limit : int, default 0</span>
</span><span id="BorisAnnotationStore.__init__-1467"><a href="#BorisAnnotationStore.__init__-1467"><span class="linenos">1467</span></a><span class="sd">            the smallest possible length of a clip (shorter clips are discarded)</span>
</span><span id="BorisAnnotationStore.__init__-1468"><a href="#BorisAnnotationStore.__init__-1468"><span class="linenos">1468</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="BorisAnnotationStore.__init__-1469"><a href="#BorisAnnotationStore.__init__-1469"><span class="linenos">1469</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="BorisAnnotationStore.__init__-1470"><a href="#BorisAnnotationStore.__init__-1470"><span class="linenos">1470</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="BorisAnnotationStore.__init__-1471"><a href="#BorisAnnotationStore.__init__-1471"><span class="linenos">1471</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="BorisAnnotationStore.__init__-1472"><a href="#BorisAnnotationStore.__init__-1472"><span class="linenos">1472</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="BorisAnnotationStore.__init__-1473"><a href="#BorisAnnotationStore.__init__-1473"><span class="linenos">1473</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="BorisAnnotationStore.__init__-1474"><a href="#BorisAnnotationStore.__init__-1474"><span class="linenos">1474</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="BorisAnnotationStore.__init__-1475"><a href="#BorisAnnotationStore.__init__-1475"><span class="linenos">1475</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="BorisAnnotationStore.__init__-1476"><a href="#BorisAnnotationStore.__init__-1476"><span class="linenos">1476</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="BorisAnnotationStore.__init__-1477"><a href="#BorisAnnotationStore.__init__-1477"><span class="linenos">1477</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="BorisAnnotationStore.__init__-1478"><a href="#BorisAnnotationStore.__init__-1478"><span class="linenos">1478</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="BorisAnnotationStore.__init__-1479"><a href="#BorisAnnotationStore.__init__-1479"><span class="linenos">1479</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="BorisAnnotationStore.__init__-1480"><a href="#BorisAnnotationStore.__init__-1480"><span class="linenos">1480</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="BorisAnnotationStore.__init__-1481"><a href="#BorisAnnotationStore.__init__-1481"><span class="linenos">1481</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="BorisAnnotationStore.__init__-1482"><a href="#BorisAnnotationStore.__init__-1482"><span class="linenos">1482</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="BorisAnnotationStore.__init__-1483"><a href="#BorisAnnotationStore.__init__-1483"><span class="linenos">1483</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="BorisAnnotationStore.__init__-1484"><a href="#BorisAnnotationStore.__init__-1484"><span class="linenos">1484</span></a><span class="sd">        use_hard_negatives : bool, default False</span>
</span><span id="BorisAnnotationStore.__init__-1485"><a href="#BorisAnnotationStore.__init__-1485"><span class="linenos">1485</span></a><span class="sd">            mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing</span>
</span><span id="BorisAnnotationStore.__init__-1486"><a href="#BorisAnnotationStore.__init__-1486"><span class="linenos">1486</span></a><span class="sd">        interactive : bool, default False</span>
</span><span id="BorisAnnotationStore.__init__-1487"><a href="#BorisAnnotationStore.__init__-1487"><span class="linenos">1487</span></a><span class="sd">            if `True`, annotation is assigned to pairs of individuals</span>
</span><span id="BorisAnnotationStore.__init__-1488"><a href="#BorisAnnotationStore.__init__-1488"><span class="linenos">1488</span></a><span class="sd">        ignored_clips : set, optional</span>
</span><span id="BorisAnnotationStore.__init__-1489"><a href="#BorisAnnotationStore.__init__-1489"><span class="linenos">1489</span></a><span class="sd">            a set of clip ids to ignore</span>
</span><span id="BorisAnnotationStore.__init__-1490"><a href="#BorisAnnotationStore.__init__-1490"><span class="linenos">1490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BorisAnnotationStore.__init__-1491"><a href="#BorisAnnotationStore.__init__-1491"><span class="linenos">1491</span></a>
</span><span id="BorisAnnotationStore.__init__-1492"><a href="#BorisAnnotationStore.__init__-1492"><span class="linenos">1492</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_agent_name</span> <span class="o">=</span> <span class="n">default_agent_name</span>
</span><span id="BorisAnnotationStore.__init__-1493"><a href="#BorisAnnotationStore.__init__-1493"><span class="linenos">1493</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="BorisAnnotationStore.__init__-1494"><a href="#BorisAnnotationStore.__init__-1494"><span class="linenos">1494</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1495"><a href="#BorisAnnotationStore.__init__-1495"><span class="linenos">1495</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1496"><a href="#BorisAnnotationStore.__init__-1496"><span class="linenos">1496</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1497"><a href="#BorisAnnotationStore.__init__-1497"><span class="linenos">1497</span></a>            <span class="n">visibility</span><span class="o">=</span><span class="n">visibility</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1498"><a href="#BorisAnnotationStore.__init__-1498"><span class="linenos">1498</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1499"><a href="#BorisAnnotationStore.__init__-1499"><span class="linenos">1499</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1500"><a href="#BorisAnnotationStore.__init__-1500"><span class="linenos">1500</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1501"><a href="#BorisAnnotationStore.__init__-1501"><span class="linenos">1501</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1502"><a href="#BorisAnnotationStore.__init__-1502"><span class="linenos">1502</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1503"><a href="#BorisAnnotationStore.__init__-1503"><span class="linenos">1503</span></a>            <span class="n">annotation_suffix</span><span class="o">=</span><span class="n">annotation_suffix</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1504"><a href="#BorisAnnotationStore.__init__-1504"><span class="linenos">1504</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1505"><a href="#BorisAnnotationStore.__init__-1505"><span class="linenos">1505</span></a>            <span class="n">behavior_file</span><span class="o">=</span><span class="n">behavior_file</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1506"><a href="#BorisAnnotationStore.__init__-1506"><span class="linenos">1506</span></a>            <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1507"><a href="#BorisAnnotationStore.__init__-1507"><span class="linenos">1507</span></a>            <span class="n">frame_limit</span><span class="o">=</span><span class="n">frame_limit</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1508"><a href="#BorisAnnotationStore.__init__-1508"><span class="linenos">1508</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="n">filter_annotated</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1509"><a href="#BorisAnnotationStore.__init__-1509"><span class="linenos">1509</span></a>            <span class="n">filter_background</span><span class="o">=</span><span class="n">filter_background</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1510"><a href="#BorisAnnotationStore.__init__-1510"><span class="linenos">1510</span></a>            <span class="n">error_class</span><span class="o">=</span><span class="n">error_class</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1511"><a href="#BorisAnnotationStore.__init__-1511"><span class="linenos">1511</span></a>            <span class="n">min_frames_action</span><span class="o">=</span><span class="n">min_frames_action</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1512"><a href="#BorisAnnotationStore.__init__-1512"><span class="linenos">1512</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1513"><a href="#BorisAnnotationStore.__init__-1513"><span class="linenos">1513</span></a>            <span class="n">visibility_min_score</span><span class="o">=</span><span class="n">visibility_min_score</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1514"><a href="#BorisAnnotationStore.__init__-1514"><span class="linenos">1514</span></a>            <span class="n">visibility_min_frac</span><span class="o">=</span><span class="n">visibility_min_frac</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1515"><a href="#BorisAnnotationStore.__init__-1515"><span class="linenos">1515</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1516"><a href="#BorisAnnotationStore.__init__-1516"><span class="linenos">1516</span></a>            <span class="n">use_hard_negatives</span><span class="o">=</span><span class="n">use_hard_negatives</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1517"><a href="#BorisAnnotationStore.__init__-1517"><span class="linenos">1517</span></a>            <span class="n">interactive</span><span class="o">=</span><span class="n">interactive</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1518"><a href="#BorisAnnotationStore.__init__-1518"><span class="linenos">1518</span></a>            <span class="n">ignored_clips</span><span class="o">=</span><span class="n">ignored_clips</span><span class="p">,</span>
</span><span id="BorisAnnotationStore.__init__-1519"><a href="#BorisAnnotationStore.__init__-1519"><span class="linenos">1519</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h2 id="parameters">Parameters</h2>

<p>video_order : list, optional
    a list of video ids that should be processed in the same order (not passed if creating from key objects)
min_frames : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    clip start frames (not passed if creating from key objects)
max_frames : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    clip end frames (not passed if creating from key objects)
visibility : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)
exclusive : bool, default True
    if True, the annotation is single-label; if False, multi-label
len_segment : int, default 128
    the length of the segments in which the data should be cut (in frames)
overlap : int, default 0
    the length of the overlap between neighboring segments (in frames)
behaviors : set, optional
    the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are
    loaded from a file)
ignored_classes : set, optional
    the list of behaviors from the behaviors list or file to not annotate
annotation_suffix : str | set, optional
    the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}
    (not passed if creating from key objects or if irrelevant for the dataset)
annotation_path : str | set, optional
    the path or the set of paths to the folder where the annotation files are stored (not passed if creating
    from key objects)
behavior_file : str, optional
    the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)
correction : dict, optional
    a dictionary of corrections for the labels (e.g. {'sleping': 'sleeping', 'calm locomotion': 'locomotion'},
    can be used to correct for variations in naming or to merge several labels in one
frame_limit : int, default 0
    the smallest possible length of a clip (shorter clips are discarded)
filter_annotated : bool, default False
    if True, the samples that do not have any labels will be filtered
filter_background : bool, default False
    if True, only the unlabeled frames that are close to annotated frames will be labeled as background
error_class : str, optional
    the name of the error class (the annotations that intersect with this label will be discarded)
min_frames_action : int, default 0
    the minimum length of an action (shorter actions are not annotated)
key_objects : tuple, optional
    the key objects to load the AnnotationStore from
visibility_min_score : float, default 5
    the minimum visibility score for visibility filtering
visibility_min_frac : float, default 0.7
    the minimum fraction of visible frames for visibility filtering
mask : dict, optional
    a masked value dictionary (for active learning simulation experiments)
use_hard_negatives : bool, default False
    mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing
interactive : bool, default False
    if <code>True</code>, annotation is assigned to pairs of individuals
ignored_clips : set, optional
    a set of clip ids to ignore</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ActionSegmentationStore">ActionSegmentationStore</a></dt>
                                <dd id="BorisAnnotationStore.remove" class="function"><a href="#ActionSegmentationStore.remove">remove</a></dd>
                <dd id="BorisAnnotationStore.key_objects" class="function"><a href="#ActionSegmentationStore.key_objects">key_objects</a></dd>
                <dd id="BorisAnnotationStore.load_from_key_objects" class="function"><a href="#ActionSegmentationStore.load_from_key_objects">load_from_key_objects</a></dd>
                <dd id="BorisAnnotationStore.to_ram" class="function"><a href="#ActionSegmentationStore.to_ram">to_ram</a></dd>
                <dd id="BorisAnnotationStore.get_original_coordinates" class="function"><a href="#ActionSegmentationStore.get_original_coordinates">get_original_coordinates</a></dd>
                <dd id="BorisAnnotationStore.create_subsample" class="function"><a href="#ActionSegmentationStore.create_subsample">create_subsample</a></dd>
                <dd id="BorisAnnotationStore.get_len" class="function"><a href="#ActionSegmentationStore.get_len">get_len</a></dd>
                <dd id="BorisAnnotationStore.get_indices" class="function"><a href="#ActionSegmentationStore.get_indices">get_indices</a></dd>
                <dd id="BorisAnnotationStore.count_classes" class="function"><a href="#ActionSegmentationStore.count_classes">count_classes</a></dd>
                <dd id="BorisAnnotationStore.behaviors_dict" class="function"><a href="#ActionSegmentationStore.behaviors_dict">behaviors_dict</a></dd>
                <dd id="BorisAnnotationStore.annotation_class" class="function"><a href="#ActionSegmentationStore.annotation_class">annotation_class</a></dd>
                <dd id="BorisAnnotationStore.size" class="function"><a href="#ActionSegmentationStore.size">size</a></dd>
                <dd id="BorisAnnotationStore.filtered_indices" class="function"><a href="#ActionSegmentationStore.filtered_indices">filtered_indices</a></dd>
                <dd id="BorisAnnotationStore.set_pseudo_labels" class="function"><a href="#ActionSegmentationStore.set_pseudo_labels">set_pseudo_labels</a></dd>
                <dd id="BorisAnnotationStore.get_file_ids" class="function"><a href="#ActionSegmentationStore.get_file_ids">get_file_ids</a></dd>

            </div>
            <div><dt><a href="base_store.html#AnnotationStore">dlc2action.data.base_store.AnnotationStore</a></dt>
                                <dd id="BorisAnnotationStore.required_objects" class="variable"><a href="base_store.html#AnnotationStore.required_objects">required_objects</a></dd>

            </div>
            <div><dt><a href="base_store.html#Store">dlc2action.data.base_store.Store</a></dt>
                                <dd id="BorisAnnotationStore.get_parameters" class="function"><a href="base_store.html#Store.get_parameters">get_parameters</a></dd>
                <dd id="BorisAnnotationStore.new" class="function"><a href="base_store.html#Store.new">new</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="PKUMMDAnnotationStore">
                            <input id="PKUMMDAnnotationStore-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PKUMMDAnnotationStore</span><wbr>(<span class="base"><a href="#FileAnnotationStore">FileAnnotationStore</a></span>):

                <label class="view-source-button" for="PKUMMDAnnotationStore-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PKUMMDAnnotationStore"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PKUMMDAnnotationStore-1553"><a href="#PKUMMDAnnotationStore-1553"><span class="linenos">1553</span></a><span class="k">class</span> <span class="nc">PKUMMDAnnotationStore</span><span class="p">(</span><span class="n">FileAnnotationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="PKUMMDAnnotationStore-1554"><a href="#PKUMMDAnnotationStore-1554"><span class="linenos">1554</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PKUMMDAnnotationStore-1555"><a href="#PKUMMDAnnotationStore-1555"><span class="linenos">1555</span></a><span class="sd">    PKU-MMD annotation data</span>
</span><span id="PKUMMDAnnotationStore-1556"><a href="#PKUMMDAnnotationStore-1556"><span class="linenos">1556</span></a>
</span><span id="PKUMMDAnnotationStore-1557"><a href="#PKUMMDAnnotationStore-1557"><span class="linenos">1557</span></a><span class="sd">    Assumes the following file structure:</span>
</span><span id="PKUMMDAnnotationStore-1558"><a href="#PKUMMDAnnotationStore-1558"><span class="linenos">1558</span></a><span class="sd">    ```</span>
</span><span id="PKUMMDAnnotationStore-1559"><a href="#PKUMMDAnnotationStore-1559"><span class="linenos">1559</span></a><span class="sd">    annotation_path</span>
</span><span id="PKUMMDAnnotationStore-1560"><a href="#PKUMMDAnnotationStore-1560"><span class="linenos">1560</span></a><span class="sd">     0364-L.txt</span>
</span><span id="PKUMMDAnnotationStore-1561"><a href="#PKUMMDAnnotationStore-1561"><span class="linenos">1561</span></a><span class="sd">    ...</span>
</span><span id="PKUMMDAnnotationStore-1562"><a href="#PKUMMDAnnotationStore-1562"><span class="linenos">1562</span></a><span class="sd">     0144-M.txt</span>
</span><span id="PKUMMDAnnotationStore-1563"><a href="#PKUMMDAnnotationStore-1563"><span class="linenos">1563</span></a><span class="sd">    ```</span>
</span><span id="PKUMMDAnnotationStore-1564"><a href="#PKUMMDAnnotationStore-1564"><span class="linenos">1564</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="PKUMMDAnnotationStore-1565"><a href="#PKUMMDAnnotationStore-1565"><span class="linenos">1565</span></a>
</span><span id="PKUMMDAnnotationStore-1566"><a href="#PKUMMDAnnotationStore-1566"><span class="linenos">1566</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="PKUMMDAnnotationStore-1567"><a href="#PKUMMDAnnotationStore-1567"><span class="linenos">1567</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1568"><a href="#PKUMMDAnnotationStore-1568"><span class="linenos">1568</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1569"><a href="#PKUMMDAnnotationStore-1569"><span class="linenos">1569</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1570"><a href="#PKUMMDAnnotationStore-1570"><span class="linenos">1570</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1571"><a href="#PKUMMDAnnotationStore-1571"><span class="linenos">1571</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1572"><a href="#PKUMMDAnnotationStore-1572"><span class="linenos">1572</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1573"><a href="#PKUMMDAnnotationStore-1573"><span class="linenos">1573</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1574"><a href="#PKUMMDAnnotationStore-1574"><span class="linenos">1574</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1575"><a href="#PKUMMDAnnotationStore-1575"><span class="linenos">1575</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1576"><a href="#PKUMMDAnnotationStore-1576"><span class="linenos">1576</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1577"><a href="#PKUMMDAnnotationStore-1577"><span class="linenos">1577</span></a>        <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1578"><a href="#PKUMMDAnnotationStore-1578"><span class="linenos">1578</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1579"><a href="#PKUMMDAnnotationStore-1579"><span class="linenos">1579</span></a>        <span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1580"><a href="#PKUMMDAnnotationStore-1580"><span class="linenos">1580</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1581"><a href="#PKUMMDAnnotationStore-1581"><span class="linenos">1581</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1582"><a href="#PKUMMDAnnotationStore-1582"><span class="linenos">1582</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1583"><a href="#PKUMMDAnnotationStore-1583"><span class="linenos">1583</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1584"><a href="#PKUMMDAnnotationStore-1584"><span class="linenos">1584</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1585"><a href="#PKUMMDAnnotationStore-1585"><span class="linenos">1585</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1586"><a href="#PKUMMDAnnotationStore-1586"><span class="linenos">1586</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1587"><a href="#PKUMMDAnnotationStore-1587"><span class="linenos">1587</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1588"><a href="#PKUMMDAnnotationStore-1588"><span class="linenos">1588</span></a>        <span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1589"><a href="#PKUMMDAnnotationStore-1589"><span class="linenos">1589</span></a>        <span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1590"><a href="#PKUMMDAnnotationStore-1590"><span class="linenos">1590</span></a>        <span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1591"><a href="#PKUMMDAnnotationStore-1591"><span class="linenos">1591</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1592"><a href="#PKUMMDAnnotationStore-1592"><span class="linenos">1592</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1593"><a href="#PKUMMDAnnotationStore-1593"><span class="linenos">1593</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PKUMMDAnnotationStore-1594"><a href="#PKUMMDAnnotationStore-1594"><span class="linenos">1594</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PKUMMDAnnotationStore-1595"><a href="#PKUMMDAnnotationStore-1595"><span class="linenos">1595</span></a><span class="sd">        Parameters</span>
</span><span id="PKUMMDAnnotationStore-1596"><a href="#PKUMMDAnnotationStore-1596"><span class="linenos">1596</span></a><span class="sd">        ----------</span>
</span><span id="PKUMMDAnnotationStore-1597"><a href="#PKUMMDAnnotationStore-1597"><span class="linenos">1597</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="PKUMMDAnnotationStore-1598"><a href="#PKUMMDAnnotationStore-1598"><span class="linenos">1598</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="PKUMMDAnnotationStore-1599"><a href="#PKUMMDAnnotationStore-1599"><span class="linenos">1599</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="PKUMMDAnnotationStore-1600"><a href="#PKUMMDAnnotationStore-1600"><span class="linenos">1600</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="PKUMMDAnnotationStore-1601"><a href="#PKUMMDAnnotationStore-1601"><span class="linenos">1601</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="PKUMMDAnnotationStore-1602"><a href="#PKUMMDAnnotationStore-1602"><span class="linenos">1602</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="PKUMMDAnnotationStore-1603"><a href="#PKUMMDAnnotationStore-1603"><span class="linenos">1603</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="PKUMMDAnnotationStore-1604"><a href="#PKUMMDAnnotationStore-1604"><span class="linenos">1604</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="PKUMMDAnnotationStore-1605"><a href="#PKUMMDAnnotationStore-1605"><span class="linenos">1605</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="PKUMMDAnnotationStore-1606"><a href="#PKUMMDAnnotationStore-1606"><span class="linenos">1606</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="PKUMMDAnnotationStore-1607"><a href="#PKUMMDAnnotationStore-1607"><span class="linenos">1607</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="PKUMMDAnnotationStore-1608"><a href="#PKUMMDAnnotationStore-1608"><span class="linenos">1608</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="PKUMMDAnnotationStore-1609"><a href="#PKUMMDAnnotationStore-1609"><span class="linenos">1609</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="PKUMMDAnnotationStore-1610"><a href="#PKUMMDAnnotationStore-1610"><span class="linenos">1610</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="PKUMMDAnnotationStore-1611"><a href="#PKUMMDAnnotationStore-1611"><span class="linenos">1611</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="PKUMMDAnnotationStore-1612"><a href="#PKUMMDAnnotationStore-1612"><span class="linenos">1612</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="PKUMMDAnnotationStore-1613"><a href="#PKUMMDAnnotationStore-1613"><span class="linenos">1613</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="PKUMMDAnnotationStore-1614"><a href="#PKUMMDAnnotationStore-1614"><span class="linenos">1614</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="PKUMMDAnnotationStore-1615"><a href="#PKUMMDAnnotationStore-1615"><span class="linenos">1615</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="PKUMMDAnnotationStore-1616"><a href="#PKUMMDAnnotationStore-1616"><span class="linenos">1616</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="PKUMMDAnnotationStore-1617"><a href="#PKUMMDAnnotationStore-1617"><span class="linenos">1617</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="PKUMMDAnnotationStore-1618"><a href="#PKUMMDAnnotationStore-1618"><span class="linenos">1618</span></a><span class="sd">            from key objects)</span>
</span><span id="PKUMMDAnnotationStore-1619"><a href="#PKUMMDAnnotationStore-1619"><span class="linenos">1619</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="PKUMMDAnnotationStore-1620"><a href="#PKUMMDAnnotationStore-1620"><span class="linenos">1620</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="PKUMMDAnnotationStore-1621"><a href="#PKUMMDAnnotationStore-1621"><span class="linenos">1621</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="PKUMMDAnnotationStore-1622"><a href="#PKUMMDAnnotationStore-1622"><span class="linenos">1622</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="PKUMMDAnnotationStore-1623"><a href="#PKUMMDAnnotationStore-1623"><span class="linenos">1623</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="PKUMMDAnnotationStore-1624"><a href="#PKUMMDAnnotationStore-1624"><span class="linenos">1624</span></a><span class="sd">        frame_limit : int, default 0</span>
</span><span id="PKUMMDAnnotationStore-1625"><a href="#PKUMMDAnnotationStore-1625"><span class="linenos">1625</span></a><span class="sd">            the smallest possible length of a clip (shorter clips are discarded)</span>
</span><span id="PKUMMDAnnotationStore-1626"><a href="#PKUMMDAnnotationStore-1626"><span class="linenos">1626</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="PKUMMDAnnotationStore-1627"><a href="#PKUMMDAnnotationStore-1627"><span class="linenos">1627</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="PKUMMDAnnotationStore-1628"><a href="#PKUMMDAnnotationStore-1628"><span class="linenos">1628</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="PKUMMDAnnotationStore-1629"><a href="#PKUMMDAnnotationStore-1629"><span class="linenos">1629</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="PKUMMDAnnotationStore-1630"><a href="#PKUMMDAnnotationStore-1630"><span class="linenos">1630</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="PKUMMDAnnotationStore-1631"><a href="#PKUMMDAnnotationStore-1631"><span class="linenos">1631</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="PKUMMDAnnotationStore-1632"><a href="#PKUMMDAnnotationStore-1632"><span class="linenos">1632</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="PKUMMDAnnotationStore-1633"><a href="#PKUMMDAnnotationStore-1633"><span class="linenos">1633</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="PKUMMDAnnotationStore-1634"><a href="#PKUMMDAnnotationStore-1634"><span class="linenos">1634</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="PKUMMDAnnotationStore-1635"><a href="#PKUMMDAnnotationStore-1635"><span class="linenos">1635</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="PKUMMDAnnotationStore-1636"><a href="#PKUMMDAnnotationStore-1636"><span class="linenos">1636</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="PKUMMDAnnotationStore-1637"><a href="#PKUMMDAnnotationStore-1637"><span class="linenos">1637</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="PKUMMDAnnotationStore-1638"><a href="#PKUMMDAnnotationStore-1638"><span class="linenos">1638</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="PKUMMDAnnotationStore-1639"><a href="#PKUMMDAnnotationStore-1639"><span class="linenos">1639</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="PKUMMDAnnotationStore-1640"><a href="#PKUMMDAnnotationStore-1640"><span class="linenos">1640</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="PKUMMDAnnotationStore-1641"><a href="#PKUMMDAnnotationStore-1641"><span class="linenos">1641</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="PKUMMDAnnotationStore-1642"><a href="#PKUMMDAnnotationStore-1642"><span class="linenos">1642</span></a><span class="sd">        use_hard_negatives : bool, default False</span>
</span><span id="PKUMMDAnnotationStore-1643"><a href="#PKUMMDAnnotationStore-1643"><span class="linenos">1643</span></a><span class="sd">            mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing</span>
</span><span id="PKUMMDAnnotationStore-1644"><a href="#PKUMMDAnnotationStore-1644"><span class="linenos">1644</span></a><span class="sd">        interactive : bool, default False</span>
</span><span id="PKUMMDAnnotationStore-1645"><a href="#PKUMMDAnnotationStore-1645"><span class="linenos">1645</span></a><span class="sd">            if `True`, annotation is assigned to pairs of individuals</span>
</span><span id="PKUMMDAnnotationStore-1646"><a href="#PKUMMDAnnotationStore-1646"><span class="linenos">1646</span></a><span class="sd">        ignored_clips : set, optional</span>
</span><span id="PKUMMDAnnotationStore-1647"><a href="#PKUMMDAnnotationStore-1647"><span class="linenos">1647</span></a><span class="sd">            a set of clip ids to ignore</span>
</span><span id="PKUMMDAnnotationStore-1648"><a href="#PKUMMDAnnotationStore-1648"><span class="linenos">1648</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PKUMMDAnnotationStore-1649"><a href="#PKUMMDAnnotationStore-1649"><span class="linenos">1649</span></a>
</span><span id="PKUMMDAnnotationStore-1650"><a href="#PKUMMDAnnotationStore-1650"><span class="linenos">1650</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="PKUMMDAnnotationStore-1651"><a href="#PKUMMDAnnotationStore-1651"><span class="linenos">1651</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1652"><a href="#PKUMMDAnnotationStore-1652"><span class="linenos">1652</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1653"><a href="#PKUMMDAnnotationStore-1653"><span class="linenos">1653</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1654"><a href="#PKUMMDAnnotationStore-1654"><span class="linenos">1654</span></a>            <span class="n">visibility</span><span class="o">=</span><span class="n">visibility</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1655"><a href="#PKUMMDAnnotationStore-1655"><span class="linenos">1655</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1656"><a href="#PKUMMDAnnotationStore-1656"><span class="linenos">1656</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1657"><a href="#PKUMMDAnnotationStore-1657"><span class="linenos">1657</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1658"><a href="#PKUMMDAnnotationStore-1658"><span class="linenos">1658</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1659"><a href="#PKUMMDAnnotationStore-1659"><span class="linenos">1659</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1660"><a href="#PKUMMDAnnotationStore-1660"><span class="linenos">1660</span></a>            <span class="n">annotation_suffix</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;.txt&quot;</span><span class="p">},</span>
</span><span id="PKUMMDAnnotationStore-1661"><a href="#PKUMMDAnnotationStore-1661"><span class="linenos">1661</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1662"><a href="#PKUMMDAnnotationStore-1662"><span class="linenos">1662</span></a>            <span class="n">behavior_file</span><span class="o">=</span><span class="n">behavior_file</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1663"><a href="#PKUMMDAnnotationStore-1663"><span class="linenos">1663</span></a>            <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1664"><a href="#PKUMMDAnnotationStore-1664"><span class="linenos">1664</span></a>            <span class="n">frame_limit</span><span class="o">=</span><span class="n">frame_limit</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1665"><a href="#PKUMMDAnnotationStore-1665"><span class="linenos">1665</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="n">filter_annotated</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1666"><a href="#PKUMMDAnnotationStore-1666"><span class="linenos">1666</span></a>            <span class="n">filter_background</span><span class="o">=</span><span class="n">filter_background</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1667"><a href="#PKUMMDAnnotationStore-1667"><span class="linenos">1667</span></a>            <span class="n">error_class</span><span class="o">=</span><span class="n">error_class</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1668"><a href="#PKUMMDAnnotationStore-1668"><span class="linenos">1668</span></a>            <span class="n">min_frames_action</span><span class="o">=</span><span class="n">min_frames_action</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1669"><a href="#PKUMMDAnnotationStore-1669"><span class="linenos">1669</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1670"><a href="#PKUMMDAnnotationStore-1670"><span class="linenos">1670</span></a>            <span class="n">visibility_min_score</span><span class="o">=</span><span class="n">visibility_min_score</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1671"><a href="#PKUMMDAnnotationStore-1671"><span class="linenos">1671</span></a>            <span class="n">visibility_min_frac</span><span class="o">=</span><span class="n">visibility_min_frac</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1672"><a href="#PKUMMDAnnotationStore-1672"><span class="linenos">1672</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1673"><a href="#PKUMMDAnnotationStore-1673"><span class="linenos">1673</span></a>            <span class="n">use_hard_negatives</span><span class="o">=</span><span class="n">use_hard_negatives</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1674"><a href="#PKUMMDAnnotationStore-1674"><span class="linenos">1674</span></a>            <span class="n">interactive</span><span class="o">=</span><span class="n">interactive</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1675"><a href="#PKUMMDAnnotationStore-1675"><span class="linenos">1675</span></a>            <span class="n">ignored_clips</span><span class="o">=</span><span class="n">ignored_clips</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1676"><a href="#PKUMMDAnnotationStore-1676"><span class="linenos">1676</span></a>            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1677"><a href="#PKUMMDAnnotationStore-1677"><span class="linenos">1677</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore-1678"><a href="#PKUMMDAnnotationStore-1678"><span class="linenos">1678</span></a>        <span class="p">)</span>
</span><span id="PKUMMDAnnotationStore-1679"><a href="#PKUMMDAnnotationStore-1679"><span class="linenos">1679</span></a>
</span><span id="PKUMMDAnnotationStore-1680"><a href="#PKUMMDAnnotationStore-1680"><span class="linenos">1680</span></a>    <span class="nd">@classmethod</span>
</span><span id="PKUMMDAnnotationStore-1681"><a href="#PKUMMDAnnotationStore-1681"><span class="linenos">1681</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="PKUMMDAnnotationStore-1682"><a href="#PKUMMDAnnotationStore-1682"><span class="linenos">1682</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PKUMMDAnnotationStore-1683"><a href="#PKUMMDAnnotationStore-1683"><span class="linenos">1683</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="PKUMMDAnnotationStore-1684"><a href="#PKUMMDAnnotationStore-1684"><span class="linenos">1684</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="PKUMMDAnnotationStore-1685"><a href="#PKUMMDAnnotationStore-1685"><span class="linenos">1685</span></a>
</span><span id="PKUMMDAnnotationStore-1686"><a href="#PKUMMDAnnotationStore-1686"><span class="linenos">1686</span></a><span class="sd">        Parameters</span>
</span><span id="PKUMMDAnnotationStore-1687"><a href="#PKUMMDAnnotationStore-1687"><span class="linenos">1687</span></a><span class="sd">        ----------</span>
</span><span id="PKUMMDAnnotationStore-1688"><a href="#PKUMMDAnnotationStore-1688"><span class="linenos">1688</span></a><span class="sd">        annotation_path : str | set</span>
</span><span id="PKUMMDAnnotationStore-1689"><a href="#PKUMMDAnnotationStore-1689"><span class="linenos">1689</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored</span>
</span><span id="PKUMMDAnnotationStore-1690"><a href="#PKUMMDAnnotationStore-1690"><span class="linenos">1690</span></a>
</span><span id="PKUMMDAnnotationStore-1691"><a href="#PKUMMDAnnotationStore-1691"><span class="linenos">1691</span></a><span class="sd">        Returns</span>
</span><span id="PKUMMDAnnotationStore-1692"><a href="#PKUMMDAnnotationStore-1692"><span class="linenos">1692</span></a><span class="sd">        -------</span>
</span><span id="PKUMMDAnnotationStore-1693"><a href="#PKUMMDAnnotationStore-1693"><span class="linenos">1693</span></a><span class="sd">        video_ids : list</span>
</span><span id="PKUMMDAnnotationStore-1694"><a href="#PKUMMDAnnotationStore-1694"><span class="linenos">1694</span></a><span class="sd">            a list of video file ids</span>
</span><span id="PKUMMDAnnotationStore-1695"><a href="#PKUMMDAnnotationStore-1695"><span class="linenos">1695</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PKUMMDAnnotationStore-1696"><a href="#PKUMMDAnnotationStore-1696"><span class="linenos">1696</span></a>
</span><span id="PKUMMDAnnotationStore-1697"><a href="#PKUMMDAnnotationStore-1697"><span class="linenos">1697</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="PKUMMDAnnotationStore-1698"><a href="#PKUMMDAnnotationStore-1698"><span class="linenos">1698</span></a>            <span class="n">annotation_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">annotation_path</span><span class="p">]</span>
</span><span id="PKUMMDAnnotationStore-1699"><a href="#PKUMMDAnnotationStore-1699"><span class="linenos">1699</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PKUMMDAnnotationStore-1700"><a href="#PKUMMDAnnotationStore-1700"><span class="linenos">1700</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">annotation_path</span><span class="p">:</span>
</span><span id="PKUMMDAnnotationStore-1701"><a href="#PKUMMDAnnotationStore-1701"><span class="linenos">1701</span></a>            <span class="n">files</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="PKUMMDAnnotationStore-1702"><a href="#PKUMMDAnnotationStore-1702"><span class="linenos">1702</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;.txt&quot;</span>
</span><span id="PKUMMDAnnotationStore-1703"><a href="#PKUMMDAnnotationStore-1703"><span class="linenos">1703</span></a>            <span class="p">]</span>
</span><span id="PKUMMDAnnotationStore-1704"><a href="#PKUMMDAnnotationStore-1704"><span class="linenos">1704</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="PKUMMDAnnotationStore-1705"><a href="#PKUMMDAnnotationStore-1705"><span class="linenos">1705</span></a>        <span class="k">return</span> <span class="n">files</span>
</span><span id="PKUMMDAnnotationStore-1706"><a href="#PKUMMDAnnotationStore-1706"><span class="linenos">1706</span></a>
</span><span id="PKUMMDAnnotationStore-1707"><a href="#PKUMMDAnnotationStore-1707"><span class="linenos">1707</span></a>    <span class="k">def</span> <span class="nf">_open_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="PKUMMDAnnotationStore-1708"><a href="#PKUMMDAnnotationStore-1708"><span class="linenos">1708</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PKUMMDAnnotationStore-1709"><a href="#PKUMMDAnnotationStore-1709"><span class="linenos">1709</span></a><span class="sd">        Load the annotation from filename</span>
</span><span id="PKUMMDAnnotationStore-1710"><a href="#PKUMMDAnnotationStore-1710"><span class="linenos">1710</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PKUMMDAnnotationStore-1711"><a href="#PKUMMDAnnotationStore-1711"><span class="linenos">1711</span></a>
</span><span id="PKUMMDAnnotationStore-1712"><a href="#PKUMMDAnnotationStore-1712"><span class="linenos">1712</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
</span><span id="PKUMMDAnnotationStore-1713"><a href="#PKUMMDAnnotationStore-1713"><span class="linenos">1713</span></a>            <span class="n">agent_name</span> <span class="o">=</span> <span class="s2">&quot;0+1&quot;</span>
</span><span id="PKUMMDAnnotationStore-1714"><a href="#PKUMMDAnnotationStore-1714"><span class="linenos">1714</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PKUMMDAnnotationStore-1715"><a href="#PKUMMDAnnotationStore-1715"><span class="linenos">1715</span></a>            <span class="n">agent_name</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
</span><span id="PKUMMDAnnotationStore-1716"><a href="#PKUMMDAnnotationStore-1716"><span class="linenos">1716</span></a>        <span class="n">times</span> <span class="o">=</span> <span class="p">{</span><span class="n">agent_name</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])}</span>
</span><span id="PKUMMDAnnotationStore-1717"><a href="#PKUMMDAnnotationStore-1717"><span class="linenos">1717</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="PKUMMDAnnotationStore-1718"><a href="#PKUMMDAnnotationStore-1718"><span class="linenos">1718</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
</span><span id="PKUMMDAnnotationStore-1719"><a href="#PKUMMDAnnotationStore-1719"><span class="linenos">1719</span></a>                <span class="n">label</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
</span><span id="PKUMMDAnnotationStore-1720"><a href="#PKUMMDAnnotationStore-1720"><span class="linenos">1720</span></a>                <span class="n">times</span><span class="p">[</span><span class="n">agent_name</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">all_behaviors</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="PKUMMDAnnotationStore-1721"><a href="#PKUMMDAnnotationStore-1721"><span class="linenos">1721</span></a>                    <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="PKUMMDAnnotationStore-1722"><a href="#PKUMMDAnnotationStore-1722"><span class="linenos">1722</span></a>                <span class="p">)</span>
</span><span id="PKUMMDAnnotationStore-1723"><a href="#PKUMMDAnnotationStore-1723"><span class="linenos">1723</span></a>        <span class="k">return</span> <span class="n">times</span>
</span><span id="PKUMMDAnnotationStore-1724"><a href="#PKUMMDAnnotationStore-1724"><span class="linenos">1724</span></a>
</span><span id="PKUMMDAnnotationStore-1725"><a href="#PKUMMDAnnotationStore-1725"><span class="linenos">1725</span></a>    <span class="k">def</span> <span class="nf">_set_behaviors</span><span class="p">(</span>
</span><span id="PKUMMDAnnotationStore-1726"><a href="#PKUMMDAnnotationStore-1726"><span class="linenos">1726</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">behaviors</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">List</span><span class="p">,</span> <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="PKUMMDAnnotationStore-1727"><a href="#PKUMMDAnnotationStore-1727"><span class="linenos">1727</span></a>    <span class="p">):</span>
</span><span id="PKUMMDAnnotationStore-1728"><a href="#PKUMMDAnnotationStore-1728"><span class="linenos">1728</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PKUMMDAnnotationStore-1729"><a href="#PKUMMDAnnotationStore-1729"><span class="linenos">1729</span></a><span class="sd">        Get a list of behaviors that should be annotated from behavior parameters</span>
</span><span id="PKUMMDAnnotationStore-1730"><a href="#PKUMMDAnnotationStore-1730"><span class="linenos">1730</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PKUMMDAnnotationStore-1731"><a href="#PKUMMDAnnotationStore-1731"><span class="linenos">1731</span></a>
</span><span id="PKUMMDAnnotationStore-1732"><a href="#PKUMMDAnnotationStore-1732"><span class="linenos">1732</span></a>        <span class="k">if</span> <span class="n">behavior_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PKUMMDAnnotationStore-1733"><a href="#PKUMMDAnnotationStore-1733"><span class="linenos">1733</span></a>            <span class="n">behaviors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">behavior_file</span><span class="p">)[</span><span class="s2">&quot;Action&quot;</span><span class="p">])</span>
</span><span id="PKUMMDAnnotationStore-1734"><a href="#PKUMMDAnnotationStore-1734"><span class="linenos">1734</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">all_behaviors</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">behaviors</span><span class="p">)</span>
</span><span id="PKUMMDAnnotationStore-1735"><a href="#PKUMMDAnnotationStore-1735"><span class="linenos">1735</span></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">ignored_classes</span><span class="p">:</span>
</span><span id="PKUMMDAnnotationStore-1736"><a href="#PKUMMDAnnotationStore-1736"><span class="linenos">1736</span></a>            <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">:</span>
</span><span id="PKUMMDAnnotationStore-1737"><a href="#PKUMMDAnnotationStore-1737"><span class="linenos">1737</span></a>                <span class="n">behaviors</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span><span id="PKUMMDAnnotationStore-1738"><a href="#PKUMMDAnnotationStore-1738"><span class="linenos">1738</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span> <span class="o">=</span> <span class="n">behaviors</span>
</span></pre></div>


            <div class="docstring"><p>PKU-MMD annotation data</p>

<p>Assumes the following file structure:</p>

<pre><code>annotation_path
 0364-L.txt
...
 0144-M.txt
</code></pre>
</div>


                            <div id="PKUMMDAnnotationStore.__init__" class="classattr">
                                        <input id="PKUMMDAnnotationStore.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PKUMMDAnnotationStore</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>,</span><span class="param">	<span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="PKUMMDAnnotationStore.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PKUMMDAnnotationStore.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PKUMMDAnnotationStore.__init__-1566"><a href="#PKUMMDAnnotationStore.__init__-1566"><span class="linenos">1566</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="PKUMMDAnnotationStore.__init__-1567"><a href="#PKUMMDAnnotationStore.__init__-1567"><span class="linenos">1567</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1568"><a href="#PKUMMDAnnotationStore.__init__-1568"><span class="linenos">1568</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1569"><a href="#PKUMMDAnnotationStore.__init__-1569"><span class="linenos">1569</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1570"><a href="#PKUMMDAnnotationStore.__init__-1570"><span class="linenos">1570</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1571"><a href="#PKUMMDAnnotationStore.__init__-1571"><span class="linenos">1571</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1572"><a href="#PKUMMDAnnotationStore.__init__-1572"><span class="linenos">1572</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1573"><a href="#PKUMMDAnnotationStore.__init__-1573"><span class="linenos">1573</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1574"><a href="#PKUMMDAnnotationStore.__init__-1574"><span class="linenos">1574</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1575"><a href="#PKUMMDAnnotationStore.__init__-1575"><span class="linenos">1575</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1576"><a href="#PKUMMDAnnotationStore.__init__-1576"><span class="linenos">1576</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1577"><a href="#PKUMMDAnnotationStore.__init__-1577"><span class="linenos">1577</span></a>        <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1578"><a href="#PKUMMDAnnotationStore.__init__-1578"><span class="linenos">1578</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1579"><a href="#PKUMMDAnnotationStore.__init__-1579"><span class="linenos">1579</span></a>        <span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1580"><a href="#PKUMMDAnnotationStore.__init__-1580"><span class="linenos">1580</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1581"><a href="#PKUMMDAnnotationStore.__init__-1581"><span class="linenos">1581</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1582"><a href="#PKUMMDAnnotationStore.__init__-1582"><span class="linenos">1582</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1583"><a href="#PKUMMDAnnotationStore.__init__-1583"><span class="linenos">1583</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1584"><a href="#PKUMMDAnnotationStore.__init__-1584"><span class="linenos">1584</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1585"><a href="#PKUMMDAnnotationStore.__init__-1585"><span class="linenos">1585</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1586"><a href="#PKUMMDAnnotationStore.__init__-1586"><span class="linenos">1586</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1587"><a href="#PKUMMDAnnotationStore.__init__-1587"><span class="linenos">1587</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1588"><a href="#PKUMMDAnnotationStore.__init__-1588"><span class="linenos">1588</span></a>        <span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1589"><a href="#PKUMMDAnnotationStore.__init__-1589"><span class="linenos">1589</span></a>        <span class="n">interactive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1590"><a href="#PKUMMDAnnotationStore.__init__-1590"><span class="linenos">1590</span></a>        <span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1591"><a href="#PKUMMDAnnotationStore.__init__-1591"><span class="linenos">1591</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1592"><a href="#PKUMMDAnnotationStore.__init__-1592"><span class="linenos">1592</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1593"><a href="#PKUMMDAnnotationStore.__init__-1593"><span class="linenos">1593</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PKUMMDAnnotationStore.__init__-1594"><a href="#PKUMMDAnnotationStore.__init__-1594"><span class="linenos">1594</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PKUMMDAnnotationStore.__init__-1595"><a href="#PKUMMDAnnotationStore.__init__-1595"><span class="linenos">1595</span></a><span class="sd">        Parameters</span>
</span><span id="PKUMMDAnnotationStore.__init__-1596"><a href="#PKUMMDAnnotationStore.__init__-1596"><span class="linenos">1596</span></a><span class="sd">        ----------</span>
</span><span id="PKUMMDAnnotationStore.__init__-1597"><a href="#PKUMMDAnnotationStore.__init__-1597"><span class="linenos">1597</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="PKUMMDAnnotationStore.__init__-1598"><a href="#PKUMMDAnnotationStore.__init__-1598"><span class="linenos">1598</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="PKUMMDAnnotationStore.__init__-1599"><a href="#PKUMMDAnnotationStore.__init__-1599"><span class="linenos">1599</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="PKUMMDAnnotationStore.__init__-1600"><a href="#PKUMMDAnnotationStore.__init__-1600"><span class="linenos">1600</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="PKUMMDAnnotationStore.__init__-1601"><a href="#PKUMMDAnnotationStore.__init__-1601"><span class="linenos">1601</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="PKUMMDAnnotationStore.__init__-1602"><a href="#PKUMMDAnnotationStore.__init__-1602"><span class="linenos">1602</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="PKUMMDAnnotationStore.__init__-1603"><a href="#PKUMMDAnnotationStore.__init__-1603"><span class="linenos">1603</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="PKUMMDAnnotationStore.__init__-1604"><a href="#PKUMMDAnnotationStore.__init__-1604"><span class="linenos">1604</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="PKUMMDAnnotationStore.__init__-1605"><a href="#PKUMMDAnnotationStore.__init__-1605"><span class="linenos">1605</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="PKUMMDAnnotationStore.__init__-1606"><a href="#PKUMMDAnnotationStore.__init__-1606"><span class="linenos">1606</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="PKUMMDAnnotationStore.__init__-1607"><a href="#PKUMMDAnnotationStore.__init__-1607"><span class="linenos">1607</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="PKUMMDAnnotationStore.__init__-1608"><a href="#PKUMMDAnnotationStore.__init__-1608"><span class="linenos">1608</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="PKUMMDAnnotationStore.__init__-1609"><a href="#PKUMMDAnnotationStore.__init__-1609"><span class="linenos">1609</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="PKUMMDAnnotationStore.__init__-1610"><a href="#PKUMMDAnnotationStore.__init__-1610"><span class="linenos">1610</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="PKUMMDAnnotationStore.__init__-1611"><a href="#PKUMMDAnnotationStore.__init__-1611"><span class="linenos">1611</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="PKUMMDAnnotationStore.__init__-1612"><a href="#PKUMMDAnnotationStore.__init__-1612"><span class="linenos">1612</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="PKUMMDAnnotationStore.__init__-1613"><a href="#PKUMMDAnnotationStore.__init__-1613"><span class="linenos">1613</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="PKUMMDAnnotationStore.__init__-1614"><a href="#PKUMMDAnnotationStore.__init__-1614"><span class="linenos">1614</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="PKUMMDAnnotationStore.__init__-1615"><a href="#PKUMMDAnnotationStore.__init__-1615"><span class="linenos">1615</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="PKUMMDAnnotationStore.__init__-1616"><a href="#PKUMMDAnnotationStore.__init__-1616"><span class="linenos">1616</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="PKUMMDAnnotationStore.__init__-1617"><a href="#PKUMMDAnnotationStore.__init__-1617"><span class="linenos">1617</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="PKUMMDAnnotationStore.__init__-1618"><a href="#PKUMMDAnnotationStore.__init__-1618"><span class="linenos">1618</span></a><span class="sd">            from key objects)</span>
</span><span id="PKUMMDAnnotationStore.__init__-1619"><a href="#PKUMMDAnnotationStore.__init__-1619"><span class="linenos">1619</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="PKUMMDAnnotationStore.__init__-1620"><a href="#PKUMMDAnnotationStore.__init__-1620"><span class="linenos">1620</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="PKUMMDAnnotationStore.__init__-1621"><a href="#PKUMMDAnnotationStore.__init__-1621"><span class="linenos">1621</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="PKUMMDAnnotationStore.__init__-1622"><a href="#PKUMMDAnnotationStore.__init__-1622"><span class="linenos">1622</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="PKUMMDAnnotationStore.__init__-1623"><a href="#PKUMMDAnnotationStore.__init__-1623"><span class="linenos">1623</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="PKUMMDAnnotationStore.__init__-1624"><a href="#PKUMMDAnnotationStore.__init__-1624"><span class="linenos">1624</span></a><span class="sd">        frame_limit : int, default 0</span>
</span><span id="PKUMMDAnnotationStore.__init__-1625"><a href="#PKUMMDAnnotationStore.__init__-1625"><span class="linenos">1625</span></a><span class="sd">            the smallest possible length of a clip (shorter clips are discarded)</span>
</span><span id="PKUMMDAnnotationStore.__init__-1626"><a href="#PKUMMDAnnotationStore.__init__-1626"><span class="linenos">1626</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="PKUMMDAnnotationStore.__init__-1627"><a href="#PKUMMDAnnotationStore.__init__-1627"><span class="linenos">1627</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="PKUMMDAnnotationStore.__init__-1628"><a href="#PKUMMDAnnotationStore.__init__-1628"><span class="linenos">1628</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="PKUMMDAnnotationStore.__init__-1629"><a href="#PKUMMDAnnotationStore.__init__-1629"><span class="linenos">1629</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="PKUMMDAnnotationStore.__init__-1630"><a href="#PKUMMDAnnotationStore.__init__-1630"><span class="linenos">1630</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="PKUMMDAnnotationStore.__init__-1631"><a href="#PKUMMDAnnotationStore.__init__-1631"><span class="linenos">1631</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="PKUMMDAnnotationStore.__init__-1632"><a href="#PKUMMDAnnotationStore.__init__-1632"><span class="linenos">1632</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="PKUMMDAnnotationStore.__init__-1633"><a href="#PKUMMDAnnotationStore.__init__-1633"><span class="linenos">1633</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="PKUMMDAnnotationStore.__init__-1634"><a href="#PKUMMDAnnotationStore.__init__-1634"><span class="linenos">1634</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="PKUMMDAnnotationStore.__init__-1635"><a href="#PKUMMDAnnotationStore.__init__-1635"><span class="linenos">1635</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="PKUMMDAnnotationStore.__init__-1636"><a href="#PKUMMDAnnotationStore.__init__-1636"><span class="linenos">1636</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="PKUMMDAnnotationStore.__init__-1637"><a href="#PKUMMDAnnotationStore.__init__-1637"><span class="linenos">1637</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="PKUMMDAnnotationStore.__init__-1638"><a href="#PKUMMDAnnotationStore.__init__-1638"><span class="linenos">1638</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="PKUMMDAnnotationStore.__init__-1639"><a href="#PKUMMDAnnotationStore.__init__-1639"><span class="linenos">1639</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="PKUMMDAnnotationStore.__init__-1640"><a href="#PKUMMDAnnotationStore.__init__-1640"><span class="linenos">1640</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="PKUMMDAnnotationStore.__init__-1641"><a href="#PKUMMDAnnotationStore.__init__-1641"><span class="linenos">1641</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="PKUMMDAnnotationStore.__init__-1642"><a href="#PKUMMDAnnotationStore.__init__-1642"><span class="linenos">1642</span></a><span class="sd">        use_hard_negatives : bool, default False</span>
</span><span id="PKUMMDAnnotationStore.__init__-1643"><a href="#PKUMMDAnnotationStore.__init__-1643"><span class="linenos">1643</span></a><span class="sd">            mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing</span>
</span><span id="PKUMMDAnnotationStore.__init__-1644"><a href="#PKUMMDAnnotationStore.__init__-1644"><span class="linenos">1644</span></a><span class="sd">        interactive : bool, default False</span>
</span><span id="PKUMMDAnnotationStore.__init__-1645"><a href="#PKUMMDAnnotationStore.__init__-1645"><span class="linenos">1645</span></a><span class="sd">            if `True`, annotation is assigned to pairs of individuals</span>
</span><span id="PKUMMDAnnotationStore.__init__-1646"><a href="#PKUMMDAnnotationStore.__init__-1646"><span class="linenos">1646</span></a><span class="sd">        ignored_clips : set, optional</span>
</span><span id="PKUMMDAnnotationStore.__init__-1647"><a href="#PKUMMDAnnotationStore.__init__-1647"><span class="linenos">1647</span></a><span class="sd">            a set of clip ids to ignore</span>
</span><span id="PKUMMDAnnotationStore.__init__-1648"><a href="#PKUMMDAnnotationStore.__init__-1648"><span class="linenos">1648</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PKUMMDAnnotationStore.__init__-1649"><a href="#PKUMMDAnnotationStore.__init__-1649"><span class="linenos">1649</span></a>
</span><span id="PKUMMDAnnotationStore.__init__-1650"><a href="#PKUMMDAnnotationStore.__init__-1650"><span class="linenos">1650</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="PKUMMDAnnotationStore.__init__-1651"><a href="#PKUMMDAnnotationStore.__init__-1651"><span class="linenos">1651</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1652"><a href="#PKUMMDAnnotationStore.__init__-1652"><span class="linenos">1652</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1653"><a href="#PKUMMDAnnotationStore.__init__-1653"><span class="linenos">1653</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1654"><a href="#PKUMMDAnnotationStore.__init__-1654"><span class="linenos">1654</span></a>            <span class="n">visibility</span><span class="o">=</span><span class="n">visibility</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1655"><a href="#PKUMMDAnnotationStore.__init__-1655"><span class="linenos">1655</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1656"><a href="#PKUMMDAnnotationStore.__init__-1656"><span class="linenos">1656</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1657"><a href="#PKUMMDAnnotationStore.__init__-1657"><span class="linenos">1657</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1658"><a href="#PKUMMDAnnotationStore.__init__-1658"><span class="linenos">1658</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1659"><a href="#PKUMMDAnnotationStore.__init__-1659"><span class="linenos">1659</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1660"><a href="#PKUMMDAnnotationStore.__init__-1660"><span class="linenos">1660</span></a>            <span class="n">annotation_suffix</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;.txt&quot;</span><span class="p">},</span>
</span><span id="PKUMMDAnnotationStore.__init__-1661"><a href="#PKUMMDAnnotationStore.__init__-1661"><span class="linenos">1661</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1662"><a href="#PKUMMDAnnotationStore.__init__-1662"><span class="linenos">1662</span></a>            <span class="n">behavior_file</span><span class="o">=</span><span class="n">behavior_file</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1663"><a href="#PKUMMDAnnotationStore.__init__-1663"><span class="linenos">1663</span></a>            <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1664"><a href="#PKUMMDAnnotationStore.__init__-1664"><span class="linenos">1664</span></a>            <span class="n">frame_limit</span><span class="o">=</span><span class="n">frame_limit</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1665"><a href="#PKUMMDAnnotationStore.__init__-1665"><span class="linenos">1665</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="n">filter_annotated</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1666"><a href="#PKUMMDAnnotationStore.__init__-1666"><span class="linenos">1666</span></a>            <span class="n">filter_background</span><span class="o">=</span><span class="n">filter_background</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1667"><a href="#PKUMMDAnnotationStore.__init__-1667"><span class="linenos">1667</span></a>            <span class="n">error_class</span><span class="o">=</span><span class="n">error_class</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1668"><a href="#PKUMMDAnnotationStore.__init__-1668"><span class="linenos">1668</span></a>            <span class="n">min_frames_action</span><span class="o">=</span><span class="n">min_frames_action</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1669"><a href="#PKUMMDAnnotationStore.__init__-1669"><span class="linenos">1669</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1670"><a href="#PKUMMDAnnotationStore.__init__-1670"><span class="linenos">1670</span></a>            <span class="n">visibility_min_score</span><span class="o">=</span><span class="n">visibility_min_score</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1671"><a href="#PKUMMDAnnotationStore.__init__-1671"><span class="linenos">1671</span></a>            <span class="n">visibility_min_frac</span><span class="o">=</span><span class="n">visibility_min_frac</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1672"><a href="#PKUMMDAnnotationStore.__init__-1672"><span class="linenos">1672</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1673"><a href="#PKUMMDAnnotationStore.__init__-1673"><span class="linenos">1673</span></a>            <span class="n">use_hard_negatives</span><span class="o">=</span><span class="n">use_hard_negatives</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1674"><a href="#PKUMMDAnnotationStore.__init__-1674"><span class="linenos">1674</span></a>            <span class="n">interactive</span><span class="o">=</span><span class="n">interactive</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1675"><a href="#PKUMMDAnnotationStore.__init__-1675"><span class="linenos">1675</span></a>            <span class="n">ignored_clips</span><span class="o">=</span><span class="n">ignored_clips</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1676"><a href="#PKUMMDAnnotationStore.__init__-1676"><span class="linenos">1676</span></a>            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1677"><a href="#PKUMMDAnnotationStore.__init__-1677"><span class="linenos">1677</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="PKUMMDAnnotationStore.__init__-1678"><a href="#PKUMMDAnnotationStore.__init__-1678"><span class="linenos">1678</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h2 id="parameters">Parameters</h2>

<p>video_order : list, optional
    a list of video ids that should be processed in the same order (not passed if creating from key objects)
min_frames : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    clip start frames (not passed if creating from key objects)
max_frames : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    clip end frames (not passed if creating from key objects)
visibility : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)
exclusive : bool, default True
    if True, the annotation is single-label; if False, multi-label
len_segment : int, default 128
    the length of the segments in which the data should be cut (in frames)
overlap : int, default 0
    the length of the overlap between neighboring segments (in frames)
ignored_classes : set, optional
    the list of behaviors from the behaviors list or file to not annotate
annotation_path : str | set, optional
    the path or the set of paths to the folder where the annotation files are stored (not passed if creating
    from key objects)
behavior_file : str, optional
    the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)
correction : dict, optional
    a dictionary of corrections for the labels (e.g. {'sleping': 'sleeping', 'calm locomotion': 'locomotion'},
    can be used to correct for variations in naming or to merge several labels in one
frame_limit : int, default 0
    the smallest possible length of a clip (shorter clips are discarded)
filter_annotated : bool, default False
    if True, the samples that do not have any labels will be filtered
filter_background : bool, default False
    if True, only the unlabeled frames that are close to annotated frames will be labeled as background
error_class : str, optional
    the name of the error class (the annotations that intersect with this label will be discarded)
min_frames_action : int, default 0
    the minimum length of an action (shorter actions are not annotated)
key_objects : tuple, optional
    the key objects to load the AnnotationStore from
visibility_min_score : float, default 5
    the minimum visibility score for visibility filtering
visibility_min_frac : float, default 0.7
    the minimum fraction of visible frames for visibility filtering
mask : dict, optional
    a masked value dictionary (for active learning simulation experiments)
use_hard_negatives : bool, default False
    mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing
interactive : bool, default False
    if <code>True</code>, annotation is assigned to pairs of individuals
ignored_clips : set, optional
    a set of clip ids to ignore</p>
</div>


                            </div>
                            <div id="PKUMMDAnnotationStore.get_file_ids" class="classattr">
                                        <input id="PKUMMDAnnotationStore.get_file_ids-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_file_ids</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">]</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n">List</span>:</span></span>

                <label class="view-source-button" for="PKUMMDAnnotationStore.get_file_ids-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PKUMMDAnnotationStore.get_file_ids"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PKUMMDAnnotationStore.get_file_ids-1680"><a href="#PKUMMDAnnotationStore.get_file_ids-1680"><span class="linenos">1680</span></a>    <span class="nd">@classmethod</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1681"><a href="#PKUMMDAnnotationStore.get_file_ids-1681"><span class="linenos">1681</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1682"><a href="#PKUMMDAnnotationStore.get_file_ids-1682"><span class="linenos">1682</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1683"><a href="#PKUMMDAnnotationStore.get_file_ids-1683"><span class="linenos">1683</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1684"><a href="#PKUMMDAnnotationStore.get_file_ids-1684"><span class="linenos">1684</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1685"><a href="#PKUMMDAnnotationStore.get_file_ids-1685"><span class="linenos">1685</span></a>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1686"><a href="#PKUMMDAnnotationStore.get_file_ids-1686"><span class="linenos">1686</span></a><span class="sd">        Parameters</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1687"><a href="#PKUMMDAnnotationStore.get_file_ids-1687"><span class="linenos">1687</span></a><span class="sd">        ----------</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1688"><a href="#PKUMMDAnnotationStore.get_file_ids-1688"><span class="linenos">1688</span></a><span class="sd">        annotation_path : str | set</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1689"><a href="#PKUMMDAnnotationStore.get_file_ids-1689"><span class="linenos">1689</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1690"><a href="#PKUMMDAnnotationStore.get_file_ids-1690"><span class="linenos">1690</span></a>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1691"><a href="#PKUMMDAnnotationStore.get_file_ids-1691"><span class="linenos">1691</span></a><span class="sd">        Returns</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1692"><a href="#PKUMMDAnnotationStore.get_file_ids-1692"><span class="linenos">1692</span></a><span class="sd">        -------</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1693"><a href="#PKUMMDAnnotationStore.get_file_ids-1693"><span class="linenos">1693</span></a><span class="sd">        video_ids : list</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1694"><a href="#PKUMMDAnnotationStore.get_file_ids-1694"><span class="linenos">1694</span></a><span class="sd">            a list of video file ids</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1695"><a href="#PKUMMDAnnotationStore.get_file_ids-1695"><span class="linenos">1695</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1696"><a href="#PKUMMDAnnotationStore.get_file_ids-1696"><span class="linenos">1696</span></a>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1697"><a href="#PKUMMDAnnotationStore.get_file_ids-1697"><span class="linenos">1697</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">annotation_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1698"><a href="#PKUMMDAnnotationStore.get_file_ids-1698"><span class="linenos">1698</span></a>            <span class="n">annotation_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">annotation_path</span><span class="p">]</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1699"><a href="#PKUMMDAnnotationStore.get_file_ids-1699"><span class="linenos">1699</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1700"><a href="#PKUMMDAnnotationStore.get_file_ids-1700"><span class="linenos">1700</span></a>        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">annotation_path</span><span class="p">:</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1701"><a href="#PKUMMDAnnotationStore.get_file_ids-1701"><span class="linenos">1701</span></a>            <span class="n">files</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1702"><a href="#PKUMMDAnnotationStore.get_file_ids-1702"><span class="linenos">1702</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">)[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;.txt&quot;</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1703"><a href="#PKUMMDAnnotationStore.get_file_ids-1703"><span class="linenos">1703</span></a>            <span class="p">]</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1704"><a href="#PKUMMDAnnotationStore.get_file_ids-1704"><span class="linenos">1704</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="PKUMMDAnnotationStore.get_file_ids-1705"><a href="#PKUMMDAnnotationStore.get_file_ids-1705"><span class="linenos">1705</span></a>        <span class="k">return</span> <span class="n">files</span>
</span></pre></div>


            <div class="docstring"><p>Process data parameters and return a list of ids  of the videos that should
be processed by the __init__ function</p>

<h2 id="parameters">Parameters</h2>

<p>annotation_path : str | set
    the path or the set of paths to the folder where the annotation files are stored</p>

<h2 id="returns">Returns</h2>

<p>video_ids : list
    a list of video file ids</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ActionSegmentationStore">ActionSegmentationStore</a></dt>
                                <dd id="PKUMMDAnnotationStore.remove" class="function"><a href="#ActionSegmentationStore.remove">remove</a></dd>
                <dd id="PKUMMDAnnotationStore.key_objects" class="function"><a href="#ActionSegmentationStore.key_objects">key_objects</a></dd>
                <dd id="PKUMMDAnnotationStore.load_from_key_objects" class="function"><a href="#ActionSegmentationStore.load_from_key_objects">load_from_key_objects</a></dd>
                <dd id="PKUMMDAnnotationStore.to_ram" class="function"><a href="#ActionSegmentationStore.to_ram">to_ram</a></dd>
                <dd id="PKUMMDAnnotationStore.get_original_coordinates" class="function"><a href="#ActionSegmentationStore.get_original_coordinates">get_original_coordinates</a></dd>
                <dd id="PKUMMDAnnotationStore.create_subsample" class="function"><a href="#ActionSegmentationStore.create_subsample">create_subsample</a></dd>
                <dd id="PKUMMDAnnotationStore.get_len" class="function"><a href="#ActionSegmentationStore.get_len">get_len</a></dd>
                <dd id="PKUMMDAnnotationStore.get_indices" class="function"><a href="#ActionSegmentationStore.get_indices">get_indices</a></dd>
                <dd id="PKUMMDAnnotationStore.count_classes" class="function"><a href="#ActionSegmentationStore.count_classes">count_classes</a></dd>
                <dd id="PKUMMDAnnotationStore.behaviors_dict" class="function"><a href="#ActionSegmentationStore.behaviors_dict">behaviors_dict</a></dd>
                <dd id="PKUMMDAnnotationStore.annotation_class" class="function"><a href="#ActionSegmentationStore.annotation_class">annotation_class</a></dd>
                <dd id="PKUMMDAnnotationStore.size" class="function"><a href="#ActionSegmentationStore.size">size</a></dd>
                <dd id="PKUMMDAnnotationStore.filtered_indices" class="function"><a href="#ActionSegmentationStore.filtered_indices">filtered_indices</a></dd>
                <dd id="PKUMMDAnnotationStore.set_pseudo_labels" class="function"><a href="#ActionSegmentationStore.set_pseudo_labels">set_pseudo_labels</a></dd>

            </div>
            <div><dt><a href="base_store.html#AnnotationStore">dlc2action.data.base_store.AnnotationStore</a></dt>
                                <dd id="PKUMMDAnnotationStore.required_objects" class="variable"><a href="base_store.html#AnnotationStore.required_objects">required_objects</a></dd>

            </div>
            <div><dt><a href="base_store.html#Store">dlc2action.data.base_store.Store</a></dt>
                                <dd id="PKUMMDAnnotationStore.get_parameters" class="function"><a href="base_store.html#Store.get_parameters">get_parameters</a></dd>
                <dd id="PKUMMDAnnotationStore.new" class="function"><a href="base_store.html#Store.new">new</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="CalMS21AnnotationStore">
                            <input id="CalMS21AnnotationStore-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CalMS21AnnotationStore</span><wbr>(<span class="base"><a href="#SequenceAnnotationStore">SequenceAnnotationStore</a></span>):

                <label class="view-source-button" for="CalMS21AnnotationStore-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CalMS21AnnotationStore"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CalMS21AnnotationStore-1741"><a href="#CalMS21AnnotationStore-1741"><span class="linenos">1741</span></a><span class="k">class</span> <span class="nc">CalMS21AnnotationStore</span><span class="p">(</span><span class="n">SequenceAnnotationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="CalMS21AnnotationStore-1742"><a href="#CalMS21AnnotationStore-1742"><span class="linenos">1742</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CalMS21AnnotationStore-1743"><a href="#CalMS21AnnotationStore-1743"><span class="linenos">1743</span></a><span class="sd">    CalMS21 annotation data</span>
</span><span id="CalMS21AnnotationStore-1744"><a href="#CalMS21AnnotationStore-1744"><span class="linenos">1744</span></a>
</span><span id="CalMS21AnnotationStore-1745"><a href="#CalMS21AnnotationStore-1745"><span class="linenos">1745</span></a><span class="sd">    Use the `&#39;random:test_from_name:{name}&#39;` and `&#39;val-from-name:{val_name}:test-from-name:{test_name}&#39;`</span>
</span><span id="CalMS21AnnotationStore-1746"><a href="#CalMS21AnnotationStore-1746"><span class="linenos">1746</span></a><span class="sd">    partitioning methods with `&#39;train&#39;`, `&#39;test&#39;` and `&#39;unlabeled&#39;` names to separate into train, test and validation</span>
</span><span id="CalMS21AnnotationStore-1747"><a href="#CalMS21AnnotationStore-1747"><span class="linenos">1747</span></a><span class="sd">    subsets according to the original files. For example, with `&#39;val-from-name:test:test-from-name:unlabeled&#39;`</span>
</span><span id="CalMS21AnnotationStore-1748"><a href="#CalMS21AnnotationStore-1748"><span class="linenos">1748</span></a><span class="sd">    the data from the test file will go into validation and the unlabeled files will be the test.</span>
</span><span id="CalMS21AnnotationStore-1749"><a href="#CalMS21AnnotationStore-1749"><span class="linenos">1749</span></a>
</span><span id="CalMS21AnnotationStore-1750"><a href="#CalMS21AnnotationStore-1750"><span class="linenos">1750</span></a><span class="sd">    Assumes the following file structure:</span>
</span><span id="CalMS21AnnotationStore-1751"><a href="#CalMS21AnnotationStore-1751"><span class="linenos">1751</span></a><span class="sd">    ```</span>
</span><span id="CalMS21AnnotationStore-1752"><a href="#CalMS21AnnotationStore-1752"><span class="linenos">1752</span></a><span class="sd">    annotation_path</span>
</span><span id="CalMS21AnnotationStore-1753"><a href="#CalMS21AnnotationStore-1753"><span class="linenos">1753</span></a><span class="sd">     calms21_task_train.npy</span>
</span><span id="CalMS21AnnotationStore-1754"><a href="#CalMS21AnnotationStore-1754"><span class="linenos">1754</span></a><span class="sd">     calms21_task_test.npy</span>
</span><span id="CalMS21AnnotationStore-1755"><a href="#CalMS21AnnotationStore-1755"><span class="linenos">1755</span></a><span class="sd">     calms21_unlabeled_videos_part1.npy</span>
</span><span id="CalMS21AnnotationStore-1756"><a href="#CalMS21AnnotationStore-1756"><span class="linenos">1756</span></a><span class="sd">     calms21_unlabeled_videos_part2.npy</span>
</span><span id="CalMS21AnnotationStore-1757"><a href="#CalMS21AnnotationStore-1757"><span class="linenos">1757</span></a><span class="sd">     calms21_unlabeled_videos_part3.npy</span>
</span><span id="CalMS21AnnotationStore-1758"><a href="#CalMS21AnnotationStore-1758"><span class="linenos">1758</span></a><span class="sd">    ```</span>
</span><span id="CalMS21AnnotationStore-1759"><a href="#CalMS21AnnotationStore-1759"><span class="linenos">1759</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CalMS21AnnotationStore-1760"><a href="#CalMS21AnnotationStore-1760"><span class="linenos">1760</span></a>
</span><span id="CalMS21AnnotationStore-1761"><a href="#CalMS21AnnotationStore-1761"><span class="linenos">1761</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1762"><a href="#CalMS21AnnotationStore-1762"><span class="linenos">1762</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1763"><a href="#CalMS21AnnotationStore-1763"><span class="linenos">1763</span></a>        <span class="n">task_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1764"><a href="#CalMS21AnnotationStore-1764"><span class="linenos">1764</span></a>        <span class="n">include_task1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1765"><a href="#CalMS21AnnotationStore-1765"><span class="linenos">1765</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1766"><a href="#CalMS21AnnotationStore-1766"><span class="linenos">1766</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1767"><a href="#CalMS21AnnotationStore-1767"><span class="linenos">1767</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1768"><a href="#CalMS21AnnotationStore-1768"><span class="linenos">1768</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1769"><a href="#CalMS21AnnotationStore-1769"><span class="linenos">1769</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1770"><a href="#CalMS21AnnotationStore-1770"><span class="linenos">1770</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1771"><a href="#CalMS21AnnotationStore-1771"><span class="linenos">1771</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1772"><a href="#CalMS21AnnotationStore-1772"><span class="linenos">1772</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1773"><a href="#CalMS21AnnotationStore-1773"><span class="linenos">1773</span></a>        <span class="n">treba_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1774"><a href="#CalMS21AnnotationStore-1774"><span class="linenos">1774</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1775"><a href="#CalMS21AnnotationStore-1775"><span class="linenos">1775</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1776"><a href="#CalMS21AnnotationStore-1776"><span class="linenos">1776</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1777"><a href="#CalMS21AnnotationStore-1777"><span class="linenos">1777</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CalMS21AnnotationStore-1778"><a href="#CalMS21AnnotationStore-1778"><span class="linenos">1778</span></a>
</span><span id="CalMS21AnnotationStore-1779"><a href="#CalMS21AnnotationStore-1779"><span class="linenos">1779</span></a><span class="sd">        Parameters</span>
</span><span id="CalMS21AnnotationStore-1780"><a href="#CalMS21AnnotationStore-1780"><span class="linenos">1780</span></a><span class="sd">        ----------</span>
</span><span id="CalMS21AnnotationStore-1781"><a href="#CalMS21AnnotationStore-1781"><span class="linenos">1781</span></a><span class="sd">        task_n : [1, 2]</span>
</span><span id="CalMS21AnnotationStore-1782"><a href="#CalMS21AnnotationStore-1782"><span class="linenos">1782</span></a><span class="sd">            the number of the task</span>
</span><span id="CalMS21AnnotationStore-1783"><a href="#CalMS21AnnotationStore-1783"><span class="linenos">1783</span></a><span class="sd">        include_task1 : bool, default True</span>
</span><span id="CalMS21AnnotationStore-1784"><a href="#CalMS21AnnotationStore-1784"><span class="linenos">1784</span></a><span class="sd">            include task 1 data to training set</span>
</span><span id="CalMS21AnnotationStore-1785"><a href="#CalMS21AnnotationStore-1785"><span class="linenos">1785</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="CalMS21AnnotationStore-1786"><a href="#CalMS21AnnotationStore-1786"><span class="linenos">1786</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="CalMS21AnnotationStore-1787"><a href="#CalMS21AnnotationStore-1787"><span class="linenos">1787</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="CalMS21AnnotationStore-1788"><a href="#CalMS21AnnotationStore-1788"><span class="linenos">1788</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="CalMS21AnnotationStore-1789"><a href="#CalMS21AnnotationStore-1789"><span class="linenos">1789</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="CalMS21AnnotationStore-1790"><a href="#CalMS21AnnotationStore-1790"><span class="linenos">1790</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="CalMS21AnnotationStore-1791"><a href="#CalMS21AnnotationStore-1791"><span class="linenos">1791</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="CalMS21AnnotationStore-1792"><a href="#CalMS21AnnotationStore-1792"><span class="linenos">1792</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="CalMS21AnnotationStore-1793"><a href="#CalMS21AnnotationStore-1793"><span class="linenos">1793</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="CalMS21AnnotationStore-1794"><a href="#CalMS21AnnotationStore-1794"><span class="linenos">1794</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="CalMS21AnnotationStore-1795"><a href="#CalMS21AnnotationStore-1795"><span class="linenos">1795</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="CalMS21AnnotationStore-1796"><a href="#CalMS21AnnotationStore-1796"><span class="linenos">1796</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="CalMS21AnnotationStore-1797"><a href="#CalMS21AnnotationStore-1797"><span class="linenos">1797</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="CalMS21AnnotationStore-1798"><a href="#CalMS21AnnotationStore-1798"><span class="linenos">1798</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="CalMS21AnnotationStore-1799"><a href="#CalMS21AnnotationStore-1799"><span class="linenos">1799</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="CalMS21AnnotationStore-1800"><a href="#CalMS21AnnotationStore-1800"><span class="linenos">1800</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="CalMS21AnnotationStore-1801"><a href="#CalMS21AnnotationStore-1801"><span class="linenos">1801</span></a><span class="sd">            from key objects)</span>
</span><span id="CalMS21AnnotationStore-1802"><a href="#CalMS21AnnotationStore-1802"><span class="linenos">1802</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="CalMS21AnnotationStore-1803"><a href="#CalMS21AnnotationStore-1803"><span class="linenos">1803</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="CalMS21AnnotationStore-1804"><a href="#CalMS21AnnotationStore-1804"><span class="linenos">1804</span></a><span class="sd">        treba_files : bool, default False</span>
</span><span id="CalMS21AnnotationStore-1805"><a href="#CalMS21AnnotationStore-1805"><span class="linenos">1805</span></a><span class="sd">            if `True`, TREBA feature files will be loaded</span>
</span><span id="CalMS21AnnotationStore-1806"><a href="#CalMS21AnnotationStore-1806"><span class="linenos">1806</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CalMS21AnnotationStore-1807"><a href="#CalMS21AnnotationStore-1807"><span class="linenos">1807</span></a>
</span><span id="CalMS21AnnotationStore-1808"><a href="#CalMS21AnnotationStore-1808"><span class="linenos">1808</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">task_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">task_n</span><span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1809"><a href="#CalMS21AnnotationStore-1809"><span class="linenos">1809</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_task1</span> <span class="o">=</span> <span class="n">include_task1</span>
</span><span id="CalMS21AnnotationStore-1810"><a href="#CalMS21AnnotationStore-1810"><span class="linenos">1810</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1811"><a href="#CalMS21AnnotationStore-1811"><span class="linenos">1811</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">include_task1</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="CalMS21AnnotationStore-1812"><a href="#CalMS21AnnotationStore-1812"><span class="linenos">1812</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">treba_files</span> <span class="o">=</span> <span class="n">treba_files</span>
</span><span id="CalMS21AnnotationStore-1813"><a href="#CalMS21AnnotationStore-1813"><span class="linenos">1813</span></a>        <span class="k">if</span> <span class="s2">&quot;exclusive&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1814"><a href="#CalMS21AnnotationStore-1814"><span class="linenos">1814</span></a>            <span class="n">exclusive</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;exclusive&quot;</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore-1815"><a href="#CalMS21AnnotationStore-1815"><span class="linenos">1815</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1816"><a href="#CalMS21AnnotationStore-1816"><span class="linenos">1816</span></a>            <span class="n">exclusive</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="CalMS21AnnotationStore-1817"><a href="#CalMS21AnnotationStore-1817"><span class="linenos">1817</span></a>        <span class="k">if</span> <span class="s2">&quot;behaviors&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;behaviors&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1818"><a href="#CalMS21AnnotationStore-1818"><span class="linenos">1818</span></a>            <span class="n">behaviors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;behaviors&quot;</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore-1819"><a href="#CalMS21AnnotationStore-1819"><span class="linenos">1819</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1820"><a href="#CalMS21AnnotationStore-1820"><span class="linenos">1820</span></a>            <span class="n">behaviors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;attack&quot;</span><span class="p">,</span> <span class="s2">&quot;investigation&quot;</span><span class="p">,</span> <span class="s2">&quot;mount&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore-1821"><a href="#CalMS21AnnotationStore-1821"><span class="linenos">1821</span></a>            <span class="k">if</span> <span class="n">task_n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1822"><a href="#CalMS21AnnotationStore-1822"><span class="linenos">1822</span></a>                <span class="n">exclusive</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="CalMS21AnnotationStore-1823"><a href="#CalMS21AnnotationStore-1823"><span class="linenos">1823</span></a>                <span class="n">behaviors</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="CalMS21AnnotationStore-1824"><a href="#CalMS21AnnotationStore-1824"><span class="linenos">1824</span></a>                    <span class="s2">&quot;approach&quot;</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1825"><a href="#CalMS21AnnotationStore-1825"><span class="linenos">1825</span></a>                    <span class="s2">&quot;disengaged&quot;</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1826"><a href="#CalMS21AnnotationStore-1826"><span class="linenos">1826</span></a>                    <span class="s2">&quot;groom&quot;</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1827"><a href="#CalMS21AnnotationStore-1827"><span class="linenos">1827</span></a>                    <span class="s2">&quot;intromission&quot;</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1828"><a href="#CalMS21AnnotationStore-1828"><span class="linenos">1828</span></a>                    <span class="s2">&quot;mount_attempt&quot;</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1829"><a href="#CalMS21AnnotationStore-1829"><span class="linenos">1829</span></a>                    <span class="s2">&quot;sniff_face&quot;</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1830"><a href="#CalMS21AnnotationStore-1830"><span class="linenos">1830</span></a>                    <span class="s2">&quot;whiterearing&quot;</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1831"><a href="#CalMS21AnnotationStore-1831"><span class="linenos">1831</span></a>                <span class="p">]</span>
</span><span id="CalMS21AnnotationStore-1832"><a href="#CalMS21AnnotationStore-1832"><span class="linenos">1832</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1833"><a href="#CalMS21AnnotationStore-1833"><span class="linenos">1833</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1834"><a href="#CalMS21AnnotationStore-1834"><span class="linenos">1834</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1835"><a href="#CalMS21AnnotationStore-1835"><span class="linenos">1835</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1836"><a href="#CalMS21AnnotationStore-1836"><span class="linenos">1836</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1837"><a href="#CalMS21AnnotationStore-1837"><span class="linenos">1837</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1838"><a href="#CalMS21AnnotationStore-1838"><span class="linenos">1838</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1839"><a href="#CalMS21AnnotationStore-1839"><span class="linenos">1839</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1840"><a href="#CalMS21AnnotationStore-1840"><span class="linenos">1840</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1841"><a href="#CalMS21AnnotationStore-1841"><span class="linenos">1841</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1842"><a href="#CalMS21AnnotationStore-1842"><span class="linenos">1842</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1843"><a href="#CalMS21AnnotationStore-1843"><span class="linenos">1843</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1844"><a href="#CalMS21AnnotationStore-1844"><span class="linenos">1844</span></a>            <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1845"><a href="#CalMS21AnnotationStore-1845"><span class="linenos">1845</span></a>        <span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1846"><a href="#CalMS21AnnotationStore-1846"><span class="linenos">1846</span></a>
</span><span id="CalMS21AnnotationStore-1847"><a href="#CalMS21AnnotationStore-1847"><span class="linenos">1847</span></a>    <span class="nd">@classmethod</span>
</span><span id="CalMS21AnnotationStore-1848"><a href="#CalMS21AnnotationStore-1848"><span class="linenos">1848</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1849"><a href="#CalMS21AnnotationStore-1849"><span class="linenos">1849</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1850"><a href="#CalMS21AnnotationStore-1850"><span class="linenos">1850</span></a>        <span class="n">task_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1851"><a href="#CalMS21AnnotationStore-1851"><span class="linenos">1851</span></a>        <span class="n">include_task1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1852"><a href="#CalMS21AnnotationStore-1852"><span class="linenos">1852</span></a>        <span class="n">treba_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1853"><a href="#CalMS21AnnotationStore-1853"><span class="linenos">1853</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1854"><a href="#CalMS21AnnotationStore-1854"><span class="linenos">1854</span></a>        <span class="n">file_paths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1855"><a href="#CalMS21AnnotationStore-1855"><span class="linenos">1855</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1856"><a href="#CalMS21AnnotationStore-1856"><span class="linenos">1856</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore-1857"><a href="#CalMS21AnnotationStore-1857"><span class="linenos">1857</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1858"><a href="#CalMS21AnnotationStore-1858"><span class="linenos">1858</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CalMS21AnnotationStore-1859"><a href="#CalMS21AnnotationStore-1859"><span class="linenos">1859</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="CalMS21AnnotationStore-1860"><a href="#CalMS21AnnotationStore-1860"><span class="linenos">1860</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="CalMS21AnnotationStore-1861"><a href="#CalMS21AnnotationStore-1861"><span class="linenos">1861</span></a>
</span><span id="CalMS21AnnotationStore-1862"><a href="#CalMS21AnnotationStore-1862"><span class="linenos">1862</span></a><span class="sd">        Parameters</span>
</span><span id="CalMS21AnnotationStore-1863"><a href="#CalMS21AnnotationStore-1863"><span class="linenos">1863</span></a><span class="sd">        ----------</span>
</span><span id="CalMS21AnnotationStore-1864"><a href="#CalMS21AnnotationStore-1864"><span class="linenos">1864</span></a><span class="sd">        task_n : {1, 2, 3}</span>
</span><span id="CalMS21AnnotationStore-1865"><a href="#CalMS21AnnotationStore-1865"><span class="linenos">1865</span></a><span class="sd">            the index of the CalMS21 challenge task</span>
</span><span id="CalMS21AnnotationStore-1866"><a href="#CalMS21AnnotationStore-1866"><span class="linenos">1866</span></a><span class="sd">        include_task1 : bool, default False</span>
</span><span id="CalMS21AnnotationStore-1867"><a href="#CalMS21AnnotationStore-1867"><span class="linenos">1867</span></a><span class="sd">            if `True`, the training file of the task 1 will be loaded</span>
</span><span id="CalMS21AnnotationStore-1868"><a href="#CalMS21AnnotationStore-1868"><span class="linenos">1868</span></a><span class="sd">        treba_files : bool, default False</span>
</span><span id="CalMS21AnnotationStore-1869"><a href="#CalMS21AnnotationStore-1869"><span class="linenos">1869</span></a><span class="sd">            if `True`, the TREBA feature files will be loaded</span>
</span><span id="CalMS21AnnotationStore-1870"><a href="#CalMS21AnnotationStore-1870"><span class="linenos">1870</span></a><span class="sd">        filenames : set, optional</span>
</span><span id="CalMS21AnnotationStore-1871"><a href="#CalMS21AnnotationStore-1871"><span class="linenos">1871</span></a><span class="sd">            a set of string filenames to search for (only basenames, not the whole paths)</span>
</span><span id="CalMS21AnnotationStore-1872"><a href="#CalMS21AnnotationStore-1872"><span class="linenos">1872</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="CalMS21AnnotationStore-1873"><a href="#CalMS21AnnotationStore-1873"><span class="linenos">1873</span></a><span class="sd">            the path to the folder where the pose and feature files are stored or a set of such paths</span>
</span><span id="CalMS21AnnotationStore-1874"><a href="#CalMS21AnnotationStore-1874"><span class="linenos">1874</span></a><span class="sd">            (not passed if creating from key objects or from `file_paths`)</span>
</span><span id="CalMS21AnnotationStore-1875"><a href="#CalMS21AnnotationStore-1875"><span class="linenos">1875</span></a><span class="sd">        file_paths : set, optional</span>
</span><span id="CalMS21AnnotationStore-1876"><a href="#CalMS21AnnotationStore-1876"><span class="linenos">1876</span></a><span class="sd">            a set of string paths to the pose and feature files</span>
</span><span id="CalMS21AnnotationStore-1877"><a href="#CalMS21AnnotationStore-1877"><span class="linenos">1877</span></a><span class="sd">            (not passed if creating from key objects or from `data_path`)</span>
</span><span id="CalMS21AnnotationStore-1878"><a href="#CalMS21AnnotationStore-1878"><span class="linenos">1878</span></a>
</span><span id="CalMS21AnnotationStore-1879"><a href="#CalMS21AnnotationStore-1879"><span class="linenos">1879</span></a><span class="sd">        Returns</span>
</span><span id="CalMS21AnnotationStore-1880"><a href="#CalMS21AnnotationStore-1880"><span class="linenos">1880</span></a><span class="sd">        -------</span>
</span><span id="CalMS21AnnotationStore-1881"><a href="#CalMS21AnnotationStore-1881"><span class="linenos">1881</span></a><span class="sd">        video_ids : list</span>
</span><span id="CalMS21AnnotationStore-1882"><a href="#CalMS21AnnotationStore-1882"><span class="linenos">1882</span></a><span class="sd">            a list of video file ids</span>
</span><span id="CalMS21AnnotationStore-1883"><a href="#CalMS21AnnotationStore-1883"><span class="linenos">1883</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CalMS21AnnotationStore-1884"><a href="#CalMS21AnnotationStore-1884"><span class="linenos">1884</span></a>
</span><span id="CalMS21AnnotationStore-1885"><a href="#CalMS21AnnotationStore-1885"><span class="linenos">1885</span></a>        <span class="n">task_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">task_n</span><span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1886"><a href="#CalMS21AnnotationStore-1886"><span class="linenos">1886</span></a>        <span class="k">if</span> <span class="n">task_n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1887"><a href="#CalMS21AnnotationStore-1887"><span class="linenos">1887</span></a>            <span class="n">include_task1</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="CalMS21AnnotationStore-1888"><a href="#CalMS21AnnotationStore-1888"><span class="linenos">1888</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CalMS21AnnotationStore-1889"><a href="#CalMS21AnnotationStore-1889"><span class="linenos">1889</span></a>        <span class="k">if</span> <span class="n">treba_files</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1890"><a href="#CalMS21AnnotationStore-1890"><span class="linenos">1890</span></a>            <span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;_features&quot;</span>
</span><span id="CalMS21AnnotationStore-1891"><a href="#CalMS21AnnotationStore-1891"><span class="linenos">1891</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1892"><a href="#CalMS21AnnotationStore-1892"><span class="linenos">1892</span></a>            <span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="CalMS21AnnotationStore-1893"><a href="#CalMS21AnnotationStore-1893"><span class="linenos">1893</span></a>        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calms21_task</span><span class="si">{</span><span class="n">task_n</span><span class="si">}</span><span class="s2">_train</span><span class="si">{</span><span class="n">postfix</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1894"><a href="#CalMS21AnnotationStore-1894"><span class="linenos">1894</span></a>        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calms21_task</span><span class="si">{</span><span class="n">task_n</span><span class="si">}</span><span class="s2">_test</span><span class="si">{</span><span class="n">postfix</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1895"><a href="#CalMS21AnnotationStore-1895"><span class="linenos">1895</span></a>        <span class="k">if</span> <span class="n">include_task1</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1896"><a href="#CalMS21AnnotationStore-1896"><span class="linenos">1896</span></a>            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calms21_task1_train</span><span class="si">{</span><span class="n">postfix</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1897"><a href="#CalMS21AnnotationStore-1897"><span class="linenos">1897</span></a>        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1898"><a href="#CalMS21AnnotationStore-1898"><span class="linenos">1898</span></a>        <span class="k">return</span> <span class="n">SequenceAnnotationStore</span><span class="o">.</span><span class="n">get_file_ids</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1899"><a href="#CalMS21AnnotationStore-1899"><span class="linenos">1899</span></a>            <span class="n">filenames</span><span class="p">,</span> <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span>
</span><span id="CalMS21AnnotationStore-1900"><a href="#CalMS21AnnotationStore-1900"><span class="linenos">1900</span></a>        <span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1901"><a href="#CalMS21AnnotationStore-1901"><span class="linenos">1901</span></a>
</span><span id="CalMS21AnnotationStore-1902"><a href="#CalMS21AnnotationStore-1902"><span class="linenos">1902</span></a>    <span class="k">def</span> <span class="nf">_open_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1903"><a href="#CalMS21AnnotationStore-1903"><span class="linenos">1903</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CalMS21AnnotationStore-1904"><a href="#CalMS21AnnotationStore-1904"><span class="linenos">1904</span></a><span class="sd">        Load the annotation from filename</span>
</span><span id="CalMS21AnnotationStore-1905"><a href="#CalMS21AnnotationStore-1905"><span class="linenos">1905</span></a>
</span><span id="CalMS21AnnotationStore-1906"><a href="#CalMS21AnnotationStore-1906"><span class="linenos">1906</span></a><span class="sd">        Parameters</span>
</span><span id="CalMS21AnnotationStore-1907"><a href="#CalMS21AnnotationStore-1907"><span class="linenos">1907</span></a><span class="sd">        ----------</span>
</span><span id="CalMS21AnnotationStore-1908"><a href="#CalMS21AnnotationStore-1908"><span class="linenos">1908</span></a><span class="sd">        filename : str</span>
</span><span id="CalMS21AnnotationStore-1909"><a href="#CalMS21AnnotationStore-1909"><span class="linenos">1909</span></a><span class="sd">            path to an annotation file</span>
</span><span id="CalMS21AnnotationStore-1910"><a href="#CalMS21AnnotationStore-1910"><span class="linenos">1910</span></a>
</span><span id="CalMS21AnnotationStore-1911"><a href="#CalMS21AnnotationStore-1911"><span class="linenos">1911</span></a><span class="sd">        Returns</span>
</span><span id="CalMS21AnnotationStore-1912"><a href="#CalMS21AnnotationStore-1912"><span class="linenos">1912</span></a><span class="sd">        -------</span>
</span><span id="CalMS21AnnotationStore-1913"><a href="#CalMS21AnnotationStore-1913"><span class="linenos">1913</span></a><span class="sd">        times : dict</span>
</span><span id="CalMS21AnnotationStore-1914"><a href="#CalMS21AnnotationStore-1914"><span class="linenos">1914</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids,</span>
</span><span id="CalMS21AnnotationStore-1915"><a href="#CalMS21AnnotationStore-1915"><span class="linenos">1915</span></a><span class="sd">            third-level keys are categories and values are</span>
</span><span id="CalMS21AnnotationStore-1916"><a href="#CalMS21AnnotationStore-1916"><span class="linenos">1916</span></a><span class="sd">            lists of (start, end, ambiguity status) lists</span>
</span><span id="CalMS21AnnotationStore-1917"><a href="#CalMS21AnnotationStore-1917"><span class="linenos">1917</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CalMS21AnnotationStore-1918"><a href="#CalMS21AnnotationStore-1918"><span class="linenos">1918</span></a>
</span><span id="CalMS21AnnotationStore-1919"><a href="#CalMS21AnnotationStore-1919"><span class="linenos">1919</span></a>        <span class="n">data_dict</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="CalMS21AnnotationStore-1920"><a href="#CalMS21AnnotationStore-1920"><span class="linenos">1920</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CalMS21AnnotationStore-1921"><a href="#CalMS21AnnotationStore-1921"><span class="linenos">1921</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="CalMS21AnnotationStore-1922"><a href="#CalMS21AnnotationStore-1922"><span class="linenos">1922</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="CalMS21AnnotationStore-1923"><a href="#CalMS21AnnotationStore-1923"><span class="linenos">1923</span></a>        <span class="k">if</span> <span class="s2">&quot;test&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="CalMS21AnnotationStore-1924"><a href="#CalMS21AnnotationStore-1924"><span class="linenos">1924</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
</span><span id="CalMS21AnnotationStore-1925"><a href="#CalMS21AnnotationStore-1925"><span class="linenos">1925</span></a>        <span class="k">elif</span> <span class="s2">&quot;unlabeled&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="CalMS21AnnotationStore-1926"><a href="#CalMS21AnnotationStore-1926"><span class="linenos">1926</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;unlabeled&quot;</span>
</span><span id="CalMS21AnnotationStore-1927"><a href="#CalMS21AnnotationStore-1927"><span class="linenos">1927</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1928"><a href="#CalMS21AnnotationStore-1928"><span class="linenos">1928</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span>
</span><span id="CalMS21AnnotationStore-1929"><a href="#CalMS21AnnotationStore-1929"><span class="linenos">1929</span></a>        <span class="k">if</span> <span class="s2">&quot;approach&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1930"><a href="#CalMS21AnnotationStore-1930"><span class="linenos">1930</span></a>            <span class="k">for</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1931"><a href="#CalMS21AnnotationStore-1931"><span class="linenos">1931</span></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="p">[</span><span class="n">behavior</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CalMS21AnnotationStore-1932"><a href="#CalMS21AnnotationStore-1932"><span class="linenos">1932</span></a>                    <span class="n">ann</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="n">behavior</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore-1933"><a href="#CalMS21AnnotationStore-1933"><span class="linenos">1933</span></a>                    <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">--</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="CalMS21AnnotationStore-1934"><a href="#CalMS21AnnotationStore-1934"><span class="linenos">1934</span></a>                        <span class="s2">&quot;mouse1+mouse2&quot;</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[])</span>
</span><span id="CalMS21AnnotationStore-1935"><a href="#CalMS21AnnotationStore-1935"><span class="linenos">1935</span></a>                    <span class="p">}</span>
</span><span id="CalMS21AnnotationStore-1936"><a href="#CalMS21AnnotationStore-1936"><span class="linenos">1936</span></a>                    <span class="n">starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1937"><a href="#CalMS21AnnotationStore-1937"><span class="linenos">1937</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">ann</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]))</span>
</span><span id="CalMS21AnnotationStore-1938"><a href="#CalMS21AnnotationStore-1938"><span class="linenos">1938</span></a>                        <span class="o">==</span> <span class="mi">1</span>
</span><span id="CalMS21AnnotationStore-1939"><a href="#CalMS21AnnotationStore-1939"><span class="linenos">1939</span></a>                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore-1940"><a href="#CalMS21AnnotationStore-1940"><span class="linenos">1940</span></a>                    <span class="n">ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1941"><a href="#CalMS21AnnotationStore-1941"><span class="linenos">1941</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">ann</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]))</span>
</span><span id="CalMS21AnnotationStore-1942"><a href="#CalMS21AnnotationStore-1942"><span class="linenos">1942</span></a>                        <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="CalMS21AnnotationStore-1943"><a href="#CalMS21AnnotationStore-1943"><span class="linenos">1943</span></a>                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore-1944"><a href="#CalMS21AnnotationStore-1944"><span class="linenos">1944</span></a>                    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">):</span>
</span><span id="CalMS21AnnotationStore-1945"><a href="#CalMS21AnnotationStore-1945"><span class="linenos">1945</span></a>                        <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">--</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s2">&quot;mouse1+mouse2&quot;</span><span class="p">][</span>
</span><span id="CalMS21AnnotationStore-1946"><a href="#CalMS21AnnotationStore-1946"><span class="linenos">1946</span></a>                            <span class="n">behavior</span>
</span><span id="CalMS21AnnotationStore-1947"><a href="#CalMS21AnnotationStore-1947"><span class="linenos">1947</span></a>                        <span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="CalMS21AnnotationStore-1948"><a href="#CalMS21AnnotationStore-1948"><span class="linenos">1948</span></a>                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1949"><a href="#CalMS21AnnotationStore-1949"><span class="linenos">1949</span></a>                        <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">--</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">---mouse1+mouse2&#39;</span><span class="p">][</span>
</span><span id="CalMS21AnnotationStore-1950"><a href="#CalMS21AnnotationStore-1950"><span class="linenos">1950</span></a>                            <span class="s2">&quot;mouse1+mouse2&quot;</span>
</span><span id="CalMS21AnnotationStore-1951"><a href="#CalMS21AnnotationStore-1951"><span class="linenos">1951</span></a>                        <span class="p">][</span><span class="sa">f</span><span class="s2">&quot;unknown </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ann</span><span class="p">),</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="CalMS21AnnotationStore-1952"><a href="#CalMS21AnnotationStore-1952"><span class="linenos">1952</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1953"><a href="#CalMS21AnnotationStore-1953"><span class="linenos">1953</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="CalMS21AnnotationStore-1954"><a href="#CalMS21AnnotationStore-1954"><span class="linenos">1954</span></a>            <span class="n">data_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1955"><a href="#CalMS21AnnotationStore-1955"><span class="linenos">1955</span></a>        <span class="k">if</span> <span class="s2">&quot;approach&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1956"><a href="#CalMS21AnnotationStore-1956"><span class="linenos">1956</span></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="CalMS21AnnotationStore-1957"><a href="#CalMS21AnnotationStore-1957"><span class="linenos">1957</span></a>                <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">--</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;mouse1+mouse2&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="CalMS21AnnotationStore-1958"><a href="#CalMS21AnnotationStore-1958"><span class="linenos">1958</span></a>                <span class="n">ann</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore-1959"><a href="#CalMS21AnnotationStore-1959"><span class="linenos">1959</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
</span><span id="CalMS21AnnotationStore-1960"><a href="#CalMS21AnnotationStore-1960"><span class="linenos">1960</span></a>                    <span class="n">starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1961"><a href="#CalMS21AnnotationStore-1961"><span class="linenos">1961</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1962"><a href="#CalMS21AnnotationStore-1962"><span class="linenos">1962</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1963"><a href="#CalMS21AnnotationStore-1963"><span class="linenos">1963</span></a>                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">ann</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="CalMS21AnnotationStore-1964"><a href="#CalMS21AnnotationStore-1964"><span class="linenos">1964</span></a>                            <span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1965"><a href="#CalMS21AnnotationStore-1965"><span class="linenos">1965</span></a>                        <span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1966"><a href="#CalMS21AnnotationStore-1966"><span class="linenos">1966</span></a>                        <span class="o">==</span> <span class="mi">1</span>
</span><span id="CalMS21AnnotationStore-1967"><a href="#CalMS21AnnotationStore-1967"><span class="linenos">1967</span></a>                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore-1968"><a href="#CalMS21AnnotationStore-1968"><span class="linenos">1968</span></a>                    <span class="n">ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1969"><a href="#CalMS21AnnotationStore-1969"><span class="linenos">1969</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1970"><a href="#CalMS21AnnotationStore-1970"><span class="linenos">1970</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1971"><a href="#CalMS21AnnotationStore-1971"><span class="linenos">1971</span></a>                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">ann</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="CalMS21AnnotationStore-1972"><a href="#CalMS21AnnotationStore-1972"><span class="linenos">1972</span></a>                            <span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1973"><a href="#CalMS21AnnotationStore-1973"><span class="linenos">1973</span></a>                        <span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1974"><a href="#CalMS21AnnotationStore-1974"><span class="linenos">1974</span></a>                        <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="CalMS21AnnotationStore-1975"><a href="#CalMS21AnnotationStore-1975"><span class="linenos">1975</span></a>                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore-1976"><a href="#CalMS21AnnotationStore-1976"><span class="linenos">1976</span></a>                    <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">--</span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s2">&quot;mouse1+mouse2&quot;</span><span class="p">][</span>
</span><span id="CalMS21AnnotationStore-1977"><a href="#CalMS21AnnotationStore-1977"><span class="linenos">1977</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore-1978"><a href="#CalMS21AnnotationStore-1978"><span class="linenos">1978</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)]</span>
</span><span id="CalMS21AnnotationStore-1979"><a href="#CalMS21AnnotationStore-1979"><span class="linenos">1979</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_n</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1980"><a href="#CalMS21AnnotationStore-1980"><span class="linenos">1980</span></a>            <span class="k">for</span> <span class="n">seq_name</span><span class="p">,</span> <span class="n">seq_dict</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="CalMS21AnnotationStore-1981"><a href="#CalMS21AnnotationStore-1981"><span class="linenos">1981</span></a>                <span class="k">if</span> <span class="s2">&quot;annotations&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seq_dict</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1982"><a href="#CalMS21AnnotationStore-1982"><span class="linenos">1982</span></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="CalMS21AnnotationStore-1983"><a href="#CalMS21AnnotationStore-1983"><span class="linenos">1983</span></a>                <span class="n">behaviors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">seq_dict</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">])</span>
</span><span id="CalMS21AnnotationStore-1984"><a href="#CalMS21AnnotationStore-1984"><span class="linenos">1984</span></a>                <span class="n">ann</span> <span class="o">=</span> <span class="n">seq_dict</span><span class="p">[</span><span class="s2">&quot;annotations&quot;</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore-1985"><a href="#CalMS21AnnotationStore-1985"><span class="linenos">1985</span></a>                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">--</span><span class="si">{</span><span class="n">seq_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="CalMS21AnnotationStore-1986"><a href="#CalMS21AnnotationStore-1986"><span class="linenos">1986</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;mouse1+mouse2&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="CalMS21AnnotationStore-1987"><a href="#CalMS21AnnotationStore-1987"><span class="linenos">1987</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore-1988"><a href="#CalMS21AnnotationStore-1988"><span class="linenos">1988</span></a>                    <span class="n">starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1989"><a href="#CalMS21AnnotationStore-1989"><span class="linenos">1989</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1990"><a href="#CalMS21AnnotationStore-1990"><span class="linenos">1990</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1991"><a href="#CalMS21AnnotationStore-1991"><span class="linenos">1991</span></a>                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">ann</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="CalMS21AnnotationStore-1992"><a href="#CalMS21AnnotationStore-1992"><span class="linenos">1992</span></a>                            <span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1993"><a href="#CalMS21AnnotationStore-1993"><span class="linenos">1993</span></a>                        <span class="p">)</span>
</span><span id="CalMS21AnnotationStore-1994"><a href="#CalMS21AnnotationStore-1994"><span class="linenos">1994</span></a>                        <span class="o">==</span> <span class="mi">1</span>
</span><span id="CalMS21AnnotationStore-1995"><a href="#CalMS21AnnotationStore-1995"><span class="linenos">1995</span></a>                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore-1996"><a href="#CalMS21AnnotationStore-1996"><span class="linenos">1996</span></a>                    <span class="n">ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1997"><a href="#CalMS21AnnotationStore-1997"><span class="linenos">1997</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1998"><a href="#CalMS21AnnotationStore-1998"><span class="linenos">1998</span></a>                            <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore-1999"><a href="#CalMS21AnnotationStore-1999"><span class="linenos">1999</span></a>                                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">ann</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="CalMS21AnnotationStore-2000"><a href="#CalMS21AnnotationStore-2000"><span class="linenos">2000</span></a>                            <span class="p">)</span>
</span><span id="CalMS21AnnotationStore-2001"><a href="#CalMS21AnnotationStore-2001"><span class="linenos">2001</span></a>                        <span class="p">)</span>
</span><span id="CalMS21AnnotationStore-2002"><a href="#CalMS21AnnotationStore-2002"><span class="linenos">2002</span></a>                        <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="CalMS21AnnotationStore-2003"><a href="#CalMS21AnnotationStore-2003"><span class="linenos">2003</span></a>                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore-2004"><a href="#CalMS21AnnotationStore-2004"><span class="linenos">2004</span></a>                    <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;mouse1+mouse2&quot;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">behaviors_dict</span><span class="p">()[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="CalMS21AnnotationStore-2005"><a href="#CalMS21AnnotationStore-2005"><span class="linenos">2005</span></a>                        <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)</span>
</span><span id="CalMS21AnnotationStore-2006"><a href="#CalMS21AnnotationStore-2006"><span class="linenos">2006</span></a>                    <span class="p">]</span>
</span><span id="CalMS21AnnotationStore-2007"><a href="#CalMS21AnnotationStore-2007"><span class="linenos">2007</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>CalMS21 annotation data</p>

<p>Use the <code>'random:test_from_name:{name}'</code> and <code>'val-from-name:{val_name}:test-from-name:{test_name}'</code>
partitioning methods with <code>'train'</code>, <code>'test'</code> and <code>'unlabeled'</code> names to separate into train, test and validation
subsets according to the original files. For example, with <code>'val-from-name:test:test-from-name:unlabeled'</code>
the data from the test file will go into validation and the unlabeled files will be the test.</p>

<p>Assumes the following file structure:</p>

<pre><code>annotation_path
 calms21_task_train.npy
 calms21_task_test.npy
 calms21_unlabeled_videos_part1.npy
 calms21_unlabeled_videos_part2.npy
 calms21_unlabeled_videos_part3.npy
</code></pre>
</div>


                            <div id="CalMS21AnnotationStore.__init__" class="classattr">
                                        <input id="CalMS21AnnotationStore.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CalMS21AnnotationStore</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">task_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">include_task1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>,</span><span class="param">	<span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">treba_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="CalMS21AnnotationStore.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CalMS21AnnotationStore.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CalMS21AnnotationStore.__init__-1761"><a href="#CalMS21AnnotationStore.__init__-1761"><span class="linenos">1761</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore.__init__-1762"><a href="#CalMS21AnnotationStore.__init__-1762"><span class="linenos">1762</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1763"><a href="#CalMS21AnnotationStore.__init__-1763"><span class="linenos">1763</span></a>        <span class="n">task_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1764"><a href="#CalMS21AnnotationStore.__init__-1764"><span class="linenos">1764</span></a>        <span class="n">include_task1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1765"><a href="#CalMS21AnnotationStore.__init__-1765"><span class="linenos">1765</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1766"><a href="#CalMS21AnnotationStore.__init__-1766"><span class="linenos">1766</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1767"><a href="#CalMS21AnnotationStore.__init__-1767"><span class="linenos">1767</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1768"><a href="#CalMS21AnnotationStore.__init__-1768"><span class="linenos">1768</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1769"><a href="#CalMS21AnnotationStore.__init__-1769"><span class="linenos">1769</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1770"><a href="#CalMS21AnnotationStore.__init__-1770"><span class="linenos">1770</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1771"><a href="#CalMS21AnnotationStore.__init__-1771"><span class="linenos">1771</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1772"><a href="#CalMS21AnnotationStore.__init__-1772"><span class="linenos">1772</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1773"><a href="#CalMS21AnnotationStore.__init__-1773"><span class="linenos">1773</span></a>        <span class="n">treba_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1774"><a href="#CalMS21AnnotationStore.__init__-1774"><span class="linenos">1774</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1775"><a href="#CalMS21AnnotationStore.__init__-1775"><span class="linenos">1775</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1776"><a href="#CalMS21AnnotationStore.__init__-1776"><span class="linenos">1776</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore.__init__-1777"><a href="#CalMS21AnnotationStore.__init__-1777"><span class="linenos">1777</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CalMS21AnnotationStore.__init__-1778"><a href="#CalMS21AnnotationStore.__init__-1778"><span class="linenos">1778</span></a>
</span><span id="CalMS21AnnotationStore.__init__-1779"><a href="#CalMS21AnnotationStore.__init__-1779"><span class="linenos">1779</span></a><span class="sd">        Parameters</span>
</span><span id="CalMS21AnnotationStore.__init__-1780"><a href="#CalMS21AnnotationStore.__init__-1780"><span class="linenos">1780</span></a><span class="sd">        ----------</span>
</span><span id="CalMS21AnnotationStore.__init__-1781"><a href="#CalMS21AnnotationStore.__init__-1781"><span class="linenos">1781</span></a><span class="sd">        task_n : [1, 2]</span>
</span><span id="CalMS21AnnotationStore.__init__-1782"><a href="#CalMS21AnnotationStore.__init__-1782"><span class="linenos">1782</span></a><span class="sd">            the number of the task</span>
</span><span id="CalMS21AnnotationStore.__init__-1783"><a href="#CalMS21AnnotationStore.__init__-1783"><span class="linenos">1783</span></a><span class="sd">        include_task1 : bool, default True</span>
</span><span id="CalMS21AnnotationStore.__init__-1784"><a href="#CalMS21AnnotationStore.__init__-1784"><span class="linenos">1784</span></a><span class="sd">            include task 1 data to training set</span>
</span><span id="CalMS21AnnotationStore.__init__-1785"><a href="#CalMS21AnnotationStore.__init__-1785"><span class="linenos">1785</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="CalMS21AnnotationStore.__init__-1786"><a href="#CalMS21AnnotationStore.__init__-1786"><span class="linenos">1786</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="CalMS21AnnotationStore.__init__-1787"><a href="#CalMS21AnnotationStore.__init__-1787"><span class="linenos">1787</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="CalMS21AnnotationStore.__init__-1788"><a href="#CalMS21AnnotationStore.__init__-1788"><span class="linenos">1788</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="CalMS21AnnotationStore.__init__-1789"><a href="#CalMS21AnnotationStore.__init__-1789"><span class="linenos">1789</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="CalMS21AnnotationStore.__init__-1790"><a href="#CalMS21AnnotationStore.__init__-1790"><span class="linenos">1790</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="CalMS21AnnotationStore.__init__-1791"><a href="#CalMS21AnnotationStore.__init__-1791"><span class="linenos">1791</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="CalMS21AnnotationStore.__init__-1792"><a href="#CalMS21AnnotationStore.__init__-1792"><span class="linenos">1792</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="CalMS21AnnotationStore.__init__-1793"><a href="#CalMS21AnnotationStore.__init__-1793"><span class="linenos">1793</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="CalMS21AnnotationStore.__init__-1794"><a href="#CalMS21AnnotationStore.__init__-1794"><span class="linenos">1794</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="CalMS21AnnotationStore.__init__-1795"><a href="#CalMS21AnnotationStore.__init__-1795"><span class="linenos">1795</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="CalMS21AnnotationStore.__init__-1796"><a href="#CalMS21AnnotationStore.__init__-1796"><span class="linenos">1796</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="CalMS21AnnotationStore.__init__-1797"><a href="#CalMS21AnnotationStore.__init__-1797"><span class="linenos">1797</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="CalMS21AnnotationStore.__init__-1798"><a href="#CalMS21AnnotationStore.__init__-1798"><span class="linenos">1798</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="CalMS21AnnotationStore.__init__-1799"><a href="#CalMS21AnnotationStore.__init__-1799"><span class="linenos">1799</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="CalMS21AnnotationStore.__init__-1800"><a href="#CalMS21AnnotationStore.__init__-1800"><span class="linenos">1800</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="CalMS21AnnotationStore.__init__-1801"><a href="#CalMS21AnnotationStore.__init__-1801"><span class="linenos">1801</span></a><span class="sd">            from key objects)</span>
</span><span id="CalMS21AnnotationStore.__init__-1802"><a href="#CalMS21AnnotationStore.__init__-1802"><span class="linenos">1802</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="CalMS21AnnotationStore.__init__-1803"><a href="#CalMS21AnnotationStore.__init__-1803"><span class="linenos">1803</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="CalMS21AnnotationStore.__init__-1804"><a href="#CalMS21AnnotationStore.__init__-1804"><span class="linenos">1804</span></a><span class="sd">        treba_files : bool, default False</span>
</span><span id="CalMS21AnnotationStore.__init__-1805"><a href="#CalMS21AnnotationStore.__init__-1805"><span class="linenos">1805</span></a><span class="sd">            if `True`, TREBA feature files will be loaded</span>
</span><span id="CalMS21AnnotationStore.__init__-1806"><a href="#CalMS21AnnotationStore.__init__-1806"><span class="linenos">1806</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CalMS21AnnotationStore.__init__-1807"><a href="#CalMS21AnnotationStore.__init__-1807"><span class="linenos">1807</span></a>
</span><span id="CalMS21AnnotationStore.__init__-1808"><a href="#CalMS21AnnotationStore.__init__-1808"><span class="linenos">1808</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">task_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">task_n</span><span class="p">)</span>
</span><span id="CalMS21AnnotationStore.__init__-1809"><a href="#CalMS21AnnotationStore.__init__-1809"><span class="linenos">1809</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">include_task1</span> <span class="o">=</span> <span class="n">include_task1</span>
</span><span id="CalMS21AnnotationStore.__init__-1810"><a href="#CalMS21AnnotationStore.__init__-1810"><span class="linenos">1810</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore.__init__-1811"><a href="#CalMS21AnnotationStore.__init__-1811"><span class="linenos">1811</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">include_task1</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="CalMS21AnnotationStore.__init__-1812"><a href="#CalMS21AnnotationStore.__init__-1812"><span class="linenos">1812</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">treba_files</span> <span class="o">=</span> <span class="n">treba_files</span>
</span><span id="CalMS21AnnotationStore.__init__-1813"><a href="#CalMS21AnnotationStore.__init__-1813"><span class="linenos">1813</span></a>        <span class="k">if</span> <span class="s2">&quot;exclusive&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore.__init__-1814"><a href="#CalMS21AnnotationStore.__init__-1814"><span class="linenos">1814</span></a>            <span class="n">exclusive</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;exclusive&quot;</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore.__init__-1815"><a href="#CalMS21AnnotationStore.__init__-1815"><span class="linenos">1815</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore.__init__-1816"><a href="#CalMS21AnnotationStore.__init__-1816"><span class="linenos">1816</span></a>            <span class="n">exclusive</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="CalMS21AnnotationStore.__init__-1817"><a href="#CalMS21AnnotationStore.__init__-1817"><span class="linenos">1817</span></a>        <span class="k">if</span> <span class="s2">&quot;behaviors&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;behaviors&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore.__init__-1818"><a href="#CalMS21AnnotationStore.__init__-1818"><span class="linenos">1818</span></a>            <span class="n">behaviors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;behaviors&quot;</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore.__init__-1819"><a href="#CalMS21AnnotationStore.__init__-1819"><span class="linenos">1819</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore.__init__-1820"><a href="#CalMS21AnnotationStore.__init__-1820"><span class="linenos">1820</span></a>            <span class="n">behaviors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;attack&quot;</span><span class="p">,</span> <span class="s2">&quot;investigation&quot;</span><span class="p">,</span> <span class="s2">&quot;mount&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">]</span>
</span><span id="CalMS21AnnotationStore.__init__-1821"><a href="#CalMS21AnnotationStore.__init__-1821"><span class="linenos">1821</span></a>            <span class="k">if</span> <span class="n">task_n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore.__init__-1822"><a href="#CalMS21AnnotationStore.__init__-1822"><span class="linenos">1822</span></a>                <span class="n">exclusive</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="CalMS21AnnotationStore.__init__-1823"><a href="#CalMS21AnnotationStore.__init__-1823"><span class="linenos">1823</span></a>                <span class="n">behaviors</span> <span class="o">+=</span> <span class="p">[</span>
</span><span id="CalMS21AnnotationStore.__init__-1824"><a href="#CalMS21AnnotationStore.__init__-1824"><span class="linenos">1824</span></a>                    <span class="s2">&quot;approach&quot;</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1825"><a href="#CalMS21AnnotationStore.__init__-1825"><span class="linenos">1825</span></a>                    <span class="s2">&quot;disengaged&quot;</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1826"><a href="#CalMS21AnnotationStore.__init__-1826"><span class="linenos">1826</span></a>                    <span class="s2">&quot;groom&quot;</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1827"><a href="#CalMS21AnnotationStore.__init__-1827"><span class="linenos">1827</span></a>                    <span class="s2">&quot;intromission&quot;</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1828"><a href="#CalMS21AnnotationStore.__init__-1828"><span class="linenos">1828</span></a>                    <span class="s2">&quot;mount_attempt&quot;</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1829"><a href="#CalMS21AnnotationStore.__init__-1829"><span class="linenos">1829</span></a>                    <span class="s2">&quot;sniff_face&quot;</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1830"><a href="#CalMS21AnnotationStore.__init__-1830"><span class="linenos">1830</span></a>                    <span class="s2">&quot;whiterearing&quot;</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1831"><a href="#CalMS21AnnotationStore.__init__-1831"><span class="linenos">1831</span></a>                <span class="p">]</span>
</span><span id="CalMS21AnnotationStore.__init__-1832"><a href="#CalMS21AnnotationStore.__init__-1832"><span class="linenos">1832</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore.__init__-1833"><a href="#CalMS21AnnotationStore.__init__-1833"><span class="linenos">1833</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1834"><a href="#CalMS21AnnotationStore.__init__-1834"><span class="linenos">1834</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1835"><a href="#CalMS21AnnotationStore.__init__-1835"><span class="linenos">1835</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1836"><a href="#CalMS21AnnotationStore.__init__-1836"><span class="linenos">1836</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1837"><a href="#CalMS21AnnotationStore.__init__-1837"><span class="linenos">1837</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1838"><a href="#CalMS21AnnotationStore.__init__-1838"><span class="linenos">1838</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1839"><a href="#CalMS21AnnotationStore.__init__-1839"><span class="linenos">1839</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1840"><a href="#CalMS21AnnotationStore.__init__-1840"><span class="linenos">1840</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1841"><a href="#CalMS21AnnotationStore.__init__-1841"><span class="linenos">1841</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1842"><a href="#CalMS21AnnotationStore.__init__-1842"><span class="linenos">1842</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1843"><a href="#CalMS21AnnotationStore.__init__-1843"><span class="linenos">1843</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1844"><a href="#CalMS21AnnotationStore.__init__-1844"><span class="linenos">1844</span></a>            <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.__init__-1845"><a href="#CalMS21AnnotationStore.__init__-1845"><span class="linenos">1845</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h2 id="parameters">Parameters</h2>

<p>task_n : [1, 2]
    the number of the task
include_task1 : bool, default True
    include task 1 data to training set
video_order : list, optional
    a list of video ids that should be processed in the same order (not passed if creating from key objects)
min_frames : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    clip start frames (not passed if creating from key objects)
max_frames : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    clip end frames (not passed if creating from key objects)
len_segment : int, default 128
    the length of the segments in which the data should be cut (in frames)
overlap : int, default 0
    the length of the overlap between neighboring segments (in frames)
ignored_classes : set, optional
    the list of behaviors from the behaviors list or file to not annotate
annotation_path : str | set, optional
    the path or the set of paths to the folder where the annotation files are stored (not passed if creating
    from key objects)
key_objects : tuple, optional
    the key objects to load the AnnotationStore from
treba_files : bool, default False
    if <code>True</code>, TREBA feature files will be loaded</p>
</div>


                            </div>
                            <div id="CalMS21AnnotationStore.get_file_ids" class="classattr">
                                        <input id="CalMS21AnnotationStore.get_file_ids-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_file_ids</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">task_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">include_task1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">treba_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">file_paths</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span>:</span></span>

                <label class="view-source-button" for="CalMS21AnnotationStore.get_file_ids-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CalMS21AnnotationStore.get_file_ids"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CalMS21AnnotationStore.get_file_ids-1847"><a href="#CalMS21AnnotationStore.get_file_ids-1847"><span class="linenos">1847</span></a>    <span class="nd">@classmethod</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1848"><a href="#CalMS21AnnotationStore.get_file_ids-1848"><span class="linenos">1848</span></a>    <span class="k">def</span> <span class="nf">get_file_ids</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1849"><a href="#CalMS21AnnotationStore.get_file_ids-1849"><span class="linenos">1849</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1850"><a href="#CalMS21AnnotationStore.get_file_ids-1850"><span class="linenos">1850</span></a>        <span class="n">task_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1851"><a href="#CalMS21AnnotationStore.get_file_ids-1851"><span class="linenos">1851</span></a>        <span class="n">include_task1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1852"><a href="#CalMS21AnnotationStore.get_file_ids-1852"><span class="linenos">1852</span></a>        <span class="n">treba_files</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1853"><a href="#CalMS21AnnotationStore.get_file_ids-1853"><span class="linenos">1853</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1854"><a href="#CalMS21AnnotationStore.get_file_ids-1854"><span class="linenos">1854</span></a>        <span class="n">file_paths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1855"><a href="#CalMS21AnnotationStore.get_file_ids-1855"><span class="linenos">1855</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1856"><a href="#CalMS21AnnotationStore.get_file_ids-1856"><span class="linenos">1856</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1857"><a href="#CalMS21AnnotationStore.get_file_ids-1857"><span class="linenos">1857</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1858"><a href="#CalMS21AnnotationStore.get_file_ids-1858"><span class="linenos">1858</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1859"><a href="#CalMS21AnnotationStore.get_file_ids-1859"><span class="linenos">1859</span></a><span class="sd">        Process data parameters and return a list of ids  of the videos that should</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1860"><a href="#CalMS21AnnotationStore.get_file_ids-1860"><span class="linenos">1860</span></a><span class="sd">        be processed by the __init__ function</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1861"><a href="#CalMS21AnnotationStore.get_file_ids-1861"><span class="linenos">1861</span></a>
</span><span id="CalMS21AnnotationStore.get_file_ids-1862"><a href="#CalMS21AnnotationStore.get_file_ids-1862"><span class="linenos">1862</span></a><span class="sd">        Parameters</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1863"><a href="#CalMS21AnnotationStore.get_file_ids-1863"><span class="linenos">1863</span></a><span class="sd">        ----------</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1864"><a href="#CalMS21AnnotationStore.get_file_ids-1864"><span class="linenos">1864</span></a><span class="sd">        task_n : {1, 2, 3}</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1865"><a href="#CalMS21AnnotationStore.get_file_ids-1865"><span class="linenos">1865</span></a><span class="sd">            the index of the CalMS21 challenge task</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1866"><a href="#CalMS21AnnotationStore.get_file_ids-1866"><span class="linenos">1866</span></a><span class="sd">        include_task1 : bool, default False</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1867"><a href="#CalMS21AnnotationStore.get_file_ids-1867"><span class="linenos">1867</span></a><span class="sd">            if `True`, the training file of the task 1 will be loaded</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1868"><a href="#CalMS21AnnotationStore.get_file_ids-1868"><span class="linenos">1868</span></a><span class="sd">        treba_files : bool, default False</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1869"><a href="#CalMS21AnnotationStore.get_file_ids-1869"><span class="linenos">1869</span></a><span class="sd">            if `True`, the TREBA feature files will be loaded</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1870"><a href="#CalMS21AnnotationStore.get_file_ids-1870"><span class="linenos">1870</span></a><span class="sd">        filenames : set, optional</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1871"><a href="#CalMS21AnnotationStore.get_file_ids-1871"><span class="linenos">1871</span></a><span class="sd">            a set of string filenames to search for (only basenames, not the whole paths)</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1872"><a href="#CalMS21AnnotationStore.get_file_ids-1872"><span class="linenos">1872</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1873"><a href="#CalMS21AnnotationStore.get_file_ids-1873"><span class="linenos">1873</span></a><span class="sd">            the path to the folder where the pose and feature files are stored or a set of such paths</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1874"><a href="#CalMS21AnnotationStore.get_file_ids-1874"><span class="linenos">1874</span></a><span class="sd">            (not passed if creating from key objects or from `file_paths`)</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1875"><a href="#CalMS21AnnotationStore.get_file_ids-1875"><span class="linenos">1875</span></a><span class="sd">        file_paths : set, optional</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1876"><a href="#CalMS21AnnotationStore.get_file_ids-1876"><span class="linenos">1876</span></a><span class="sd">            a set of string paths to the pose and feature files</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1877"><a href="#CalMS21AnnotationStore.get_file_ids-1877"><span class="linenos">1877</span></a><span class="sd">            (not passed if creating from key objects or from `data_path`)</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1878"><a href="#CalMS21AnnotationStore.get_file_ids-1878"><span class="linenos">1878</span></a>
</span><span id="CalMS21AnnotationStore.get_file_ids-1879"><a href="#CalMS21AnnotationStore.get_file_ids-1879"><span class="linenos">1879</span></a><span class="sd">        Returns</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1880"><a href="#CalMS21AnnotationStore.get_file_ids-1880"><span class="linenos">1880</span></a><span class="sd">        -------</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1881"><a href="#CalMS21AnnotationStore.get_file_ids-1881"><span class="linenos">1881</span></a><span class="sd">        video_ids : list</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1882"><a href="#CalMS21AnnotationStore.get_file_ids-1882"><span class="linenos">1882</span></a><span class="sd">            a list of video file ids</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1883"><a href="#CalMS21AnnotationStore.get_file_ids-1883"><span class="linenos">1883</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1884"><a href="#CalMS21AnnotationStore.get_file_ids-1884"><span class="linenos">1884</span></a>
</span><span id="CalMS21AnnotationStore.get_file_ids-1885"><a href="#CalMS21AnnotationStore.get_file_ids-1885"><span class="linenos">1885</span></a>        <span class="n">task_n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">task_n</span><span class="p">)</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1886"><a href="#CalMS21AnnotationStore.get_file_ids-1886"><span class="linenos">1886</span></a>        <span class="k">if</span> <span class="n">task_n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1887"><a href="#CalMS21AnnotationStore.get_file_ids-1887"><span class="linenos">1887</span></a>            <span class="n">include_task1</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1888"><a href="#CalMS21AnnotationStore.get_file_ids-1888"><span class="linenos">1888</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1889"><a href="#CalMS21AnnotationStore.get_file_ids-1889"><span class="linenos">1889</span></a>        <span class="k">if</span> <span class="n">treba_files</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1890"><a href="#CalMS21AnnotationStore.get_file_ids-1890"><span class="linenos">1890</span></a>            <span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;_features&quot;</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1891"><a href="#CalMS21AnnotationStore.get_file_ids-1891"><span class="linenos">1891</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1892"><a href="#CalMS21AnnotationStore.get_file_ids-1892"><span class="linenos">1892</span></a>            <span class="n">postfix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1893"><a href="#CalMS21AnnotationStore.get_file_ids-1893"><span class="linenos">1893</span></a>        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calms21_task</span><span class="si">{</span><span class="n">task_n</span><span class="si">}</span><span class="s2">_train</span><span class="si">{</span><span class="n">postfix</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1894"><a href="#CalMS21AnnotationStore.get_file_ids-1894"><span class="linenos">1894</span></a>        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calms21_task</span><span class="si">{</span><span class="n">task_n</span><span class="si">}</span><span class="s2">_test</span><span class="si">{</span><span class="n">postfix</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1895"><a href="#CalMS21AnnotationStore.get_file_ids-1895"><span class="linenos">1895</span></a>        <span class="k">if</span> <span class="n">include_task1</span><span class="p">:</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1896"><a href="#CalMS21AnnotationStore.get_file_ids-1896"><span class="linenos">1896</span></a>            <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calms21_task1_train</span><span class="si">{</span><span class="n">postfix</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">)</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1897"><a href="#CalMS21AnnotationStore.get_file_ids-1897"><span class="linenos">1897</span></a>        <span class="n">filenames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1898"><a href="#CalMS21AnnotationStore.get_file_ids-1898"><span class="linenos">1898</span></a>        <span class="k">return</span> <span class="n">SequenceAnnotationStore</span><span class="o">.</span><span class="n">get_file_ids</span><span class="p">(</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1899"><a href="#CalMS21AnnotationStore.get_file_ids-1899"><span class="linenos">1899</span></a>            <span class="n">filenames</span><span class="p">,</span> <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span>
</span><span id="CalMS21AnnotationStore.get_file_ids-1900"><a href="#CalMS21AnnotationStore.get_file_ids-1900"><span class="linenos">1900</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Process data parameters and return a list of ids  of the videos that should
be processed by the __init__ function</p>

<h2 id="parameters">Parameters</h2>

<p>task_n : {1, 2, 3}
    the index of the CalMS21 challenge task
include_task1 : bool, default False
    if <code>True</code>, the training file of the task 1 will be loaded
treba_files : bool, default False
    if <code>True</code>, the TREBA feature files will be loaded
filenames : set, optional
    a set of string filenames to search for (only basenames, not the whole paths)
annotation_path : str | set, optional
    the path to the folder where the pose and feature files are stored or a set of such paths
    (not passed if creating from key objects or from <code>file_paths</code>)
file_paths : set, optional
    a set of string paths to the pose and feature files
    (not passed if creating from key objects or from <code>data_path</code>)</p>

<h2 id="returns">Returns</h2>

<p>video_ids : list
    a list of video file ids</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ActionSegmentationStore">ActionSegmentationStore</a></dt>
                                <dd id="CalMS21AnnotationStore.remove" class="function"><a href="#ActionSegmentationStore.remove">remove</a></dd>
                <dd id="CalMS21AnnotationStore.key_objects" class="function"><a href="#ActionSegmentationStore.key_objects">key_objects</a></dd>
                <dd id="CalMS21AnnotationStore.load_from_key_objects" class="function"><a href="#ActionSegmentationStore.load_from_key_objects">load_from_key_objects</a></dd>
                <dd id="CalMS21AnnotationStore.to_ram" class="function"><a href="#ActionSegmentationStore.to_ram">to_ram</a></dd>
                <dd id="CalMS21AnnotationStore.get_original_coordinates" class="function"><a href="#ActionSegmentationStore.get_original_coordinates">get_original_coordinates</a></dd>
                <dd id="CalMS21AnnotationStore.create_subsample" class="function"><a href="#ActionSegmentationStore.create_subsample">create_subsample</a></dd>
                <dd id="CalMS21AnnotationStore.get_len" class="function"><a href="#ActionSegmentationStore.get_len">get_len</a></dd>
                <dd id="CalMS21AnnotationStore.get_indices" class="function"><a href="#ActionSegmentationStore.get_indices">get_indices</a></dd>
                <dd id="CalMS21AnnotationStore.count_classes" class="function"><a href="#ActionSegmentationStore.count_classes">count_classes</a></dd>
                <dd id="CalMS21AnnotationStore.behaviors_dict" class="function"><a href="#ActionSegmentationStore.behaviors_dict">behaviors_dict</a></dd>
                <dd id="CalMS21AnnotationStore.annotation_class" class="function"><a href="#ActionSegmentationStore.annotation_class">annotation_class</a></dd>
                <dd id="CalMS21AnnotationStore.size" class="function"><a href="#ActionSegmentationStore.size">size</a></dd>
                <dd id="CalMS21AnnotationStore.filtered_indices" class="function"><a href="#ActionSegmentationStore.filtered_indices">filtered_indices</a></dd>
                <dd id="CalMS21AnnotationStore.set_pseudo_labels" class="function"><a href="#ActionSegmentationStore.set_pseudo_labels">set_pseudo_labels</a></dd>

            </div>
            <div><dt><a href="base_store.html#AnnotationStore">dlc2action.data.base_store.AnnotationStore</a></dt>
                                <dd id="CalMS21AnnotationStore.required_objects" class="variable"><a href="base_store.html#AnnotationStore.required_objects">required_objects</a></dd>

            </div>
            <div><dt><a href="base_store.html#Store">dlc2action.data.base_store.Store</a></dt>
                                <dd id="CalMS21AnnotationStore.get_parameters" class="function"><a href="base_store.html#Store.get_parameters">get_parameters</a></dd>
                <dd id="CalMS21AnnotationStore.new" class="function"><a href="base_store.html#Store.new">new</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="CSVAnnotationStore">
                            <input id="CSVAnnotationStore-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CSVAnnotationStore</span><wbr>(<span class="base"><a href="#FileAnnotationStore">FileAnnotationStore</a></span>):

                <label class="view-source-button" for="CSVAnnotationStore-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CSVAnnotationStore"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CSVAnnotationStore-2010"><a href="#CSVAnnotationStore-2010"><span class="linenos">2010</span></a><span class="k">class</span> <span class="nc">CSVAnnotationStore</span><span class="p">(</span><span class="n">FileAnnotationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="CSVAnnotationStore-2011"><a href="#CSVAnnotationStore-2011"><span class="linenos">2011</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CSVAnnotationStore-2012"><a href="#CSVAnnotationStore-2012"><span class="linenos">2012</span></a><span class="sd">    CSV type annotation data</span>
</span><span id="CSVAnnotationStore-2013"><a href="#CSVAnnotationStore-2013"><span class="linenos">2013</span></a>
</span><span id="CSVAnnotationStore-2014"><a href="#CSVAnnotationStore-2014"><span class="linenos">2014</span></a><span class="sd">    Assumes that files are saved as .csv tables with at least the following columns:</span>
</span><span id="CSVAnnotationStore-2015"><a href="#CSVAnnotationStore-2015"><span class="linenos">2015</span></a><span class="sd">    - from / start : start of action,</span>
</span><span id="CSVAnnotationStore-2016"><a href="#CSVAnnotationStore-2016"><span class="linenos">2016</span></a><span class="sd">    - to / end : end of action,</span>
</span><span id="CSVAnnotationStore-2017"><a href="#CSVAnnotationStore-2017"><span class="linenos">2017</span></a><span class="sd">    - class / behavior / behaviour / label / type : action label.</span>
</span><span id="CSVAnnotationStore-2018"><a href="#CSVAnnotationStore-2018"><span class="linenos">2018</span></a>
</span><span id="CSVAnnotationStore-2019"><a href="#CSVAnnotationStore-2019"><span class="linenos">2019</span></a><span class="sd">    If the times are set in seconds instead of frames, don&#39;t forget to set the `fps` parameter to your frame rate.</span>
</span><span id="CSVAnnotationStore-2020"><a href="#CSVAnnotationStore-2020"><span class="linenos">2020</span></a>
</span><span id="CSVAnnotationStore-2021"><a href="#CSVAnnotationStore-2021"><span class="linenos">2021</span></a><span class="sd">    Assumes the following file structure:</span>
</span><span id="CSVAnnotationStore-2022"><a href="#CSVAnnotationStore-2022"><span class="linenos">2022</span></a><span class="sd">    ```</span>
</span><span id="CSVAnnotationStore-2023"><a href="#CSVAnnotationStore-2023"><span class="linenos">2023</span></a><span class="sd">    annotation_path</span>
</span><span id="CSVAnnotationStore-2024"><a href="#CSVAnnotationStore-2024"><span class="linenos">2024</span></a><span class="sd">     video1_annotation.csv</span>
</span><span id="CSVAnnotationStore-2025"><a href="#CSVAnnotationStore-2025"><span class="linenos">2025</span></a><span class="sd">     video2_labels.csv</span>
</span><span id="CSVAnnotationStore-2026"><a href="#CSVAnnotationStore-2026"><span class="linenos">2026</span></a><span class="sd">    ```</span>
</span><span id="CSVAnnotationStore-2027"><a href="#CSVAnnotationStore-2027"><span class="linenos">2027</span></a><span class="sd">    Here `annotation_suffix` is `{&#39;_annotation.csv&#39;, &#39;_labels.csv&#39;}`.</span>
</span><span id="CSVAnnotationStore-2028"><a href="#CSVAnnotationStore-2028"><span class="linenos">2028</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CSVAnnotationStore-2029"><a href="#CSVAnnotationStore-2029"><span class="linenos">2029</span></a>
</span><span id="CSVAnnotationStore-2030"><a href="#CSVAnnotationStore-2030"><span class="linenos">2030</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="CSVAnnotationStore-2031"><a href="#CSVAnnotationStore-2031"><span class="linenos">2031</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2032"><a href="#CSVAnnotationStore-2032"><span class="linenos">2032</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2033"><a href="#CSVAnnotationStore-2033"><span class="linenos">2033</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2034"><a href="#CSVAnnotationStore-2034"><span class="linenos">2034</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2035"><a href="#CSVAnnotationStore-2035"><span class="linenos">2035</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2036"><a href="#CSVAnnotationStore-2036"><span class="linenos">2036</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2037"><a href="#CSVAnnotationStore-2037"><span class="linenos">2037</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2038"><a href="#CSVAnnotationStore-2038"><span class="linenos">2038</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2039"><a href="#CSVAnnotationStore-2039"><span class="linenos">2039</span></a>        <span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2040"><a href="#CSVAnnotationStore-2040"><span class="linenos">2040</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2041"><a href="#CSVAnnotationStore-2041"><span class="linenos">2041</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2042"><a href="#CSVAnnotationStore-2042"><span class="linenos">2042</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2043"><a href="#CSVAnnotationStore-2043"><span class="linenos">2043</span></a>        <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2044"><a href="#CSVAnnotationStore-2044"><span class="linenos">2044</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2045"><a href="#CSVAnnotationStore-2045"><span class="linenos">2045</span></a>        <span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2046"><a href="#CSVAnnotationStore-2046"><span class="linenos">2046</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2047"><a href="#CSVAnnotationStore-2047"><span class="linenos">2047</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2048"><a href="#CSVAnnotationStore-2048"><span class="linenos">2048</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2049"><a href="#CSVAnnotationStore-2049"><span class="linenos">2049</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2050"><a href="#CSVAnnotationStore-2050"><span class="linenos">2050</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2051"><a href="#CSVAnnotationStore-2051"><span class="linenos">2051</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2052"><a href="#CSVAnnotationStore-2052"><span class="linenos">2052</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2053"><a href="#CSVAnnotationStore-2053"><span class="linenos">2053</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2054"><a href="#CSVAnnotationStore-2054"><span class="linenos">2054</span></a>        <span class="n">default_agent_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ind0&quot;</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2055"><a href="#CSVAnnotationStore-2055"><span class="linenos">2055</span></a>        <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2056"><a href="#CSVAnnotationStore-2056"><span class="linenos">2056</span></a>        <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2057"><a href="#CSVAnnotationStore-2057"><span class="linenos">2057</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2058"><a href="#CSVAnnotationStore-2058"><span class="linenos">2058</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2059"><a href="#CSVAnnotationStore-2059"><span class="linenos">2059</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CSVAnnotationStore-2060"><a href="#CSVAnnotationStore-2060"><span class="linenos">2060</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CSVAnnotationStore-2061"><a href="#CSVAnnotationStore-2061"><span class="linenos">2061</span></a><span class="sd">        Parameters</span>
</span><span id="CSVAnnotationStore-2062"><a href="#CSVAnnotationStore-2062"><span class="linenos">2062</span></a><span class="sd">        ----------</span>
</span><span id="CSVAnnotationStore-2063"><a href="#CSVAnnotationStore-2063"><span class="linenos">2063</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="CSVAnnotationStore-2064"><a href="#CSVAnnotationStore-2064"><span class="linenos">2064</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="CSVAnnotationStore-2065"><a href="#CSVAnnotationStore-2065"><span class="linenos">2065</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="CSVAnnotationStore-2066"><a href="#CSVAnnotationStore-2066"><span class="linenos">2066</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="CSVAnnotationStore-2067"><a href="#CSVAnnotationStore-2067"><span class="linenos">2067</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="CSVAnnotationStore-2068"><a href="#CSVAnnotationStore-2068"><span class="linenos">2068</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="CSVAnnotationStore-2069"><a href="#CSVAnnotationStore-2069"><span class="linenos">2069</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="CSVAnnotationStore-2070"><a href="#CSVAnnotationStore-2070"><span class="linenos">2070</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="CSVAnnotationStore-2071"><a href="#CSVAnnotationStore-2071"><span class="linenos">2071</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="CSVAnnotationStore-2072"><a href="#CSVAnnotationStore-2072"><span class="linenos">2072</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="CSVAnnotationStore-2073"><a href="#CSVAnnotationStore-2073"><span class="linenos">2073</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="CSVAnnotationStore-2074"><a href="#CSVAnnotationStore-2074"><span class="linenos">2074</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="CSVAnnotationStore-2075"><a href="#CSVAnnotationStore-2075"><span class="linenos">2075</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="CSVAnnotationStore-2076"><a href="#CSVAnnotationStore-2076"><span class="linenos">2076</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="CSVAnnotationStore-2077"><a href="#CSVAnnotationStore-2077"><span class="linenos">2077</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="CSVAnnotationStore-2078"><a href="#CSVAnnotationStore-2078"><span class="linenos">2078</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="CSVAnnotationStore-2079"><a href="#CSVAnnotationStore-2079"><span class="linenos">2079</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="CSVAnnotationStore-2080"><a href="#CSVAnnotationStore-2080"><span class="linenos">2080</span></a><span class="sd">        behaviors : set, optional</span>
</span><span id="CSVAnnotationStore-2081"><a href="#CSVAnnotationStore-2081"><span class="linenos">2081</span></a><span class="sd">            the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are</span>
</span><span id="CSVAnnotationStore-2082"><a href="#CSVAnnotationStore-2082"><span class="linenos">2082</span></a><span class="sd">            loaded from a file)</span>
</span><span id="CSVAnnotationStore-2083"><a href="#CSVAnnotationStore-2083"><span class="linenos">2083</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="CSVAnnotationStore-2084"><a href="#CSVAnnotationStore-2084"><span class="linenos">2084</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="CSVAnnotationStore-2085"><a href="#CSVAnnotationStore-2085"><span class="linenos">2085</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="CSVAnnotationStore-2086"><a href="#CSVAnnotationStore-2086"><span class="linenos">2086</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="CSVAnnotationStore-2087"><a href="#CSVAnnotationStore-2087"><span class="linenos">2087</span></a><span class="sd">            (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="CSVAnnotationStore-2088"><a href="#CSVAnnotationStore-2088"><span class="linenos">2088</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="CSVAnnotationStore-2089"><a href="#CSVAnnotationStore-2089"><span class="linenos">2089</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="CSVAnnotationStore-2090"><a href="#CSVAnnotationStore-2090"><span class="linenos">2090</span></a><span class="sd">            from key objects)</span>
</span><span id="CSVAnnotationStore-2091"><a href="#CSVAnnotationStore-2091"><span class="linenos">2091</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="CSVAnnotationStore-2092"><a href="#CSVAnnotationStore-2092"><span class="linenos">2092</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="CSVAnnotationStore-2093"><a href="#CSVAnnotationStore-2093"><span class="linenos">2093</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="CSVAnnotationStore-2094"><a href="#CSVAnnotationStore-2094"><span class="linenos">2094</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="CSVAnnotationStore-2095"><a href="#CSVAnnotationStore-2095"><span class="linenos">2095</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="CSVAnnotationStore-2096"><a href="#CSVAnnotationStore-2096"><span class="linenos">2096</span></a><span class="sd">        frame_limit : int, default 0</span>
</span><span id="CSVAnnotationStore-2097"><a href="#CSVAnnotationStore-2097"><span class="linenos">2097</span></a><span class="sd">            the smallest possible length of a clip (shorter clips are discarded)</span>
</span><span id="CSVAnnotationStore-2098"><a href="#CSVAnnotationStore-2098"><span class="linenos">2098</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="CSVAnnotationStore-2099"><a href="#CSVAnnotationStore-2099"><span class="linenos">2099</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="CSVAnnotationStore-2100"><a href="#CSVAnnotationStore-2100"><span class="linenos">2100</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="CSVAnnotationStore-2101"><a href="#CSVAnnotationStore-2101"><span class="linenos">2101</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="CSVAnnotationStore-2102"><a href="#CSVAnnotationStore-2102"><span class="linenos">2102</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="CSVAnnotationStore-2103"><a href="#CSVAnnotationStore-2103"><span class="linenos">2103</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="CSVAnnotationStore-2104"><a href="#CSVAnnotationStore-2104"><span class="linenos">2104</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="CSVAnnotationStore-2105"><a href="#CSVAnnotationStore-2105"><span class="linenos">2105</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="CSVAnnotationStore-2106"><a href="#CSVAnnotationStore-2106"><span class="linenos">2106</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="CSVAnnotationStore-2107"><a href="#CSVAnnotationStore-2107"><span class="linenos">2107</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="CSVAnnotationStore-2108"><a href="#CSVAnnotationStore-2108"><span class="linenos">2108</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="CSVAnnotationStore-2109"><a href="#CSVAnnotationStore-2109"><span class="linenos">2109</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="CSVAnnotationStore-2110"><a href="#CSVAnnotationStore-2110"><span class="linenos">2110</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="CSVAnnotationStore-2111"><a href="#CSVAnnotationStore-2111"><span class="linenos">2111</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="CSVAnnotationStore-2112"><a href="#CSVAnnotationStore-2112"><span class="linenos">2112</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="CSVAnnotationStore-2113"><a href="#CSVAnnotationStore-2113"><span class="linenos">2113</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="CSVAnnotationStore-2114"><a href="#CSVAnnotationStore-2114"><span class="linenos">2114</span></a><span class="sd">        default_agent_name : str, default &quot;ind0&quot;</span>
</span><span id="CSVAnnotationStore-2115"><a href="#CSVAnnotationStore-2115"><span class="linenos">2115</span></a><span class="sd">            the clip id to use when there is no given</span>
</span><span id="CSVAnnotationStore-2116"><a href="#CSVAnnotationStore-2116"><span class="linenos">2116</span></a><span class="sd">        separator : str, default &quot;,&quot;</span>
</span><span id="CSVAnnotationStore-2117"><a href="#CSVAnnotationStore-2117"><span class="linenos">2117</span></a><span class="sd">            the separator in the csv files</span>
</span><span id="CSVAnnotationStore-2118"><a href="#CSVAnnotationStore-2118"><span class="linenos">2118</span></a><span class="sd">        fps : int, default 30</span>
</span><span id="CSVAnnotationStore-2119"><a href="#CSVAnnotationStore-2119"><span class="linenos">2119</span></a><span class="sd">            frames per second in the videos</span>
</span><span id="CSVAnnotationStore-2120"><a href="#CSVAnnotationStore-2120"><span class="linenos">2120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CSVAnnotationStore-2121"><a href="#CSVAnnotationStore-2121"><span class="linenos">2121</span></a>
</span><span id="CSVAnnotationStore-2122"><a href="#CSVAnnotationStore-2122"><span class="linenos">2122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_agent_name</span> <span class="o">=</span> <span class="n">default_agent_name</span>
</span><span id="CSVAnnotationStore-2123"><a href="#CSVAnnotationStore-2123"><span class="linenos">2123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">separator</span> <span class="o">=</span> <span class="n">separator</span>
</span><span id="CSVAnnotationStore-2124"><a href="#CSVAnnotationStore-2124"><span class="linenos">2124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="n">fps</span>
</span><span id="CSVAnnotationStore-2125"><a href="#CSVAnnotationStore-2125"><span class="linenos">2125</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="CSVAnnotationStore-2126"><a href="#CSVAnnotationStore-2126"><span class="linenos">2126</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2127"><a href="#CSVAnnotationStore-2127"><span class="linenos">2127</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2128"><a href="#CSVAnnotationStore-2128"><span class="linenos">2128</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2129"><a href="#CSVAnnotationStore-2129"><span class="linenos">2129</span></a>            <span class="n">visibility</span><span class="o">=</span><span class="n">visibility</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2130"><a href="#CSVAnnotationStore-2130"><span class="linenos">2130</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2131"><a href="#CSVAnnotationStore-2131"><span class="linenos">2131</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2132"><a href="#CSVAnnotationStore-2132"><span class="linenos">2132</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2133"><a href="#CSVAnnotationStore-2133"><span class="linenos">2133</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2134"><a href="#CSVAnnotationStore-2134"><span class="linenos">2134</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2135"><a href="#CSVAnnotationStore-2135"><span class="linenos">2135</span></a>            <span class="n">ignored_clips</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2136"><a href="#CSVAnnotationStore-2136"><span class="linenos">2136</span></a>            <span class="n">annotation_suffix</span><span class="o">=</span><span class="n">annotation_suffix</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2137"><a href="#CSVAnnotationStore-2137"><span class="linenos">2137</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2138"><a href="#CSVAnnotationStore-2138"><span class="linenos">2138</span></a>            <span class="n">behavior_file</span><span class="o">=</span><span class="n">behavior_file</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2139"><a href="#CSVAnnotationStore-2139"><span class="linenos">2139</span></a>            <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2140"><a href="#CSVAnnotationStore-2140"><span class="linenos">2140</span></a>            <span class="n">frame_limit</span><span class="o">=</span><span class="n">frame_limit</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2141"><a href="#CSVAnnotationStore-2141"><span class="linenos">2141</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="n">filter_annotated</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2142"><a href="#CSVAnnotationStore-2142"><span class="linenos">2142</span></a>            <span class="n">filter_background</span><span class="o">=</span><span class="n">filter_background</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2143"><a href="#CSVAnnotationStore-2143"><span class="linenos">2143</span></a>            <span class="n">error_class</span><span class="o">=</span><span class="n">error_class</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2144"><a href="#CSVAnnotationStore-2144"><span class="linenos">2144</span></a>            <span class="n">min_frames_action</span><span class="o">=</span><span class="n">min_frames_action</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2145"><a href="#CSVAnnotationStore-2145"><span class="linenos">2145</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2146"><a href="#CSVAnnotationStore-2146"><span class="linenos">2146</span></a>            <span class="n">visibility_min_score</span><span class="o">=</span><span class="n">visibility_min_score</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2147"><a href="#CSVAnnotationStore-2147"><span class="linenos">2147</span></a>            <span class="n">visibility_min_frac</span><span class="o">=</span><span class="n">visibility_min_frac</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2148"><a href="#CSVAnnotationStore-2148"><span class="linenos">2148</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="CSVAnnotationStore-2149"><a href="#CSVAnnotationStore-2149"><span class="linenos">2149</span></a>        <span class="p">)</span>
</span><span id="CSVAnnotationStore-2150"><a href="#CSVAnnotationStore-2150"><span class="linenos">2150</span></a>
</span><span id="CSVAnnotationStore-2151"><a href="#CSVAnnotationStore-2151"><span class="linenos">2151</span></a>    <span class="k">def</span> <span class="nf">_open_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="CSVAnnotationStore-2152"><a href="#CSVAnnotationStore-2152"><span class="linenos">2152</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CSVAnnotationStore-2153"><a href="#CSVAnnotationStore-2153"><span class="linenos">2153</span></a><span class="sd">        Load the annotation from `filename`</span>
</span><span id="CSVAnnotationStore-2154"><a href="#CSVAnnotationStore-2154"><span class="linenos">2154</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CSVAnnotationStore-2155"><a href="#CSVAnnotationStore-2155"><span class="linenos">2155</span></a>
</span><span id="CSVAnnotationStore-2156"><a href="#CSVAnnotationStore-2156"><span class="linenos">2156</span></a>        <span class="c1"># try:</span>
</span><span id="CSVAnnotationStore-2157"><a href="#CSVAnnotationStore-2157"><span class="linenos">2157</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">separator</span><span class="p">)</span>
</span><span id="CSVAnnotationStore-2158"><a href="#CSVAnnotationStore-2158"><span class="linenos">2158</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
</span><span id="CSVAnnotationStore-2159"><a href="#CSVAnnotationStore-2159"><span class="linenos">2159</span></a>        <span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">,</span> <span class="n">actions</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="CSVAnnotationStore-2160"><a href="#CSVAnnotationStore-2160"><span class="linenos">2160</span></a>        <span class="n">start_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">]</span>
</span><span id="CSVAnnotationStore-2161"><a href="#CSVAnnotationStore-2161"><span class="linenos">2161</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">start_names</span><span class="p">:</span>
</span><span id="CSVAnnotationStore-2162"><a href="#CSVAnnotationStore-2162"><span class="linenos">2162</span></a>            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CSVAnnotationStore-2163"><a href="#CSVAnnotationStore-2163"><span class="linenos">2163</span></a>                <span class="n">starts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
</span><span id="CSVAnnotationStore-2164"><a href="#CSVAnnotationStore-2164"><span class="linenos">2164</span></a>        <span class="n">end_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">]</span>
</span><span id="CSVAnnotationStore-2165"><a href="#CSVAnnotationStore-2165"><span class="linenos">2165</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">end_names</span><span class="p">:</span>
</span><span id="CSVAnnotationStore-2166"><a href="#CSVAnnotationStore-2166"><span class="linenos">2166</span></a>            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CSVAnnotationStore-2167"><a href="#CSVAnnotationStore-2167"><span class="linenos">2167</span></a>                <span class="n">ends</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
</span><span id="CSVAnnotationStore-2168"><a href="#CSVAnnotationStore-2168"><span class="linenos">2168</span></a>        <span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;behavior&quot;</span><span class="p">,</span> <span class="s2">&quot;behaviour&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">]</span>
</span><span id="CSVAnnotationStore-2169"><a href="#CSVAnnotationStore-2169"><span class="linenos">2169</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">class_names</span><span class="p">:</span>
</span><span id="CSVAnnotationStore-2170"><a href="#CSVAnnotationStore-2170"><span class="linenos">2170</span></a>            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="CSVAnnotationStore-2171"><a href="#CSVAnnotationStore-2171"><span class="linenos">2171</span></a>                <span class="n">actions</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
</span><span id="CSVAnnotationStore-2172"><a href="#CSVAnnotationStore-2172"><span class="linenos">2172</span></a>        <span class="k">if</span> <span class="n">starts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CSVAnnotationStore-2173"><a href="#CSVAnnotationStore-2173"><span class="linenos">2173</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The file must have a column titled &#39;from&#39; or &#39;start&#39;!&quot;</span><span class="p">)</span>
</span><span id="CSVAnnotationStore-2174"><a href="#CSVAnnotationStore-2174"><span class="linenos">2174</span></a>        <span class="k">if</span> <span class="n">ends</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CSVAnnotationStore-2175"><a href="#CSVAnnotationStore-2175"><span class="linenos">2175</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The file must have a column titled &#39;to&#39; or &#39;end&#39;!&quot;</span><span class="p">)</span>
</span><span id="CSVAnnotationStore-2176"><a href="#CSVAnnotationStore-2176"><span class="linenos">2176</span></a>        <span class="k">if</span> <span class="n">actions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CSVAnnotationStore-2177"><a href="#CSVAnnotationStore-2177"><span class="linenos">2177</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="CSVAnnotationStore-2178"><a href="#CSVAnnotationStore-2178"><span class="linenos">2178</span></a>                <span class="s2">&quot;The file must have a column titled &#39;class&#39;, &#39;behavior&#39;, &#39;behaviour&#39;, &#39;type&#39; or &#39;label&#39;!&quot;</span>
</span><span id="CSVAnnotationStore-2179"><a href="#CSVAnnotationStore-2179"><span class="linenos">2179</span></a>            <span class="p">)</span>
</span><span id="CSVAnnotationStore-2180"><a href="#CSVAnnotationStore-2180"><span class="linenos">2180</span></a>        <span class="n">times</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[]))</span>
</span><span id="CSVAnnotationStore-2181"><a href="#CSVAnnotationStore-2181"><span class="linenos">2181</span></a>        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">action</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
</span><span id="CSVAnnotationStore-2182"><a href="#CSVAnnotationStore-2182"><span class="linenos">2182</span></a>            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">]]):</span>
</span><span id="CSVAnnotationStore-2183"><a href="#CSVAnnotationStore-2183"><span class="linenos">2183</span></a>                <span class="k">continue</span>
</span><span id="CSVAnnotationStore-2184"><a href="#CSVAnnotationStore-2184"><span class="linenos">2184</span></a>            <span class="n">times</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_agent_name</span><span class="p">][</span><span class="n">action</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="CSVAnnotationStore-2185"><a href="#CSVAnnotationStore-2185"><span class="linenos">2185</span></a>                <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">start</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="CSVAnnotationStore-2186"><a href="#CSVAnnotationStore-2186"><span class="linenos">2186</span></a>            <span class="p">)</span>
</span><span id="CSVAnnotationStore-2187"><a href="#CSVAnnotationStore-2187"><span class="linenos">2187</span></a>        <span class="k">return</span> <span class="n">times</span>
</span></pre></div>


            <div class="docstring"><p>CSV type annotation data</p>

<p>Assumes that files are saved as .csv tables with at least the following columns:</p>

<ul>
<li>from / start : start of action,</li>
<li>to / end : end of action,</li>
<li>class / behavior / behaviour / label / type : action label.</li>
</ul>

<p>If the times are set in seconds instead of frames, don't forget to set the <code>fps</code> parameter to your frame rate.</p>

<p>Assumes the following file structure:</p>

<pre><code>annotation_path
 video1_annotation.csv
 video2_labels.csv
</code></pre>

<p>Here <code>annotation_suffix</code> is <code>{'_annotation.csv', '_labels.csv'}</code>.</p>
</div>


                            <div id="CSVAnnotationStore.__init__" class="classattr">
                                        <input id="CSVAnnotationStore.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CSVAnnotationStore</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>,</span><span class="param">	<span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span>,</span><span class="param">	<span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span>,</span><span class="param">	<span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">default_agent_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ind0&#39;</span>,</span><span class="param">	<span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span>,</span><span class="param">	<span class="n">fps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="CSVAnnotationStore.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CSVAnnotationStore.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CSVAnnotationStore.__init__-2030"><a href="#CSVAnnotationStore.__init__-2030"><span class="linenos">2030</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="CSVAnnotationStore.__init__-2031"><a href="#CSVAnnotationStore.__init__-2031"><span class="linenos">2031</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2032"><a href="#CSVAnnotationStore.__init__-2032"><span class="linenos">2032</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2033"><a href="#CSVAnnotationStore.__init__-2033"><span class="linenos">2033</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2034"><a href="#CSVAnnotationStore.__init__-2034"><span class="linenos">2034</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2035"><a href="#CSVAnnotationStore.__init__-2035"><span class="linenos">2035</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2036"><a href="#CSVAnnotationStore.__init__-2036"><span class="linenos">2036</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2037"><a href="#CSVAnnotationStore.__init__-2037"><span class="linenos">2037</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2038"><a href="#CSVAnnotationStore.__init__-2038"><span class="linenos">2038</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2039"><a href="#CSVAnnotationStore.__init__-2039"><span class="linenos">2039</span></a>        <span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2040"><a href="#CSVAnnotationStore.__init__-2040"><span class="linenos">2040</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2041"><a href="#CSVAnnotationStore.__init__-2041"><span class="linenos">2041</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2042"><a href="#CSVAnnotationStore.__init__-2042"><span class="linenos">2042</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2043"><a href="#CSVAnnotationStore.__init__-2043"><span class="linenos">2043</span></a>        <span class="n">behavior_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2044"><a href="#CSVAnnotationStore.__init__-2044"><span class="linenos">2044</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2045"><a href="#CSVAnnotationStore.__init__-2045"><span class="linenos">2045</span></a>        <span class="n">frame_limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2046"><a href="#CSVAnnotationStore.__init__-2046"><span class="linenos">2046</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2047"><a href="#CSVAnnotationStore.__init__-2047"><span class="linenos">2047</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2048"><a href="#CSVAnnotationStore.__init__-2048"><span class="linenos">2048</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2049"><a href="#CSVAnnotationStore.__init__-2049"><span class="linenos">2049</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2050"><a href="#CSVAnnotationStore.__init__-2050"><span class="linenos">2050</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2051"><a href="#CSVAnnotationStore.__init__-2051"><span class="linenos">2051</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2052"><a href="#CSVAnnotationStore.__init__-2052"><span class="linenos">2052</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2053"><a href="#CSVAnnotationStore.__init__-2053"><span class="linenos">2053</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2054"><a href="#CSVAnnotationStore.__init__-2054"><span class="linenos">2054</span></a>        <span class="n">default_agent_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ind0&quot;</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2055"><a href="#CSVAnnotationStore.__init__-2055"><span class="linenos">2055</span></a>        <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2056"><a href="#CSVAnnotationStore.__init__-2056"><span class="linenos">2056</span></a>        <span class="n">fps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2057"><a href="#CSVAnnotationStore.__init__-2057"><span class="linenos">2057</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2058"><a href="#CSVAnnotationStore.__init__-2058"><span class="linenos">2058</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2059"><a href="#CSVAnnotationStore.__init__-2059"><span class="linenos">2059</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CSVAnnotationStore.__init__-2060"><a href="#CSVAnnotationStore.__init__-2060"><span class="linenos">2060</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="CSVAnnotationStore.__init__-2061"><a href="#CSVAnnotationStore.__init__-2061"><span class="linenos">2061</span></a><span class="sd">        Parameters</span>
</span><span id="CSVAnnotationStore.__init__-2062"><a href="#CSVAnnotationStore.__init__-2062"><span class="linenos">2062</span></a><span class="sd">        ----------</span>
</span><span id="CSVAnnotationStore.__init__-2063"><a href="#CSVAnnotationStore.__init__-2063"><span class="linenos">2063</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="CSVAnnotationStore.__init__-2064"><a href="#CSVAnnotationStore.__init__-2064"><span class="linenos">2064</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="CSVAnnotationStore.__init__-2065"><a href="#CSVAnnotationStore.__init__-2065"><span class="linenos">2065</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="CSVAnnotationStore.__init__-2066"><a href="#CSVAnnotationStore.__init__-2066"><span class="linenos">2066</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="CSVAnnotationStore.__init__-2067"><a href="#CSVAnnotationStore.__init__-2067"><span class="linenos">2067</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="CSVAnnotationStore.__init__-2068"><a href="#CSVAnnotationStore.__init__-2068"><span class="linenos">2068</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="CSVAnnotationStore.__init__-2069"><a href="#CSVAnnotationStore.__init__-2069"><span class="linenos">2069</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="CSVAnnotationStore.__init__-2070"><a href="#CSVAnnotationStore.__init__-2070"><span class="linenos">2070</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="CSVAnnotationStore.__init__-2071"><a href="#CSVAnnotationStore.__init__-2071"><span class="linenos">2071</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="CSVAnnotationStore.__init__-2072"><a href="#CSVAnnotationStore.__init__-2072"><span class="linenos">2072</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="CSVAnnotationStore.__init__-2073"><a href="#CSVAnnotationStore.__init__-2073"><span class="linenos">2073</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="CSVAnnotationStore.__init__-2074"><a href="#CSVAnnotationStore.__init__-2074"><span class="linenos">2074</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="CSVAnnotationStore.__init__-2075"><a href="#CSVAnnotationStore.__init__-2075"><span class="linenos">2075</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="CSVAnnotationStore.__init__-2076"><a href="#CSVAnnotationStore.__init__-2076"><span class="linenos">2076</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="CSVAnnotationStore.__init__-2077"><a href="#CSVAnnotationStore.__init__-2077"><span class="linenos">2077</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="CSVAnnotationStore.__init__-2078"><a href="#CSVAnnotationStore.__init__-2078"><span class="linenos">2078</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="CSVAnnotationStore.__init__-2079"><a href="#CSVAnnotationStore.__init__-2079"><span class="linenos">2079</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="CSVAnnotationStore.__init__-2080"><a href="#CSVAnnotationStore.__init__-2080"><span class="linenos">2080</span></a><span class="sd">        behaviors : set, optional</span>
</span><span id="CSVAnnotationStore.__init__-2081"><a href="#CSVAnnotationStore.__init__-2081"><span class="linenos">2081</span></a><span class="sd">            the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are</span>
</span><span id="CSVAnnotationStore.__init__-2082"><a href="#CSVAnnotationStore.__init__-2082"><span class="linenos">2082</span></a><span class="sd">            loaded from a file)</span>
</span><span id="CSVAnnotationStore.__init__-2083"><a href="#CSVAnnotationStore.__init__-2083"><span class="linenos">2083</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="CSVAnnotationStore.__init__-2084"><a href="#CSVAnnotationStore.__init__-2084"><span class="linenos">2084</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="CSVAnnotationStore.__init__-2085"><a href="#CSVAnnotationStore.__init__-2085"><span class="linenos">2085</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="CSVAnnotationStore.__init__-2086"><a href="#CSVAnnotationStore.__init__-2086"><span class="linenos">2086</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="CSVAnnotationStore.__init__-2087"><a href="#CSVAnnotationStore.__init__-2087"><span class="linenos">2087</span></a><span class="sd">            (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="CSVAnnotationStore.__init__-2088"><a href="#CSVAnnotationStore.__init__-2088"><span class="linenos">2088</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="CSVAnnotationStore.__init__-2089"><a href="#CSVAnnotationStore.__init__-2089"><span class="linenos">2089</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="CSVAnnotationStore.__init__-2090"><a href="#CSVAnnotationStore.__init__-2090"><span class="linenos">2090</span></a><span class="sd">            from key objects)</span>
</span><span id="CSVAnnotationStore.__init__-2091"><a href="#CSVAnnotationStore.__init__-2091"><span class="linenos">2091</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="CSVAnnotationStore.__init__-2092"><a href="#CSVAnnotationStore.__init__-2092"><span class="linenos">2092</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="CSVAnnotationStore.__init__-2093"><a href="#CSVAnnotationStore.__init__-2093"><span class="linenos">2093</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="CSVAnnotationStore.__init__-2094"><a href="#CSVAnnotationStore.__init__-2094"><span class="linenos">2094</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="CSVAnnotationStore.__init__-2095"><a href="#CSVAnnotationStore.__init__-2095"><span class="linenos">2095</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="CSVAnnotationStore.__init__-2096"><a href="#CSVAnnotationStore.__init__-2096"><span class="linenos">2096</span></a><span class="sd">        frame_limit : int, default 0</span>
</span><span id="CSVAnnotationStore.__init__-2097"><a href="#CSVAnnotationStore.__init__-2097"><span class="linenos">2097</span></a><span class="sd">            the smallest possible length of a clip (shorter clips are discarded)</span>
</span><span id="CSVAnnotationStore.__init__-2098"><a href="#CSVAnnotationStore.__init__-2098"><span class="linenos">2098</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="CSVAnnotationStore.__init__-2099"><a href="#CSVAnnotationStore.__init__-2099"><span class="linenos">2099</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="CSVAnnotationStore.__init__-2100"><a href="#CSVAnnotationStore.__init__-2100"><span class="linenos">2100</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="CSVAnnotationStore.__init__-2101"><a href="#CSVAnnotationStore.__init__-2101"><span class="linenos">2101</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="CSVAnnotationStore.__init__-2102"><a href="#CSVAnnotationStore.__init__-2102"><span class="linenos">2102</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="CSVAnnotationStore.__init__-2103"><a href="#CSVAnnotationStore.__init__-2103"><span class="linenos">2103</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="CSVAnnotationStore.__init__-2104"><a href="#CSVAnnotationStore.__init__-2104"><span class="linenos">2104</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="CSVAnnotationStore.__init__-2105"><a href="#CSVAnnotationStore.__init__-2105"><span class="linenos">2105</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="CSVAnnotationStore.__init__-2106"><a href="#CSVAnnotationStore.__init__-2106"><span class="linenos">2106</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="CSVAnnotationStore.__init__-2107"><a href="#CSVAnnotationStore.__init__-2107"><span class="linenos">2107</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="CSVAnnotationStore.__init__-2108"><a href="#CSVAnnotationStore.__init__-2108"><span class="linenos">2108</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="CSVAnnotationStore.__init__-2109"><a href="#CSVAnnotationStore.__init__-2109"><span class="linenos">2109</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="CSVAnnotationStore.__init__-2110"><a href="#CSVAnnotationStore.__init__-2110"><span class="linenos">2110</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="CSVAnnotationStore.__init__-2111"><a href="#CSVAnnotationStore.__init__-2111"><span class="linenos">2111</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="CSVAnnotationStore.__init__-2112"><a href="#CSVAnnotationStore.__init__-2112"><span class="linenos">2112</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="CSVAnnotationStore.__init__-2113"><a href="#CSVAnnotationStore.__init__-2113"><span class="linenos">2113</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="CSVAnnotationStore.__init__-2114"><a href="#CSVAnnotationStore.__init__-2114"><span class="linenos">2114</span></a><span class="sd">        default_agent_name : str, default &quot;ind0&quot;</span>
</span><span id="CSVAnnotationStore.__init__-2115"><a href="#CSVAnnotationStore.__init__-2115"><span class="linenos">2115</span></a><span class="sd">            the clip id to use when there is no given</span>
</span><span id="CSVAnnotationStore.__init__-2116"><a href="#CSVAnnotationStore.__init__-2116"><span class="linenos">2116</span></a><span class="sd">        separator : str, default &quot;,&quot;</span>
</span><span id="CSVAnnotationStore.__init__-2117"><a href="#CSVAnnotationStore.__init__-2117"><span class="linenos">2117</span></a><span class="sd">            the separator in the csv files</span>
</span><span id="CSVAnnotationStore.__init__-2118"><a href="#CSVAnnotationStore.__init__-2118"><span class="linenos">2118</span></a><span class="sd">        fps : int, default 30</span>
</span><span id="CSVAnnotationStore.__init__-2119"><a href="#CSVAnnotationStore.__init__-2119"><span class="linenos">2119</span></a><span class="sd">            frames per second in the videos</span>
</span><span id="CSVAnnotationStore.__init__-2120"><a href="#CSVAnnotationStore.__init__-2120"><span class="linenos">2120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CSVAnnotationStore.__init__-2121"><a href="#CSVAnnotationStore.__init__-2121"><span class="linenos">2121</span></a>
</span><span id="CSVAnnotationStore.__init__-2122"><a href="#CSVAnnotationStore.__init__-2122"><span class="linenos">2122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">default_agent_name</span> <span class="o">=</span> <span class="n">default_agent_name</span>
</span><span id="CSVAnnotationStore.__init__-2123"><a href="#CSVAnnotationStore.__init__-2123"><span class="linenos">2123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">separator</span> <span class="o">=</span> <span class="n">separator</span>
</span><span id="CSVAnnotationStore.__init__-2124"><a href="#CSVAnnotationStore.__init__-2124"><span class="linenos">2124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="n">fps</span>
</span><span id="CSVAnnotationStore.__init__-2125"><a href="#CSVAnnotationStore.__init__-2125"><span class="linenos">2125</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="CSVAnnotationStore.__init__-2126"><a href="#CSVAnnotationStore.__init__-2126"><span class="linenos">2126</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2127"><a href="#CSVAnnotationStore.__init__-2127"><span class="linenos">2127</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2128"><a href="#CSVAnnotationStore.__init__-2128"><span class="linenos">2128</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2129"><a href="#CSVAnnotationStore.__init__-2129"><span class="linenos">2129</span></a>            <span class="n">visibility</span><span class="o">=</span><span class="n">visibility</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2130"><a href="#CSVAnnotationStore.__init__-2130"><span class="linenos">2130</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2131"><a href="#CSVAnnotationStore.__init__-2131"><span class="linenos">2131</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2132"><a href="#CSVAnnotationStore.__init__-2132"><span class="linenos">2132</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2133"><a href="#CSVAnnotationStore.__init__-2133"><span class="linenos">2133</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2134"><a href="#CSVAnnotationStore.__init__-2134"><span class="linenos">2134</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2135"><a href="#CSVAnnotationStore.__init__-2135"><span class="linenos">2135</span></a>            <span class="n">ignored_clips</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2136"><a href="#CSVAnnotationStore.__init__-2136"><span class="linenos">2136</span></a>            <span class="n">annotation_suffix</span><span class="o">=</span><span class="n">annotation_suffix</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2137"><a href="#CSVAnnotationStore.__init__-2137"><span class="linenos">2137</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2138"><a href="#CSVAnnotationStore.__init__-2138"><span class="linenos">2138</span></a>            <span class="n">behavior_file</span><span class="o">=</span><span class="n">behavior_file</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2139"><a href="#CSVAnnotationStore.__init__-2139"><span class="linenos">2139</span></a>            <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2140"><a href="#CSVAnnotationStore.__init__-2140"><span class="linenos">2140</span></a>            <span class="n">frame_limit</span><span class="o">=</span><span class="n">frame_limit</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2141"><a href="#CSVAnnotationStore.__init__-2141"><span class="linenos">2141</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="n">filter_annotated</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2142"><a href="#CSVAnnotationStore.__init__-2142"><span class="linenos">2142</span></a>            <span class="n">filter_background</span><span class="o">=</span><span class="n">filter_background</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2143"><a href="#CSVAnnotationStore.__init__-2143"><span class="linenos">2143</span></a>            <span class="n">error_class</span><span class="o">=</span><span class="n">error_class</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2144"><a href="#CSVAnnotationStore.__init__-2144"><span class="linenos">2144</span></a>            <span class="n">min_frames_action</span><span class="o">=</span><span class="n">min_frames_action</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2145"><a href="#CSVAnnotationStore.__init__-2145"><span class="linenos">2145</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2146"><a href="#CSVAnnotationStore.__init__-2146"><span class="linenos">2146</span></a>            <span class="n">visibility_min_score</span><span class="o">=</span><span class="n">visibility_min_score</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2147"><a href="#CSVAnnotationStore.__init__-2147"><span class="linenos">2147</span></a>            <span class="n">visibility_min_frac</span><span class="o">=</span><span class="n">visibility_min_frac</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2148"><a href="#CSVAnnotationStore.__init__-2148"><span class="linenos">2148</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="CSVAnnotationStore.__init__-2149"><a href="#CSVAnnotationStore.__init__-2149"><span class="linenos">2149</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h2 id="parameters">Parameters</h2>

<p>video_order : list, optional
    a list of video ids that should be processed in the same order (not passed if creating from key objects)
min_frames : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    clip start frames (not passed if creating from key objects)
max_frames : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    clip end frames (not passed if creating from key objects)
visibility : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)
exclusive : bool, default True
    if True, the annotation is single-label; if False, multi-label
len_segment : int, default 128
    the length of the segments in which the data should be cut (in frames)
overlap : int, default 0
    the length of the overlap between neighboring segments (in frames)
behaviors : set, optional
    the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are
    loaded from a file)
ignored_classes : set, optional
    the list of behaviors from the behaviors list or file to not annotate
annotation_suffix : str | set, optional
    the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}
    (not passed if creating from key objects or if irrelevant for the dataset)
annotation_path : str | set, optional
    the path or the set of paths to the folder where the annotation files are stored (not passed if creating
    from key objects)
behavior_file : str, optional
    the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)
correction : dict, optional
    a dictionary of corrections for the labels (e.g. {'sleping': 'sleeping', 'calm locomotion': 'locomotion'},
    can be used to correct for variations in naming or to merge several labels in one
frame_limit : int, default 0
    the smallest possible length of a clip (shorter clips are discarded)
filter_annotated : bool, default False
    if True, the samples that do not have any labels will be filtered
filter_background : bool, default False
    if True, only the unlabeled frames that are close to annotated frames will be labeled as background
error_class : str, optional
    the name of the error class (the annotations that intersect with this label will be discarded)
min_frames_action : int, default 0
    the minimum length of an action (shorter actions are not annotated)
key_objects : tuple, optional
    the key objects to load the AnnotationStore from
visibility_min_score : float, default 5
    the minimum visibility score for visibility filtering
visibility_min_frac : float, default 0.7
    the minimum fraction of visible frames for visibility filtering
mask : dict, optional
    a masked value dictionary (for active learning simulation experiments)
default_agent_name : str, default "ind0"
    the clip id to use when there is no given
separator : str, default ","
    the separator in the csv files
fps : int, default 30
    frames per second in the videos</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ActionSegmentationStore">ActionSegmentationStore</a></dt>
                                <dd id="CSVAnnotationStore.remove" class="function"><a href="#ActionSegmentationStore.remove">remove</a></dd>
                <dd id="CSVAnnotationStore.key_objects" class="function"><a href="#ActionSegmentationStore.key_objects">key_objects</a></dd>
                <dd id="CSVAnnotationStore.load_from_key_objects" class="function"><a href="#ActionSegmentationStore.load_from_key_objects">load_from_key_objects</a></dd>
                <dd id="CSVAnnotationStore.to_ram" class="function"><a href="#ActionSegmentationStore.to_ram">to_ram</a></dd>
                <dd id="CSVAnnotationStore.get_original_coordinates" class="function"><a href="#ActionSegmentationStore.get_original_coordinates">get_original_coordinates</a></dd>
                <dd id="CSVAnnotationStore.create_subsample" class="function"><a href="#ActionSegmentationStore.create_subsample">create_subsample</a></dd>
                <dd id="CSVAnnotationStore.get_len" class="function"><a href="#ActionSegmentationStore.get_len">get_len</a></dd>
                <dd id="CSVAnnotationStore.get_indices" class="function"><a href="#ActionSegmentationStore.get_indices">get_indices</a></dd>
                <dd id="CSVAnnotationStore.count_classes" class="function"><a href="#ActionSegmentationStore.count_classes">count_classes</a></dd>
                <dd id="CSVAnnotationStore.behaviors_dict" class="function"><a href="#ActionSegmentationStore.behaviors_dict">behaviors_dict</a></dd>
                <dd id="CSVAnnotationStore.annotation_class" class="function"><a href="#ActionSegmentationStore.annotation_class">annotation_class</a></dd>
                <dd id="CSVAnnotationStore.size" class="function"><a href="#ActionSegmentationStore.size">size</a></dd>
                <dd id="CSVAnnotationStore.filtered_indices" class="function"><a href="#ActionSegmentationStore.filtered_indices">filtered_indices</a></dd>
                <dd id="CSVAnnotationStore.set_pseudo_labels" class="function"><a href="#ActionSegmentationStore.set_pseudo_labels">set_pseudo_labels</a></dd>
                <dd id="CSVAnnotationStore.get_file_ids" class="function"><a href="#ActionSegmentationStore.get_file_ids">get_file_ids</a></dd>

            </div>
            <div><dt><a href="base_store.html#AnnotationStore">dlc2action.data.base_store.AnnotationStore</a></dt>
                                <dd id="CSVAnnotationStore.required_objects" class="variable"><a href="base_store.html#AnnotationStore.required_objects">required_objects</a></dd>

            </div>
            <div><dt><a href="base_store.html#Store">dlc2action.data.base_store.Store</a></dt>
                                <dd id="CSVAnnotationStore.get_parameters" class="function"><a href="base_store.html#Store.get_parameters">get_parameters</a></dd>
                <dd id="CSVAnnotationStore.new" class="function"><a href="base_store.html#Store.new">new</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SIMBAAnnotationStore">
                            <input id="SIMBAAnnotationStore-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SIMBAAnnotationStore</span><wbr>(<span class="base"><a href="#FileAnnotationStore">FileAnnotationStore</a></span>):

                <label class="view-source-button" for="SIMBAAnnotationStore-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SIMBAAnnotationStore"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SIMBAAnnotationStore-2190"><a href="#SIMBAAnnotationStore-2190"><span class="linenos">2190</span></a><span class="k">class</span> <span class="nc">SIMBAAnnotationStore</span><span class="p">(</span><span class="n">FileAnnotationStore</span><span class="p">):</span>  <span class="c1"># +</span>
</span><span id="SIMBAAnnotationStore-2191"><a href="#SIMBAAnnotationStore-2191"><span class="linenos">2191</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SIMBAAnnotationStore-2192"><a href="#SIMBAAnnotationStore-2192"><span class="linenos">2192</span></a><span class="sd">    SIMBA paper format data</span>
</span><span id="SIMBAAnnotationStore-2193"><a href="#SIMBAAnnotationStore-2193"><span class="linenos">2193</span></a>
</span><span id="SIMBAAnnotationStore-2194"><a href="#SIMBAAnnotationStore-2194"><span class="linenos">2194</span></a><span class="sd">    Assumes the following file structure:</span>
</span><span id="SIMBAAnnotationStore-2195"><a href="#SIMBAAnnotationStore-2195"><span class="linenos">2195</span></a><span class="sd">    ```</span>
</span><span id="SIMBAAnnotationStore-2196"><a href="#SIMBAAnnotationStore-2196"><span class="linenos">2196</span></a><span class="sd">    annotation_path</span>
</span><span id="SIMBAAnnotationStore-2197"><a href="#SIMBAAnnotationStore-2197"><span class="linenos">2197</span></a><span class="sd">     Video1.csv</span>
</span><span id="SIMBAAnnotationStore-2198"><a href="#SIMBAAnnotationStore-2198"><span class="linenos">2198</span></a><span class="sd">    ...</span>
</span><span id="SIMBAAnnotationStore-2199"><a href="#SIMBAAnnotationStore-2199"><span class="linenos">2199</span></a><span class="sd">     Video9.csv</span>
</span><span id="SIMBAAnnotationStore-2200"><a href="#SIMBAAnnotationStore-2200"><span class="linenos">2200</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SIMBAAnnotationStore-2201"><a href="#SIMBAAnnotationStore-2201"><span class="linenos">2201</span></a>
</span><span id="SIMBAAnnotationStore-2202"><a href="#SIMBAAnnotationStore-2202"><span class="linenos">2202</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SIMBAAnnotationStore-2203"><a href="#SIMBAAnnotationStore-2203"><span class="linenos">2203</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2204"><a href="#SIMBAAnnotationStore-2204"><span class="linenos">2204</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2205"><a href="#SIMBAAnnotationStore-2205"><span class="linenos">2205</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2206"><a href="#SIMBAAnnotationStore-2206"><span class="linenos">2206</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2207"><a href="#SIMBAAnnotationStore-2207"><span class="linenos">2207</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2208"><a href="#SIMBAAnnotationStore-2208"><span class="linenos">2208</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2209"><a href="#SIMBAAnnotationStore-2209"><span class="linenos">2209</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2210"><a href="#SIMBAAnnotationStore-2210"><span class="linenos">2210</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2211"><a href="#SIMBAAnnotationStore-2211"><span class="linenos">2211</span></a>        <span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2212"><a href="#SIMBAAnnotationStore-2212"><span class="linenos">2212</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2213"><a href="#SIMBAAnnotationStore-2213"><span class="linenos">2213</span></a>        <span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2214"><a href="#SIMBAAnnotationStore-2214"><span class="linenos">2214</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2215"><a href="#SIMBAAnnotationStore-2215"><span class="linenos">2215</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2216"><a href="#SIMBAAnnotationStore-2216"><span class="linenos">2216</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2217"><a href="#SIMBAAnnotationStore-2217"><span class="linenos">2217</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2218"><a href="#SIMBAAnnotationStore-2218"><span class="linenos">2218</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2219"><a href="#SIMBAAnnotationStore-2219"><span class="linenos">2219</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2220"><a href="#SIMBAAnnotationStore-2220"><span class="linenos">2220</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2221"><a href="#SIMBAAnnotationStore-2221"><span class="linenos">2221</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2222"><a href="#SIMBAAnnotationStore-2222"><span class="linenos">2222</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2223"><a href="#SIMBAAnnotationStore-2223"><span class="linenos">2223</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2224"><a href="#SIMBAAnnotationStore-2224"><span class="linenos">2224</span></a>        <span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2225"><a href="#SIMBAAnnotationStore-2225"><span class="linenos">2225</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2226"><a href="#SIMBAAnnotationStore-2226"><span class="linenos">2226</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2227"><a href="#SIMBAAnnotationStore-2227"><span class="linenos">2227</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2228"><a href="#SIMBAAnnotationStore-2228"><span class="linenos">2228</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SIMBAAnnotationStore-2229"><a href="#SIMBAAnnotationStore-2229"><span class="linenos">2229</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SIMBAAnnotationStore-2230"><a href="#SIMBAAnnotationStore-2230"><span class="linenos">2230</span></a><span class="sd">        Parameters</span>
</span><span id="SIMBAAnnotationStore-2231"><a href="#SIMBAAnnotationStore-2231"><span class="linenos">2231</span></a><span class="sd">        ----------</span>
</span><span id="SIMBAAnnotationStore-2232"><a href="#SIMBAAnnotationStore-2232"><span class="linenos">2232</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="SIMBAAnnotationStore-2233"><a href="#SIMBAAnnotationStore-2233"><span class="linenos">2233</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="SIMBAAnnotationStore-2234"><a href="#SIMBAAnnotationStore-2234"><span class="linenos">2234</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="SIMBAAnnotationStore-2235"><a href="#SIMBAAnnotationStore-2235"><span class="linenos">2235</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="SIMBAAnnotationStore-2236"><a href="#SIMBAAnnotationStore-2236"><span class="linenos">2236</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="SIMBAAnnotationStore-2237"><a href="#SIMBAAnnotationStore-2237"><span class="linenos">2237</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="SIMBAAnnotationStore-2238"><a href="#SIMBAAnnotationStore-2238"><span class="linenos">2238</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="SIMBAAnnotationStore-2239"><a href="#SIMBAAnnotationStore-2239"><span class="linenos">2239</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="SIMBAAnnotationStore-2240"><a href="#SIMBAAnnotationStore-2240"><span class="linenos">2240</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="SIMBAAnnotationStore-2241"><a href="#SIMBAAnnotationStore-2241"><span class="linenos">2241</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="SIMBAAnnotationStore-2242"><a href="#SIMBAAnnotationStore-2242"><span class="linenos">2242</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="SIMBAAnnotationStore-2243"><a href="#SIMBAAnnotationStore-2243"><span class="linenos">2243</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="SIMBAAnnotationStore-2244"><a href="#SIMBAAnnotationStore-2244"><span class="linenos">2244</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="SIMBAAnnotationStore-2245"><a href="#SIMBAAnnotationStore-2245"><span class="linenos">2245</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="SIMBAAnnotationStore-2246"><a href="#SIMBAAnnotationStore-2246"><span class="linenos">2246</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="SIMBAAnnotationStore-2247"><a href="#SIMBAAnnotationStore-2247"><span class="linenos">2247</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="SIMBAAnnotationStore-2248"><a href="#SIMBAAnnotationStore-2248"><span class="linenos">2248</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="SIMBAAnnotationStore-2249"><a href="#SIMBAAnnotationStore-2249"><span class="linenos">2249</span></a><span class="sd">        behaviors : set, optional</span>
</span><span id="SIMBAAnnotationStore-2250"><a href="#SIMBAAnnotationStore-2250"><span class="linenos">2250</span></a><span class="sd">            the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are</span>
</span><span id="SIMBAAnnotationStore-2251"><a href="#SIMBAAnnotationStore-2251"><span class="linenos">2251</span></a><span class="sd">            loaded from a file)</span>
</span><span id="SIMBAAnnotationStore-2252"><a href="#SIMBAAnnotationStore-2252"><span class="linenos">2252</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="SIMBAAnnotationStore-2253"><a href="#SIMBAAnnotationStore-2253"><span class="linenos">2253</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="SIMBAAnnotationStore-2254"><a href="#SIMBAAnnotationStore-2254"><span class="linenos">2254</span></a><span class="sd">        ignored_clips : set, optional</span>
</span><span id="SIMBAAnnotationStore-2255"><a href="#SIMBAAnnotationStore-2255"><span class="linenos">2255</span></a><span class="sd">            clip ids to ignore</span>
</span><span id="SIMBAAnnotationStore-2256"><a href="#SIMBAAnnotationStore-2256"><span class="linenos">2256</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="SIMBAAnnotationStore-2257"><a href="#SIMBAAnnotationStore-2257"><span class="linenos">2257</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="SIMBAAnnotationStore-2258"><a href="#SIMBAAnnotationStore-2258"><span class="linenos">2258</span></a><span class="sd">            from key objects)</span>
</span><span id="SIMBAAnnotationStore-2259"><a href="#SIMBAAnnotationStore-2259"><span class="linenos">2259</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="SIMBAAnnotationStore-2260"><a href="#SIMBAAnnotationStore-2260"><span class="linenos">2260</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="SIMBAAnnotationStore-2261"><a href="#SIMBAAnnotationStore-2261"><span class="linenos">2261</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="SIMBAAnnotationStore-2262"><a href="#SIMBAAnnotationStore-2262"><span class="linenos">2262</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="SIMBAAnnotationStore-2263"><a href="#SIMBAAnnotationStore-2263"><span class="linenos">2263</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="SIMBAAnnotationStore-2264"><a href="#SIMBAAnnotationStore-2264"><span class="linenos">2264</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="SIMBAAnnotationStore-2265"><a href="#SIMBAAnnotationStore-2265"><span class="linenos">2265</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="SIMBAAnnotationStore-2266"><a href="#SIMBAAnnotationStore-2266"><span class="linenos">2266</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="SIMBAAnnotationStore-2267"><a href="#SIMBAAnnotationStore-2267"><span class="linenos">2267</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="SIMBAAnnotationStore-2268"><a href="#SIMBAAnnotationStore-2268"><span class="linenos">2268</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="SIMBAAnnotationStore-2269"><a href="#SIMBAAnnotationStore-2269"><span class="linenos">2269</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="SIMBAAnnotationStore-2270"><a href="#SIMBAAnnotationStore-2270"><span class="linenos">2270</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="SIMBAAnnotationStore-2271"><a href="#SIMBAAnnotationStore-2271"><span class="linenos">2271</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="SIMBAAnnotationStore-2272"><a href="#SIMBAAnnotationStore-2272"><span class="linenos">2272</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="SIMBAAnnotationStore-2273"><a href="#SIMBAAnnotationStore-2273"><span class="linenos">2273</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="SIMBAAnnotationStore-2274"><a href="#SIMBAAnnotationStore-2274"><span class="linenos">2274</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="SIMBAAnnotationStore-2275"><a href="#SIMBAAnnotationStore-2275"><span class="linenos">2275</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="SIMBAAnnotationStore-2276"><a href="#SIMBAAnnotationStore-2276"><span class="linenos">2276</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="SIMBAAnnotationStore-2277"><a href="#SIMBAAnnotationStore-2277"><span class="linenos">2277</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="SIMBAAnnotationStore-2278"><a href="#SIMBAAnnotationStore-2278"><span class="linenos">2278</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="SIMBAAnnotationStore-2279"><a href="#SIMBAAnnotationStore-2279"><span class="linenos">2279</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="SIMBAAnnotationStore-2280"><a href="#SIMBAAnnotationStore-2280"><span class="linenos">2280</span></a><span class="sd">        use_hard_negatives : bool, default False</span>
</span><span id="SIMBAAnnotationStore-2281"><a href="#SIMBAAnnotationStore-2281"><span class="linenos">2281</span></a><span class="sd">            mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing</span>
</span><span id="SIMBAAnnotationStore-2282"><a href="#SIMBAAnnotationStore-2282"><span class="linenos">2282</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="SIMBAAnnotationStore-2283"><a href="#SIMBAAnnotationStore-2283"><span class="linenos">2283</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="SIMBAAnnotationStore-2284"><a href="#SIMBAAnnotationStore-2284"><span class="linenos">2284</span></a><span class="sd">            (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="SIMBAAnnotationStore-2285"><a href="#SIMBAAnnotationStore-2285"><span class="linenos">2285</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SIMBAAnnotationStore-2286"><a href="#SIMBAAnnotationStore-2286"><span class="linenos">2286</span></a>
</span><span id="SIMBAAnnotationStore-2287"><a href="#SIMBAAnnotationStore-2287"><span class="linenos">2287</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SIMBAAnnotationStore-2288"><a href="#SIMBAAnnotationStore-2288"><span class="linenos">2288</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2289"><a href="#SIMBAAnnotationStore-2289"><span class="linenos">2289</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2290"><a href="#SIMBAAnnotationStore-2290"><span class="linenos">2290</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2291"><a href="#SIMBAAnnotationStore-2291"><span class="linenos">2291</span></a>            <span class="n">visibility</span><span class="o">=</span><span class="n">visibility</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2292"><a href="#SIMBAAnnotationStore-2292"><span class="linenos">2292</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2293"><a href="#SIMBAAnnotationStore-2293"><span class="linenos">2293</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2294"><a href="#SIMBAAnnotationStore-2294"><span class="linenos">2294</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2295"><a href="#SIMBAAnnotationStore-2295"><span class="linenos">2295</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2296"><a href="#SIMBAAnnotationStore-2296"><span class="linenos">2296</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2297"><a href="#SIMBAAnnotationStore-2297"><span class="linenos">2297</span></a>            <span class="n">ignored_clips</span><span class="o">=</span><span class="n">ignored_clips</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2298"><a href="#SIMBAAnnotationStore-2298"><span class="linenos">2298</span></a>            <span class="n">annotation_suffix</span><span class="o">=</span><span class="n">annotation_suffix</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2299"><a href="#SIMBAAnnotationStore-2299"><span class="linenos">2299</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2300"><a href="#SIMBAAnnotationStore-2300"><span class="linenos">2300</span></a>            <span class="n">behavior_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2301"><a href="#SIMBAAnnotationStore-2301"><span class="linenos">2301</span></a>            <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2302"><a href="#SIMBAAnnotationStore-2302"><span class="linenos">2302</span></a>            <span class="n">frame_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2303"><a href="#SIMBAAnnotationStore-2303"><span class="linenos">2303</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="n">filter_annotated</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2304"><a href="#SIMBAAnnotationStore-2304"><span class="linenos">2304</span></a>            <span class="n">filter_background</span><span class="o">=</span><span class="n">filter_background</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2305"><a href="#SIMBAAnnotationStore-2305"><span class="linenos">2305</span></a>            <span class="n">error_class</span><span class="o">=</span><span class="n">error_class</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2306"><a href="#SIMBAAnnotationStore-2306"><span class="linenos">2306</span></a>            <span class="n">min_frames_action</span><span class="o">=</span><span class="n">min_frames_action</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2307"><a href="#SIMBAAnnotationStore-2307"><span class="linenos">2307</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2308"><a href="#SIMBAAnnotationStore-2308"><span class="linenos">2308</span></a>            <span class="n">visibility_min_score</span><span class="o">=</span><span class="n">visibility_min_score</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2309"><a href="#SIMBAAnnotationStore-2309"><span class="linenos">2309</span></a>            <span class="n">visibility_min_frac</span><span class="o">=</span><span class="n">visibility_min_frac</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2310"><a href="#SIMBAAnnotationStore-2310"><span class="linenos">2310</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2311"><a href="#SIMBAAnnotationStore-2311"><span class="linenos">2311</span></a>            <span class="n">use_hard_negatives</span><span class="o">=</span><span class="n">use_hard_negatives</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2312"><a href="#SIMBAAnnotationStore-2312"><span class="linenos">2312</span></a>            <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore-2313"><a href="#SIMBAAnnotationStore-2313"><span class="linenos">2313</span></a>        <span class="p">)</span>
</span><span id="SIMBAAnnotationStore-2314"><a href="#SIMBAAnnotationStore-2314"><span class="linenos">2314</span></a>
</span><span id="SIMBAAnnotationStore-2315"><a href="#SIMBAAnnotationStore-2315"><span class="linenos">2315</span></a>    <span class="k">def</span> <span class="nf">_open_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="SIMBAAnnotationStore-2316"><a href="#SIMBAAnnotationStore-2316"><span class="linenos">2316</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SIMBAAnnotationStore-2317"><a href="#SIMBAAnnotationStore-2317"><span class="linenos">2317</span></a><span class="sd">        Load the annotation from filename</span>
</span><span id="SIMBAAnnotationStore-2318"><a href="#SIMBAAnnotationStore-2318"><span class="linenos">2318</span></a>
</span><span id="SIMBAAnnotationStore-2319"><a href="#SIMBAAnnotationStore-2319"><span class="linenos">2319</span></a><span class="sd">        Parameters</span>
</span><span id="SIMBAAnnotationStore-2320"><a href="#SIMBAAnnotationStore-2320"><span class="linenos">2320</span></a><span class="sd">        ----------</span>
</span><span id="SIMBAAnnotationStore-2321"><a href="#SIMBAAnnotationStore-2321"><span class="linenos">2321</span></a><span class="sd">        filename : str</span>
</span><span id="SIMBAAnnotationStore-2322"><a href="#SIMBAAnnotationStore-2322"><span class="linenos">2322</span></a><span class="sd">            path to an annotation file</span>
</span><span id="SIMBAAnnotationStore-2323"><a href="#SIMBAAnnotationStore-2323"><span class="linenos">2323</span></a>
</span><span id="SIMBAAnnotationStore-2324"><a href="#SIMBAAnnotationStore-2324"><span class="linenos">2324</span></a><span class="sd">        Returns</span>
</span><span id="SIMBAAnnotationStore-2325"><a href="#SIMBAAnnotationStore-2325"><span class="linenos">2325</span></a><span class="sd">        -------</span>
</span><span id="SIMBAAnnotationStore-2326"><a href="#SIMBAAnnotationStore-2326"><span class="linenos">2326</span></a><span class="sd">        times : dict</span>
</span><span id="SIMBAAnnotationStore-2327"><a href="#SIMBAAnnotationStore-2327"><span class="linenos">2327</span></a><span class="sd">            a nested dictionary where first-level keys are clip ids, second-level keys are categories and values are</span>
</span><span id="SIMBAAnnotationStore-2328"><a href="#SIMBAAnnotationStore-2328"><span class="linenos">2328</span></a><span class="sd">            lists of (start, end, ambiguity status) lists</span>
</span><span id="SIMBAAnnotationStore-2329"><a href="#SIMBAAnnotationStore-2329"><span class="linenos">2329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SIMBAAnnotationStore-2330"><a href="#SIMBAAnnotationStore-2330"><span class="linenos">2330</span></a>
</span><span id="SIMBAAnnotationStore-2331"><a href="#SIMBAAnnotationStore-2331"><span class="linenos">2331</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="SIMBAAnnotationStore-2332"><a href="#SIMBAAnnotationStore-2332"><span class="linenos">2332</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
</span><span id="SIMBAAnnotationStore-2333"><a href="#SIMBAAnnotationStore-2333"><span class="linenos">2333</span></a>        <span class="n">animals</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">]))</span>
</span><span id="SIMBAAnnotationStore-2334"><a href="#SIMBAAnnotationStore-2334"><span class="linenos">2334</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SIMBAAnnotationStore-2335"><a href="#SIMBAAnnotationStore-2335"><span class="linenos">2335</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="SIMBAAnnotationStore-2336"><a href="#SIMBAAnnotationStore-2336"><span class="linenos">2336</span></a>                <span class="s2">&quot;SIMBAAnnotationStore is only implemented for files with 1 or 2 animals!&quot;</span>
</span><span id="SIMBAAnnotationStore-2337"><a href="#SIMBAAnnotationStore-2337"><span class="linenos">2337</span></a>            <span class="p">)</span>
</span><span id="SIMBAAnnotationStore-2338"><a href="#SIMBAAnnotationStore-2338"><span class="linenos">2338</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SIMBAAnnotationStore-2339"><a href="#SIMBAAnnotationStore-2339"><span class="linenos">2339</span></a>            <span class="n">ind</span> <span class="o">=</span> <span class="n">animals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SIMBAAnnotationStore-2340"><a href="#SIMBAAnnotationStore-2340"><span class="linenos">2340</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SIMBAAnnotationStore-2341"><a href="#SIMBAAnnotationStore-2341"><span class="linenos">2341</span></a>            <span class="n">ind</span> <span class="o">=</span> <span class="s2">&quot;+&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span>
</span><span id="SIMBAAnnotationStore-2342"><a href="#SIMBAAnnotationStore-2342"><span class="linenos">2342</span></a>        <span class="n">behaviors</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SIMBAAnnotationStore-2343"><a href="#SIMBAAnnotationStore-2343"><span class="linenos">2343</span></a>            <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="SIMBAAnnotationStore-2344"><a href="#SIMBAAnnotationStore-2344"><span class="linenos">2344</span></a>            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span>
</span><span id="SIMBAAnnotationStore-2345"><a href="#SIMBAAnnotationStore-2345"><span class="linenos">2345</span></a>            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;prediction&quot;</span>
</span><span id="SIMBAAnnotationStore-2346"><a href="#SIMBAAnnotationStore-2346"><span class="linenos">2346</span></a>        <span class="p">]</span>
</span><span id="SIMBAAnnotationStore-2347"><a href="#SIMBAAnnotationStore-2347"><span class="linenos">2347</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="SIMBAAnnotationStore-2348"><a href="#SIMBAAnnotationStore-2348"><span class="linenos">2348</span></a>        <span class="k">for</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">:</span>
</span><span id="SIMBAAnnotationStore-2349"><a href="#SIMBAAnnotationStore-2349"><span class="linenos">2349</span></a>            <span class="n">ann</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">behavior</span><span class="si">}</span><span class="s2">_prediction&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</span><span id="SIMBAAnnotationStore-2350"><a href="#SIMBAAnnotationStore-2350"><span class="linenos">2350</span></a>            <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span>
</span><span id="SIMBAAnnotationStore-2351"><a href="#SIMBAAnnotationStore-2351"><span class="linenos">2351</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">ann</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])])</span>
</span><span id="SIMBAAnnotationStore-2352"><a href="#SIMBAAnnotationStore-2352"><span class="linenos">2352</span></a>            <span class="p">)</span>
</span><span id="SIMBAAnnotationStore-2353"><a href="#SIMBAAnnotationStore-2353"><span class="linenos">2353</span></a>            <span class="n">starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SIMBAAnnotationStore-2354"><a href="#SIMBAAnnotationStore-2354"><span class="linenos">2354</span></a>            <span class="n">ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SIMBAAnnotationStore-2355"><a href="#SIMBAAnnotationStore-2355"><span class="linenos">2355</span></a>            <span class="n">result</span><span class="p">[</span><span class="n">behavior</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)]</span>
</span><span id="SIMBAAnnotationStore-2356"><a href="#SIMBAAnnotationStore-2356"><span class="linenos">2356</span></a>            <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span>
</span><span id="SIMBAAnnotationStore-2357"><a href="#SIMBAAnnotationStore-2357"><span class="linenos">2357</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="SIMBAAnnotationStore-2358"><a href="#SIMBAAnnotationStore-2358"><span class="linenos">2358</span></a>                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ann</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="SIMBAAnnotationStore-2359"><a href="#SIMBAAnnotationStore-2359"><span class="linenos">2359</span></a>                <span class="p">)</span>
</span><span id="SIMBAAnnotationStore-2360"><a href="#SIMBAAnnotationStore-2360"><span class="linenos">2360</span></a>            <span class="p">)</span>
</span><span id="SIMBAAnnotationStore-2361"><a href="#SIMBAAnnotationStore-2361"><span class="linenos">2361</span></a>            <span class="n">starts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SIMBAAnnotationStore-2362"><a href="#SIMBAAnnotationStore-2362"><span class="linenos">2362</span></a>            <span class="n">ends</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SIMBAAnnotationStore-2363"><a href="#SIMBAAnnotationStore-2363"><span class="linenos">2363</span></a>            <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;unknown </span><span class="si">{</span><span class="n">behavior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SIMBAAnnotationStore-2364"><a href="#SIMBAAnnotationStore-2364"><span class="linenos">2364</span></a>                <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">starts</span><span class="p">,</span> <span class="n">ends</span><span class="p">)</span>
</span><span id="SIMBAAnnotationStore-2365"><a href="#SIMBAAnnotationStore-2365"><span class="linenos">2365</span></a>            <span class="p">]</span>
</span><span id="SIMBAAnnotationStore-2366"><a href="#SIMBAAnnotationStore-2366"><span class="linenos">2366</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SIMBAAnnotationStore-2367"><a href="#SIMBAAnnotationStore-2367"><span class="linenos">2367</span></a>            <span class="k">for</span> <span class="n">behavior</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">behaviors</span><span class="p">:</span>
</span><span id="SIMBAAnnotationStore-2368"><a href="#SIMBAAnnotationStore-2368"><span class="linenos">2368</span></a>                <span class="k">if</span> <span class="n">behavior</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">behaviors</span><span class="p">:</span>
</span><span id="SIMBAAnnotationStore-2369"><a href="#SIMBAAnnotationStore-2369"><span class="linenos">2369</span></a>                    <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;unknown </span><span class="si">{</span><span class="n">behavior</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mi">0</span><span class="p">]]</span>
</span><span id="SIMBAAnnotationStore-2370"><a href="#SIMBAAnnotationStore-2370"><span class="linenos">2370</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">ind</span><span class="p">:</span> <span class="n">result</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>SIMBA paper format data</p>

<p>Assumes the following file structure:
```
annotation_path
 Video1.csv
...
 Video9.csv</p>
</div>


                            <div id="SIMBAAnnotationStore.__init__" class="classattr">
                                        <input id="SIMBAAnnotationStore.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SIMBAAnnotationStore</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>,</span><span class="param">	<span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span>,</span><span class="param">	<span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span>,</span><span class="param">	<span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">annotation_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="SIMBAAnnotationStore.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SIMBAAnnotationStore.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SIMBAAnnotationStore.__init__-2202"><a href="#SIMBAAnnotationStore.__init__-2202"><span class="linenos">2202</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SIMBAAnnotationStore.__init__-2203"><a href="#SIMBAAnnotationStore.__init__-2203"><span class="linenos">2203</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2204"><a href="#SIMBAAnnotationStore.__init__-2204"><span class="linenos">2204</span></a>        <span class="n">video_order</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2205"><a href="#SIMBAAnnotationStore.__init__-2205"><span class="linenos">2205</span></a>        <span class="n">min_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2206"><a href="#SIMBAAnnotationStore.__init__-2206"><span class="linenos">2206</span></a>        <span class="n">max_frames</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2207"><a href="#SIMBAAnnotationStore.__init__-2207"><span class="linenos">2207</span></a>        <span class="n">visibility</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2208"><a href="#SIMBAAnnotationStore.__init__-2208"><span class="linenos">2208</span></a>        <span class="n">exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2209"><a href="#SIMBAAnnotationStore.__init__-2209"><span class="linenos">2209</span></a>        <span class="n">len_segment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2210"><a href="#SIMBAAnnotationStore.__init__-2210"><span class="linenos">2210</span></a>        <span class="n">overlap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2211"><a href="#SIMBAAnnotationStore.__init__-2211"><span class="linenos">2211</span></a>        <span class="n">behaviors</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2212"><a href="#SIMBAAnnotationStore.__init__-2212"><span class="linenos">2212</span></a>        <span class="n">ignored_classes</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2213"><a href="#SIMBAAnnotationStore.__init__-2213"><span class="linenos">2213</span></a>        <span class="n">ignored_clips</span><span class="p">:</span> <span class="n">Set</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2214"><a href="#SIMBAAnnotationStore.__init__-2214"><span class="linenos">2214</span></a>        <span class="n">annotation_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Set</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2215"><a href="#SIMBAAnnotationStore.__init__-2215"><span class="linenos">2215</span></a>        <span class="n">correction</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2216"><a href="#SIMBAAnnotationStore.__init__-2216"><span class="linenos">2216</span></a>        <span class="n">filter_annotated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2217"><a href="#SIMBAAnnotationStore.__init__-2217"><span class="linenos">2217</span></a>        <span class="n">filter_background</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2218"><a href="#SIMBAAnnotationStore.__init__-2218"><span class="linenos">2218</span></a>        <span class="n">error_class</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2219"><a href="#SIMBAAnnotationStore.__init__-2219"><span class="linenos">2219</span></a>        <span class="n">min_frames_action</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2220"><a href="#SIMBAAnnotationStore.__init__-2220"><span class="linenos">2220</span></a>        <span class="n">key_objects</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2221"><a href="#SIMBAAnnotationStore.__init__-2221"><span class="linenos">2221</span></a>        <span class="n">visibility_min_score</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2222"><a href="#SIMBAAnnotationStore.__init__-2222"><span class="linenos">2222</span></a>        <span class="n">visibility_min_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2223"><a href="#SIMBAAnnotationStore.__init__-2223"><span class="linenos">2223</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2224"><a href="#SIMBAAnnotationStore.__init__-2224"><span class="linenos">2224</span></a>        <span class="n">use_hard_negatives</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2225"><a href="#SIMBAAnnotationStore.__init__-2225"><span class="linenos">2225</span></a>        <span class="n">annotation_suffix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2226"><a href="#SIMBAAnnotationStore.__init__-2226"><span class="linenos">2226</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2227"><a href="#SIMBAAnnotationStore.__init__-2227"><span class="linenos">2227</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2228"><a href="#SIMBAAnnotationStore.__init__-2228"><span class="linenos">2228</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SIMBAAnnotationStore.__init__-2229"><a href="#SIMBAAnnotationStore.__init__-2229"><span class="linenos">2229</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SIMBAAnnotationStore.__init__-2230"><a href="#SIMBAAnnotationStore.__init__-2230"><span class="linenos">2230</span></a><span class="sd">        Parameters</span>
</span><span id="SIMBAAnnotationStore.__init__-2231"><a href="#SIMBAAnnotationStore.__init__-2231"><span class="linenos">2231</span></a><span class="sd">        ----------</span>
</span><span id="SIMBAAnnotationStore.__init__-2232"><a href="#SIMBAAnnotationStore.__init__-2232"><span class="linenos">2232</span></a><span class="sd">        video_order : list, optional</span>
</span><span id="SIMBAAnnotationStore.__init__-2233"><a href="#SIMBAAnnotationStore.__init__-2233"><span class="linenos">2233</span></a><span class="sd">            a list of video ids that should be processed in the same order (not passed if creating from key objects)</span>
</span><span id="SIMBAAnnotationStore.__init__-2234"><a href="#SIMBAAnnotationStore.__init__-2234"><span class="linenos">2234</span></a><span class="sd">        min_frames : dict, optional</span>
</span><span id="SIMBAAnnotationStore.__init__-2235"><a href="#SIMBAAnnotationStore.__init__-2235"><span class="linenos">2235</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="SIMBAAnnotationStore.__init__-2236"><a href="#SIMBAAnnotationStore.__init__-2236"><span class="linenos">2236</span></a><span class="sd">            clip start frames (not passed if creating from key objects)</span>
</span><span id="SIMBAAnnotationStore.__init__-2237"><a href="#SIMBAAnnotationStore.__init__-2237"><span class="linenos">2237</span></a><span class="sd">        max_frames : dict, optional</span>
</span><span id="SIMBAAnnotationStore.__init__-2238"><a href="#SIMBAAnnotationStore.__init__-2238"><span class="linenos">2238</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="SIMBAAnnotationStore.__init__-2239"><a href="#SIMBAAnnotationStore.__init__-2239"><span class="linenos">2239</span></a><span class="sd">            clip end frames (not passed if creating from key objects)</span>
</span><span id="SIMBAAnnotationStore.__init__-2240"><a href="#SIMBAAnnotationStore.__init__-2240"><span class="linenos">2240</span></a><span class="sd">        visibility : dict, optional</span>
</span><span id="SIMBAAnnotationStore.__init__-2241"><a href="#SIMBAAnnotationStore.__init__-2241"><span class="linenos">2241</span></a><span class="sd">            a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are</span>
</span><span id="SIMBAAnnotationStore.__init__-2242"><a href="#SIMBAAnnotationStore.__init__-2242"><span class="linenos">2242</span></a><span class="sd">            visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="SIMBAAnnotationStore.__init__-2243"><a href="#SIMBAAnnotationStore.__init__-2243"><span class="linenos">2243</span></a><span class="sd">        exclusive : bool, default True</span>
</span><span id="SIMBAAnnotationStore.__init__-2244"><a href="#SIMBAAnnotationStore.__init__-2244"><span class="linenos">2244</span></a><span class="sd">            if True, the annotation is single-label; if False, multi-label</span>
</span><span id="SIMBAAnnotationStore.__init__-2245"><a href="#SIMBAAnnotationStore.__init__-2245"><span class="linenos">2245</span></a><span class="sd">        len_segment : int, default 128</span>
</span><span id="SIMBAAnnotationStore.__init__-2246"><a href="#SIMBAAnnotationStore.__init__-2246"><span class="linenos">2246</span></a><span class="sd">            the length of the segments in which the data should be cut (in frames)</span>
</span><span id="SIMBAAnnotationStore.__init__-2247"><a href="#SIMBAAnnotationStore.__init__-2247"><span class="linenos">2247</span></a><span class="sd">        overlap : int, default 0</span>
</span><span id="SIMBAAnnotationStore.__init__-2248"><a href="#SIMBAAnnotationStore.__init__-2248"><span class="linenos">2248</span></a><span class="sd">            the length of the overlap between neighboring segments (in frames)</span>
</span><span id="SIMBAAnnotationStore.__init__-2249"><a href="#SIMBAAnnotationStore.__init__-2249"><span class="linenos">2249</span></a><span class="sd">        behaviors : set, optional</span>
</span><span id="SIMBAAnnotationStore.__init__-2250"><a href="#SIMBAAnnotationStore.__init__-2250"><span class="linenos">2250</span></a><span class="sd">            the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are</span>
</span><span id="SIMBAAnnotationStore.__init__-2251"><a href="#SIMBAAnnotationStore.__init__-2251"><span class="linenos">2251</span></a><span class="sd">            loaded from a file)</span>
</span><span id="SIMBAAnnotationStore.__init__-2252"><a href="#SIMBAAnnotationStore.__init__-2252"><span class="linenos">2252</span></a><span class="sd">        ignored_classes : set, optional</span>
</span><span id="SIMBAAnnotationStore.__init__-2253"><a href="#SIMBAAnnotationStore.__init__-2253"><span class="linenos">2253</span></a><span class="sd">            the list of behaviors from the behaviors list or file to not annotate</span>
</span><span id="SIMBAAnnotationStore.__init__-2254"><a href="#SIMBAAnnotationStore.__init__-2254"><span class="linenos">2254</span></a><span class="sd">        ignored_clips : set, optional</span>
</span><span id="SIMBAAnnotationStore.__init__-2255"><a href="#SIMBAAnnotationStore.__init__-2255"><span class="linenos">2255</span></a><span class="sd">            clip ids to ignore</span>
</span><span id="SIMBAAnnotationStore.__init__-2256"><a href="#SIMBAAnnotationStore.__init__-2256"><span class="linenos">2256</span></a><span class="sd">        annotation_path : str | set, optional</span>
</span><span id="SIMBAAnnotationStore.__init__-2257"><a href="#SIMBAAnnotationStore.__init__-2257"><span class="linenos">2257</span></a><span class="sd">            the path or the set of paths to the folder where the annotation files are stored (not passed if creating</span>
</span><span id="SIMBAAnnotationStore.__init__-2258"><a href="#SIMBAAnnotationStore.__init__-2258"><span class="linenos">2258</span></a><span class="sd">            from key objects)</span>
</span><span id="SIMBAAnnotationStore.__init__-2259"><a href="#SIMBAAnnotationStore.__init__-2259"><span class="linenos">2259</span></a><span class="sd">        behavior_file : str, optional</span>
</span><span id="SIMBAAnnotationStore.__init__-2260"><a href="#SIMBAAnnotationStore.__init__-2260"><span class="linenos">2260</span></a><span class="sd">            the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="SIMBAAnnotationStore.__init__-2261"><a href="#SIMBAAnnotationStore.__init__-2261"><span class="linenos">2261</span></a><span class="sd">        correction : dict, optional</span>
</span><span id="SIMBAAnnotationStore.__init__-2262"><a href="#SIMBAAnnotationStore.__init__-2262"><span class="linenos">2262</span></a><span class="sd">            a dictionary of corrections for the labels (e.g. {&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;},</span>
</span><span id="SIMBAAnnotationStore.__init__-2263"><a href="#SIMBAAnnotationStore.__init__-2263"><span class="linenos">2263</span></a><span class="sd">            can be used to correct for variations in naming or to merge several labels in one</span>
</span><span id="SIMBAAnnotationStore.__init__-2264"><a href="#SIMBAAnnotationStore.__init__-2264"><span class="linenos">2264</span></a><span class="sd">        filter_annotated : bool, default False</span>
</span><span id="SIMBAAnnotationStore.__init__-2265"><a href="#SIMBAAnnotationStore.__init__-2265"><span class="linenos">2265</span></a><span class="sd">            if True, the samples that do not have any labels will be filtered</span>
</span><span id="SIMBAAnnotationStore.__init__-2266"><a href="#SIMBAAnnotationStore.__init__-2266"><span class="linenos">2266</span></a><span class="sd">        filter_background : bool, default False</span>
</span><span id="SIMBAAnnotationStore.__init__-2267"><a href="#SIMBAAnnotationStore.__init__-2267"><span class="linenos">2267</span></a><span class="sd">            if True, only the unlabeled frames that are close to annotated frames will be labeled as background</span>
</span><span id="SIMBAAnnotationStore.__init__-2268"><a href="#SIMBAAnnotationStore.__init__-2268"><span class="linenos">2268</span></a><span class="sd">        error_class : str, optional</span>
</span><span id="SIMBAAnnotationStore.__init__-2269"><a href="#SIMBAAnnotationStore.__init__-2269"><span class="linenos">2269</span></a><span class="sd">            the name of the error class (the annotations that intersect with this label will be discarded)</span>
</span><span id="SIMBAAnnotationStore.__init__-2270"><a href="#SIMBAAnnotationStore.__init__-2270"><span class="linenos">2270</span></a><span class="sd">        min_frames_action : int, default 0</span>
</span><span id="SIMBAAnnotationStore.__init__-2271"><a href="#SIMBAAnnotationStore.__init__-2271"><span class="linenos">2271</span></a><span class="sd">            the minimum length of an action (shorter actions are not annotated)</span>
</span><span id="SIMBAAnnotationStore.__init__-2272"><a href="#SIMBAAnnotationStore.__init__-2272"><span class="linenos">2272</span></a><span class="sd">        key_objects : tuple, optional</span>
</span><span id="SIMBAAnnotationStore.__init__-2273"><a href="#SIMBAAnnotationStore.__init__-2273"><span class="linenos">2273</span></a><span class="sd">            the key objects to load the AnnotationStore from</span>
</span><span id="SIMBAAnnotationStore.__init__-2274"><a href="#SIMBAAnnotationStore.__init__-2274"><span class="linenos">2274</span></a><span class="sd">        visibility_min_score : float, default 5</span>
</span><span id="SIMBAAnnotationStore.__init__-2275"><a href="#SIMBAAnnotationStore.__init__-2275"><span class="linenos">2275</span></a><span class="sd">            the minimum visibility score for visibility filtering</span>
</span><span id="SIMBAAnnotationStore.__init__-2276"><a href="#SIMBAAnnotationStore.__init__-2276"><span class="linenos">2276</span></a><span class="sd">        visibility_min_frac : float, default 0.7</span>
</span><span id="SIMBAAnnotationStore.__init__-2277"><a href="#SIMBAAnnotationStore.__init__-2277"><span class="linenos">2277</span></a><span class="sd">            the minimum fraction of visible frames for visibility filtering</span>
</span><span id="SIMBAAnnotationStore.__init__-2278"><a href="#SIMBAAnnotationStore.__init__-2278"><span class="linenos">2278</span></a><span class="sd">        mask : dict, optional</span>
</span><span id="SIMBAAnnotationStore.__init__-2279"><a href="#SIMBAAnnotationStore.__init__-2279"><span class="linenos">2279</span></a><span class="sd">            a masked value dictionary (for active learning simulation experiments)</span>
</span><span id="SIMBAAnnotationStore.__init__-2280"><a href="#SIMBAAnnotationStore.__init__-2280"><span class="linenos">2280</span></a><span class="sd">        use_hard_negatives : bool, default False</span>
</span><span id="SIMBAAnnotationStore.__init__-2281"><a href="#SIMBAAnnotationStore.__init__-2281"><span class="linenos">2281</span></a><span class="sd">            mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing</span>
</span><span id="SIMBAAnnotationStore.__init__-2282"><a href="#SIMBAAnnotationStore.__init__-2282"><span class="linenos">2282</span></a><span class="sd">        annotation_suffix : str | set, optional</span>
</span><span id="SIMBAAnnotationStore.__init__-2283"><a href="#SIMBAAnnotationStore.__init__-2283"><span class="linenos">2283</span></a><span class="sd">            the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}</span>
</span><span id="SIMBAAnnotationStore.__init__-2284"><a href="#SIMBAAnnotationStore.__init__-2284"><span class="linenos">2284</span></a><span class="sd">            (not passed if creating from key objects or if irrelevant for the dataset)</span>
</span><span id="SIMBAAnnotationStore.__init__-2285"><a href="#SIMBAAnnotationStore.__init__-2285"><span class="linenos">2285</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SIMBAAnnotationStore.__init__-2286"><a href="#SIMBAAnnotationStore.__init__-2286"><span class="linenos">2286</span></a>
</span><span id="SIMBAAnnotationStore.__init__-2287"><a href="#SIMBAAnnotationStore.__init__-2287"><span class="linenos">2287</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="SIMBAAnnotationStore.__init__-2288"><a href="#SIMBAAnnotationStore.__init__-2288"><span class="linenos">2288</span></a>            <span class="n">video_order</span><span class="o">=</span><span class="n">video_order</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2289"><a href="#SIMBAAnnotationStore.__init__-2289"><span class="linenos">2289</span></a>            <span class="n">min_frames</span><span class="o">=</span><span class="n">min_frames</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2290"><a href="#SIMBAAnnotationStore.__init__-2290"><span class="linenos">2290</span></a>            <span class="n">max_frames</span><span class="o">=</span><span class="n">max_frames</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2291"><a href="#SIMBAAnnotationStore.__init__-2291"><span class="linenos">2291</span></a>            <span class="n">visibility</span><span class="o">=</span><span class="n">visibility</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2292"><a href="#SIMBAAnnotationStore.__init__-2292"><span class="linenos">2292</span></a>            <span class="n">exclusive</span><span class="o">=</span><span class="n">exclusive</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2293"><a href="#SIMBAAnnotationStore.__init__-2293"><span class="linenos">2293</span></a>            <span class="n">len_segment</span><span class="o">=</span><span class="n">len_segment</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2294"><a href="#SIMBAAnnotationStore.__init__-2294"><span class="linenos">2294</span></a>            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2295"><a href="#SIMBAAnnotationStore.__init__-2295"><span class="linenos">2295</span></a>            <span class="n">behaviors</span><span class="o">=</span><span class="n">behaviors</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2296"><a href="#SIMBAAnnotationStore.__init__-2296"><span class="linenos">2296</span></a>            <span class="n">ignored_classes</span><span class="o">=</span><span class="n">ignored_classes</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2297"><a href="#SIMBAAnnotationStore.__init__-2297"><span class="linenos">2297</span></a>            <span class="n">ignored_clips</span><span class="o">=</span><span class="n">ignored_clips</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2298"><a href="#SIMBAAnnotationStore.__init__-2298"><span class="linenos">2298</span></a>            <span class="n">annotation_suffix</span><span class="o">=</span><span class="n">annotation_suffix</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2299"><a href="#SIMBAAnnotationStore.__init__-2299"><span class="linenos">2299</span></a>            <span class="n">annotation_path</span><span class="o">=</span><span class="n">annotation_path</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2300"><a href="#SIMBAAnnotationStore.__init__-2300"><span class="linenos">2300</span></a>            <span class="n">behavior_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2301"><a href="#SIMBAAnnotationStore.__init__-2301"><span class="linenos">2301</span></a>            <span class="n">correction</span><span class="o">=</span><span class="n">correction</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2302"><a href="#SIMBAAnnotationStore.__init__-2302"><span class="linenos">2302</span></a>            <span class="n">frame_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2303"><a href="#SIMBAAnnotationStore.__init__-2303"><span class="linenos">2303</span></a>            <span class="n">filter_annotated</span><span class="o">=</span><span class="n">filter_annotated</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2304"><a href="#SIMBAAnnotationStore.__init__-2304"><span class="linenos">2304</span></a>            <span class="n">filter_background</span><span class="o">=</span><span class="n">filter_background</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2305"><a href="#SIMBAAnnotationStore.__init__-2305"><span class="linenos">2305</span></a>            <span class="n">error_class</span><span class="o">=</span><span class="n">error_class</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2306"><a href="#SIMBAAnnotationStore.__init__-2306"><span class="linenos">2306</span></a>            <span class="n">min_frames_action</span><span class="o">=</span><span class="n">min_frames_action</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2307"><a href="#SIMBAAnnotationStore.__init__-2307"><span class="linenos">2307</span></a>            <span class="n">key_objects</span><span class="o">=</span><span class="n">key_objects</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2308"><a href="#SIMBAAnnotationStore.__init__-2308"><span class="linenos">2308</span></a>            <span class="n">visibility_min_score</span><span class="o">=</span><span class="n">visibility_min_score</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2309"><a href="#SIMBAAnnotationStore.__init__-2309"><span class="linenos">2309</span></a>            <span class="n">visibility_min_frac</span><span class="o">=</span><span class="n">visibility_min_frac</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2310"><a href="#SIMBAAnnotationStore.__init__-2310"><span class="linenos">2310</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2311"><a href="#SIMBAAnnotationStore.__init__-2311"><span class="linenos">2311</span></a>            <span class="n">use_hard_negatives</span><span class="o">=</span><span class="n">use_hard_negatives</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2312"><a href="#SIMBAAnnotationStore.__init__-2312"><span class="linenos">2312</span></a>            <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="SIMBAAnnotationStore.__init__-2313"><a href="#SIMBAAnnotationStore.__init__-2313"><span class="linenos">2313</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h2 id="parameters">Parameters</h2>

<p>video_order : list, optional
    a list of video ids that should be processed in the same order (not passed if creating from key objects)
min_frames : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    clip start frames (not passed if creating from key objects)
max_frames : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    clip end frames (not passed if creating from key objects)
visibility : dict, optional
    a nested dictionary where first-level keys are video ids, second-level keys are clip ids and values are
    visibility score arrays (not passed if creating from key objects or if irrelevant for the dataset)
exclusive : bool, default True
    if True, the annotation is single-label; if False, multi-label
len_segment : int, default 128
    the length of the segments in which the data should be cut (in frames)
overlap : int, default 0
    the length of the overlap between neighboring segments (in frames)
behaviors : set, optional
    the list of behaviors to put in the annotation (not passed if creating a blank instance or if behaviors are
    loaded from a file)
ignored_classes : set, optional
    the list of behaviors from the behaviors list or file to not annotate
ignored_clips : set, optional
    clip ids to ignore
annotation_path : str | set, optional
    the path or the set of paths to the folder where the annotation files are stored (not passed if creating
    from key objects)
behavior_file : str, optional
    the path to an .xlsx behavior file (not passed if creating from key objects or if irrelevant for the dataset)
correction : dict, optional
    a dictionary of corrections for the labels (e.g. {'sleping': 'sleeping', 'calm locomotion': 'locomotion'},
    can be used to correct for variations in naming or to merge several labels in one
filter_annotated : bool, default False
    if True, the samples that do not have any labels will be filtered
filter_background : bool, default False
    if True, only the unlabeled frames that are close to annotated frames will be labeled as background
error_class : str, optional
    the name of the error class (the annotations that intersect with this label will be discarded)
min_frames_action : int, default 0
    the minimum length of an action (shorter actions are not annotated)
key_objects : tuple, optional
    the key objects to load the AnnotationStore from
visibility_min_score : float, default 5
    the minimum visibility score for visibility filtering
visibility_min_frac : float, default 0.7
    the minimum fraction of visible frames for visibility filtering
mask : dict, optional
    a masked value dictionary (for active learning simulation experiments)
use_hard_negatives : bool, default False
    mark hard negatives as 2 instead of 0 or 1, for loss functions that have options for hard negative processing
annotation_suffix : str | set, optional
    the suffix or the set of suffices such that the annotation files are named {video_id}{annotation_suffix}
    (not passed if creating from key objects or if irrelevant for the dataset)</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#ActionSegmentationStore">ActionSegmentationStore</a></dt>
                                <dd id="SIMBAAnnotationStore.remove" class="function"><a href="#ActionSegmentationStore.remove">remove</a></dd>
                <dd id="SIMBAAnnotationStore.key_objects" class="function"><a href="#ActionSegmentationStore.key_objects">key_objects</a></dd>
                <dd id="SIMBAAnnotationStore.load_from_key_objects" class="function"><a href="#ActionSegmentationStore.load_from_key_objects">load_from_key_objects</a></dd>
                <dd id="SIMBAAnnotationStore.to_ram" class="function"><a href="#ActionSegmentationStore.to_ram">to_ram</a></dd>
                <dd id="SIMBAAnnotationStore.get_original_coordinates" class="function"><a href="#ActionSegmentationStore.get_original_coordinates">get_original_coordinates</a></dd>
                <dd id="SIMBAAnnotationStore.create_subsample" class="function"><a href="#ActionSegmentationStore.create_subsample">create_subsample</a></dd>
                <dd id="SIMBAAnnotationStore.get_len" class="function"><a href="#ActionSegmentationStore.get_len">get_len</a></dd>
                <dd id="SIMBAAnnotationStore.get_indices" class="function"><a href="#ActionSegmentationStore.get_indices">get_indices</a></dd>
                <dd id="SIMBAAnnotationStore.count_classes" class="function"><a href="#ActionSegmentationStore.count_classes">count_classes</a></dd>
                <dd id="SIMBAAnnotationStore.behaviors_dict" class="function"><a href="#ActionSegmentationStore.behaviors_dict">behaviors_dict</a></dd>
                <dd id="SIMBAAnnotationStore.annotation_class" class="function"><a href="#ActionSegmentationStore.annotation_class">annotation_class</a></dd>
                <dd id="SIMBAAnnotationStore.size" class="function"><a href="#ActionSegmentationStore.size">size</a></dd>
                <dd id="SIMBAAnnotationStore.filtered_indices" class="function"><a href="#ActionSegmentationStore.filtered_indices">filtered_indices</a></dd>
                <dd id="SIMBAAnnotationStore.set_pseudo_labels" class="function"><a href="#ActionSegmentationStore.set_pseudo_labels">set_pseudo_labels</a></dd>
                <dd id="SIMBAAnnotationStore.get_file_ids" class="function"><a href="#ActionSegmentationStore.get_file_ids">get_file_ids</a></dd>

            </div>
            <div><dt><a href="base_store.html#AnnotationStore">dlc2action.data.base_store.AnnotationStore</a></dt>
                                <dd id="SIMBAAnnotationStore.required_objects" class="variable"><a href="base_store.html#AnnotationStore.required_objects">required_objects</a></dd>

            </div>
            <div><dt><a href="base_store.html#Store">dlc2action.data.base_store.Store</a></dt>
                                <dd id="SIMBAAnnotationStore.get_parameters" class="function"><a href="base_store.html#Store.get_parameters">get_parameters</a></dd>
                <dd id="SIMBAAnnotationStore.new" class="function"><a href="base_store.html#Store.new">new</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>