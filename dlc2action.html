<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>dlc2action API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>
            <img src="https://i.ibb.co/NstG5hz/03.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#usage">Usage</a>
  <ul>
    <li><a href="#project">Project</a></li>
  </ul></li>
  <li><a href="#contribution">Contribution</a>
  <ul>
    <li><a href="#models">Models</a></li>
    <li><a href="#ssl">SSL</a></li>
    <li><a href="#datasets">Datasets</a></li>
    <li><a href="#losses">Losses</a></li>
    <li><a href="#metrics">Metrics</a></li>
    <li><a href="#feature-extractors">Feature extractors</a></li>
    <li><a href="#augmentations">Augmentations</a></li>
    <li><a href="#config-files">Config files</a></li>
  </ul></li>
  <li><a href="#options">Options</a>
  <ul>
    <li><a href="#data-types">Data types</a></li>
    <li><a href="#annotation-types">Annotation types</a></li>
    <li><a href="#data">Data</a></li>
    <li><a href="#augmentations-2">Augmentations</a></li>
    <li><a href="#model">Model</a></li>
    <li><a href="#general">General</a></li>
    <li><a href="#losses-2">Losses</a></li>
    <li><a href="#metrics-2">Metrics</a></li>
    <li><a href="#ssl-2">SSL</a></li>
    <li><a href="#training-2">Training</a></li>
  </ul></li>
</ul>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="dlc2action/data.html">data</a></li>
                    <li><a href="dlc2action/feature_extraction.html">feature_extraction</a></li>
                    <li><a href="dlc2action/loss.html">loss</a></li>
                    <li><a href="dlc2action/metric.html">metric</a></li>
                    <li><a href="dlc2action/model.html">model</a></li>
                    <li><a href="dlc2action/options.html">options</a></li>
                    <li><a href="dlc2action/project.html">project</a></li>
                    <li><a href="dlc2action/scripts.html">scripts</a></li>
                    <li><a href="dlc2action/ssl.html">ssl</a></li>
                    <li><a href="dlc2action/task.html">task</a></li>
                    <li><a href="dlc2action/transformer.html">transformer</a></li>
                    <li><a href="dlc2action/utils.html">utils</a></li>
                    <li><a href="dlc2action/version.html">version</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
dlc2action    </h1>

                        <div class="docstring"><p><code><a href="">dlc2action</a></code> is an action segmentation package that makes running and tracking experiments easy.</p>

<h1 id="usage">Usage</h1>

<p><code><a href="">dlc2action</a></code> is designed to be modular.
You can use the high-level project interface for convenient experiment management or just import a metric
or an SSL module if you want more freedom. Here are some tutorials for using the package.</p>

<h2 id="project">Project</h2>

<p>Project is the class that can create and maintain configuration files and keep track of your experiments.</p>

<h3 id="creating">Creating</h3>

<p>To start a new project, you can create a new <code><a href="dlc2action/project/project.html#Project">dlc2action.project.project.Project</a></code> instance in python.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn"><a href="dlc2action/project.html">dlc2action.project</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">Project</span>

<span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span>
    <span class="s1">&#39;project_name&#39;</span><span class="p">,</span>
    <span class="n">data_type</span><span class="o">=</span><span class="s1">&#39;data_type&#39;</span><span class="p">,</span>
    <span class="n">annotation_type</span><span class="o">=</span><span class="s1">&#39;annotation_type&#39;</span><span class="p">,</span>
    <span class="n">data_path</span><span class="o">=</span><span class="s1">&#39;path/to/data/folder&#39;</span><span class="p">,</span>
    <span class="n">annotation_path</span><span class="o">=</span><span class="s1">&#39;path/to/annotation/folder&#39;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>
</div>

<p>Alternatively, if you have installed the package with pip, you can run a command in your terminal.</p>

<pre><code>$ dlc2action_init --name project_name -d data_type -a annotation_type -dp path/to/data_folder -ap path/to/annotation_folder
</code></pre>

<p>A new folder will be created at <code>projects_path/project_name</code> with all the necessary files. The default projects path is
a <code>DLC2Action</code> folder that will be created in your home directory.
The project structure looks like this.</p>

<pre><code>.
project_name
├── config                                             # Settings files
├── meta                                               # Project meta files (experiment records)
├── saved_datasets                                     # Pre-computed dataset files
└── results
    ├── logs                                           # Training logs (human readable)
    │   └── episode.txt
    ├── models                                         # Model checkpoints
    │   └── episode
    │       ├── epoch25.pt
    │       └── epoch50.pt
    ├── searches                                       # Hyperparameter search results (graphs)
    │   └── search
    │       ├── search_param_importances.html_docs
    │       └── search_contour.html_docs
    ├── splits                                         # Split files
    │       ├── time_25.0%validation_10.0%test.txt
    │       └── random_20.0%validation_10.0%test.txt
    ├── suggestions                                    # Suggestion and active learning files
    │       └── active_learning
    │           ├── video1_suggestion.pickle
    │           ├── video2_suggestion.pickle
    │           └── al_points.pickle
    └── predictions                                    # Prediction files (pickled dictionaries)
            ├── episode_epoch25.pickle
            └── episode_epoch50_newdata.pickle
</code></pre>

<p>You can find a more detailed explanation of the structure at <code><a href="dlc2action/project.html">dlc2action.project</a></code>.</p>

<p>After the poprojectrject is created you can modify the
parameters manually in the <code>project_name/config</code> folder or with the <code>project.update_parameters()</code> function.
Make sure to fill in all the fields marked with <code>???</code>.</p>

<p>This can also be done through the terminal. With an <code>--all</code> flag the command will iterate through all parameters
and otherwise it will only ask you to fill in the <code>???</code> blanks.</p>

<pre><code>$ dlc2action_fill --name project_name --all
</code></pre>

<h3 id="training">Training</h3>

<p>When you want to start your experiments, just create a <code><a href="dlc2action/project/project.html#Project">dlc2action.project.project.Project</a></code> instance again
(or use the one you created
to initialize the project). This time you don't have to set any parameters except the project name (and, if
you used it when creating the project, <code>projects_path</code>).</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn"><a href="dlc2action/project.html">dlc2action.project</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">Project</span>
<span class="n">project</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="s1">&#39;project_name&#39;</span><span class="p">)</span>
</code></pre>
</div>

<p>The first thing you will want to do is train some models. There are three ways to run a <em>training episode</em>
in <code><a href="">dlc2action</a></code>.</p>

<ol>
<li><p><strong>Run a single episode</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">project</span><span class="o">.</span><span class="n">run_episode</span><span class="p">(</span><span class="s1">&#39;episode_1&#39;</span><span class="p">)</span>
</code></pre>
</div>

<p>We have now run a training episode with the default project parameters (read from the configuration files)
and saved it in the meta files under the name <code>episode_1</code>.</p></li>
<li><p><strong>Run multiple episodes in a row</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">project</span><span class="o">.</span><span class="n">run_episodes</span><span class="p">([</span><span class="s1">&#39;episode_2&#39;</span><span class="p">,</span> <span class="s1">&#39;episode_3&#39;</span><span class="p">,</span> <span class="s1">&#39;episode_4&#39;</span><span class="p">])</span>
</code></pre>
</div>

<p>That way the <code><a href="dlc2action/task/universal_task.html#Task">dlc2action.task.universal_task.Task</a></code> instance will not be
re-created every time, which might save you some time.</p></li>
<li><p><strong>Continue a previously run episode</strong></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">project</span><span class="o">.</span><span class="n">continue_episode</span><span class="p">(</span><span class="s1">&#39;episode_2&#39;</span><span class="p">,</span> <span class="n">num_epochs</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</code></pre>
</div>

<p>In case you decide you want to continue an older episode, you can load all parameters and state dictionaries
and set a new number of epochs. That way training will go on from where it has stopped and in the end the
episode will be re-saved under the same name. Note that <code>num_epochs</code> denotes the <strong>new total number of epochs</strong>,
so if <code>episode_2</code> has already been trained for 300 epochs, for example, it will now run for 200 epochs more,
not 500.</p></li>
</ol>

<p>Of course, changing the default parameters every time you want to run a new configuration is not very convenient.
And, luckily, you don't have to do that. Instead you can add a <code>parameters_update</code> parameter to
<code><a href="dlc2action/project/project.html#Project.run_episode">dlc2action.project.project.Project.run_episode</a></code> (or <code>parameters_updates</code> to
<code><a href="dlc2action/project/project.html#Project.run_episodes">dlc2action.project.project.Project.run_episodes</a></code>; all other parameters generalize to multiple episodes
in a similar way). The third
function does not take many additional parameters since it aims to continue an experiment from exactly where
it ended.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">project</span><span class="o">.</span><span class="n">run_episode</span><span class="p">(</span>
    <span class="s1">&#39;episode_5&#39;</span><span class="p">,</span>
    <span class="n">parameters_update</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;general&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ssl&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;contrastive&#39;</span><span class="p">]},</span>
        <span class="s1">&#39;ssl&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;contrastive&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ssl_weight&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">}},</span>
    <span class="p">},</span>
<span class="p">)</span>
</code></pre>
</div>

<p>In order to find the parameters you can modify, just open the <em>config</em> folder of your project and browse through
the files or call <code>dlc2action_fill</code> in your terminal (see [creating] section). The first-level keys
are the filenames without the extension (<code>'augmentations'</code>, <code>'data'</code>, <code>'general'</code>, <code>'losses'</code>,
<code>'metrics'</code>, <code>'ssl'</code>, <code>'training'</code>). Note that there are no
<em>model.yaml</em> or <em>features.yaml</em> files there for the <code>'model'</code> and <code>'features'</code> keys in the parameter
dictionaries. Those parameters are <strong>read from the files in the <em>model</em> and <em>features</em> folders</strong> that correspond
to the options you set in the <code>'general'</code> dictionary. For example, if at <em>general.yaml</em> <code>model_name</code> is set to
<code>'ms_tcn3'</code>, the <code>'model'</code> dictionary will be read from <em>model/ms_tcn3.yaml</em>.</p>

<p>If you want to create a new episode with modified parameters that loads a previously trained model, you can do that
by adding a <code>load_episode</code> parameter. By default we will load the last saved epoch, but you can also specify
which epoch you want with <code>load_epoch</code>. In that case the closest checkpoint will be chosen.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">project</span><span class="o">.</span><span class="n">run_episode</span><span class="p">(</span>
    <span class="s1">&#39;episode_6&#39;</span><span class="p">,</span>
    <span class="n">parameters_update</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;training&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;batch_size&#39;</span><span class="p">:</span> <span class="mi">64</span><span class="p">}},</span>
    <span class="n">load_episode</span><span class="o">=</span><span class="s1">&#39;episode_2&#39;</span><span class="p">,</span>
    <span class="n">load_epoch</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>
</div>

<h3 id="optimizing">Optimizing</h3>

<p><code><a href="">dlc2action</a></code> also has tools for easy hyperparameter optimization. We use the <code>optuna</code> auto-ML package to perform
the searches and then save the best parameters and the search graphs (contour and parameter importance).
The best parameters
can then be loaded when you are run an episode or saved as the defaults in the configuration files.</p>

<p>To start a search, you need to run the <code>project.project.Project.run_hyperparameter_search</code> command. Let's
say we want to optimize for four parameters: overlap length, SSL task type, learning rate and
number of feature maps in the model. Here is the process
to figure out what we want to run.</p>

<ol>
<li><p><strong>Find the parameter names</strong></p>

<p>We look those parameters up in the config files and find them in <em>data.yaml</em>, <em>general.yaml</em>, <em>training.yaml</em>
and <em>models/ms_tcn3.yaml</em>,
respectively.
That means that our parameter names are <code>'data/overlap'</code>, <code>'general/ssl'</code>, <code>'training/lr'</code> and
<code>'model/num_f_maps'</code>.</p></li>
<li><p><strong>Define the search space</strong></p>

<p>There are five types of search spaces in <code><a href="">dlc2action</a></code>:</p>

<ul>
<li><code>int</code>: integer values (uniform sampling),</li>
<li><code>int_log</code>: integer values (logarithmic scale sampling),</li>
<li><code>float</code>: float values (uniform sampling),</li>
<li><code>float_log</code>: float values (logarithmic sampling),</li>
<li><code>categorical</code>: choice between several values.</li>
</ul>

<p>The first four are defined with their minimum and maximum value while <code>categorical</code> requires a list of
possible values. So the search spaces are described with tuples that look either like
<code>(search_space_type, min, max)</code> or like <code>("categorical", list_of_values)</code>.</p>

<p>We suspect that the optimal overlap is somewhere between 10 and 80 frames, SSL tasks should be either
only contrastive or contrastive and masked_features together, sensible learning rate is between
10<sup>-2</sup> and 10<sup>-4</sup> and the number of feature maps should be between 8 and 64.
That makes our search spaces <code>("int", 10, 80)</code> for the overlap,
<code>("categorical", [["contrastive"], ["contrastive", "masked_features"]])</code> for the SSL tasks,
<code>("float_log", 1e-4, 1e-2)</code> for the learning rate and ("int_log", 8, 64) for the feature maps.</p></li>
<li><p><strong>Choose the search parameters</strong></p>

<p>You need to decide which metric you are optimizing for and for how many trials. Note that it has to be one
of the metrics you are computing: check <code>metric_functions</code> at <em>general.yaml</em> and add your
metric if it's not there. The <code>direction</code> parameter determines whether this metric is minimized or maximized.
The metric can also be averaged over a few of the most successful epochs (<code>average</code> parameter). If you want to
use <code>optuna</code>'s pruning feature, set <code>prune</code> to <code>True</code>.</p>

<p>You can also use parameter updates and load older experiments, as in the [training] section of this tutorial.</p>

<p>Here we will maximize the recall averaged over 5 top epochs and run 50 trials with pruning.</p></li>
</ol>

<p>Now we are ready to run!</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">project</span><span class="o">.</span><span class="n">run_hyperparameter_search</span><span class="p">(</span>
    <span class="n">search_space</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;data/overlap&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span>
        <span class="s2">&quot;general/ssl&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;categorical&quot;</span><span class="p">,</span>
            <span class="p">[[</span><span class="s2">&quot;contrastive&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;contrastive&quot;</span><span class="p">,</span> <span class="s2">&quot;masked_features&quot;</span><span class="p">]]</span>
        <span class="p">),</span>
        <span class="s2">&quot;training/lr&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;float_log&quot;</span><span class="p">:</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">),</span>
        <span class="s2">&quot;model/num_f_maps&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;int_log&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;recall&quot;</span><span class="p">,</span>
    <span class="n">n_trials</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">average</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">search_name</span><span class="o">=</span><span class="s2">&quot;search_1&quot;</span><span class="p">,</span>
    <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;maximize&quot;</span><span class="p">,</span>
    <span class="n">prune</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>
</div>

<p>After a search is finished, the best parameters are saved in the meta files and search graphs are saved at
<em>project_name/results/searches/search_1</em>. You can see the best parameters by running
<code>project.project.Project.list_best_parameters</code>:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">project</span><span class="o">.</span><span class="n">list_best_parameters</span><span class="p">(</span><span class="s1">&#39;search_1&#39;</span><span class="p">)</span>
</code></pre>
</div>

<p>Those results can also be loaded in a training episode or saved in the configuration files directly.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">project</span><span class="o">.</span><span class="n">update_parameters</span><span class="p">(</span>
    <span class="n">load_search</span><span class="o">=</span><span class="s1">&#39;search_1&#39;</span><span class="p">,</span>
    <span class="n">load_parameters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;training/lr&#39;</span><span class="p">,</span> <span class="s1">&#39;model/num_f_maps&#39;</span><span class="p">],</span>
    <span class="n">round_to_binary</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;model/num_f_maps&#39;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">project</span><span class="o">.</span><span class="n">run_episode</span><span class="p">(</span>
    <span class="s1">&#39;episode_best_params&#39;</span><span class="p">,</span>
    <span class="n">load_search</span><span class="o">=</span><span class="s1">&#39;search_1&#39;</span><span class="p">,</span>
    <span class="n">load_parameters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;data/overlap&#39;</span><span class="p">,</span> <span class="s1">&#39;general/ssl&#39;</span><span class="p">],</span>
<span class="p">)</span>
</code></pre>
</div>

<p>In this example we saved the learning rate and the number of feature maps in the configuration files and
loaded the other parameters to run
the <code>episode_best_params</code> training episode. Note how we used the <code>round_to_binary</code> parameter.
It will round the number of feature maps to the closest power of two (7 to 8, 35 to 32 and so on). This is useful
for parameters like the number of features or the batch size.</p>

<h3 id="exploring-results">Exploring results</h3>

<p>After you run a bunch of experiments you will likely want to get an overview.</p>

<h4 id="visualization">Visualization</h4>

<p>You can get a feeling for the predictions made by a model by running <code>project.project.Project.visualize_results</code>.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">project</span><span class="o">.</span><span class="n">visualize_results</span><span class="p">(</span><span class="s1">&#39;episode_1&#39;</span><span class="p">,</span> <span class="n">load_epoch</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</code></pre>
</div>

<p>This command will generate a prediction for a random sample and visualize it compared to the ground truth.
There is a lot of parameters you can customize, check them out in the documentation).</p>

<p>Another available visualization type is training curve comparison with <code>project.project.Project.plot_episodes</code>.
You can compare different metrics and modes across several episode or within one. For example, this command
will plot the validation accuracy curves for the two episodes.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">project</span><span class="o">.</span><span class="n">plot_episodes</span><span class="p">([</span><span class="s1">&#39;episode_1&#39;</span><span class="p">,</span> <span class="s1">&#39;episode_2&#39;</span><span class="p">],</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>
</code></pre>
</div>

<p>And this will plot training and validation recall curves for <code>episode_3</code>.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">project</span><span class="o">.</span><span class="n">plot_episodes</span><span class="p">([</span><span class="s1">&#39;episode_3&#39;</span><span class="p">],</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;recall&#39;</span><span class="p">],</span> <span class="n">modes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">])</span>
</code></pre>
</div>

<p>You can also plot several episodes as one curve. That can be useful, for example, with episodes 2 and 6
in our tutorial, since <code>episode_6</code> loaded the model from <code>episode_2</code>.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">project</span><span class="o">.</span><span class="n">plot_episodes</span><span class="p">([[</span><span class="s1">&#39;episode_2&#39;</span><span class="p">,</span> <span class="s1">&#39;episode_6&#39;</span><span class="p">],</span> <span class="s1">&#39;episode_4&#39;</span><span class="p">],</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">])</span>
</code></pre>
</div>

<h4 id="tables">Tables</h4>

<p>Alternatively, you can start analyzing your experiments by putting them in a table. You can get a summary of
your training episodes with <code>project.project.Project.list_episodes</code>. It provides you with three ways to filter
the data.</p>

<ol>
<li><p><strong>Episode names</strong></p>

<p>You can directly say which episodes you want to look at and disregard all others. Let's say we want to see
episodes 1, 2, 3 and 4.</p></li>
<li><p><strong>Parameters</strong></p>

<p>In a similar fashion, you can choose to only display certain parameters. See all available parameters by
running <code>project.list_episodes().columns</code>. Here we are only interested in the time of adding the record,
the recall results and the learning rate.</p></li>
<li><p><strong>Value filter</strong></p>

<p>The last option is to filter by parameter values. Filters are defined by strings that look like this:
<code>'{parameter_name}::{sign}{value}'</code>. You can use as many filters as ypu want and separate them with a comma.
The parameter names are the same as in point 2, the sign can be either
<code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code> or <code>=</code> and you choose the value. Let's say we want to only get the episodes that took
at least 30 minutes to train and got to a recall that is higher than 0.4. That translates to
<code>'results/recall::&gt;0.4,meta/training_time::&gt;=00:30:00'</code>.</p></li>
</ol>

<p>Putting it all together, we get this command.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">project</span><span class="o">.</span><span class="n">list_episodes</span><span class="p">(</span>
    <span class="n">episodes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;episode_1&#39;</span><span class="p">,</span> <span class="s1">&#39;episode_2&#39;</span><span class="p">,</span> <span class="s1">&#39;episode_3&#39;</span><span class="p">,</span> <span class="s1">&#39;episode_4&#39;</span><span class="p">],</span>
    <span class="n">display_parameters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;meta/time&#39;</span><span class="p">,</span> <span class="s1">&#39;results/recall&#39;</span><span class="p">,</span> <span class="s1">&#39;training/lr&#39;</span><span class="p">],</span>
    <span class="n">episode_filter</span><span class="o">=</span><span class="s1">&#39;results/recall::&gt;0.4,meta/training_time::&gt;=00:30:00&#39;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>
</div>

<p>There are similar functions for summarizing other history files: <code>project.project.Project.list_searches</code>,
<code>project.project.Project.list_predictions</code>, <code>project.project.Project.list_suggestions</code> and they all follow the
same pattern.</p>

<h3 id="making-predictions">Making predictions</h3>

<p>When you feel good about one of the models, you can move on to making predictions. There are two ways to do that:
generate pickled prediction dictionaries with <code>project.project.Project.run_prediction</code> or active learning
and suggestion files for the [GUI] with <code>project.project.Project.run_suggestion</code>.</p>

<p>By default the predictions will be made for the entire dataset at the data path of the project. However, you
can also choose to only make them for the training, validation or test subset (set with <code>mode</code> parameter) or
even for entirely new data (set with <code>data_path</code> parameter). Note that if you set the <code>data_path</code>
value, <strong>the split
parameters will be disregarded</strong> and <code>mode</code> will be forced to <code>'all'</code>!</p>

<p>Here is an example of running these functions.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">project</span><span class="o">.</span><span class="n">run_prediction</span><span class="p">(</span><span class="s1">&#39;prediction_1&#39;</span><span class="p">,</span> <span class="n">episode_name</span><span class="o">=</span><span class="s1">&#39;episode_3&#39;</span><span class="p">,</span> <span class="n">load_epoch</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">project</span><span class="o">.</span><span class="n">run_suggestion</span><span class="p">(</span>
    <span class="s1">&#39;suggestion_new_data&#39;</span><span class="p">,</span>
    <span class="n">suggestion_episode</span><span class="o">=</span><span class="s1">&#39;episode_4&#39;</span><span class="p">,</span>
    <span class="n">suggestion_classes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sleeping&#39;</span><span class="p">,</span> <span class="s1">&#39;eating&#39;</span><span class="p">],</span>
    <span class="n">suggestion_threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">exclude_classes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;inactive&#39;</span><span class="p">],</span>
    <span class="n">data_path</span><span class="o">=</span><span class="s1">&#39;/path/to/new_data_folder&#39;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>
</div>

<p>The first command will generate a prediction dictionary with the model from epoch 150 of <code>episode_3</code> for the test
subset of the project data (split according to the configuration files) and save it at
<em>project_name/results/predictions/prediction_1.pickle</em>. The second command will create suggestion and active
learning files for data at <em>/path/to/new_data_folder</em> and save them at
<em>project_name/results/suggestions/suggestion_new_data</em>. There is a lot of parameters you can tune here to
get exactly what you need, so we really recommend reading the documentation of the
<code>project.project.Project.run_suggestion</code> function before using it.</p>

<p>The history of prediction and suggestion runs is recorded and at the [exploring] section
we have described how to access it.</p>

<h1 id="contribution">Contribution</h1>

<p>Here you can learn how to add new elements to <code><a href="">dlc2action</a></code>.</p>

<h2 id="models">Models</h2>

<p>Models in <code><a href="">dlc2action</a></code> are formalized as <code>model.base_model.Model</code> instances. This class inherits from
<code>torch.nn.Module</code> but adds a more formalized structure and defines interaction with SSL modules.
Note that <strong>SSL modules and base models are added separately</strong> to allow for 'mixing and matching', so make sure
the model you want to add only predicts the target value.</p>

<p>The process to add a new model would be as follows.</p>

<ol>
<li><p><strong>Separate your model into feature extraction and prediction</strong></p>

<p>If we want to add an SSL module to your module, where should it go? Everything up to that point is
your feature extractor and everything after is the prediction generator.</p></li>
<li><p><strong>Write the modules</strong></p>

<p>Create a <em>{model_name}_modules.py</em> file at the <em>dlc2action/models</em> folder and write all necessary modules there.</p></li>
<li><p><strong>Formalize input and output</strong></p>

<p>Make sure that your feature extraction and prediction generation modules accept a single input and return
a single output.</p></li>
<li><p><strong>Write the model</strong></p>

<p>Create a <em>{model_name}.py</em> file at the <em>dlc2action/models</em> folder and write the code for the
<code>model.base_model.Model</code> child class. The <code>model.base_model.Model._feature_extractor</code> and
<code>model.base_model.Model._predictor</code> functions need to return your feature extraction and prediction
generation modules, respectively. See the <code>model.ms_tcn</code> code for reference.</p></li>
<li><p><strong>Add options</strong></p>

<p>Add your model to the <code>models</code> dictionary at <code><a href="dlc2action/options.html">dlc2action.options</a></code>. Add
<code>{'{model_name}.{class_name}.dump_patches': False, '{model_name}.{class_name}.training': False}</code> to the
<code>__pdoc__</code> dictionary at <code>dlc2action.model.__init__</code>.</p></li>
<li><p><strong>Add config parameters</strong></p>

<p>Read the [config] explanation and add your parameters.</p></li>
</ol>

<h2 id="ssl">SSL</h2>

<p>SSL tasks are formalized as <code>ssl.base_ssl.SSLConstructor</code> instances. Read the documentation at <code>ssl</code> to
learn more about this and follow the process.</p>

<ol>
<li><p><strong>Create a new file</strong></p>

<p>Create a new file for your constructor at <em>dlc2action/ssl</em> and start defining a <code>ssl.base_ssl.SSLConstructor</code>
child class.</p></li>
<li><p><strong>Determine the type of your task</strong></p>

<p>You can find the descriptions of available SSL types at <code>ssl.base_ssl.SSLConstructor</code>. If what you want to do
does not fit any of those types, you can add a new one. In that case you will have to modify the
<code>model.base_model</code>
code. More specifically, add the new name to the <code>available_ssl_types</code> variable and define the interaction
at <code>model.base_model.Model.forward</code>. Set the <code>type</code> class variable to the type you decided on.</p></li>
<li><p><strong>Define the data transformation</strong></p>

<p>You need to write a function that will take a <em>feature dictionary</em> (see <code>feature_extraction</code>) as input
and return SSL input and SSL target as output. Read more about that at <code>ssl</code>. The <code>transformation</code> method
of your class should perform that function.</p></li>
<li><p><strong>Define the network module</strong></p>

<p>Take a look at <code>ssl.modules</code> and choose one of the existing modules or add your own. Remember that its
 <code>forward</code> method has
to receive the output of a base model's feature extraction module (see the [model] tutorial for more details)
as input and return a value that will go into the SSL loss function as output. Your class's <code>construct_module</code>
method needs to return an instance of this module.</p></li>
<li><p><strong>Define the loss function</strong></p>

<p>Choose your loss at <code><a href="dlc2action/loss.html">dlc2action.loss</a></code> or add a new one.
If you do decide to add a new loss, see the [loss] tutorial.
Set the <code>loss</code> method of your class to apply this loss.</p></li>
<li><p><strong>Add options</strong></p>

<p>Add your model to the <code>ssl_constructors</code> dictionary at <code><a href="dlc2action/options.html">dlc2action.options</a></code> and set a default loss weight
in the <code>ssl_weights</code> dictionary at <em>training.yaml</em>.</p></li>
<li><p><strong>Add config parameters</strong></p>

<p>Read the [config] explanation and add your parameters.</p></li>
</ol>

<h2 id="datasets">Datasets</h2>

<p>Datasets in <code><a href="">dlc2action</a></code> are defined through <code>data.base_store.InputStore</code> and <code>data.base_store.BehaviorStore</code>
classes. Before you start, please read the documentation at <code>data</code> to learn more about the assumptions we make
and the different classes involved in data processing. Then, follow these instructions.</p>

<ol>
<li><p><strong>Figure out what you need to add</strong></p>

<p>What are the data and annotation types of your dataset? Can you find either of them at <code>options.input_stores</code>
and <code>options.annotation_stores</code>? If so, you are in luck. If not, move on to have a look at <code>data.annotation_store</code>
and <code>data.input_store</code>. It's likely that the classes we already have already do most of what you need.
For annotation, in most cases it should be enough to inherit from <code>data.annotation_store.ActionSegmentationStore</code>
and only change the <code>data.annotation_store.ActionSegmentationStore._open_annotations</code> function. With input stores
it can be more complicated, but should definitely use implementations at <code>data.input_store</code> as an example.</p></li>
<li><p><strong>Write the class</strong></p>

<p>Create a new class at either <code>data.input_store</code> or <code>data.annotation_store</code>, inherit from whatever is the closest
to what you need and implement all abstract functions.</p></li>
<li><p><strong>Add options</strong></p>

<p>Add your store to <code>options.annotation_stores</code> or <code>options.input_stores</code>.</p></li>
<li><p><strong>Add config parameters</strong></p>

<p>Read the [config] explanation and add your parameters.</p></li>
</ol>

<h2 id="losses">Losses</h2>

<p>Adding a new loss is fairly straightforward since <code><a href="">dlc2action</a></code> uses <code>torch.nn.Module</code> instances as losses.</p>

<ol>
<li><p><strong>Write the class</strong></p>

<p>Add a new loss class inheriting from <code>torch.nn.Module</code> at <code><a href="dlc2action/loss.html">dlc2action.loss</a></code>. Add it to one of the existing
submodules or create a new one if it isn't a good fit for anything. Generally, the <code>forward</code> method of your
loss should take prediction and target tensors as input, in that order, and return a float value.</p></li>
<li><p><strong>Add options</strong></p>

<p>If you want your new loss to be an option for the main loss function in training, you should add
it to the <code><a href="dlc2action/options.html#losses">dlc2action.options.losses</a></code> dictionary. Note that in that case it has to have the input and output
formats described above. If your loss expects input from a multi-stage model, like MS-TCN, add its name to
<code><a href="dlc2action/options.html#losses_multistage">dlc2action.options.losses_multistage</a></code> as well.</p></li>
<li><p><strong>Add config parameters</strong></p>

<p>Read the [config] explanation and add your parameters.</p></li>
</ol>

<h2 id="metrics">Metrics</h2>

<p>All metrics in <code><a href="">dlc2action</a></code> inherit from <code>metric.base_metric.Metric</code>. They store internal parameters that get updated
with each batch and are then used to compute the metric value. You need to write the functions for resetting the
parameters, updating them and calculating the value.</p>

<ol>
<li><p><strong>Write the class</strong></p>

<p>Add a new class at <code>metric.metrics</code>, inheriting from <code>metric.base_metric.Metric</code> and write the three
abstract methods (read the documentation for details).</p></li>
<li><p><strong>Add options</strong></p>

<p>Add your new metric to the <code><a href="dlc2action/options.html#metrics">dlc2action.options.metrics</a></code> dictionary. Next, if it is supposed to decrease with
increasing prediction quality, add its name to the <code><a href="dlc2action/options.html#metrics_minimize">dlc2action.options.metrics_minimize</a></code> list and if it does not
say anything about how good the predictions are, add it to <code><a href="dlc2action/options.html#metrics_no_direction">dlc2action.options.metrics_no_direction</a></code>.
If it increases when predictions get better, you don't need to do anything else.</p></li>
<li><p><strong>Add config parameters</strong></p>

<p>If you added your loss to the options at the previous step, you also need to add it to the config files.
Read the [config] explanation and do that.</p></li>
</ol>

<h2 id="feature-extractors">Feature extractors</h2>

<p>Feature extractors in <code><a href="">dlc2action</a></code> are defined fairly loosely. You need to make a new class that inherits from
one of <code>feature_extraction.FeatureExtractor</code> subclasses (i.e. <code>feature_extraction.PoseFeatureExtractor</code>). Each
of those subclasses are defined for a subclass of <code>data.base_store.InputStore</code> for a specific broad type of
data (i.e. <code>data.base_store.PoseInputStore</code> for pose estimation data).</p>

<p>When extracting the features, <code>data.base_store.InputStore</code> instances will pass a data dictionary to the feature
extractor and they will also contain the methods to extract information from that dictionary. You only
need to use that information (coordinates, list of body parts, number of frames and so on) to compute
some new features (distances, speeds, accelerations). Read the <code>feature_Extraction</code> documentation to find out more
about that. When you're done with reading you can start with those instructions.</p>

<ol>
<li><p><strong>Write the class</strong></p>

<p>Create a new class at <code>feature_extraction</code> that inherits from a <code>feature_extraction.FeatureExtractor</code> subclass.
Look at the methods available for information extraction and write the <code>extract_features</code>
function that will transform
that information into some new features.</p></li>
<li><p><strong>Add a transformer</strong></p>

<p>Since you've added some new features, <code><a href="">dlc2action</a></code> does not know how to handle them when adding augmentations.
You need to either create a new <code>transformer.base_transformer.Transformer</code> or modify an existing one to fix
that. Read the [augmentations]
tutorial to find out how.</p></li>
<li><p><strong>Add options</strong></p>

<p>Add your feature extractor to <code><a href="dlc2action/options.html#feature_extractors">dlc2action.options.feature_extractors</a></code> and set the corresponding transformer
at <code><a href="dlc2action/options.html#extractor_to_transformer">dlc2action.options.extractor_to_transformer</a></code>.</p></li>
<li><p><strong>Add config parameters</strong></p>

<p>Read the [config] explanation and add your parameters.</p></li>
</ol>

<h2 id="augmentations">Augmentations</h2>

<p>Augmentations in <code><a href="">dlc2action</a></code> are carried out by <code>transformer.base_transformer.Transformer</code> instances.
Since they need to know how to handle different features, each transformer handles the output of specific
<code>feature_extraction.FeatureExtractor</code> subclasses (only one transformer corresponds to each feature extractor,
but each transformer can
work with multiple feature extractors). Hence the instructions.</p>

<ol>
<li><p><strong>Figure out whether you need a new transformer</strong></p>

<p>If the feature extractor you are interested in already has a corresponding transformer, you only need to
add a new method to that transformer. You can find which transformer you need at
<code><a href="dlc2action/options.html#extractor_to_transformer">dlc2action.options.extractor_to_transformer</a></code>. If the feature extractor is new, it might still be enough to
modify an existing transformer. Take a look at <code>transformer</code> and see if any of the existing classes are close
enough to what you need. If they are not, you will have to create a new class.</p></li>
<li><p><strong>Add a new class</strong> <em>(skip this step if you are not creating a new transformer)</em></p>

<p>If you did decide to create a new class, create a new <em>{transformer_name}.py</em> file at <code><a href="dlc2action/transformer.html">dlc2action.transformer</a></code>
and write it there, inheriting from <code>transformer.base_transformer.Transformer</code>.</p></li>
<li><p><strong>Add augmentation functions</strong></p>

<p>Add new methods to your transformer class. Each method has to perform one augmentation, take
<code>(main_input: dict, ssl_inputs: list, ssl_targets: list)</code>
as input and return an output of the same format. Here <code>main_input</code> is a feature dictionary of the sample
data, <code>ssl_inputs</code> is a list of SSL input feature dictionaries and <code>ssl_targets</code> is a list of SSL target
feature dictionaries. The same augmentations are applied to all inputs if they are not <code>None</code> and
have feature keys that
are recognized by your transformer.</p>

<p>When you are done writing the methods, add them with their names to the dictionary returned by
<code>transformer.base_transformer.augmentations_dict</code>. If you think that your augmentation suits a very wide
range of datasets, add its name to the list returned by <code>transformer.base_transformer.default_augmentations</code>
as well.</p></li>
<li><p><strong>Add options</strong> <em>(skip this step if you are not creating a new transformer)</em></p>

<p>Add your new transformer to <code><a href="dlc2action/options.html#transformers">dlc2action.options.transformers</a></code>.</p></li>
<li><p><strong>Add config parameters</strong></p>

<p>Read the [config] explanation and add your parameters.</p></li>
</ol>

<h2 id="config-files">Config files</h2>

<p>It is important to modify the config files when you add something new to <code><a href="">dlc2action</a></code> since it is supposed to
mainly be used through the <code>project</code> interface that relies on the files being up-to-date.</p>

<p>To add configuration parameters for a new model, feature extractor,
input or annotation store, create a new file in the <em>model</em>, <em>features</em>,
<em>data</em> or <em>annotation</em> subfolder of <em>dlc2action/config</em>, respectively. If you are adding a new loss,
metric or SSL constructor, add a new dictionary to the corresponding file
at the same folder. <strong>Make sure to use the same name as what you've added to the options file.</strong> Then just
list all necessary parameters (use the same names as in the class signature), their default values
and an explanation in the commentary.</p>

<p>The commentary for every parameter has to start with its supposed type. Use one of <code>'bool'</code>, <code>'int'</code>, <code>'float'</code>,
<code>'str'</code>, <code>'list'</code> or <code>'set'</code> or define a set of possible values with square brackets (e.g. <code>['pose', 'image']</code>).
The type has to be followed with a semicolon and a short explanation. Please try to keep the explanations one line
long. Here is an example:</p>

<pre><code>frame_limit: 15 # int; tracklets shorter than this number of frames will be discarded
</code></pre>

<p>Note that if a parameter that you need is already defined at <em>dlc2action/config/general.yaml</em>, <strong>it will be pulled
automatically</strong>, there is no need to add it to your new list of parameters. Just make sure that the name of the
parameter in your class signature and at <em>general.yaml</em> is the same.</p>

<p>In addition, there are also several <em>blanks</em> you can use to set the default parameters. Those <em>blanks</em>
are filled at runtime after the dataset is created. Read more about them at the <code>project</code> documentation.</p>

<p>When you are finished with defining the parameters, you should also describe them in the documentation (perhaps in
more detail) at the [options] section.</p>

<h1 id="options">Options</h1>

<p>Here you can find an overview of the parameters currently available in the settings.</p>

<h2 id="data-types">Data types</h2>

<ul>
<li><code>'dlc_tracklet'</code>: DLC tracklet data,</li>
<li><code>'dlc_track'</code>: DLC track data,</li>
</ul>

<h2 id="annotation-types">Annotation types</h2>

<ul>
<li><code>'dlc'</code>: the classic_annotation GUI format,</li>
<li><code>'boris'</code>: BORIS format,</li>
</ul>

<h2 id="data">Data</h2>

<h3 id="annotation">Annotation</h3>

<h4 id="boris-and-dlc">BORIS and DLC</h4>

<ul>
<li><code>behaviors: set</code> <br />
the set of string names of the behaviors to predict</li>
<li><code>annotation_suffix: set</code> <br />
the set of string suffixes such that annotation file names have the format of
<em>{video_id}{annotation_suffix}</em></li>
<li><code>correction: dict</code> <br />
a dictionary of label corrections where keys are the names to be replaced and values are the replacements
(e. g. <code>{'sleping': 'sleeping', 'calm locomotion': 'locomotion'}</code>)</li>
<li><code>error_class: str</code> <br />
a class denoting errors in pose estimation (the intervals annotated with this class will be ignored)</li>
<li><code>min_frames_action: int</code> <br />
the minimum number of frames for an action (shorter actions will be discarded during training)</li>
<li><code>filter_annotated: bool</code> <br />
if true, <code><a href="">dlc2action</a></code> will discard long unannotated intervals during training</li>
<li><code>filter_background: bool</code> <br />
if true, only label frames as background if a behavior is annotated somewhere close (in the same segment)</li>
<li><code>filter_visibility: bool</code> <br />
if true, only label behaviors if there is suffucient visibility (a fraction of frames in a segment larger than
<code>visibility_min_frac</code> has visibility score larger than <code>visibility_min_score</code>; the visibility score is defined by
<code>data.base_store.InputStore</code> instances and should generally be from 0 to 1</li>
<li><code>visibility_min_score: float</code> <br />
the minimum visibility score for visibility filtering (generally from 0 to 1)</li>
<li><code>visibility_min_frac: float</code> <br />
the minimum fraction of visible frames for visibility filtering</li>
</ul>

<h4 id="calms21">CalMS21</h4>

<p>No parameters</p>

<h3 id="input">Input</h3>

<h4 id="dlc-track-and-tracklet">DLC track and tracklet</h4>

<ul>
<li><code>data_suffix: set</code> <br />
the set of suffices such that the data files have the format of <em>{video_id}{data_suffix}</em></li>
<li><code>data_prefix: set</code> <br />
a set of prefixes used in file names for different views such that the data files have the format
of <em>{data_prefix}{video_id}{data_suffix}</em></li>
<li><code>feature_suffix: str</code> <br />
the string suffix such that the precomputed feature files are named <em>{video_id}{feature_suffix}</em>;
the files should be either stored at <code>data_path</code> or included in <code>file_paths</code></li>
<li><code>contert_int_indices: bool</code> <br />
if true, convert any integer key i in feature files to 'ind{i}'</li>
<li><code>canvas_shape: list</code> <br />
the size of the canvas where the pose was defined</li>
<li><code>len_segment: int</code> <br />
the length of segments (in frames) to cut the videos into</li>
<li><code>overlap: int</code> <br />
the overlap (in frames) between neighboring segments</li>
<li><code>ignored_bodyparts: set</code> <br />
the set of string names of bodyparts to ignore</li>
<li><code>default_agent_name: str</code> <br />
the default agent name used in pose file generation</li>
<li><code>frame_limit: int</code> (only for tracklets) <br />
tracklets shorter than this number of frames will be discarded</li>
</ul>

<h4 id="calms21-2">CalMS21</h4>

<ul>
<li><code>len_segment: int</code> <br />
the length of segments (in frames) to cut the videos into</li>
<li><code>overlap: int</code> <br />
the overlap (in frames) between neighboring segments</li>
<li><code>load_unlabeled: bool</code> <br />
if true, unlabeled data will be loaded</li>
<li><code>file_prefix: str</code> <br />
the prefix such that the data files are named {prefix}train.npy and {prefix}test.npy</li>
</ul>

<h3 id="features">Features</h3>

<h4 id="kinematic">Kinematic</h4>

<ul>
<li><code>interactive: bool</code> <br />
if true, features are computed for pairs of clips (agents)</li>
<li><code>keys: set</code> <br />
the keys to include
(a subset of <code>{"coords", "intra_distance", "speed_joints", "angle_joints_radian", "acc_joints", "inter_distance"}</code>
where
<ul>
<li><code>'coords'</code> is the raw coordinates,</li>
<li><code>'intra_distance'</code> is the distances between all pairs of keypoints,</li>
<li><code>'speed_joints'</code> is the approximated vector speeds of all keypoints,</li>
<li><code>'angle_joints_radian'</code> is the approximated angular speeds of all keypoints,</li>
<li><code>'acc_joints'</code> is the approximated accelerations of all keypoints,</li>
<li><code>'inter_distance'</code> is the distance between all pairs of keypoints where the points belong to different agents
(used if <code>interactive</code> is true))</li>
</ul></li>
</ul>

<h2 id="augmentations-2">Augmentations</h2>

<h3 id="kinematic-2">Kinematic</h3>

<ul>
<li><code>augmentations: set</code> <br />
a list of augmentations (a subset of <code>{'rotate', 'mask', 'add_noise', 'shift', 'zoom', 'mirror'}</code>)</li>
<li><code>use_default_augmentations: bool</code> <br />
if true, the default augmentation list will be used (<code>['mirror', 'shift', 'add_noise']</code>)</li>
<li><code>rotation_limits: list</code> <br />
list of float rotation angle limits ([low, high]; default [-pi/2, pi/2])</li>
<li><code>mirror_dim: set</code> <br />
set of integer dimension indices that can be mirrored</li>
<li><code>noise_std: float</code> <br />
standard deviation of added noise</li>
<li><code>zoom_limits: list</code> <br />
list of float zoom limits ([low, high]; default [0.5, 1.5])</li>
<li><code>masking_probability: float</code> <br />
the probability of masking a joint</li>
</ul>

<h2 id="model">Model</h2>

<h3 id="ms-tcn3">MS-TCN3</h3>

<ul>
<li>num_layers_PG: int` <br />
number of layers in prediction generation stage</li>
<li>num_layers_R: int` <br />
number of layers in refinement stages</li>
<li><code>num_R: int</code> <br />
number of refinement stages</li>
<li><code>num_f_maps: int</code> <br />
number of feature maps</li>
<li><code>dims: int</code> <br />
number of input features (set to 'dataset_features' to get the number from
<code>dlc2action.data.dataset.BehaviorDataset.dataset_features()</code>)</li>
<li><code>dropout_rate: float</code> <br />
dropout rate</li>
<li><code>skip_connections_refinement: bool</code> <br />
if true, skip connections are added to the refinement stages</li>
<li><code>block_size_prediction: int</code> <br />
if not null, skip connections are added to the prediction generation stage with this interval</li>
<li><code>direction_R: str</code> <br />
causality of refinement stages; choose from:
<ul>
<li><code>None</code>: no causality,</li>
<li><code>bidirectional</code>: a combination of forward and backward networks,</li>
<li><code>forward</code>: causal,</li>
<li><code>backward</code>: anticausal</li>
</ul></li>
<li><code>direction_PG: str</code> <br />
causality of refinement stages (see <code>direction_R</code>)</li>
<li><code>shared_weights: bool</code> <br />
if `True``, weights are shared across refinement stages</li>
<li><code>block_size_refinement: int</code> <br />
if not 0, skip connections are added to the refinement stage with this interval</li>
<li><code>PG_in_FE: bool</code> <br />
if <code>True</code>, the prediction generation stage is included in the feature extractor</li>
<li><code>rare_dilations: bool</code> <br />
if <code>True</code>, dilation increases with layer less often</li>
<li><code>num_heads: int</code> <br />
the number of parallel refinement stages</li>
</ul>

<h2 id="general">General</h2>

<ul>
<li><code>model_name: str</code> <br />
model name; choose from:
<ul>
<li><code>'ms_tcn3'</code>: the original MS-TCN++ model with options to share weights across refinement stages or
add skip connections.</li>
</ul></li>
<li><code>num_classes: int</code> <br />
number of classes (set to 'dataset_num_classes' to get the number from
<code><a href="dlc2action/data/dataset.html#BehaviorDataset.num_classes">dlc2action.data.dataset.BehaviorDataset.num_classes()</a></code>)</li>
<li><code>exclusive: bool</code> <br />
if true, single-label classification is used; otherwise multi-label</li>
<li><code>ssl: set</code> <br />
a set of SSL types to use; choose from:
<ul>
<li><code>'contrastive'</code>: contrastive SSL with NT-Xent loss,</li>
<li><code>'pairwise'</code>: pairwise comparison SSL with triplet or circle loss,</li>
<li><code>'masked_features'</code>: prediction of randomly masked features with MSE loss,</li>
<li><code>'masked_frames'</code>: prediction of randomly masked frames with MSE loss,</li>
<li><code>'masked_joints'</code>: prediction of randomly masked joints with MSE loss,</li>
<li><code>'masked_features_tcn'</code>: prediction of randomly masked features with MSE loss and a TCN module,</li>
<li><code>'masked_frames_tcn'</code>: prediction of randomly masked frames with MSE loss and a TCN module,</li>
<li><code>'masked_joints_tcn'</code>: prediction of randomly masked joints with MSE loss and a TCN module</li>
</ul></li>
<li><code>metric_functions: set</code> <br />
set of metric names; choose from:
<ul>
<li><code>'recall'</code>: frame-wise recall,</li>
<li><code>'segmental_recall'</code>: segmental recall,</li>
<li><code>'precision'</code>: frame-wise precision,</li>
<li><code>'segmental_precision'</code>: segmental precision,</li>
<li><code>'f1'</code>: frame-wise F1 score,</li>
<li><code>'segmental_f1'</code>: segmental F1 score,</li>
<li><code>'edit_distance'</code>: edit distance (as a fraction of length of segment),</li>
<li><code>'count'</code>: the fraction of predictions labeled with a specific behavior</li>
</ul></li>
<li><code>loss_function: str</code> <br />
name of loss function; choose from:
<ul>
<li><code>'ms_tcn'</code>: a loss designed for the MS-TCN network; cross-entropy + MSE for consistency</li>
</ul></li>
<li><code>feature_extraction: str</code> <br />
the feature extraction method; choose from:
<ul>
<li><code>'kinematic'</code>: extracts distances, speeds and accelerations for pose estimation data</li>
</ul></li>
<li><code>only_load_annotated: bool</code> <br />
if true, the input files that don't have a matching annotation file will be disregarded</li>
<li><code>ignored_clips: set</code> <br />
a set of string clip ids (agent names) to be ignored</li>
</ul>

<h2 id="losses-2">Losses</h2>

<h3 id="ms_tcn">MS_TCN</h3>

<ul>
<li><code>weights: list</code> <br />
list of weights for weighted cross-entropy</li>
<li><code>focal: bool</code> <br />
if True, focal loss will be used</li>
<li><code>gamma: float</code> <br />
the gamma parameter of focal loss</li>
<li><code>alpha: float</code> <br />
the weight of consistency loss</li>
</ul>

<h2 id="metrics-2">Metrics</h2>

<h3 id="recall-precision-and-f1-score-segmental-and-not">Recall, precision and F1 score (segmental and not)</h3>

<ul>
<li><code>main_class: int</code> <br />
if not null, recall will only be calculated for main_class</li>
<li><code>average: str</code> <br />
averaging method; choose from <code>'macro'</code>, <code>'micro'</code> or <code>'none'</code></li>
<li><code>ignored_classes: set</code> <br />
a set of class ids to ignore in calculation</li>
<li><code>iou_threshold: float</code> (only for segmental metrics) <br />
intervals with IoU larger than this threshold are considered correct</li>
</ul>

<h3 id="count">Count</h3>

<ul>
<li><code>classes: set</code> <br />
a set of the class indices to count the occurrences of</li>
</ul>

<h2 id="ssl-2">SSL</h2>

<h3 id="contrastive">Contrastive</h3>

<ul>
<li><code>ssl_features: int</code> <br />
length of clip feature vectors</li>
<li><code>tau: float</code> <br />
tau (NT-Xent loss parameter)</li>
<li><code>len_segment: int</code> <br />
length of the segments that enter the SSL module</li>
<li><code>num_f_maps: list</code> <br />
shape of the segments that enter the SSL module</li>
</ul>

<h3 id="pairwise">Pairwise</h3>

<ul>
<li><code>ssl_features: int</code> <br />
length of clip feature vectors</li>
<li><code>margin: float</code> <br />
margin (triplet loss parameter)</li>
<li><code>distance: str</code> <br />
either 'cosine' or 'euclidean'</li>
<li><code>loss: str</code> <br />
either 'triplet' or 'circle'</li>
<li><code>gamma: float</code> <br />
gamma (triplet and circle loss parameter)</li>
<li><code>len_segment: int</code> <br />
length of the segments that enter the SSL module</li>
<li><code>num_f_maps: list</code> <br />
shape of the segments that enter the SSL module</li>
</ul>

<h3 id="masked-joints-features-and-frames">Masked joints, features and frames</h3>

<ul>
<li><code>frac_masked: float</code> <br />
fraction of features to be masked</li>
<li><code>num_ssl_layers: int</code> <br />
number of layers in the SSL module</li>
<li><code>num_ssl_f_maps: int</code> <br />
number of feature maps in the SSL module</li>
<li><code>dims: int</code> <br />
number of features per frame in original input data</li>
<li><code>num_f_maps: list</code> <br />
shape of the segments that enter the SSL module</li>
</ul>

<h3 id="contrastive-masked">Contrastive masked</h3>

<ul>
<li><code>ssl_features: int</code> <br />
length of clip feature vectors</li>
<li><code>tau: float</code> <br />
tau (NT-Xent loss parameter)</li>
<li><code>len_segment: int</code> <br />
length of the segments that enter the SSL module</li>
<li><code>num_f_maps: list</code> <br />
shape of the segments that enter the SSL module</li>
<li><code>num_masked: int</code> <br />
number of frames to mask</li>
</ul>

<h2 id="training-2">Training</h2>

<ul>
<li><code>lr: float</code> <br />
learning rate</li>
<li><code>device: str</code> <br />
device name (recognized by <code>torch</code>)</li>
<li><code>verbose: bool</code> <br />
print training process</li>
<li><code>augment_train: int</code> <br />
either 1 to use augmentations during training or 0 to not use</li>
<li><code>augment_val: int</code> <br />
number of augmentations to average over at validation</li>
<li><code>ssl_weights: dict</code> <br />
dictionary of SSL loss function weights (keys are SSL names, values are weights)</li>
<li><code>num_epochs: int</code> <br />
number of epochs</li>
<li><code>to_ram: bool</code> <br />
transfer the dataset to RAM for training (preferred if the dataset fits in working memory)</li>
<li><code>batch_size: int</code> <br />
batch size</li>
<li><code>freeze_features: bool</code> <br />
freeze the feature extractor parameters</li>
<li><code>ignore_tags: bool</code> <br />
ignore meta tags (meta tags are generated by some datasets and used by some models and can contain
information such as annotator id); when <code>True</code>, all meta tags are set to <code>None</code></li>
<li><code>model_save_epochs: int</code> <br />
interval for saving training checkpoints (the last epoch is always saved)</li>
<li><code>use_test: float</code> <br />
the fraction of the test dataset to use in training without labels (for SSL tasks)</li>
<li><code>partition_method: str</code>  <br />
the train/test/val partitioning method; choose from:
<ul>
<li><code>'random'</code>: sort videos into subsets randomly,</li>
<li><code>'random:test-from-name'</code> (or <code>'random:test-from-name:{name}'</code>): sort videos into training and validation
subsets randomly and create
the test subset from the video ids that start with a speific substring (<code>'test'</code> by default, or <code>name</code>
if provided),</li>
<li><code>'random:equalize:segments'</code> and <code>'random:equalize:videos'</code>: sort videos into subsets randomly but
making sure that for the rarest classes at least <code>0.8 * val_frac</code> of the videos/segments that contain
occurrences of the class get into the validation subset and <code>0.8 * test_frac</code> get into the test subset;
this in ensured for all classes in order of increasing number of occurrences until the validation and
test subsets are full</li>
<li><code>'val-from-name:{val_name}:test-from-name:{test_name}'</code>: create the validation and test
subsets from the video ids that start with specific substrings (<code>val_name</code> for validation
and <code>test_name</code> for test) and sort all other videos into the training subset</li>
<li><code>'folders'</code>: read videos from folders named <em>test</em>, <em>train</em> and <em>val</em> into corresponding subsets,</li>
<li><code>'time'</code>: split each video into training, validation and test subsequences,</li>
<li><code>'time:strict'</code>: split each video into validation, test and training subsequences
and throw out the last segment in validation and test (to get rid of overlaps),</li>
<li><code>'file'</code>: split according to a split file.</li>
</ul></li>
<li><code>val_frac: float</code> <br />
fraction of dataset to use as validation</li>
<li><code>test_frac: float</code> <br />
fraction of dataset to use as test</li>
<li><code>split_path: str</code> <br />
path to the split file (<strong>only used when partition_method is <code>'file'</code>,
otherwise disregarded and filled automatically</strong>)</li>
</ul>
</div>

                        <input id="mod-dlc2action-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-dlc2action-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="c1">#</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="c1"># Copyright 2020-present by A. Mathis Group and contributors. All rights reserved.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="c1">#</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="c1"># This project and all its files are licensed under GNU AGPLv3 or later version. </span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="c1"># A copy is included in dlc2action/LICENSE.AGPL.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="c1">#</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">`dlc2action` is an action segmentation package that makes running and tracking experiments easy.</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd"># Usage</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="sd">`dlc2action` is designed to be modular.</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="sd">You can use the high-level project interface for convenient experiment management or just import a metric</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="sd">or an SSL module if you want more freedom. Here are some tutorials for using the package.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="sd">## Project</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="sd">Project is the class that can create and maintain configuration files and keep track of your experiments.</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">### Creating</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="sd">[creating]: #creating</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="sd">To start a new project, you can create a new `dlc2action.project.project.Project` instance in python.</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="sd">```python</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="sd">from dlc2action.project import Project</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="sd">project = Project(</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">    &#39;project_name&#39;,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">    data_type=&#39;data_type&#39;,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="sd">    annotation_type=&#39;annotation_type&#39;,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">    data_path=&#39;path/to/data/folder&#39;,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">    annotation_path=&#39;path/to/annotation/folder&#39;,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">)</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">```</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">Alternatively, if you have installed the package with pip, you can run a command in your terminal.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">```</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">$ dlc2action_init --name project_name -d data_type -a annotation_type -dp path/to/data_folder -ap path/to/annotation_folder</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">```</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">A new folder will be created at `projects_path/project_name` with all the necessary files. The default projects path is</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">a `DLC2Action` folder that will be created in your home directory.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">The project structure looks like this.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">```</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">.</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">project_name</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">├── config                                             # Settings files</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">├── meta                                               # Project meta files (experiment records)</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">├── saved_datasets                                     # Pre-computed dataset files</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">└── results</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">    ├── logs                                           # Training logs (human readable)</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">    │   └── episode.txt</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">    ├── models                                         # Model checkpoints</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">    │   └── episode</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">    │       ├── epoch25.pt</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">    │       └── epoch50.pt</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">    ├── searches                                       # Hyperparameter search results (graphs)</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">    │   └── search</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="sd">    │       ├── search_param_importances.html_docs</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="sd">    │       └── search_contour.html_docs</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">    ├── splits                                         # Split files</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="sd">    │       ├── time_25.0%validation_10.0%test.txt</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">    │       └── random_20.0%validation_10.0%test.txt</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">    ├── suggestions                                    # Suggestion and active learning files</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="sd">    │       └── active_learning</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">    │           ├── video1_suggestion.pickle</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="sd">    │           ├── video2_suggestion.pickle</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">    │           └── al_points.pickle</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">    └── predictions                                    # Prediction files (pickled dictionaries)</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">            ├── episode_epoch25.pickle</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">            └── episode_epoch50_newdata.pickle</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">```</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="sd">You can find a more detailed explanation of the structure at `dlc2action.project`.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">After the poprojectrject is created you can modify the</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">parameters manually in the `project_name/config` folder or with the `project.update_parameters()` function.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">Make sure to fill in all the fields marked with `???`.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">This can also be done through the terminal. With an `--all` flag the command will iterate through all parameters</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">and otherwise it will only ask you to fill in the `???` blanks.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">```</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">$ dlc2action_fill --name project_name --all</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">```</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">### Training</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a><span class="sd">[training]: #training</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">When you want to start your experiments, just create a `dlc2action.project.project.Project` instance again</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="sd">(or use the one you created</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="sd">to initialize the project). This time you don&#39;t have to set any parameters except the project name (and, if</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">you used it when creating the project, `projects_path`).</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">```python</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="sd">from dlc2action.project import Project</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">project = Project(&#39;project_name&#39;)</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="sd">```</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd">The first thing you will want to do is train some models. There are three ways to run a *training episode*</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">in `dlc2action`.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="sd">1. **Run a single episode**</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="sd">    ```python</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="sd">    project.run_episode(&#39;episode_1&#39;)</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="sd">    ```</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="sd">    We have now run a training episode with the default project parameters (read from the configuration files)</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="sd">    and saved it in the meta files under the name `episode_1`.</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="sd">2. **Run multiple episodes in a row**</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="sd">    ```python</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">    project.run_episodes([&#39;episode_2&#39;, &#39;episode_3&#39;, &#39;episode_4&#39;])</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">    ```</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">    That way the `dlc2action.task.universal_task.Task` instance will not be</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">    re-created every time, which might save you some time.</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">3. **Continue a previously run episode**</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">    ```python</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="sd">    project.continue_episode(&#39;episode_2&#39;, num_epochs=500)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">    ```</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">    In case you decide you want to continue an older episode, you can load all parameters and state dictionaries</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">    and set a new number of epochs. That way training will go on from where it has stopped and in the end the</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">    episode will be re-saved under the same name. Note that `num_epochs` denotes the **new total number of epochs**,</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="sd">    so if `episode_2` has already been trained for 300 epochs, for example, it will now run for 200 epochs more,</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">    not 500.</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">Of course, changing the default parameters every time you want to run a new configuration is not very convenient.</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">And, luckily, you don&#39;t have to do that. Instead you can add a `parameters_update` parameter to</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">`dlc2action.project.project.Project.run_episode` (or `parameters_updates` to</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">`dlc2action.project.project.Project.run_episodes`; all other parameters generalize to multiple episodes</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">in a similar way). The third</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="sd">function does not take many additional parameters since it aims to continue an experiment from exactly where</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">it ended.</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="sd">```python</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="sd">project.run_episode(</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="sd">    &#39;episode_5&#39;,</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">    parameters_update={</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">        &#39;general&#39;: {&#39;ssl&#39;: [&#39;contrastive&#39;]},</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">        &#39;ssl&#39;: {&#39;contrastive&#39;: {&#39;ssl_weight&#39;: 0.01}},</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">    },</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">```</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">In order to find the parameters you can modify, just open the *config* folder of your project and browse through</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">the files or call `dlc2action_fill` in your terminal (see [creating] section). The first-level keys</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">are the filenames without the extension (`&#39;augmentations&#39;`, `&#39;data&#39;`, `&#39;general&#39;`, `&#39;losses&#39;`,</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">`&#39;metrics&#39;`, `&#39;ssl&#39;`, `&#39;training&#39;`). Note that there are no</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">*model.yaml* or *features.yaml* files there for the `&#39;model&#39;` and `&#39;features&#39;` keys in the parameter</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">dictionaries. Those parameters are **read from the files in the *model* and *features* folders** that correspond</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">to the options you set in the `&#39;general&#39;` dictionary. For example, if at *general.yaml* `model_name` is set to</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">`&#39;ms_tcn3&#39;`, the `&#39;model&#39;` dictionary will be read from *model/ms_tcn3.yaml*.</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">If you want to create a new episode with modified parameters that loads a previously trained model, you can do that</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">by adding a `load_episode` parameter. By default we will load the last saved epoch, but you can also specify</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">which epoch you want with `load_epoch`. In that case the closest checkpoint will be chosen.</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">```python</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a><span class="sd">project.run_episode(</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">    &#39;episode_6&#39;,</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">    parameters_update={&#39;training&#39;: {&#39;batch_size&#39;: 64}},</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">    load_episode=&#39;episode_2&#39;,</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">    load_epoch=100,</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a><span class="sd">```</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">### Optimizing</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">`dlc2action` also has tools for easy hyperparameter optimization. We use the `optuna` auto-ML package to perform</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">the searches and then save the best parameters and the search graphs (contour and parameter importance).</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">The best parameters</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">can then be loaded when you are run an episode or saved as the defaults in the configuration files.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">To start a search, you need to run the `project.project.Project.run_hyperparameter_search` command. Let&#39;s</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">say we want to optimize for four parameters: overlap length, SSL task type, learning rate and</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">number of feature maps in the model. Here is the process</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">to figure out what we want to run.</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">1. **Find the parameter names**</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">    We look those parameters up in the config files and find them in *data.yaml*, *general.yaml*, *training.yaml*</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="sd">    and *models/ms_tcn3.yaml*,</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a><span class="sd">    respectively.</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="sd">    That means that our parameter names are `&#39;data/overlap&#39;`, `&#39;general/ssl&#39;`, `&#39;training/lr&#39;` and</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="sd">    `&#39;model/num_f_maps&#39;`.</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="sd">2. **Define the search space**</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">    There are five types of search spaces in `dlc2action`:</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">    - `int`: integer values (uniform sampling),</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">    - `int_log`: integer values (logarithmic scale sampling),</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="sd">    - `float`: float values (uniform sampling),</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">    - `float_log`: float values (logarithmic sampling),</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">    - `categorical`: choice between several values.</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="sd">    The first four are defined with their minimum and maximum value while `categorical` requires a list of</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">    possible values. So the search spaces are described with tuples that look either like</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">    `(search_space_type, min, max)` or like `(&quot;categorical&quot;, list_of_values)`.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">    We suspect that the optimal overlap is somewhere between 10 and 80 frames, SSL tasks should be either</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">    only contrastive or contrastive and masked_features together, sensible learning rate is between</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">    10&lt;sup&gt;-2&lt;/sup&gt; and 10&lt;sup&gt;-4&lt;/sup&gt; and the number of feature maps should be between 8 and 64.</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">    That makes our search spaces `(&quot;int&quot;, 10, 80)` for the overlap,</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">    `(&quot;categorical&quot;, [[&quot;contrastive&quot;], [&quot;contrastive&quot;, &quot;masked_features&quot;]])` for the SSL tasks,</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">    `(&quot;float_log&quot;, 1e-4, 1e-2)` for the learning rate and (&quot;int_log&quot;, 8, 64) for the feature maps.</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">3. **Choose the search parameters**</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">    You need to decide which metric you are optimizing for and for how many trials. Note that it has to be one</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">    of the metrics you are computing: check `metric_functions` at *general.yaml* and add your</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="sd">    metric if it&#39;s not there. The `direction` parameter determines whether this metric is minimized or maximized.</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">    The metric can also be averaged over a few of the most successful epochs (`average` parameter). If you want to</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">    use `optuna`&#39;s pruning feature, set `prune` to `True`.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">    You can also use parameter updates and load older experiments, as in the [training] section of this tutorial.</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">    Here we will maximize the recall averaged over 5 top epochs and run 50 trials with pruning.</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">Now we are ready to run!</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">```python</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">project.run_hyperparameter_search(</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">    search_space={</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">        &quot;data/overlap&quot;: (&quot;int&quot;, 10, 80),</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="sd">        &quot;general/ssl&quot;: (</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="sd">            &quot;categorical&quot;,</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">            [[&quot;contrastive&quot;], [&quot;contrastive&quot;, &quot;masked_features&quot;]]</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">        ),</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">        &quot;training/lr&quot;: (&quot;float_log&quot;: 1e-4, 1e-2),</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a><span class="sd">        &quot;model/num_f_maps&quot;: (&quot;int_log&quot;, 8, 64),</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">    },</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="sd">    metric=&quot;recall&quot;,</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">    n_trials=50,</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">    average=5,</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="sd">    search_name=&quot;search_1&quot;,</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="sd">    direction=&quot;maximize&quot;,</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">    prune=True,</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">```</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">After a search is finished, the best parameters are saved in the meta files and search graphs are saved at</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">*project_name/results/searches/search_1*. You can see the best parameters by running</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">`project.project.Project.list_best_parameters`:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">```python</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">project.list_best_parameters(&#39;search_1&#39;)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">```</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="sd">Those results can also be loaded in a training episode or saved in the configuration files directly.</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">```python</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">project.update_parameters(</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="sd">    load_search=&#39;search_1&#39;,</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">    load_parameters=[&#39;training/lr&#39;, &#39;model/num_f_maps&#39;],</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">    round_to_binary=[&#39;model/num_f_maps&#39;],</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">project.run_episode(</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">    &#39;episode_best_params&#39;,</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">    load_search=&#39;search_1&#39;,</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">    load_parameters=[&#39;data/overlap&#39;, &#39;general/ssl&#39;],</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a><span class="sd">```</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="sd">In this example we saved the learning rate and the number of feature maps in the configuration files and</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">loaded the other parameters to run</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">the `episode_best_params` training episode. Note how we used the `round_to_binary` parameter.</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">It will round the number of feature maps to the closest power of two (7 to 8, 35 to 32 and so on). This is useful</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">for parameters like the number of features or the batch size.</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">### Exploring results</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a><span class="sd">[exploring]: #exploring-results</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a><span class="sd">After you run a bunch of experiments you will likely want to get an overview.</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="sd">#### Visualization</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="sd">You can get a feeling for the predictions made by a model by running `project.project.Project.visualize_results`.</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="sd">```python</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="sd">project.visualize_results(&#39;episode_1&#39;, load_epoch=50)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="sd">```</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">This command will generate a prediction for a random sample and visualize it compared to the ground truth.</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="sd">There is a lot of parameters you can customize, check them out in the documentation).</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">Another available visualization type is training curve comparison with `project.project.Project.plot_episodes`.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="sd">You can compare different metrics and modes across several episode or within one. For example, this command</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">will plot the validation accuracy curves for the two episodes.</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a><span class="sd">```python</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">project.plot_episodes([&#39;episode_1&#39;, &#39;episode_2&#39;], metrics=[&#39;accuracy&#39;])</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">```</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="sd">And this will plot training and validation recall curves for `episode_3`.</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a><span class="sd">```python</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">project.plot_episodes([&#39;episode_3&#39;], metrics=[&#39;recall&#39;], modes=[&#39;train&#39;, &#39;val&#39;])</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">```</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a><span class="sd">You can also plot several episodes as one curve. That can be useful, for example, with episodes 2 and 6</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="sd">in our tutorial, since `episode_6` loaded the model from `episode_2`.</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="sd">```python</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a><span class="sd">project.plot_episodes([[&#39;episode_2&#39;, &#39;episode_6&#39;], &#39;episode_4&#39;], metrics=[&#39;precision&#39;])</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="sd">```</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="sd">#### Tables</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a><span class="sd">Alternatively, you can start analyzing your experiments by putting them in a table. You can get a summary of</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a><span class="sd">your training episodes with `project.project.Project.list_episodes`. It provides you with three ways to filter</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="sd">the data.</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="sd">1. **Episode names**</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="sd">    You can directly say which episodes you want to look at and disregard all others. Let&#39;s say we want to see</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">    episodes 1, 2, 3 and 4.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="sd">2. **Parameters**</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="sd">    In a similar fashion, you can choose to only display certain parameters. See all available parameters by</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">    running `project.list_episodes().columns`. Here we are only interested in the time of adding the record,</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">    the recall results and the learning rate.</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="sd">3. **Value filter**</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="sd">    The last option is to filter by parameter values. Filters are defined by strings that look like this:</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="sd">    `&#39;{parameter_name}::{sign}{value}&#39;`. You can use as many filters as ypu want and separate them with a comma.</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a><span class="sd">    The parameter names are the same as in point 2, the sign can be either</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a><span class="sd">    `&gt;`, `&gt;=`, `&lt;`, `&lt;=` or `=` and you choose the value. Let&#39;s say we want to only get the episodes that took</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="sd">    at least 30 minutes to train and got to a recall that is higher than 0.4. That translates to</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a><span class="sd">    `&#39;results/recall::&gt;0.4,meta/training_time::&gt;=00:30:00&#39;`.</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="sd">Putting it all together, we get this command.</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a><span class="sd">```python</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="sd">project.list_episodes(</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="sd">    episodes=[&#39;episode_1&#39;, &#39;episode_2&#39;, &#39;episode_3&#39;, &#39;episode_4&#39;],</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a><span class="sd">    display_parameters=[&#39;meta/time&#39;, &#39;results/recall&#39;, &#39;training/lr&#39;],</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a><span class="sd">    episode_filter=&#39;results/recall::&gt;0.4,meta/training_time::&gt;=00:30:00&#39;,</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a><span class="sd">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="sd">```</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="sd">There are similar functions for summarizing other history files: `project.project.Project.list_searches`,</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a><span class="sd">`project.project.Project.list_predictions`, `project.project.Project.list_suggestions` and they all follow the</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a><span class="sd">same pattern.</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a><span class="sd">### Making predictions</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a><span class="sd">When you feel good about one of the models, you can move on to making predictions. There are two ways to do that:</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="sd">generate pickled prediction dictionaries with `project.project.Project.run_prediction` or active learning</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="sd">and suggestion files for the [GUI] with `project.project.Project.run_suggestion`.</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">By default the predictions will be made for the entire dataset at the data path of the project. However, you</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="sd">can also choose to only make them for the training, validation or test subset (set with `mode` parameter) or</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">even for entirely new data (set with `data_path` parameter). Note that if you set the `data_path`</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">value, **the split</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">parameters will be disregarded** and `mode` will be forced to `&#39;all&#39;`!</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a><span class="sd">Here is an example of running these functions.</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">```python</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="sd">project.run_prediction(&#39;prediction_1&#39;, episode_name=&#39;episode_3&#39;, load_epoch=150, mode=&#39;test&#39;)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">project.run_suggestion(</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a><span class="sd">    &#39;suggestion_new_data&#39;,</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a><span class="sd">    suggestion_episode=&#39;episode_4&#39;,</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">    suggestion_classes=[&#39;sleeping&#39;, &#39;eating&#39;],</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a><span class="sd">    suggestion_threshold=0.6,</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a><span class="sd">    exclude_classes=[&#39;inactive&#39;],</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a><span class="sd">    data_path=&#39;/path/to/new_data_folder&#39;,</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a><span class="sd">)</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a><span class="sd">```</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a><span class="sd">The first command will generate a prediction dictionary with the model from epoch 150 of `episode_3` for the test</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a><span class="sd">subset of the project data (split according to the configuration files) and save it at</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a><span class="sd">*project_name/results/predictions/prediction_1.pickle*. The second command will create suggestion and active</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="sd">learning files for data at */path/to/new_data_folder* and save them at</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a><span class="sd">*project_name/results/suggestions/suggestion_new_data*. There is a lot of parameters you can tune here to</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="sd">get exactly what you need, so we really recommend reading the documentation of the</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="sd">`project.project.Project.run_suggestion` function before using it.</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">The history of prediction and suggestion runs is recorded and at the [exploring] section</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">we have described how to access it.</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="sd">[GUI]: https://github.com/amathislab/classic_annotation</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="sd"># Contribution</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a><span class="sd">Here you can learn how to add new elements to `dlc2action`.</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="sd">## Models</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="sd">[model]: #models</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a><span class="sd">Models in `dlc2action` are formalized as `model.base_model.Model` instances. This class inherits from</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="sd">`torch.nn.Module` but adds a more formalized structure and defines interaction with SSL modules.</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="sd">Note that **SSL modules and base models are added separately** to allow for &#39;mixing and matching&#39;, so make sure</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="sd">the model you want to add only predicts the target value.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a><span class="sd">The process to add a new model would be as follows.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a><span class="sd">1. **Separate your model into feature extraction and prediction**</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="sd">    If we want to add an SSL module to your module, where should it go? Everything up to that point is</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">    your feature extractor and everything after is the prediction generator.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="sd">2. **Write the modules**</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="sd">    Create a *{model_name}_modules.py* file at the *dlc2action/models* folder and write all necessary modules there.</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a><span class="sd">3. **Formalize input and output**</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a><span class="sd">    Make sure that your feature extraction and prediction generation modules accept a single input and return</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a><span class="sd">    a single output.</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="sd">4. **Write the model**</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="sd">    Create a *{model_name}.py* file at the *dlc2action/models* folder and write the code for the</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">    `model.base_model.Model` child class. The `model.base_model.Model._feature_extractor` and</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">    `model.base_model.Model._predictor` functions need to return your feature extraction and prediction</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">    generation modules, respectively. See the `model.ms_tcn` code for reference.</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">5. **Add options**</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">    Add your model to the `models` dictionary at `dlc2action.options`. Add</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a><span class="sd">    `{&#39;{model_name}.{class_name}.dump_patches&#39;: False, &#39;{model_name}.{class_name}.training&#39;: False}` to the</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">    `__pdoc__` dictionary at `dlc2action.model.__init__`.</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a><span class="sd">6. **Add config parameters**</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="sd">    Read the [config] explanation and add your parameters.</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">## SSL</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="sd">SSL tasks are formalized as `ssl.base_ssl.SSLConstructor` instances. Read the documentation at `ssl` to</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">learn more about this and follow the process.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">1. **Create a new file**</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">    Create a new file for your constructor at *dlc2action/ssl* and start defining a `ssl.base_ssl.SSLConstructor`</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="sd">    child class.</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a><span class="sd">2. **Determine the type of your task**</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="sd">    You can find the descriptions of available SSL types at `ssl.base_ssl.SSLConstructor`. If what you want to do</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="sd">    does not fit any of those types, you can add a new one. In that case you will have to modify the</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="sd">    `model.base_model`</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="sd">    code. More specifically, add the new name to the `available_ssl_types` variable and define the interaction</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">    at `model.base_model.Model.forward`. Set the `type` class variable to the type you decided on.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">3. **Define the data transformation**</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">    You need to write a function that will take a *feature dictionary* (see `feature_extraction`) as input</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">    and return SSL input and SSL target as output. Read more about that at `ssl`. The `transformation` method</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">    of your class should perform that function.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a><span class="sd">4. **Define the network module**</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a><span class="sd">    Take a look at `ssl.modules` and choose one of the existing modules or add your own. Remember that its</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a><span class="sd">     `forward` method has</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a><span class="sd">    to receive the output of a base model&#39;s feature extraction module (see the [model] tutorial for more details)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a><span class="sd">    as input and return a value that will go into the SSL loss function as output. Your class&#39;s `construct_module`</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="sd">    method needs to return an instance of this module.</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a><span class="sd">5. **Define the loss function**</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a><span class="sd">    Choose your loss at `dlc2action.loss` or add a new one.</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a><span class="sd">    If you do decide to add a new loss, see the [loss] tutorial.</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a><span class="sd">    Set the `loss` method of your class to apply this loss.</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="sd">6. **Add options**</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a><span class="sd">    Add your model to the `ssl_constructors` dictionary at `dlc2action.options` and set a default loss weight</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a><span class="sd">    in the `ssl_weights` dictionary at *training.yaml*.</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a><span class="sd">7. **Add config parameters**</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a><span class="sd">    Read the [config] explanation and add your parameters.</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a><span class="sd">## Datasets</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a><span class="sd">Datasets in `dlc2action` are defined through `data.base_store.InputStore` and `data.base_store.BehaviorStore`</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a><span class="sd">classes. Before you start, please read the documentation at `data` to learn more about the assumptions we make</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a><span class="sd">and the different classes involved in data processing. Then, follow these instructions.</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a><span class="sd">1. **Figure out what you need to add**</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a><span class="sd">    What are the data and annotation types of your dataset? Can you find either of them at `options.input_stores`</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="sd">    and `options.annotation_stores`? If so, you are in luck. If not, move on to have a look at `data.annotation_store`</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a><span class="sd">    and `data.input_store`. It&#39;s likely that the classes we already have already do most of what you need.</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a><span class="sd">    For annotation, in most cases it should be enough to inherit from `data.annotation_store.ActionSegmentationStore`</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a><span class="sd">    and only change the `data.annotation_store.ActionSegmentationStore._open_annotations` function. With input stores</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a><span class="sd">    it can be more complicated, but should definitely use implementations at `data.input_store` as an example.</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a><span class="sd">2. **Write the class**</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="sd">    Create a new class at either `data.input_store` or `data.annotation_store`, inherit from whatever is the closest</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="sd">    to what you need and implement all abstract functions.</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a><span class="sd">3. **Add options**</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a><span class="sd">    Add your store to `options.annotation_stores` or `options.input_stores`.</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="sd">4. **Add config parameters**</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a><span class="sd">    Read the [config] explanation and add your parameters.</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a><span class="sd">## Losses</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a><span class="sd">Adding a new loss is fairly straightforward since `dlc2action` uses `torch.nn.Module` instances as losses.</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a><span class="sd">1. **Write the class**</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a><span class="sd">    Add a new loss class inheriting from `torch.nn.Module` at `dlc2action.loss`. Add it to one of the existing</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a><span class="sd">    submodules or create a new one if it isn&#39;t a good fit for anything. Generally, the `forward` method of your</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a><span class="sd">    loss should take prediction and target tensors as input, in that order, and return a float value.</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">2. **Add options**</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">    If you want your new loss to be an option for the main loss function in training, you should add</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a><span class="sd">    it to the `dlc2action.options.losses` dictionary. Note that in that case it has to have the input and output</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="sd">    formats described above. If your loss expects input from a multi-stage model, like MS-TCN, add its name to</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="sd">    `dlc2action.options.losses_multistage` as well.</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a><span class="sd">3. **Add config parameters**</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a><span class="sd">    Read the [config] explanation and add your parameters.</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a><span class="sd">## Metrics</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="sd">All metrics in `dlc2action` inherit from `metric.base_metric.Metric`. They store internal parameters that get updated</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a><span class="sd">with each batch and are then used to compute the metric value. You need to write the functions for resetting the</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a><span class="sd">parameters, updating them and calculating the value.</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a><span class="sd">1. **Write the class**</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a><span class="sd">    Add a new class at `metric.metrics`, inheriting from `metric.base_metric.Metric` and write the three</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a><span class="sd">    abstract methods (read the documentation for details).</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a><span class="sd">2. **Add options**</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="sd">    Add your new metric to the `dlc2action.options.metrics` dictionary. Next, if it is supposed to decrease with</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a><span class="sd">    increasing prediction quality, add its name to the `dlc2action.options.metrics_minimize` list and if it does not</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a><span class="sd">    say anything about how good the predictions are, add it to `dlc2action.options.metrics_no_direction`.</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a><span class="sd">    If it increases when predictions get better, you don&#39;t need to do anything else.</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a><span class="sd">3. **Add config parameters**</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="sd">    If you added your loss to the options at the previous step, you also need to add it to the config files.</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">    Read the [config] explanation and do that.</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">## Feature extractors</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">Feature extractors in `dlc2action` are defined fairly loosely. You need to make a new class that inherits from</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">one of `feature_extraction.FeatureExtractor` subclasses (i.e. `feature_extraction.PoseFeatureExtractor`). Each</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a><span class="sd">of those subclasses are defined for a subclass of `data.base_store.InputStore` for a specific broad type of</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">data (i.e. `data.base_store.PoseInputStore` for pose estimation data).</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">When extracting the features, `data.base_store.InputStore` instances will pass a data dictionary to the feature</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">extractor and they will also contain the methods to extract information from that dictionary. You only</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">need to use that information (coordinates, list of body parts, number of frames and so on) to compute</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">some new features (distances, speeds, accelerations). Read the `feature_Extraction` documentation to find out more</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">about that. When you&#39;re done with reading you can start with those instructions.</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">1. **Write the class**</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">    Create a new class at `feature_extraction` that inherits from a `feature_extraction.FeatureExtractor` subclass.</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">    Look at the methods available for information extraction and write the `extract_features`</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">    function that will transform</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">    that information into some new features.</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">2. **Add a transformer**</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">    Since you&#39;ve added some new features, `dlc2action` does not know how to handle them when adding augmentations.</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">    You need to either create a new `transformer.base_transformer.Transformer` or modify an existing one to fix</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">    that. Read the [augmentations]</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a><span class="sd">    tutorial to find out how.</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">3. **Add options**</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a><span class="sd">    Add your feature extractor to `dlc2action.options.feature_extractors` and set the corresponding transformer</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="sd">    at `dlc2action.options.extractor_to_transformer`.</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="sd">3. **Add config parameters**</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a><span class="sd">    Read the [config] explanation and add your parameters.</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a><span class="sd">## Augmentations</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a><span class="sd">[augmentations]: #augmentations</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a><span class="sd">Augmentations in `dlc2action` are carried out by `transformer.base_transformer.Transformer` instances.</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a><span class="sd">Since they need to know how to handle different features, each transformer handles the output of specific</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a><span class="sd">`feature_extraction.FeatureExtractor` subclasses (only one transformer corresponds to each feature extractor,</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a><span class="sd">but each transformer can</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a><span class="sd">work with multiple feature extractors). Hence the instructions.</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a><span class="sd">1. **Figure out whether you need a new transformer**</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">    If the feature extractor you are interested in already has a corresponding transformer, you only need to</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a><span class="sd">    add a new method to that transformer. You can find which transformer you need at</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="sd">    `dlc2action.options.extractor_to_transformer`. If the feature extractor is new, it might still be enough to</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a><span class="sd">    modify an existing transformer. Take a look at `transformer` and see if any of the existing classes are close</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="sd">    enough to what you need. If they are not, you will have to create a new class.</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">2. **Add a new class** *(skip this step if you are not creating a new transformer)*</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">    If you did decide to create a new class, create a new *{transformer_name}.py* file at `dlc2action.transformer`</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">    and write it there, inheriting from `transformer.base_transformer.Transformer`.</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">3. **Add augmentation functions**</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">    Add new methods to your transformer class. Each method has to perform one augmentation, take</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="sd">    `(main_input: dict, ssl_inputs: list, ssl_targets: list)`</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="sd">    as input and return an output of the same format. Here `main_input` is a feature dictionary of the sample</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="sd">    data, `ssl_inputs` is a list of SSL input feature dictionaries and `ssl_targets` is a list of SSL target</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="sd">    feature dictionaries. The same augmentations are applied to all inputs if they are not `None` and</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="sd">    have feature keys that</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">    are recognized by your transformer.</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="sd">    When you are done writing the methods, add them with their names to the dictionary returned by</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">    `transformer.base_transformer.augmentations_dict`. If you think that your augmentation suits a very wide</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">    range of datasets, add its name to the list returned by `transformer.base_transformer.default_augmentations`</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">    as well.</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a><span class="sd">4. **Add options** *(skip this step if you are not creating a new transformer)*</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a><span class="sd">    Add your new transformer to `dlc2action.options.transformers`.</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a><span class="sd">5. **Add config parameters**</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a><span class="sd">    Read the [config] explanation and add your parameters.</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a><span class="sd">## Config files</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="sd">[config]: #config-files</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a><span class="sd">It is important to modify the config files when you add something new to `dlc2action` since it is supposed to</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="sd">mainly be used through the `project` interface that relies on the files being up-to-date.</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">To add configuration parameters for a new model, feature extractor,</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a><span class="sd">input or annotation store, create a new file in the *model*, *features*,</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a><span class="sd">*data* or *annotation* subfolder of *dlc2action/config*, respectively. If you are adding a new loss,</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a><span class="sd">metric or SSL constructor, add a new dictionary to the corresponding file</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="sd">at the same folder. **Make sure to use the same name as what you&#39;ve added to the options file.** Then just</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="sd">list all necessary parameters (use the same names as in the class signature), their default values</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a><span class="sd">and an explanation in the commentary.</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="sd">The commentary for every parameter has to start with its supposed type. Use one of `&#39;bool&#39;`, `&#39;int&#39;`, `&#39;float&#39;`,</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a><span class="sd">`&#39;str&#39;`, `&#39;list&#39;` or `&#39;set&#39;` or define a set of possible values with square brackets (e.g. `[&#39;pose&#39;, &#39;image&#39;]`).</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="sd">The type has to be followed with a semicolon and a short explanation. Please try to keep the explanations one line</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a><span class="sd">long. Here is an example:</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a><span class="sd">```</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a><span class="sd">frame_limit: 15 # int; tracklets shorter than this number of frames will be discarded</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a><span class="sd">```</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a><span class="sd">Note that if a parameter that you need is already defined at *dlc2action/config/general.yaml*, **it will be pulled</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="sd">automatically**, there is no need to add it to your new list of parameters. Just make sure that the name of the</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="sd">parameter in your class signature and at *general.yaml* is the same.</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a><span class="sd">In addition, there are also several *blanks* you can use to set the default parameters. Those *blanks*</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="sd">are filled at runtime after the dataset is created. Read more about them at the `project` documentation.</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a><span class="sd">When you are finished with defining the parameters, you should also describe them in the documentation (perhaps in</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">more detail) at the [options] section.</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd"># Options</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">[options]: #options</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">Here you can find an overview of the parameters currently available in the settings.</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">## Data types</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a><span class="sd"> - `&#39;dlc_tracklet&#39;`: DLC tracklet data,</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="sd"> - `&#39;dlc_track&#39;`: DLC track data,</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a><span class="sd">## Annotation types</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a><span class="sd"> - `&#39;dlc&#39;`: the classic_annotation GUI format,</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a><span class="sd"> - `&#39;boris&#39;`: BORIS format,</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="sd">## Data</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="sd">### Annotation</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">#### BORIS and DLC</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">- `behaviors: set` &lt;br /&gt;</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">    the set of string names of the behaviors to predict</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">- `annotation_suffix: set` &lt;br /&gt;</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="sd">    the set of string suffixes such that annotation file names have the format of</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a><span class="sd">    *{video_id}{annotation_suffix}*</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a><span class="sd">- `correction: dict` &lt;br /&gt;</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="sd">    a dictionary of label corrections where keys are the names to be replaced and values are the replacements</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="sd">    (e. g. `{&#39;sleping&#39;: &#39;sleeping&#39;, &#39;calm locomotion&#39;: &#39;locomotion&#39;}`)</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">- `error_class: str` &lt;br /&gt;</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">    a class denoting errors in pose estimation (the intervals annotated with this class will be ignored)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">- `min_frames_action: int` &lt;br /&gt;</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">    the minimum number of frames for an action (shorter actions will be discarded during training)</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">- `filter_annotated: bool` &lt;br /&gt;</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="sd">    if true, `dlc2action` will discard long unannotated intervals during training</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="sd">- `filter_background: bool` &lt;br /&gt;</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a><span class="sd">    if true, only label frames as background if a behavior is annotated somewhere close (in the same segment)</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">- `filter_visibility: bool` &lt;br /&gt;</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="sd">    if true, only label behaviors if there is suffucient visibility (a fraction of frames in a segment larger than</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="sd">    `visibility_min_frac` has visibility score larger than `visibility_min_score`; the visibility score is defined by</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a><span class="sd">    `data.base_store.InputStore` instances and should generally be from 0 to 1</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a><span class="sd">- `visibility_min_score: float` &lt;br /&gt;</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a><span class="sd">    the minimum visibility score for visibility filtering (generally from 0 to 1)</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a><span class="sd">- `visibility_min_frac: float` &lt;br /&gt;</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="sd">    the minimum fraction of visible frames for visibility filtering</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="sd">#### CalMS21</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="sd">No parameters</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a><span class="sd">### Input</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a><span class="sd">#### DLC track and tracklet</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a><span class="sd">- `data_suffix: set` &lt;br /&gt;</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="sd">    the set of suffices such that the data files have the format of *{video_id}{data_suffix}*</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="sd">- `data_prefix: set` &lt;br /&gt;</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">    a set of prefixes used in file names for different views such that the data files have the format</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="sd">    of *{data_prefix}{video_id}{data_suffix}*</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="sd">- `feature_suffix: str` &lt;br /&gt;</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">    the string suffix such that the precomputed feature files are named *{video_id}{feature_suffix}*;</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a><span class="sd">    the files should be either stored at `data_path` or included in `file_paths`</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a><span class="sd">- `contert_int_indices: bool` &lt;br /&gt;</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="sd">    if true, convert any integer key i in feature files to &#39;ind{i}&#39;</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="sd">- `canvas_shape: list` &lt;br /&gt;</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a><span class="sd">    the size of the canvas where the pose was defined</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="sd">- `len_segment: int` &lt;br /&gt;</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">    the length of segments (in frames) to cut the videos into</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">- `overlap: int` &lt;br /&gt;</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">    the overlap (in frames) between neighboring segments</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="sd">- `ignored_bodyparts: set` &lt;br /&gt;</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">    the set of string names of bodyparts to ignore</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">- `default_agent_name: str` &lt;br /&gt;</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">    the default agent name used in pose file generation</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">- `frame_limit: int` (only for tracklets) &lt;br /&gt;</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">    tracklets shorter than this number of frames will be discarded</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">#### CalMS21</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">- `len_segment: int` &lt;br /&gt;</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="sd">    the length of segments (in frames) to cut the videos into</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="sd">- `overlap: int` &lt;br /&gt;</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">    the overlap (in frames) between neighboring segments</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="sd">- `load_unlabeled: bool` &lt;br /&gt;</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">    if true, unlabeled data will be loaded</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">- `file_prefix: str` &lt;br /&gt;</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a><span class="sd">    the prefix such that the data files are named {prefix}train.npy and {prefix}test.npy</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">### Features</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">#### Kinematic</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a><span class="sd">- `interactive: bool` &lt;br /&gt;</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a><span class="sd">    if true, features are computed for pairs of clips (agents)</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="sd">- `keys: set` &lt;br /&gt;</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a><span class="sd">    the keys to include</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="sd">    (a subset of `{&quot;coords&quot;, &quot;intra_distance&quot;, &quot;speed_joints&quot;, &quot;angle_joints_radian&quot;, &quot;acc_joints&quot;, &quot;inter_distance&quot;}`</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="sd">    where</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="sd">    - `&#39;coords&#39;` is the raw coordinates,</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">    - `&#39;intra_distance&#39;` is the distances between all pairs of keypoints,</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">    - `&#39;speed_joints&#39;` is the approximated vector speeds of all keypoints,</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="sd">    - `&#39;angle_joints_radian&#39;` is the approximated angular speeds of all keypoints,</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">    - `&#39;acc_joints&#39;` is the approximated accelerations of all keypoints,</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">    - `&#39;inter_distance&#39;` is the distance between all pairs of keypoints where the points belong to different agents</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">        (used if `interactive` is true))</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">## Augmentations</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">### Kinematic</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">- `augmentations: set` &lt;br /&gt;</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">    a list of augmentations (a subset of `{&#39;rotate&#39;, &#39;mask&#39;, &#39;add_noise&#39;, &#39;shift&#39;, &#39;zoom&#39;, &#39;mirror&#39;}`)</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">- `use_default_augmentations: bool` &lt;br /&gt;</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="sd">    if true, the default augmentation list will be used (`[&#39;mirror&#39;, &#39;shift&#39;, &#39;add_noise&#39;]`)</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="sd">- `rotation_limits: list` &lt;br /&gt;</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="sd">    list of float rotation angle limits ([low, high]; default [-pi/2, pi/2])</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="sd">- `mirror_dim: set` &lt;br /&gt;</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">    set of integer dimension indices that can be mirrored</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a><span class="sd">- `noise_std: float` &lt;br /&gt;</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="sd">    standard deviation of added noise</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a><span class="sd">- `zoom_limits: list` &lt;br /&gt;</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a><span class="sd">    list of float zoom limits ([low, high]; default [0.5, 1.5])</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a><span class="sd">- `masking_probability: float` &lt;br /&gt;</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a><span class="sd">    the probability of masking a joint</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a><span class="sd">## Model</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="sd">### MS-TCN3</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="sd">- num_layers_PG: int` &lt;br /&gt;</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a><span class="sd">    number of layers in prediction generation stage</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a><span class="sd">- num_layers_R: int` &lt;br /&gt;</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a><span class="sd">    number of layers in refinement stages</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a><span class="sd">- `num_R: int` &lt;br /&gt;</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a><span class="sd">    number of refinement stages</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a><span class="sd">- `num_f_maps: int` &lt;br /&gt;</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a><span class="sd">    number of feature maps</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a><span class="sd">- `dims: int` &lt;br /&gt;</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a><span class="sd">    number of input features (set to &#39;dataset_features&#39; to get the number from</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a><span class="sd">    `dlc2action.data.dataset.BehaviorDataset.dataset_features()`)</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a><span class="sd">- `dropout_rate: float` &lt;br /&gt;</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a><span class="sd">    dropout rate</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a><span class="sd">- `skip_connections_refinement: bool` &lt;br /&gt;</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a><span class="sd">    if true, skip connections are added to the refinement stages</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a><span class="sd">- `block_size_prediction: int` &lt;br /&gt;</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a><span class="sd">    if not null, skip connections are added to the prediction generation stage with this interval</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a><span class="sd">- `direction_R: str` &lt;br /&gt;</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a><span class="sd">    causality of refinement stages; choose from:</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="sd">    - `None`: no causality,</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a><span class="sd">    - `bidirectional`: a combination of forward and backward networks,</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">    - `forward`: causal,</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a><span class="sd">    - `backward`: anticausal</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a><span class="sd">- `direction_PG: str` &lt;br /&gt;</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a><span class="sd">    causality of refinement stages (see `direction_R`)</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a><span class="sd">- `shared_weights: bool` &lt;br /&gt;</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a><span class="sd">    if `True``, weights are shared across refinement stages</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="sd">- `block_size_refinement: int` &lt;br /&gt;</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a><span class="sd">    if not 0, skip connections are added to the refinement stage with this interval</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a><span class="sd">- `PG_in_FE: bool` &lt;br /&gt;</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a><span class="sd">    if `True`, the prediction generation stage is included in the feature extractor</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a><span class="sd">- `rare_dilations: bool` &lt;br /&gt;</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a><span class="sd">    if `True`, dilation increases with layer less often</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a><span class="sd">- `num_heads: int` &lt;br /&gt;</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a><span class="sd">    the number of parallel refinement stages</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="sd">## General</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a><span class="sd">- `model_name: str` &lt;br /&gt;</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="sd">    model name; choose from:</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="sd">     - `&#39;ms_tcn3&#39;`: the original MS-TCN++ model with options to share weights across refinement stages or</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="sd">        add skip connections.</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="sd">- `num_classes: int` &lt;br /&gt;</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="sd">    number of classes (set to &#39;dataset_num_classes&#39; to get the number from</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">    `dlc2action.data.dataset.BehaviorDataset.num_classes()`)</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">- `exclusive: bool` &lt;br /&gt;</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">    if true, single-label classification is used; otherwise multi-label</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="sd">- `ssl: set` &lt;br /&gt;</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a><span class="sd">    a set of SSL types to use; choose from:</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="sd">     - `&#39;contrastive&#39;`: contrastive SSL with NT-Xent loss,</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a><span class="sd">     - `&#39;pairwise&#39;`: pairwise comparison SSL with triplet or circle loss,</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a><span class="sd">     - `&#39;masked_features&#39;`: prediction of randomly masked features with MSE loss,</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a><span class="sd">     - `&#39;masked_frames&#39;`: prediction of randomly masked frames with MSE loss,</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a><span class="sd">     - `&#39;masked_joints&#39;`: prediction of randomly masked joints with MSE loss,</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a><span class="sd">     - `&#39;masked_features_tcn&#39;`: prediction of randomly masked features with MSE loss and a TCN module,</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a><span class="sd">     - `&#39;masked_frames_tcn&#39;`: prediction of randomly masked frames with MSE loss and a TCN module,</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a><span class="sd">     - `&#39;masked_joints_tcn&#39;`: prediction of randomly masked joints with MSE loss and a TCN module</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a><span class="sd">- `metric_functions: set` &lt;br /&gt;</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a><span class="sd">    set of metric names; choose from:</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a><span class="sd">     - `&#39;recall&#39;`: frame-wise recall,</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="sd">     - `&#39;segmental_recall&#39;`: segmental recall,</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a><span class="sd">     - `&#39;precision&#39;`: frame-wise precision,</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a><span class="sd">     - `&#39;segmental_precision&#39;`: segmental precision,</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="sd">     - `&#39;f1&#39;`: frame-wise F1 score,</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">     - `&#39;segmental_f1&#39;`: segmental F1 score,</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">     - `&#39;edit_distance&#39;`: edit distance (as a fraction of length of segment),</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">     - `&#39;count&#39;`: the fraction of predictions labeled with a specific behavior</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">- `loss_function: str` &lt;br /&gt;</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">    name of loss function; choose from:</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">     - `&#39;ms_tcn&#39;`: a loss designed for the MS-TCN network; cross-entropy + MSE for consistency</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">- `feature_extraction: str` &lt;br /&gt;</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">    the feature extraction method; choose from:</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">     - `&#39;kinematic&#39;`: extracts distances, speeds and accelerations for pose estimation data</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a><span class="sd">- `only_load_annotated: bool` &lt;br /&gt;</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a><span class="sd">    if true, the input files that don&#39;t have a matching annotation file will be disregarded</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="sd">- `ignored_clips: set` &lt;br /&gt;</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a><span class="sd">    a set of string clip ids (agent names) to be ignored</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">## Losses</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="sd">### MS_TCN</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">- `weights: list` &lt;br /&gt;</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a><span class="sd">    list of weights for weighted cross-entropy</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">- `focal: bool` &lt;br /&gt;</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">    if True, focal loss will be used</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="sd">- `gamma: float` &lt;br /&gt;</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a><span class="sd">    the gamma parameter of focal loss</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="sd">- `alpha: float` &lt;br /&gt;</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="sd">    the weight of consistency loss</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a><span class="sd">## Metrics</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a><span class="sd">### Recall, precision and F1 score (segmental and not)</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a><span class="sd">- `main_class: int` &lt;br /&gt;</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a><span class="sd">    if not null, recall will only be calculated for main_class</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a><span class="sd">- `average: str` &lt;br /&gt;</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">    averaging method; choose from `&#39;macro&#39;`, `&#39;micro&#39;` or `&#39;none&#39;`</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a><span class="sd">- `ignored_classes: set` &lt;br /&gt;</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">    a set of class ids to ignore in calculation</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a><span class="sd">- `iou_threshold: float` (only for segmental metrics) &lt;br /&gt;</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a><span class="sd">    intervals with IoU larger than this threshold are considered correct</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">### Count</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a><span class="sd">- `classes: set` &lt;br /&gt;</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="sd">    a set of the class indices to count the occurrences of</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="sd">## SSL</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a><span class="sd">### Contrastive</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a><span class="sd">- `ssl_features: int` &lt;br /&gt;</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a><span class="sd">    length of clip feature vectors</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="sd">- `tau: float` &lt;br /&gt;</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a><span class="sd">    tau (NT-Xent loss parameter)</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a><span class="sd">- `len_segment: int` &lt;br /&gt;</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="sd">    length of the segments that enter the SSL module</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a><span class="sd">- `num_f_maps: list` &lt;br /&gt;</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a><span class="sd">    shape of the segments that enter the SSL module</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="sd">### Pairwise</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="sd">- `ssl_features: int` &lt;br /&gt;</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a><span class="sd">    length of clip feature vectors</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="sd">- `margin: float` &lt;br /&gt;</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a><span class="sd">    margin (triplet loss parameter)</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="sd">- `distance: str` &lt;br /&gt;</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="sd">    either &#39;cosine&#39; or &#39;euclidean&#39;</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="sd">- `loss: str` &lt;br /&gt;</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">    either &#39;triplet&#39; or &#39;circle&#39;</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a><span class="sd">- `gamma: float` &lt;br /&gt;</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="sd">    gamma (triplet and circle loss parameter)</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a><span class="sd">- `len_segment: int` &lt;br /&gt;</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a><span class="sd">    length of the segments that enter the SSL module</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="sd">- `num_f_maps: list` &lt;br /&gt;</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="sd">    shape of the segments that enter the SSL module</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="sd">### Masked joints, features and frames</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">- `frac_masked: float` &lt;br /&gt;</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">    fraction of features to be masked</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">- `num_ssl_layers: int` &lt;br /&gt;</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="sd">    number of layers in the SSL module</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a><span class="sd">- `num_ssl_f_maps: int` &lt;br /&gt;</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a><span class="sd">    number of feature maps in the SSL module</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a><span class="sd">- `dims: int` &lt;br /&gt;</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a><span class="sd">    number of features per frame in original input data</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a><span class="sd">- `num_f_maps: list` &lt;br /&gt;</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a><span class="sd">    shape of the segments that enter the SSL module</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="sd">### Contrastive masked</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="sd">- `ssl_features: int` &lt;br /&gt;</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="sd">    length of clip feature vectors</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="sd">- `tau: float` &lt;br /&gt;</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="sd">    tau (NT-Xent loss parameter)</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="sd">- `len_segment: int` &lt;br /&gt;</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="sd">    length of the segments that enter the SSL module</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a><span class="sd">- `num_f_maps: list` &lt;br /&gt;</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="sd">    shape of the segments that enter the SSL module</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a><span class="sd">- `num_masked: int` &lt;br /&gt;</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a><span class="sd">    number of frames to mask</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a><span class="sd">## Training</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a><span class="sd">- `lr: float` &lt;br /&gt;</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="sd">    learning rate</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a><span class="sd">- `device: str` &lt;br /&gt;</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a><span class="sd">    device name (recognized by `torch`)</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="sd">- `verbose: bool` &lt;br /&gt;</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="sd">    print training process</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="sd">- `augment_train: int` &lt;br /&gt;</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="sd">    either 1 to use augmentations during training or 0 to not use</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">- `augment_val: int` &lt;br /&gt;</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">    number of augmentations to average over at validation</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="sd">- `ssl_weights: dict` &lt;br /&gt;</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">    dictionary of SSL loss function weights (keys are SSL names, values are weights)</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="sd">- `num_epochs: int` &lt;br /&gt;</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a><span class="sd">    number of epochs</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a><span class="sd">- `to_ram: bool` &lt;br /&gt;</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a><span class="sd">    transfer the dataset to RAM for training (preferred if the dataset fits in working memory)</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a><span class="sd">- `batch_size: int` &lt;br /&gt;</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a><span class="sd">    batch size</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a><span class="sd">- `freeze_features: bool` &lt;br /&gt;</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a><span class="sd">    freeze the feature extractor parameters</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a><span class="sd">- `ignore_tags: bool` &lt;br /&gt;</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a><span class="sd">    ignore meta tags (meta tags are generated by some datasets and used by some models and can contain</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="sd">    information such as annotator id); when `True`, all meta tags are set to `None`</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="sd">- `model_save_epochs: int` &lt;br /&gt;</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="sd">    interval for saving training checkpoints (the last epoch is always saved)</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="sd">- `use_test: float` &lt;br /&gt;</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a><span class="sd">    the fraction of the test dataset to use in training without labels (for SSL tasks)</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="sd">- `partition_method: str`  &lt;br /&gt;</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="sd">    the train/test/val partitioning method; choose from:</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="sd">    - `&#39;random&#39;`: sort videos into subsets randomly,</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="sd">    - `&#39;random:test-from-name&#39;` (or `&#39;random:test-from-name:{name}&#39;`): sort videos into training and validation</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a><span class="sd">        subsets randomly and create</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="sd">        the test subset from the video ids that start with a speific substring (`&#39;test&#39;` by default, or `name`</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="sd">        if provided),</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="sd">    - `&#39;random:equalize:segments&#39;` and `&#39;random:equalize:videos&#39;`: sort videos into subsets randomly but</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="sd">        making sure that for the rarest classes at least `0.8 * val_frac` of the videos/segments that contain</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a><span class="sd">        occurrences of the class get into the validation subset and `0.8 * test_frac` get into the test subset;</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="sd">        this in ensured for all classes in order of increasing number of occurrences until the validation and</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a><span class="sd">        test subsets are full</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a><span class="sd">    - `&#39;val-from-name:{val_name}:test-from-name:{test_name}&#39;`: create the validation and test</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a><span class="sd">        subsets from the video ids that start with specific substrings (`val_name` for validation</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a><span class="sd">        and `test_name` for test) and sort all other videos into the training subset</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a><span class="sd">    - `&#39;folders&#39;`: read videos from folders named *test*, *train* and *val* into corresponding subsets,</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a><span class="sd">    - `&#39;time&#39;`: split each video into training, validation and test subsequences,</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a><span class="sd">    - `&#39;time:strict&#39;`: split each video into validation, test and training subsequences</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a><span class="sd">        and throw out the last segment in validation and test (to get rid of overlaps),</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a><span class="sd">    - `&#39;file&#39;`: split according to a split file.</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a><span class="sd">- `val_frac: float` &lt;br /&gt;</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a><span class="sd">    fraction of dataset to use as validation</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a><span class="sd">- `test_frac: float` &lt;br /&gt;</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a><span class="sd">    fraction of dataset to use as test</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a><span class="sd">- `split_path: str` &lt;br /&gt;</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a><span class="sd">    path to the split file (**only used when partition_method is `&#39;file&#39;`,</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="sd">    otherwise disregarded and filled automatically**)</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">dlc2action.version</span><span class="w"> </span><span class="kn">import</span> <span class="n">__version__</span><span class="p">,</span> <span class="n">VERSION</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="n">__pdoc__</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;scripts&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span></pre></div>


            </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>